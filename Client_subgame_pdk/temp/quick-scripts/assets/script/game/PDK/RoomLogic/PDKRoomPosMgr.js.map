{"version":3,"sources":["PDKRoomPosMgr.js"],"names":["app","require","PDKRoomPosMgr","BaseClass","extend","Init","JS_Name","subGameName","toUpperCase","ComTool","ShareDefine","WeChatManager","OnReload","Log","dataInfo","clientPos","downPos","upPos","facePos","posCount","OnInitRoomPosData","roomPosInfoList","heroImageUrlDict","heroID","GetHeroID","length","index","roomPosInfo","pos","pid","headImageUrl","InitHeroHeadImageByDict","GetRoomPlayerCount","UpdateOwnerID","ownerID","OnPosLeave","playerInfo","ErrLog","OnPosUpdate","posInfo","InitHeroHeadImage","OnPosIsReady","isReady","isCardReady","OnPosReadyChg","roomReady","OnPosContinueGame","OnSetEnd","setEnd","pointList","lostCardList","sportsPoint","sp","parseFloat","toFixed","addSp","sportsPointList","totalSp","real","addReal","totalReal","OnSportsPointChange","serverPack","posId","GetPlayerReadyState","roomSetID","ReadyState","GetPlayerInfoByPos","SetPlayerOfflineState","isLostConnect","isShowLeave","hasOwnProperty","GetRoomAllPlayerInfo","GetPlayerInfoByPid","i","GetClientPos","GetClientUpPos","GetClientDownPos","GetClientFacePos","GetPosCount","GetUIPosByDataPos","dataPos","playerCount","uiPos","gameScene","LocalDataManager","GetConfigProperty","g_PDKRoomPosMgr","exports","GetModel"],"mappings":"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","file":"PDKRoomPosMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\script\\game\\PDK\\RoomLogic","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package SSSRoomPosMgr.js\r\n *  @todo: 拼罗松房间\r\n *\r\n *  @author hongdian\r\n *  @date 2014-10-30 16:04\r\n *  @version 1.0\r\n *\r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *\r\n */\r\nvar app = require('pdk_app');\r\n\r\n/**\r\n * 类构造\r\n */\r\nvar PDKRoomPosMgr = app.BaseClass.extend({\r\n\r\n    /**\r\n     * 初始化\r\n     */\r\n    Init: function () {\r\n\r\n        this.JS_Name = app.subGameName.toUpperCase() + \"RoomPosMgr\";\r\n\r\n        this.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n        this.WeChatManager = app[app.subGameName + \"_WeChatManager\"]();\r\n\r\n        // S2228_LostConnect\r\n        this.OnReload();\r\n\r\n        this.Log(\"Init\");\r\n\r\n\r\n    },\r\n\r\n    OnReload: function () {\r\n\r\n        this.dataInfo = {};\r\n\r\n        this.clientPos = -1;\r\n        this.downPos = -1;\r\n        this.upPos = -1;\r\n        this.facePos = -1;\r\n        this.posCount = -1;\r\n    },\r\n\r\n\r\n    //-----------------------回调函数-----------------------------\r\n    OnInitRoomPosData: function (roomPosInfoList) {\r\n        this.dataInfo = {};\r\n\r\n        this.clientPos = -1;\r\n        this.downPos = -1;\r\n        this.upPos = -1;\r\n        this.facePos = -1;\r\n        this.posCount = -1;\r\n        let heroImageUrlDict = {};\r\n        let heroID = app[app.subGameName + \"_HeroManager\"]().GetHeroID();\r\n        this.posCount = roomPosInfoList.length;\r\n\r\n        for (let index = 0; index < this.posCount; index++) {\r\n            let roomPosInfo = roomPosInfoList[index];\r\n            let pos = roomPosInfo[\"pos\"];\r\n            this.dataInfo[pos] = roomPosInfo;\r\n\r\n            let pid = roomPosInfo[\"pid\"];\r\n            let headImageUrl = roomPosInfo[\"headImageUrl\"];\r\n            if (pid == heroID) {\r\n                this.clientPos = pos;\r\n            }\r\n            if (pid && headImageUrl) {\r\n                heroImageUrlDict[pid] = headImageUrl;\r\n            }\r\n        }\r\n\r\n        this.WeChatManager.InitHeroHeadImageByDict(heroImageUrlDict);\r\n        // if(this.clientPos < 0){\r\n        // \tthis.ErrLog(\"OnInitRoomPosData clientPos not find\");\r\n        // }\r\n        // else{\r\n        // \tlet posNum = 4;\r\n        // \tif(this.posCount != 2){\r\n        // \t\tthis.upPos = (this.clientPos + posNum - 1)%posNum;\r\n        // \t\tthis.downPos = (this.clientPos + 1)%posNum;\r\n        // \t\tthis.facePos = (this.clientPos + 2)%posNum;\r\n\r\n        // \t}\r\n        // \telse\r\n        // \t\tthis.facePos = this.clientPos == 0 ? 1 : 0;\r\n\r\n        // \tthis.Log(\"upPos(%s) clientPos(%s) downPos(%s) facePos(%s)\", this.upPos, this.clientPos, this.downPos, this.facePos);\r\n        // }\r\n\r\n        this.upPos = (this.clientPos + this.posCount - 1) % this.posCount;\r\n        this.downPos = (this.clientPos + 1) % this.posCount;\r\n        this.facePos = (this.clientPos + 2) % this.posCount;\r\n\r\n        this.Log(\"OnInitRoomPosData:\", this.dataInfo)\r\n    },\r\n    //获取房间有几个玩家\r\n    GetRoomPlayerCount: function () {\r\n        return this.posCount;\r\n    },\r\n    UpdateOwnerID: function (ownerID) {\r\n        this.dataInfo['ownerID'] = ownerID;\r\n    },\r\n\r\n    OnPosLeave: function (pos) {\r\n        let playerInfo = this.dataInfo[pos];\r\n        if (!playerInfo) {\r\n            this.ErrLog(\"OnPosLeave not find:%s\", pos);\r\n            return\r\n        }\r\n        playerInfo[\"pid\"] = 0;\r\n        playerInfo[\"name\"] = 0;\r\n        playerInfo[\"roomReady\"] = false;\r\n        playerInfo[\"gameReady\"] = false;\r\n        playerInfo[\"giveUpGame\"] = 0;\r\n        playerInfo[\"point\"] = 0;\r\n        playerInfo[\"realPoint\"] = 0;\r\n        playerInfo[\"flashCnt\"] = 0;\r\n        playerInfo[\"paiPin\"] = 0;\r\n        playerInfo[\"up\"] = 0;\r\n        playerInfo[\"down\"] = 0;\r\n    },\r\n\r\n\r\n    //座位信息更新\r\n    OnPosUpdate: function (pos, posInfo) {\r\n        let playerInfo = this.dataInfo[pos];\r\n        if (!playerInfo) {\r\n            this.Log(\"OnPosUpdate not find:%s\", pos);\r\n            return false\r\n        }\r\n        this.dataInfo[pos] = posInfo;\r\n\r\n        let heroID = posInfo[\"pid\"];\r\n        let headImageUrl = posInfo[\"headImageUrl\"];\r\n        if (heroID && headImageUrl) {\r\n            this.WeChatManager.InitHeroHeadImage(heroID, headImageUrl);\r\n        }\r\n\r\n        return true\r\n    },\r\n\r\n    OnPosIsReady: function (pos, isReady) {\r\n        let playerInfo = this.dataInfo[pos];\r\n        if (!playerInfo) {\r\n            this.Log(\"onPosTotalJifen not find:%s\", pos);\r\n            return false\r\n        }\r\n        playerInfo.isCardReady = isReady;\r\n\r\n    },\r\n\r\n    //开局准备\r\n    OnPosReadyChg: function (pos, roomReady) {\r\n        let playerInfo = this.dataInfo[pos];\r\n        if (!playerInfo) {\r\n            this.Log(\"OnPosReadyChg not find:%s\", pos);\r\n            return false\r\n        }\r\n        playerInfo[\"roomReady\"] = roomReady;\r\n\r\n        return true\r\n    },\r\n\r\n    //准备下一句\r\n    OnPosContinueGame: function (pos) {\r\n        let playerInfo = this.dataInfo[pos];\r\n        if (!playerInfo) {\r\n            this.ErrLog(\"OnPosContinueGame not find:%s\", pos);\r\n            return\r\n        }\r\n        playerInfo[\"gameReady\"] = true;\r\n    },\r\n\r\n    OnSetEnd: function (setEnd) {\r\n        //清除准备状态\r\n        for (let pos in this.dataInfo) {\r\n            let playerInfo = this.dataInfo[pos];\r\n            playerInfo[\"gameReady\"] = false;\r\n            playerInfo[\"point\"] += setEnd.pointList[pos];\r\n            if (setEnd.lostCardList) {\r\n                playerInfo[\"loseCardCount\"] = setEnd.lostCardList[pos]\r\n            }\r\n            this.dataInfo[pos]['point'] = playerInfo[\"point\"];\r\n            //比赛分\r\n            if (typeof (playerInfo.sportsPoint) != \"undefined\") {\r\n                let sp = parseFloat(playerInfo[\"sportsPoint\"]).toFixed(2);\r\n                let addSp = parseFloat(setEnd.sportsPointList[pos]).toFixed(2);\r\n                let totalSp = parseFloat(sp) + parseFloat(addSp);\r\n                //保留小数点后面两位\r\n                playerInfo[\"sportsPoint\"] = totalSp.toFixed(2);\r\n                this.dataInfo[pos]['sportsPoint'] = totalSp.toFixed(2);\r\n\r\n\r\n                let real = parseFloat(playerInfo[\"realPoint\"]).toFixed(2);\r\n                let addReal = parseFloat(setEnd.sportsPointList[pos]).toFixed(2);\r\n                let totalReal = parseFloat(real) + parseFloat(addReal);\r\n                playerInfo[\"realPoint\"] = totalReal.toFixed(2);\r\n            }\r\n        }\r\n        // this.OnPoint(setEnd.pointList);\r\n    },\r\n    //更新积分，如果是断线重连不需要增加分数，直接同步服务端的分数就好\r\n    // OnPoint:function(pointList, isReconnect = false){\r\n    // \tfor(let pos in this.dataInfo){\r\n    // \t\tlet playerInfo = this.dataInfo[pos];\r\n    // \t\tif(isReconnect){\r\n    // \t\t\tplayerInfo[\"point\"] = pointList[pos].point;\r\n    // \t\t}\r\n    // \t\telse{\r\n    // \t\t\tplayerInfo[\"point\"] += pointList[pos];\r\n    // \t\t}\r\n    // \t}\r\n    // },\r\n    OnSportsPointChange: function (serverPack) {\r\n        //同步更新比赛分\r\n        for (let pos in this.dataInfo) {\r\n            let playerInfo = this.dataInfo[pos];\r\n            if (pos == serverPack.posId &&\r\n                playerInfo.pid == serverPack.pid) {\r\n                let sp = parseFloat(playerInfo[\"sportsPoint\"]).toFixed(2);\r\n                let addSp = parseFloat(serverPack.sportsPoint).toFixed(2);\r\n                let totalSp = parseFloat(sp) + parseFloat(addSp);\r\n                //保留小数点后面两位\r\n                playerInfo[\"sportsPoint\"] = totalSp.toFixed(2);\r\n                this.dataInfo[pos]['sportsPoint'] = totalSp.toFixed(2);\r\n            }\r\n        }\r\n    },\r\n    //-------------------------获取接口---------------------\r\n    //获取客户端玩家准备状态\r\n    GetPlayerReadyState: function (roomSetID) {\r\n        let ReadyState = \"\";\r\n        if (roomSetID > 0) {\r\n            ReadyState = \"gameReady\";\r\n        } else {\r\n            ReadyState = \"roomReady\";\r\n        }\r\n        return this.GetPlayerInfoByPos(this.clientPos)[ReadyState];\r\n    },\r\n\r\n    //设置玩家离线状态\r\n    SetPlayerOfflineState: function (pos, isLostConnect, isShowLeave) {\r\n        if (!this.dataInfo.hasOwnProperty(pos)) {\r\n            this.ErrLog(\"SetPlayerOfflineState not find:%s\", pos);\r\n            return\r\n        }\r\n        this.dataInfo[pos][\"isLostConnect\"] = isLostConnect;\r\n        this.dataInfo[pos][\"isShowLeave\"] = isShowLeave;\r\n    },\r\n\r\n    //获取房间所有玩家信息\r\n    GetRoomAllPlayerInfo: function () {\r\n        return this.dataInfo\r\n    },\r\n\r\n    GetPlayerInfoByPid: function (pid) {\r\n        for (let i in this.dataInfo) {\r\n            if (pid == this.dataInfo[i].pid)\r\n                return this.dataInfo[i];\r\n        }\r\n        return null;\r\n    },\r\n\r\n    //获取房间指定位置玩家信息\r\n    GetPlayerInfoByPos: function (pos) {\r\n        if (!this.dataInfo.hasOwnProperty(pos)) {\r\n            this.ErrLog(\"GetPlayerInfoByPos(%s) not find\", pos);\r\n            return\r\n        }\r\n        return this.dataInfo[pos];\r\n    },\r\n\r\n    //获取客户端玩家的座位\r\n    GetClientPos: function () {\r\n        return this.clientPos\r\n    },\r\n\r\n    //获取客户端玩家的上家位置ID\r\n    GetClientUpPos: function () {\r\n        return this.upPos\r\n    },\r\n\r\n    //获取客户端玩家下家位置ID\r\n    GetClientDownPos: function () {\r\n        return this.downPos\r\n    },\r\n\r\n    //获取客户端玩家对家位置ID\r\n    GetClientFacePos: function () {\r\n        return this.facePos\r\n    },\r\n\r\n    //获取开设房间位置的数量\r\n    GetPosCount: function () {\r\n        return this.posCount;\r\n    },\r\n\r\n    //服务端位置转客户端位置\r\n    GetUIPosByDataPos: function (dataPos) {\r\n        let playerCount = this.posCount;\r\n        let uiPos = (dataPos + (playerCount - this.clientPos)) % playerCount;\r\n        //如果是三人场，是使用0,3,1位置\r\n        //如果是两人场并且是sy版本，是使用0,3位置\r\n        let gameScene = app.LocalDataManager().GetConfigProperty(\"SysSetting\", app.subGameName + \"_GameBg\");\r\n        if (playerCount == 3) {\r\n            switch (uiPos) {\r\n                case 1:\r\n                    uiPos = 3;\r\n                    break;\r\n                case 2:\r\n                    uiPos = 2;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }else if (playerCount == 2 && gameScene == 3) {\r\n            switch (uiPos) {\r\n                case 1:\r\n                    uiPos = 3;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n\r\n        return uiPos;\r\n    }\r\n})\r\n\r\n\r\nvar g_PDKRoomPosMgr = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function () {\r\n    if (!g_PDKRoomPosMgr)\r\n        g_PDKRoomPosMgr = new PDKRoomPosMgr();\r\n    return g_PDKRoomPosMgr;\r\n\r\n}\r\n"]}