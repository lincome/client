{"version":3,"sources":["pdk_TopLayer.js"],"names":["app","require","cc","Class","extends","subGameName","properties","OnCreate","sceneType","JS_Name","join","ModalDelayTick","showModalTick","showModalEventType","waitNetEffectNode","GetGlobalEffectNode","node","addChild","OnCloseModalLayer","OnBeforeExitScene","PushGlobalEffectNode","OnUpdate","nowTick","OnShowModalLayerEffect","active","console","log","OnTopEvent","eventType","reConnectTip","CloseReConnectTip","isOpenNet","OnShowModalLayer","StartReConnect","ErrLog","Date","now"],"mappings":"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","file":"pdk_TopLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\scene\\Layer","sourcesContent":["/*\r\n 场景模态置顶层\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\ncc.Class({\r\n\textends: require(app.subGameName + \"_BaseComponent\"),\r\n\r\n\tproperties: {\r\n\t},\r\n\r\n\tOnCreate: function (sceneType) {\r\n\t\tthis.JS_Name = [sceneType, \"TopLayer\"].join(\"_\");\r\n\r\n\t\t//TopLv相关延迟多少毫秒显示\r\n\t\tthis.ModalDelayTick = 500;\r\n\t\tthis.showModalTick = 0;\r\n\t\tthis.showModalEventType = \"\";\r\n\r\n\t\t//等待通信特效\r\n\t\tthis.waitNetEffectNode = app[app.subGameName + \"Client\"].GetGlobalEffectNode(\"WaitNet\");\r\n\t\tif(this.waitNetEffectNode){\r\n\t\t\tthis.node.addChild(this.waitNetEffectNode);\r\n\t\t}\r\n\t\t//创建默认关闭状态\r\n\t\tthis.OnCloseModalLayer();\r\n\t},\r\n\r\n\tOnBeforeExitScene:function(){\r\n\t\tif(this.waitNetEffectNode){\r\n\t\t\tapp[app.subGameName + \"Client\"].PushGlobalEffectNode(this.waitNetEffectNode);\r\n\t\t\tthis.waitNetEffectNode = null;\r\n\t\t}\r\n\t},\r\n\r\n\tOnUpdate:function(nowTick){\r\n\t\tif (this.showModalTick && this.showModalTick <= nowTick) {\r\n\t\t\tthis.OnShowModalLayerEffect();\r\n\t\t}\r\n\t},\r\n\r\n\t//显示特效\r\n\tOnShowModalLayerEffect:function(){\r\n\t\t//清空显示事件\r\n\t\tthis.showModalTick = 0;\r\n\r\n\t\tswitch(this.showModalEventType){\r\n\r\n\t\t\tcase \"OpenNet\":\r\n\t\t\t\tif(this.waitNetEffectNode){\r\n\t\t\t\t\tthis.waitNetEffectNode.active = true;\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\t\t\tcase \"CreateForm\":\r\n\t\t\t\tif(this.waitNetEffectNode){\r\n\t\t\t\t\tthis.waitNetEffectNode.active = true;\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"OnShowModalLayerEffect error:\" + this.showModalEventType);\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t},\r\n\r\n\tOnTopEvent:function(eventType){\r\n\t\t//console.log('OnTopEvent EventType' + eventType);\r\n\t\tswitch(eventType){\r\n\r\n\t\t\tcase \"ReceiveNet\":\r\n\t\t\t\tif (app[app.subGameName + \"Client\"].reConnectTip.active) {\r\n\t\t\t\t\tconsole.log(\"收到消息，关闭断线重连提示\");\r\n\t\t\t\t\tapp[app.subGameName + \"Client\"].CloseReConnectTip();\r\n\t\t\t\t}\r\n\t\t\t\tthis.OnCloseModalLayer();\r\n\t\t\t\tthis.isOpenNet = false;\r\n\t\t\t\tthis.showModalEventType = \"\";\r\n\t\t\t\t// if(app[app.subGameName + \"Client\"].bStartReConnect)\r\n\t\t\t\t// \tapp[app.subGameName + \"Client\"].CloseReConnectTip();\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OpenNet\":\r\n\t\t\t\tthis.OnShowModalLayer();\r\n\t\t\t\tthis.isOpenNet = true;\r\n\t\t\t\tthis.showModalEventType = eventType;\r\n\t\t\t\tbreak\r\n\t\t\tcase \"StartReConnect\":\r\n\t\t\t\tapp[app.subGameName + \"Client\"].StartReConnect();\r\n\t\t\t\tthis.node.active = true;\r\n\t\t\t\tbreak;\r\n\t\t\tcase \"CreateForm\":\r\n\t\t\t\tif(this.isOpenNet){\r\n\t\t\t\t\tconsole.log(\"CreateForm 等待通信结束\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.OnShowModalLayer();\r\n\t\t\t\t\tthis.showModalEventType = eventType;\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"CreateFormEnd\":\r\n\t\t\t\tif(this.isOpenNet){\r\n\t\t\t\t\tconsole.log(\"CreateFormEnd 等待通信结束\");\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthis.showModalEventType = \"\";\r\n\t\t\t\t\tthis.OnCloseModalLayer();\r\n\t\t\t\t}\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"Close\":\r\n\t\t\t\tthis.showModalEventType = \"\";\r\n\t\t\t\tthis.OnCloseModalLayer();\r\n\t\t\t\tbreak\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthis.ErrLog(\"OnTopEvent(%s) error\", eventType);\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t},\r\n\r\n\t//显示模态层提示\r\n\tOnShowModalLayer:function(){\r\n\t\tthis.node.active = true;\r\n\t\t//注册显示事件的Tick\r\n\t\tthis.showModalTick = Date.now() + this.ModalDelayTick;\r\n\t\tif(this.waitNetEffectNode){\r\n\t\t\tthis.waitNetEffectNode.active = false;\r\n\t\t}\r\n\t},\r\n\r\n\t//关闭场景模态层\r\n\tOnCloseModalLayer:function(){\r\n\t\tthis.node.active = false;\r\n\t\t//清空显示事件\r\n\t\tthis.showModalTick = 0;\r\n\t\tif(this.waitNetEffectNode){\r\n\t\t\tthis.waitNetEffectNode.active = false;\r\n\t\t}\r\n\t},\r\n\r\n});\r\n"]}