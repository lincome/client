{"version":3,"sources":["pdk_NetRequest.js"],"names":["app","require","pdk_NetRequest","BaseClass","extend","Init","JS_Name","subGameName","SendHttpRequest","serverUrl","argString","requestType","sendPack","url","join","dataStr","JSON","stringify","timeOut","httpRequest","XMLHttpRequest","timeout","open","setRequestHeader","that","onerror","ErrLog","OnConnectHttpFail","readyState","status","ontimeout","onreadystatechange","OnReceiveHttpPack","responseText","send","g_pdk_httpRequest","exports","GetModel"],"mappings":";;;;;;AAAA;;;;;;;;;;;;;;;AAeA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;;AAEA;;;AAGA,IAAIC,iBAAiBF,IAAIG,SAAJ,CAAcC,MAAd,CAAqB;;AAEzCC,OAAK,gBAAU;AACd,OAAKC,OAAL,GAAeN,IAAIO,WAAJ,GAAkB,aAAjC;AACA,EAJwC;;AAOzC;;;;AAIAC,kBAAgB,yBAASC,SAAT,EAAoBC,SAApB,EAA+BC,WAA/B,EAA4CC,QAA5C,EAAqD;;AAEpE,MAAIC,MAAM,CAACJ,SAAD,EAAYC,SAAZ,EAAuBI,IAAvB,CAA4B,EAA5B,CAAV;;AAEC,MAAIC,UAAUC,KAAKC,SAAL,CAAeL,QAAf,CAAd;AACA,MAAIM,UAAQ,KAAZ;AACD;AACA,MAAIC,cAAc,IAAIC,cAAJ,EAAlB;AACAD,cAAYE,OAAZ,GAAsB,IAAtB;AACAF,cAAYG,IAAZ,CAAiBX,WAAjB,EAA8BE,GAA9B,EAAmC,IAAnC;AACA;AACAM,cAAYI,gBAAZ,CAA6B,cAA7B,EAA6C,kBAA7C;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,MAAIC,OAAO,IAAX;AACAL,cAAYM,OAAZ,GAAsB,YAAU;AAC/BD,QAAKE,MAAL,CAAY,sBAAZ,EAAoCb,GAApC;AACAb,OAAIA,IAAIO,WAAJ,GAAkB,aAAtB,IAAuCoB,iBAAvC,CAAyDlB,SAAzD,EAAoEU,YAAYS,UAAhF,EAA4FT,YAAYU,MAAxG;AACA,GAHD;AAIAV,cAAYW,SAAZ,GAAwB,YAAU;AACjCZ,aAAQ,IAAR;AACSlB,OAAIA,IAAIO,WAAJ,GAAkB,aAAtB,IAAuCoB,iBAAvC,CAAyDlB,SAAzD,EAAoEU,YAAYS,UAAhF,EAA4FT,YAAYU,MAAxG;AACH,GAHP;AAIAV,cAAYY,kBAAZ,GAAiC,YAAU;AAC1C,OAAGb,WAAS,IAAZ,EAAiB;AAChB;AACA;AACD;AACA,OAAIC,YAAYU,MAAZ,IAAsB,GAA1B,EAA8B;AAC7B,QAAGV,YAAYS,UAAZ,IAA0B,CAA7B,EAA+B;AAC9B5B,SAAIA,IAAIO,WAAJ,GAAkB,aAAtB,IAAuCyB,iBAAvC,CAAyDvB,SAAzD,EAAoEU,YAAYc,YAAhF;AACA;AACD,IAJD,MAKI;AACHjC,QAAIA,IAAIO,WAAJ,GAAkB,aAAtB,IAAuCoB,iBAAvC,CAAyDlB,SAAzD,EAAoEU,YAAYS,UAAhF,EAA4FT,YAAYU,MAAxG;AACAL,SAAKE,MAAL,CAAY,2BAAZ,EAAyCP,YAAYS,UAArD,EAAiET,YAAYU,MAA7E;AACA;AACD,GAdD;AAeAV,cAAYe,IAAZ,CAAiBnB,OAAjB;AAEA;;AAzDwC,CAArB,CAArB;;AAgEA;AACA,IAAIoB,oBAAoB,IAAxB;;AAGA;;;AAGAC,QAAQC,QAAR,GAAmB,YAAU;AACzB,KAAG,CAACF,iBAAJ,EAAsB;AAClBA,sBAAoB,IAAIjC,cAAJ,EAApB;AACH;AACD,QAAOiC,iBAAP;AACH,CALD","file":"pdk_NetRequest.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\net","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package NetRequest.js\r\n *  @todo: 发送接收http\r\n *  \r\n *  @author hongdian\r\n *  @date 2014-10-30 16:04\r\n *  @version 1.0\r\n *  \r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *  \r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\n/**\r\n * 类方法定义\r\n */\r\nvar pdk_NetRequest = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t\tthis.JS_Name = app.subGameName + \"_NetRequest\";\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * 发送HTTP请求\r\n\t * * @param requestType POST or GET\r\n\t */\r\n\tSendHttpRequest:function(serverUrl, argString, requestType, sendPack){\r\n\r\n\t\tvar url = [serverUrl, argString].join(\"\")\r\n\r\n\t \tvar dataStr = JSON.stringify(sendPack);\r\n\t \tlet timeOut=false;\r\n\t\t//每次都实例化一个，否则会引起请求结束，实例被释放了\r\n\t\tvar httpRequest = new XMLHttpRequest();\r\n\t\thttpRequest.timeout = 3000;\r\n\t\thttpRequest.open(requestType, url, true);\r\n\t\t//服务器json解码\r\n\t\thttpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\t\t//httpRequest.setRequestHeader(\"Content-Length\", dataStr.length);\r\n\r\n\t\t//['loadstart', 'abort', 'error', 'load', 'loadend', 'timeout'].forEach(function (eventname) {\r\n\t\t//\thttpRequest[\"on\" + eventname] = function () {\r\n\t\t//\t\tcc.log(\"\\nEvent : \" + eventname);\r\n\t\t//\t}\r\n\t\t//});\r\n\r\n\t\tvar that = this;\r\n\t\thttpRequest.onerror = function(){\r\n\t\t\tthat.ErrLog(\"httpRequest.error:%s\", url);\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\r\n\t\t};\r\n\t\thttpRequest.ontimeout = function(){\r\n\t\t\ttimeOut=true;\r\n            app[app.subGameName + \"_NetManager\"]().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\r\n        };\r\n\t\thttpRequest.onreadystatechange = function(){\r\n\t\t\tif(timeOut==true){\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//执行成功\r\n\t\t\tif (httpRequest.status == 200){\r\n\t\t\t\tif(httpRequest.readyState == 4){\r\n\t\t\t\t\tapp[app.subGameName + \"_NetManager\"]().OnReceiveHttpPack(serverUrl, httpRequest.responseText);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tapp[app.subGameName + \"_NetManager\"]().OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\r\n\t\t\t\tthat.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\r\n\t\t\t}\r\n\t\t};\r\n\t\thttpRequest.send(dataStr);\r\n\t\t\r\n\t},\r\n\r\n\r\n})\r\n\r\n\r\n\r\n//定义一个全局http\r\nvar g_pdk_httpRequest = null \r\n\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_httpRequest){\r\n        g_pdk_httpRequest = new pdk_NetRequest();\r\n    }\r\n    return g_pdk_httpRequest;\r\n}"]}