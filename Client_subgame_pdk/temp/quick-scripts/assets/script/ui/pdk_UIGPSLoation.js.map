{"version":3,"sources":["pdk_UIGPSLoation.js"],"names":["app","require","cc","Class","extends","subGameName","properties","OnCreateInit","WeChatManager","OnClose","Pos2Show","pos","RoomPosMgr","RoomMgr","GetEnterRoom","GetRoomPosMgr","clientPos","GetClientPos","downPos","GetClientDownPos","facePos","GetClientFacePos","upPos","GetClientUpPos","OnShow","Init","toUpperCase","room","roomID","GetRoomProperty","roomPosMgr","playerAll","GetRoomAllPlayerInfo","playerAllList","Object","keys","playerCount","showPosPid","pid","i","length","showpos","CloseForm","sendPack","that","SendPack","success","detail","locationInfos","NewDetail","now","Math","floor","Date","getTime","updateTime","push","ShowGps","error","node","getChildByName","active","toRad","d","PI","getDisance","lat1","lng1","lat2","lng2","dis","radLat1","radLat2","deltaLat","deltaLng","asin","sqrt","pow","sin","cos","userinfo","player","GetPlayerInfoByPos","WeChatHeadImage","getComponent","ShowHeroHead","Label","string","name","substr","Address","node12","isGetError","distance12","Latitude","Longitude","OnTranformationDistance","node13","distance13","node14","distance14","node23","distance23","node24","distance24","node34","distance34","distance","distanceStr","toFixed"],"mappings":"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","file":"pdk_UIGPSLoation.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"pdk_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n    },\r\n    OnCreateInit:function(){\r\n        this.WeChatManager = app[app.subGameName+\"_WeChatManager\"]();\r\n    },\r\n    OnClose:function(){\r\n    },\r\n    //不同玩家展示位置不同，二人麻将\r\n    Pos2Show:function(pos){\r\n        let RoomPosMgr = this.RoomMgr.GetEnterRoom().GetRoomPosMgr();\r\n        let clientPos=RoomPosMgr.GetClientPos();\r\n        let downPos=RoomPosMgr.GetClientDownPos();\r\n        let facePos=RoomPosMgr.GetClientFacePos();\r\n        let upPos=RoomPosMgr.GetClientUpPos();\r\n        if(pos==clientPos){\r\n            return 1;\r\n        }else if(pos==downPos){\r\n            return 2;\r\n        }else if(pos==facePos){\r\n            return 3;\r\n        }else if(pos==upPos){\r\n            return 4;\r\n        }\r\n        return -1;\r\n    },\r\n    OnShow: function () {\r\n        this.Init();//隐藏素有的定位信息\r\n        this.RoomMgr = app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        let room =this.RoomMgr.GetEnterRoom();\r\n        let roomID = room.GetRoomProperty(\"roomID\");\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        this.playerAll = roomPosMgr.GetRoomAllPlayerInfo();\r\n        let playerAllList= Object.keys(this.playerAll);\r\n        let playerCount=0;\r\n        let showPosPid=[];\r\n        showPosPid[1]={pid:0};\r\n        showPosPid[2]={pid:0};\r\n        showPosPid[3]={pid:0};\r\n        showPosPid[4]={pid:0};\r\n        for(let i=0;i<playerAllList.length;i++){\r\n            if(this.playerAll[i].pid>0){\r\n                playerCount++;\r\n            }\r\n            let showpos=this.Pos2Show(this.playerAll[i].pos);\r\n            showPosPid[showpos]=this.playerAll[i];\r\n        }\r\n        this.showPosPid=showPosPid;\r\n        if(playerCount<2){\r\n            this.CloseForm();\r\n        }\r\n        let sendPack={\"roomID\":roomID};\r\n        let that=this;\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(\"game.CGetAllLocation\",sendPack,function(success){\r\n            let detail=success.locationInfos;\r\n            let NewDetail=[];\r\n            let now=Math.floor(new Date().getTime()/1000);\r\n            for(let i=0;i<detail.length;i++){\r\n                if(now-detail[i].updateTime<10800){\r\n                    //3小时内的定位有效\r\n                    NewDetail.push(detail[i]);\r\n                }else{\r\n                    NewDetail.push({\"isGetError\":true,\"Address\":\"\",\"pid\":detail[i].pid,\"pos\":detail[i].pos});\r\n                }\r\n            }\r\n            that.ShowGps(NewDetail);\r\n        },function(error){\r\n            //全部定位获取失败\r\n        });\r\n    },\r\n    Init:function(){\r\n        this.node.getChildByName('gps_line_12').active=false;\r\n        this.node.getChildByName('gps_line_13').active=false;\r\n        this.node.getChildByName('gps_line_14').active=false;\r\n        this.node.getChildByName('gps_line_23').active=false;\r\n        this.node.getChildByName('gps_line_24').active=false;\r\n        this.node.getChildByName('gps_line_34').active=false;\r\n        this.node.getChildByName('userinfo1').active=false;\r\n        this.node.getChildByName('userinfo2').active=false;\r\n        this.node.getChildByName('userinfo3').active=false;\r\n        this.node.getChildByName('userinfo4').active=false;\r\n    },\r\n    toRad:function(d) {  \r\n        return d * Math.PI / 180; \r\n    },\r\n    getDisance:function(lat1, lng1, lat2, lng2) {\r\n        var dis = 0;\r\n        var radLat1 = this.toRad(lat1);\r\n        var radLat2 = this.toRad(lat2);\r\n        var deltaLat = radLat1 - radLat2;\r\n        var deltaLng = this.toRad(lng1) -this. toRad(lng2);\r\n        var dis = 2 * Math.asin(Math.sqrt(Math.pow(Math.sin(deltaLat / 2), 2) + Math.cos(radLat1) * Math.cos(radLat2) * Math.pow(Math.sin(deltaLng / 2), 2)));\r\n        return dis * 6378137;\r\n    },\r\n    ShowGps:function(detail){\r\n        let room =this.RoomMgr.GetEnterRoom();\r\n        let NewDetail=[];\r\n        for(let i=0;i<detail.length;i++){\r\n            let pos=detail[i].pos;\r\n            let showpos=this.Pos2Show(pos);\r\n            if(this.showPosPid[showpos].pid>0){\r\n                //显示有收到定位的gps节点\r\n                let userinfo=this.node.getChildByName('userinfo'+showpos);\r\n                userinfo.active=true;\r\n                let player = room.GetRoomPosMgr().GetPlayerInfoByPos(pos);\r\n                let WeChatHeadImage=userinfo.getChildByName('head').getChildByName('head_img').getComponent(app.subGameName + \"_WeChatHeadImage\");\r\n                WeChatHeadImage.ShowHeroHead(player.pid);\r\n                userinfo.getChildByName('username').getComponent(cc.Label).string=player.name.substr(0,8);\r\n                userinfo.getChildByName('address').getComponent(cc.Label).string=detail[i].Address; \r\n            }\r\n            NewDetail[showpos]=detail[i];\r\n        }\r\n        if(this.showPosPid[1].pid>0 && this.showPosPid[2].pid>0){\r\n             let node12=this.node.getChildByName('gps_line_12');\r\n             node12.active=true;\r\n             if(NewDetail[1].isGetError==false && NewDetail[2].isGetError==false){\r\n                 let distance12=this.getDisance(NewDetail[1].Latitude,NewDetail[1].Longitude,NewDetail[2].Latitude,NewDetail[2].Longitude);\r\n                 node12.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance12);\r\n             }else{\r\n                 node12.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n\r\n        if(this.showPosPid[1].pid>0 && this.showPosPid[3].pid>0){\r\n             let node13=this.node.getChildByName('gps_line_13');\r\n             node13.active=true;\r\n             if(NewDetail[1].isGetError==false && NewDetail[3].isGetError==false){\r\n                 let distance13=this.getDisance(NewDetail[1].Latitude,NewDetail[1].Longitude,NewDetail[3].Latitude,NewDetail[3].Longitude);\r\n                 node13.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance13);\r\n             }else{\r\n                 node13.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n        if(this.showPosPid[1].pid>0 && this.showPosPid[4].pid>0){\r\n             let node14=this.node.getChildByName('gps_line_14');\r\n             node14.active=true;\r\n             if(NewDetail[1].isGetError==false && NewDetail[4].isGetError==false){\r\n                 let distance14=this.getDisance(NewDetail[1].Latitude,NewDetail[1].Longitude,NewDetail[4].Latitude,NewDetail[4].Longitude);\r\n                 node14.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance14);\r\n             }else{\r\n                 node14.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n        if(this.showPosPid[2].pid>0 && this.showPosPid[3].pid>0){\r\n             let node23=this.node.getChildByName('gps_line_23');\r\n             node23.active=true;\r\n             if(NewDetail[2].isGetError==false && NewDetail[3].isGetError==false){\r\n                 let distance23=this.getDisance(NewDetail[2].Latitude,NewDetail[2].Longitude,NewDetail[3].Latitude,NewDetail[3].Longitude);\r\n                 node23.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance23);\r\n             }else{\r\n                 node23.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n        if(this.showPosPid[2].pid>0 && this.showPosPid[4].pid>0){\r\n             let node24=this.node.getChildByName('gps_line_24');\r\n             node24.active=true;\r\n             if(NewDetail[2].isGetError==false && NewDetail[4].isGetError==false){\r\n                 let distance24=this.getDisance(NewDetail[2].Latitude,NewDetail[2].Longitude,NewDetail[4].Latitude,NewDetail[4].Longitude);\r\n                 node24.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance24);\r\n             }else{\r\n                 node24.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n        if(this.showPosPid[3].pid>0 && this.showPosPid[4].pid>0){\r\n             let node34=this.node.getChildByName('gps_line_34');\r\n             node34.active=true;\r\n             if(NewDetail[3].isGetError==false && NewDetail[4].isGetError==false){\r\n                 let distance34=this.getDisance(NewDetail[3].Latitude,NewDetail[3].Longitude,NewDetail[4].Latitude,NewDetail[4].Longitude);\r\n                 node34.getChildByName('label_juli').getComponent(cc.Label).string=this.OnTranformationDistance(distance34);\r\n             }else{\r\n                 node34.getChildByName('label_juli').getComponent(cc.Label).string=\"未知距离\";\r\n             }\r\n        }\r\n    },\r\n    //距离转换米或者公里\r\n    OnTranformationDistance:function(distance){\r\n        let distanceStr = '';\r\n        if(distance / 1000 > 1){\r\n            distanceStr = (distance / 1000.0).toFixed(2) + '公里';\r\n        }else {\r\n            distanceStr = distance.toFixed(2) + '米';\r\n        }\r\n        return distanceStr;\r\n    },\r\n});\r\n"]}