{"version":3,"sources":["pdk_UILogin.js"],"names":["app","require","cc","Class","extends","subGameName","properties","EditBoxAccount","EditBox","EditBoxPsw","OnCreateInit","debug","setDisplayStats","HeroAccountManager","ShareDefine","RegEvent","Event_CodeError","Event_ConnectFail","isToken","event","argDict","code","KickOut_AccountTokenError","string","KickOut_ServerClose","WaitForConfirm","ConfirmYN","UpdateAccessPoint","ShowSysMsg","OnShow","sys","isNative","ExitGame","ShowAccountInfo","accountList","GetLocalAccountList","count","length","account","token","GetAccountToken","OnClick","btnName","btnNode","Click_btnLogin","Click_btnReg","ErrLog","charAccount","psw","AccountLogin","OneKeyRegAccount","OnEditBoxBegin","sender","ChangeAccessPoint"],"mappings":"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","file":"pdk_UILogin.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n    UILogin 登陆界面\r\n*/\r\nvar app = require(\"pdk_app\");\r\n\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        EditBoxAccount: cc.EditBox,\r\n        EditBoxPsw: cc.EditBox,\r\n\r\n    },\r\n\r\n    //初始化\r\n    OnCreateInit:function(){\r\n        cc.debug.setDisplayStats(false);//关闭showFps\r\n        \r\n        this.HeroAccountManager = app[app.subGameName + \"_HeroAccountManager\"]();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\r\n\t    this.RegEvent(\"CodeError\", this.Event_CodeError);\r\n        this.RegEvent(\"ConnectFail\", this.Event_ConnectFail);\r\n\r\n        this.isToken = 0;\r\n    },\r\n\r\n\t//登录错误码\r\n\tEvent_CodeError:function(event){\r\n\t\tlet argDict = event;\r\n\t\tlet code = argDict[\"Code\"];\r\n\t\tif(code == this.ShareDefine.KickOut_AccountTokenError){\r\n\t\t\tthis.EditBoxPsw.string = \"\";\r\n\t\t}\r\n\t\telse if(code == this.ShareDefine.KickOut_ServerClose){\r\n\t\t\tthis.WaitForConfirm(\"Code_10016\", [], [], this.ShareDefine.ConfirmYN)\r\n\t\t}\r\n\t},\r\n\r\n\t//连接服务器失败\r\n\tEvent_ConnectFail:function(event){\r\n        this.UpdateAccessPoint();\r\n        let argDict = event;\r\n\t\tif(!argDict['bCloseByLogout'])\r\n\t\t\tthis.ShowSysMsg(\"Net_ConnectFail\");\r\n    },\r\n\r\n\t//--------------------显示函数----------------\r\n\r\n    OnShow:function(){\r\n        if (cc.sys.isNative){\r\n            app[app.subGameName + \"Client\"].ExitGame();\r\n            return;\r\n        }\r\n        this.ShowAccountInfo();\r\n    },\r\n\r\n    //显示账号信息\r\n    ShowAccountInfo:function(){\r\n        let accountList = this.HeroAccountManager.GetLocalAccountList();\r\n        let count = accountList.length;\r\n\r\n        let account = \"\";\r\n        let token = \"\";\r\n\r\n        if(count){\r\n            account = accountList[count-1];\r\n            token = this.HeroAccountManager.GetAccountToken(account);\r\n\t        this.isToken = 1;\r\n        }\r\n\r\n        this.EditBoxAccount.string = account;\r\n        this.EditBoxPsw.string = token;\r\n\r\n    },\r\n\r\n    //---------点击函数---------------------\r\n\r\n    OnClick:function(btnName, btnNode){\r\n\r\n        if(btnName == \"btnLogin\"){\r\n            this.Click_btnLogin();\r\n        }\r\n        else if(btnName == \"btnReg\"){\r\n            this.Click_btnReg();\r\n        }\r\n        else{\r\n            this.ErrLog(\"OnClick:%s not find\", btnName);\r\n        }\r\n    },\r\n\r\n    //点击登陆\r\n    Click_btnLogin:function(){\r\n        let charAccount = this.EditBoxAccount.string;\r\n        if(!charAccount){\r\n            this.ShowSysMsg(\"AccountLogin_NotInputAccount\")\r\n            return\r\n        }\r\n        let psw = this.EditBoxPsw.string;\r\n        if(!psw){\r\n            this.ShowSysMsg(\"AccountLogin_NotInputPsw\")\r\n            return\r\n        }\r\n\r\n        //如果密码等于token为token登录\r\n        if(this.isToken){\r\n\t\t    psw = this.HeroAccountManager.GetAccountToken(charAccount);\r\n        }\r\n\r\n        //账号密码登陆\r\n        this.HeroAccountManager.AccountLogin(charAccount, psw, this.isToken);\r\n\r\n    },\r\n\r\n    //点击注册\r\n    Click_btnReg:function(){\r\n        this.HeroAccountManager.OneKeyRegAccount();\r\n    },\r\n\r\n    OnEditBoxBegin:function(sender){\r\n\r\n\t    //如果点击了密码输入,则清除token标示\r\n\t    if(sender == this.EditBoxPsw){\r\n\t\t    this.isToken = 0;\r\n\t\t    sender.string = \"\";\r\n\t    }\r\n    },\r\n    UpdateAccessPoint:function(){\r\n        app[app.subGameName + \"_HeroAccountManager\"]().ChangeAccessPoint();\r\n    },\r\n});\r\n"]}