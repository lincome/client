{"version":3,"sources":["pdk_UIUserInfo.js"],"names":["app","require","cc","Class","extends","subGameName","properties","sp_head","Sprite","label_name","Label","label_id","label_ip","label_gps","sp_female","sp_ip","Node","sp_gps","sp_boy","SpriteFrame","sp_girl","itemsNode","itemPrefab","Prefab","editBox","EditBox","btnCopyNode","OnCreateInit","ReqIP","pos","RegEvent","OnEvt_ShowInfoDistance","OnEvt_CopyTextNtf","Gifts","GetTableDict","giftCfg","key","itemNode","instantiate","name","on","OnGiftClick","addChild","imgPath","ImageName","iconPath","SetWndImageByFilePath","node","EditBoxChangeCB","EditBoxEndCB","string","OnShow","active","ShowHero_NameOrID","RoomMgr","toUpperCase","room","GetEnterRoom","roomPosMgr","GetRoomPosMgr","ShowPlayerInfo","playerInfo","GetPlayerInfoByPos","ShowPlayerAddress","pid","ShowSex","SetGiftBtnInteractable","that","sendPack","SendPack","success","detail","locationInfo","address","Address","updateTime","now","Math","floor","Date","getTime","error","SendHttpRequest","serverUrl","argString","requestType","url","join","dataStr","JSON","stringify","httpRequest","XMLHttpRequest","timeout","open","setRequestHeader","onerror","ErrLog","OnConnectHttpFail","readyState","status","ontimeout","onreadystatechange","OnReceiveHttpPack","responseText","send","httpResText","serverPack","parse","getChildByName","getComponent","myip","bEnable","items","children","i","length","btn","Button","interactable","allPlayerInfo","GetRoomAllPlayerInfo","GetRoomProperty","ComTool","GetPid","SetShowIDNode","undefined","WeChatHeadImage1","ShowHeroHead","event","distance","parseInt","toString","GetClientPos","heroName","GetHeroProperty","heroID","sex","GetAccountProperty","HeroSex_Boy","spriteFrame","itemName","target","data","roomID","productId","substr","CloseForm","sys","isNative","code","ShowSysMsg","msg","OnClick","btnName","btnNode","str","argList","CallToNative"],"mappings":"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","file":"pdk_UIUserInfo.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"pdk_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        sp_head:cc.Sprite,\r\n        label_name:cc.Label,\r\n        label_id:cc.Label,\r\n        label_ip:cc.Label,\r\n        label_gps:cc.Label,\r\n        sp_female:cc.Sprite,\r\n        sp_ip:cc.Node,\r\n        sp_gps:cc.Node,\r\n        sp_boy:cc.SpriteFrame,\r\n        sp_girl:cc.SpriteFrame,\r\n        itemsNode:cc.Node,\r\n        itemPrefab:cc.Prefab,\r\n        editBox:cc.EditBox,\r\n        btnCopyNode:cc.Node,\r\n    },\r\n\r\n    OnCreateInit: function () {\r\n        this.ReqIP();\r\n        this.pos=-1;\r\n        this.RegEvent(\"SHOWINFODISTANCE\", this.OnEvt_ShowInfoDistance);\r\n        this.RegEvent(\"OnCopyTextNtf\", this.OnEvt_CopyTextNtf);\r\n        \r\n        let Gifts = app[app.subGameName + \"_SysDataManager\"]().GetTableDict(\"Gift\");\r\n        this.giftCfg = [];\r\n        for(let key in Gifts){\r\n            let itemNode = cc.instantiate(this.itemPrefab);\r\n            itemNode.name = 'item' + key;\r\n            itemNode.on('click',this.OnGiftClick,this);\r\n\r\n            this.itemsNode.addChild(itemNode);\r\n            let imgPath = 'texture/ui/' +app.subGameName +  '_UIUserInfo/' + Gifts[key].ImageName;\r\n            let iconPath = 'ScrollView/items/' + itemNode.name + '/item_icon'\r\n            this.SetWndImageByFilePath(iconPath,imgPath);\r\n        }\r\n        this.editBox.node.on('editing-did-ended',this.EditBoxChangeCB,this);\r\n    },\r\n    EditBoxEndCB:function(){\r\n        this.editBox.string = this.label_id.string;\r\n    },\r\n    OnShow: function (pos=-1) {\r\n//        app.LocationMgr().setType(\"userinfo\");\r\n        this.pos = pos;\r\n        if(pos<0){\r\n            this.sp_gps.active = false;\r\n            this.itemsNode.active = false;\r\n            this.ShowHero_NameOrID();\r\n        }else{\r\n            this.RoomMgr = app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n            let room = this.RoomMgr.GetEnterRoom();\r\n            let roomPosMgr = room.GetRoomPosMgr();\r\n            this.sp_gps.active = true;\r\n            this.itemsNode.active = true;\r\n            this.ShowPlayerInfo(room);\r\n            let playerInfo=roomPosMgr.GetPlayerInfoByPos(this.pos);\r\n            if(playerInfo){\r\n                this.ShowPlayerAddress(playerInfo.pid);\r\n            }\r\n        }\r\n        this.ShowSex();\r\n        this.SetGiftBtnInteractable(this.sp_gps.active);\r\n    },\r\n    ShowPlayerAddress:function(pid){\r\n        if(pid>0){\r\n            let that=this;\r\n            let sendPack={\"pid\":pid};\r\n            app[app.subGameName + \"_NetManager\"]().SendPack(\"game.CPlayerLocationInfo\",sendPack,function(success){\r\n                let detail=success.locationInfo;\r\n                let address=detail.Address;\r\n                let updateTime=detail.updateTime;\r\n                let now=Math.floor(new Date().getTime()/1000);\r\n                if(now-updateTime>10800){\r\n                    //3小时内的定位有效\r\n                    that.label_gps.string =\"未知地址\";\r\n                    return;\r\n                }\r\n                if(address){\r\n                    that.label_gps.string =\"地址:\"+address;\r\n                }else{\r\n                    that.label_gps.string =\"未知地址\";\r\n                }\r\n                \r\n            },function(error){\r\n                //全部定位获取失败\r\n                that.label_gps.string =\"未知地址\";\r\n            });\r\n        }else{\r\n            this.label_gps.string =\"未知地址\";\r\n        }\r\n        //显示用户ip\r\n       // this.SendHttpRequest('http://www.qp355.com/myip.php', \"?Sign=ddcat\", \"GET\",{});\r\n    },\r\n    SendHttpRequest:function(serverUrl, argString, requestType, sendPack){\r\n\r\n        var url = [serverUrl, argString].join(\"\")\r\n\r\n        var dataStr = JSON.stringify(sendPack);\r\n\r\n        //每次都实例化一个，否则会引起请求结束，实例被释放了\r\n        var httpRequest = new XMLHttpRequest();\r\n\r\n        httpRequest.timeout = 2000;\r\n\r\n\r\n        httpRequest.open(requestType, url, true);\r\n        //服务器json解码\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        var that = this;\r\n        httpRequest.onerror = function(){\r\n            that.ErrLog(\"httpRequest.error:%s\", url);\r\n            that.OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\r\n        };\r\n        httpRequest.ontimeout = function(){\r\n            \r\n        };\r\n        httpRequest.onreadystatechange = function(){\r\n\r\n            //执行成功\r\n            if (httpRequest.status == 200){\r\n                if(httpRequest.readyState == 4){\r\n                    that.OnReceiveHttpPack(serverUrl, httpRequest.responseText);\r\n                }\r\n            }\r\n            else{\r\n                that.OnConnectHttpFail(serverUrl, httpRequest.readyState, httpRequest.status);\r\n                that.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\r\n            }\r\n        };\r\n        httpRequest.send(dataStr);\r\n\r\n    },\r\n    OnReceiveHttpPack:function(serverUrl, httpResText){\r\n        try{\r\n            let serverPack = JSON.parse(httpResText);\r\n            if(serverPack[\"IsSuccess\"] == 1){\r\n                this.sp_ip.getChildByName('label_IP').getComponent(cc.Label).string=serverPack.myip;\r\n            }\r\n            else{\r\n               this.sp_ip.getChildByName('label_IP').getComponent(cc.Label).string='未知ip';\r\n            }\r\n        }\r\n        catch (error){\r\n            this.sp_ip.getChildByName('label_IP').getComponent(cc.Label).string='未知ip';\r\n        }\r\n    },\r\n    OnConnectHttpFail:function(serverUrl, readyState, status){\r\n       this.sp_ip.getChildByName('label_IP').getComponent(cc.Label).string='未知ip';\r\n    },\r\n    SetGiftBtnInteractable:function(bEnable){\r\n        let items = this.itemsNode.children;\r\n        for(let i=0;i<items.length;i++){\r\n            let btn = items[i].getComponent(cc.Button);\r\n            if(btn)\r\n                btn.interactable = bEnable;\r\n        }\r\n    },\r\n    ShowPlayerInfo:function(room){\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let allPlayerInfo = null;\r\n        if(roomPosMgr)\r\n            allPlayerInfo = roomPosMgr.GetRoomAllPlayerInfo();\r\n        else\r\n            allPlayerInfo = room.GetRoomProperty('posList');\r\n        let playerInfo = allPlayerInfo[this.pos];\r\n        this.label_name.string = playerInfo[\"name\"];\r\n        this.label_id.string = this.ComTool.GetPid(playerInfo[\"pid\"]);\r\n        this.editBox.string = this.label_id.string;\r\n        this.SetShowIDNode();\r\n        if(playerInfo[\"playerIP\"]==undefined){\r\n            this.label_ip.string=\"ip获取失败\"\r\n        }else{\r\n            this.label_ip.string = playerInfo[\"playerIP\"];  \r\n        }\r\n        //this.label_gps.string = \"您距\"+ this.label_name.string +\"的距离：未知距离\";\r\n        let WeChatHeadImage1 = this.sp_head.getComponent(app.subGameName + \"_WeChatHeadImage\");\r\n        WeChatHeadImage1.ShowHeroHead(playerInfo[\"pid\"]);\r\n\r\n        //app.LocationMgr().OnGetLocation();\r\n\r\n    },\r\n    //显示距离\r\n    OnEvt_ShowInfoDistance:function(event){\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let distance = parseInt(event[\"distance\"].toString());\r\n        if(event[\"pos1\"]==roomPosMgr.GetClientPos()&&event[\"pos2\"]==this.pos){\r\n            this.label_gps.string = \"您距\"+ this.label_name.string +\"的距离：\"+ distance +\"米\";\r\n        }else if(event[\"pos2\"]==roomPosMgr.GetClientPos()&&event[\"pos1\"]==this.pos){\r\n            this.label_gps.string = \"您距\"+ this.label_name.string +\"的距离：\"+ distance +\"米\";\r\n        }\r\n    },\r\n    ReqIP:function(){\r\n        app[app.subGameName + \"_NetManager\"]().SendPack('game.CPlayerAddress', {});\r\n    },\r\n  \r\n    ShowHero_NameOrID:function () {\r\n        let heroName = app[app.subGameName + \"_HeroManager\"]().GetHeroProperty(\"name\");\r\n        this.label_name.string =heroName;\r\n        let heroID = app[app.subGameName + \"_HeroManager\"]().GetHeroProperty(\"pid\");\r\n        this.label_id.string =this.ComTool.GetPid(heroID);// app.i18n.t(\"UIMain_PIDText\",{\"pid\":this.ComTool.GetPid(heroID)});\r\n        this.editBox.string = this.label_id.string;\r\n        let WeChatHeadImage1 = this.sp_head.getComponent(app.subGameName + \"_WeChatHeadImage\");\r\n        WeChatHeadImage1.ShowHeroHead(heroID);\r\n        this.SetShowIDNode();\r\n    },\r\n    ShowSex:function(){\r\n    \tlet sex = -1;\r\n        if(-1 == this.pos)\r\n            sex = app[app.subGameName + \"_HeroAccountManager\"]().GetAccountProperty(\"Sex\");\r\n        else{\r\n            let room = this.RoomMgr.GetEnterRoom();\r\n            sex = room.GetRoomProperty('posList')[this.pos].sex;\r\n        }\r\n    \tif (sex == app[app.subGameName + \"_ShareDefine\"]().HeroSex_Boy) {\r\n    \t\tthis.sp_female.spriteFrame = this.sp_boy;\r\n    \t} else {\r\n    \t\tthis.sp_female.spriteFrame = this.sp_girl;\r\n    \t}\r\n    },\r\n    OnGiftClick:function(event){\r\n        if(-1 == this.pos)\r\n            return;\r\n        if(!this.RoomMgr)\r\n            return;\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        if(!room)\r\n            return;\r\n\r\n        let itemName = event.target.name;\r\n        let data = {};\r\n        data.roomID = room.GetRoomProperty(\"roomID\");\r\n        data.pos = this.pos;\r\n        data.productId = parseInt(itemName.substr(('item').length));\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"SendGift\", data);\r\n        this.CloseForm();\r\n    },\r\n    SetShowIDNode:function(){\r\n        if(cc.sys.isNative){\r\n            this.label_id.node.active = true;\r\n            this.editBox.node.active = false;\r\n            //this.btnCopyNode.active = true;\r\n        }\r\n        else{\r\n            this.label_id.node.active = false;\r\n            this.editBox.node.active = true;\r\n            this.btnCopyNode.active = false;\r\n        }\r\n    },\r\n    OnEvt_CopyTextNtf:function(event){\r\n        if(0 == event.code)\r\n            this.ShowSysMsg(\"已复制ID：\"+event.msg);\r\n        else\r\n            this.ShowSysMsg(\"复制失败\");\r\n    },\r\n    OnClick:function(btnName, btnNode){\r\n        if('btn_copy' == btnName){\r\n            let str = this.label_id.string;\r\n            if(cc.sys.isNative){\r\n                let argList = [{\"Name\":\"msg\",\"Value\":str.toString()}];\r\n                app[app.subGameName + \"_NativeManager\"]().CallToNative(\"copyText\", argList);\r\n            }\r\n            else{\r\n                \r\n            }\r\n        }\r\n    },\r\n});\r\n"]}