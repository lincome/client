{"version":3,"sources":["pdk_UIMessage02.js"],"names":["app","require","cc","Class","extends","subGameName","properties","lb_time","Label","LabelMessage","playerNodes","Node","btnCancel","Button","btnSure","OnCreateInit","RegEvent","Event_PosDealVote","Event_CodeError","OnShow","RoomMgr","toUpperCase","RoomPosMgr","GetEnterRoom","GetRoomPosMgr","room","IsClientIsOwner","interactable","ShowPosAgree","dissolveInfo","GetRoomProperty","createPos","roomPosMgr","posName","GetPlayerInfoByPos","name","i18n","t","string","endSec","timeString","GetCDTimeStringBySec","ShareDefine","ShowHourMinSec","updateTime","Date","getTime","posAgreeList","allPlayers","GetRoomAllPlayerInfo","clientPos","GetClientPos","playingList","idx","push","canClick","i","length","active","getChildByName","pid","nameLabel","getComponent","CloseForm","Show_btnCancel_btnSure","enableAutoGrayEffect","event","argDict","code","NotExistRoom","error","FormManager","Name","ClearDissolve","ShowSysMsg","OnUpdate","time","ShowSecondSec","num","parseInt","OnClick","btnName","btnNode","roomID","GetEnterRoomID","SendDissolveRoomRefuse","SendDissolveRoomAgree"],"mappings":"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","file":"pdk_UIMessage02.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n UIMessage 模态消息界面\r\n */\r\n\r\nvar app = require(\"pdk_app\");\r\n\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        lb_time:cc.Label,\r\n        LabelMessage:cc.Label,\r\n        playerNodes:[cc.Node],\r\n        btnCancel:cc.Button,\r\n        btnSure:cc.Button,\r\n    },\r\n\r\n    //初始化\r\n    OnCreateInit:function(){\r\n        this.RegEvent(\"PosDealVote\", this.Event_PosDealVote);\r\n        this.RegEvent(\"CodeError\", this.Event_CodeError);\r\n    },\r\n\r\n    //---------显示函数--------------------\r\n\r\n    OnShow:function () {\r\n        this.RoomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        this.RoomPosMgr = this.RoomMgr.GetEnterRoom().GetRoomPosMgr();\r\n\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        if(room.IsClientIsOwner()){\r\n            this.btnCancel.interactable = 0;\r\n            this.btnSure.interactable = 0;\r\n        }\r\n        this.ShowPosAgree(room);\r\n        let dissolveInfo = room.GetRoomProperty(\"dissolve\");\r\n        let createPos = dissolveInfo[\"createPos\"];\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let posName = roomPosMgr.GetPlayerInfoByPos(createPos).name;\r\n        let LabelMessage = app.i18n.t(\"DissolutiontText\",{\"Name\": posName});\r\n        this.LabelMessage.string = LabelMessage;\r\n        this.endSec = room.GetRoomProperty(\"dissolve\")[\"endSec\"];\r\n        let timeString = app[app.subGameName + \"_ServerTimeManager\"]().GetCDTimeStringBySec(this.endSec, this.ShareDefine.ShowHourMinSec);\r\n        this.lb_time.string = timeString;\r\n\r\n        this.updateTime = new Date().getTime();\r\n    },\r\n    ShowPosAgree:function (room) {\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let dissolveInfo = room.GetRoomProperty(\"dissolve\");\r\n        let posAgreeList = dissolveInfo[\"posAgreeList\"];\r\n        let allPlayers = roomPosMgr.GetRoomAllPlayerInfo();\r\n        let createPos = dissolveInfo[\"createPos\"];\r\n        let clientPos = roomPosMgr.GetClientPos();\r\n        let playingList = [];\r\n        for(let idx in allPlayers){\r\n            playingList.push(allPlayers[idx]);\r\n        }\r\n        let canClick = true;\r\n        for(let i=0;i<this.playerNodes.length;i++){\r\n            this.playerNodes[i].active = false;\r\n            this.playerNodes[i].getChildByName('icon_jujue').active = false;\r\n            this.playerNodes[i].getChildByName('icon_tongyi').active = false;\r\n            if(i < playingList.length && playingList[i].pid){\r\n                let nameLabel = this.playerNodes[i].getChildByName('name').getComponent(cc.Label);\r\n                nameLabel.string = playingList[i].name;\r\n                //0未表态 1支持 2拒绝\r\n                if(0 == posAgreeList[i]){\r\n\r\n                }\r\n                else if(1 == posAgreeList[i]){\r\n                    this.playerNodes[i].getChildByName('icon_tongyi').active = true;\r\n                    if(i == clientPos)\r\n                        canClick = false;\r\n                }\r\n                else{\r\n                    this.playerNodes[i].getChildByName('icon_jujue').active = true;\r\n                    this.CloseForm();\r\n                    if(i == clientPos)\r\n                        canClick = false;\r\n                }\r\n                \r\n                this.playerNodes[i].active = true;\r\n            }\r\n        }\r\n        if(createPos == clientPos)\r\n            canClick = false;\r\n        this.Show_btnCancel_btnSure(canClick);\r\n    },\r\n    Show_btnCancel_btnSure:function(canClick){\r\n        if(canClick){\r\n            this.btnCancel.interactable = 1;\r\n            this.btnCancel.enableAutoGrayEffect = 0;\r\n            this.btnSure.interactable = 1;\r\n            this.btnSure.enableAutoGrayEffect = 0;\r\n        }\r\n        else{\r\n            this.btnCancel.interactable = 0;\r\n            this.btnCancel.enableAutoGrayEffect = 1;\r\n            this.btnSure.interactable = 0;\r\n            this.btnSure.enableAutoGrayEffect = 1;\r\n        }\r\n    },\r\n    //---------回调函数--------------------\r\n    Event_CodeError:function(event){\r\n        let argDict = event;\r\n        let code = argDict[\"Code\"];\r\n        if(code == this.ShareDefine.NotExistRoom){\r\n            try{\r\n                this.CloseForm();\r\n            }\r\n            catch(error){\r\n                \r\n            }\r\n        }\r\n    },\r\n    //收到同意/拒绝解散房间\r\n    Event_PosDealVote:function(event){\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        let argDict = event;\r\n        let posAgreeList = argDict[\"posAgreeList\"];\r\n        let createPos = argDict[\"createPos\"];\r\n        let clientPos = room.GetRoomPosMgr().GetClientPos();\r\n        for(let i = 0; i < posAgreeList.length; i++){\r\n            if(posAgreeList[i] == 2){//0未表态 1支持 2拒绝\r\n                this.FormManager.CloseForm(app.subGameName + \"_UIMessage02\");\r\n                let Name = this.RoomMgr.GetEnterRoom().GetRoomPosMgr().GetPlayerInfoByPos(i)[\"name\"];\r\n                room.ClearDissolve();\r\n                this.ShowSysMsg(\"PlayersRefusedToDisband\",[Name]);\r\n                return;\r\n            }\r\n            else if(posAgreeList[i] == 1){\r\n                this.playerNodes[i].getChildByName('icon_tongyi').active = true;\r\n            }\r\n            else{\r\n\r\n            }\r\n        }\r\n    },\r\n \r\n    //---------刷新函数--------------------\r\n    OnUpdate:function () {\r\n        if(this.endSec){\r\n            let time = new Date().getTime();\r\n            if( time < this.updateTime){\r\n                let timeString = app[app.subGameName + \"_ServerTimeManager\"]().GetCDTimeStringBySec(this.endSec, this.ShareDefine.ShowSecondSec);\r\n                let num = parseInt(timeString);\r\n                if(!num){\r\n                    this.CloseForm();\r\n                    return;\r\n                }\r\n                this.lb_time.string = timeString;\r\n            }\r\n            else{\r\n                this.updateTime += 500;\r\n            }\r\n        }\r\n    },\r\n\r\n    //---------点击函数---------------------\r\n    OnClick:function(btnName, btnNode){\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        let roomID = this.RoomMgr.GetEnterRoomID();\r\n        if(btnName == \"btnCancel\"){\r\n           // this.RoomMgr.SendDissolveRoomRefuse(roomID);\r\n            app[app.subGameName + \"_GameManager\"]().SendDissolveRoomRefuse(roomID);\r\n            this.Show_btnCancel_btnSure(false);\r\n        }\r\n        else if(btnName == \"btnSure\"){\r\n            //this.RoomMgr.SendDissolveRoomAgree(roomID);\r\n            app[app.subGameName + \"_GameManager\"]().SendDissolveRoomAgree(roomID);\r\n            this.Show_btnCancel_btnSure(false);\r\n        }\r\n    },\r\n\r\n});\r\n"]}