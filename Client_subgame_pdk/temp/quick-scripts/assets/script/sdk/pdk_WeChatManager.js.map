{"version":3,"sources":["pdk_WeChatManager.js"],"names":["app","require","pdk_WeChatManager","BaseClass","extend","Init","JS_Name","subGameName","ShareDefine","SysDataManager","HeroAccountManager","NetManager","ControlManager","HeroManager","SysNotifyManager","wx","window","sdk","RegHttpNetPack","OnHttpPack_IsSubscribeWeChatMPResult","OnHttpPack_RequestWeChatSDKInitSignResult","OnHttpPack_HeadImagePathInfo","RegEvent","OnEvent_PlayerLoginOK","dataInfo","heroHeadSpriteFrame","Log","OnReload","InitWeChatSDKParameter","code","ErrLog","serverPack","IsSubscribe","OnEvent","console","log","signature","Signature","config","AppId","Timestamp","NonceStr","ready","OnWeChatReady","bind","error","OnWeChatError","room","toUpperCase","roomKey","GetRoomProperty","InitRoomWeChatShare","InitGameWeChatShare","result","ShowSysMsg","clientConfig","GetClientConfig","SetWeChatShareDataInfo","BeginShare","title","desc","weChatShareImageUrl","GetClientConfigProperty","link","shareInfo","imgUrl","type","dataUrl","success","ShareSuccess","cancel","ShareCancel","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","SuccessTcnUrl","requestUrl","jsonStr","replace","ShareUrl","eval","url_short","ShareTitle","ShareDesc","FailTcnUrl","event","WeChatShare","setCount","GetRoomConfigByProperty","allPlayerInfo","joinPlayerCount","length","nowJoin","i","pid","gamedesc","autoCardIdx","que","teshuwanfan","WanFa","gameCreateConfig","GetTableDict","playGame","wanfa","key","GameName","isWanFa","dataKey","Key","value","ToggleType","ToggleDesc","split","str","gameType","baseDiZhus","dizhuIdx","dizhu","dingzhu","toString","j","argDict","gameLoadUrl","gameID","mpID","GetHeroID","GetUrlStr","dataDict","argList","Object","keys","sort","count","urlSendStr","index","substring","GetSDK","GetSDKProperty","property","hasOwnProperty","heroID","headImageUrl","GetHeroProperty","InitHeroHeadImage","headSpriteFrameInfo","SetDefault","headInfo","SendHttpLoadHeadImage","InitHeroHeadImageByDict","heroHeadInfo","sendPack","GetHttpSendPack","HeadInfo","GameID","SendHttpPack","resServerUrl","GetResServerHttpAddress","bluebirdList","headPathInfo","push","CreateSpriteFrame","that","bluebird","all","then","heroIDList","catch","stack","headPath","targetPath","join","CreateLoadPromiseByUrl","texture","cc","Texture2D","spriteFrame","SpriteFrame","GetHeroHeadSpriteFrame","ReceivePrepayOrder","prepayOrderInfo","OnPayResult","chooseWXPay","ReceivePrepayQRCodeOrder","code_url","orderServerIP","orderServerPort","sys","openURL","resultInfo","JSON","stringify","Login","token","LoginAccountBySDK","SDKType_WeChat","CheckLoginBySDK","SendRequestWeChatSDKIntSign","isNative","url","location","href","MPID","Url","SendIsSubscribeWeChatMP","accountID","GetAccountProperty","AccountID","playgame","gameCfg","GametTypeID2PinYin","Array","gameId","GametTypeNameDict","gamename","GametTypeID2Name","special","weChatAppShareUrl","ShortShareUrl","ComTool","ShortHeroID","GetPid","g_pdk_WeChatManager","exports","GetModel"],"mappings":"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","file":"pdk_WeChatManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/*\r\n WeChatManager.js 微信sdk\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_WeChatManager = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t\tthis.JS_Name = app.subGameName + \"_WeChatManager\";\r\n\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.HeroAccountManager = app[app.subGameName + \"_HeroAccountManager\"]();\r\n\t\tthis.NetManager = app[app.subGameName + \"_NetManager\"]();\r\n\t\tthis.ControlManager = app[app.subGameName + \"_ControlManager\"]();\r\n\t\tthis.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n\t\tthis.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\r\n\t\t//如果存在全局sdk对象\r\n\t\tthis.wx = window.wx;\r\n\t\tthis.sdk = null;\r\n\r\n\t\tthis.NetManager.RegHttpNetPack(0x0003, this.OnHttpPack_IsSubscribeWeChatMPResult, this);\r\n\t\tthis.NetManager.RegHttpNetPack(0x0004, this.OnHttpPack_RequestWeChatSDKInitSignResult, this);\r\n\t\tthis.NetManager.RegHttpNetPack(0x0007, this.OnHttpPack_HeadImagePathInfo, this);\r\n\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"PlayerLoginOK\", this.OnEvent_PlayerLoginOK, this);\r\n\r\n\t\tthis.dataInfo = {};\r\n\r\n\t\t//玩家第3方头像spriteFrame缓存字典\r\n\t\t//{heroID:{\"HeadImageUrl\":\"XX\",\"SpriteFrame\":null}}\r\n\t\tthis.heroHeadSpriteFrame = {};\r\n\r\n\t\t//this.OnReload();\r\n\r\n\t\tthis.Log(\"Init\");\r\n\t},\r\n\r\n\tOnReload:function(){\r\n\t\t//这里不能reload，不然会导致登录不了，故直接return\r\n\t\treturn;\r\n\t\tthis.dataInfo[\"code\"] = null;\r\n\t\t\r\n\t},\r\n\r\n\t//授权参数初始化\r\n\tInitWeChatSDKParameter:function(dataInfo){\r\n\t\tlet code = dataInfo[\"code\"];\r\n\t\t//使用公众号登录授权启动没有携带code\r\n\t\tif(!code){\r\n\t\t\tthis.ErrLog(\"InitWeChatSDKParameter dataInfo not find code\", dataInfo);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.dataInfo = dataInfo;\r\n\t},\r\n\r\n\t//是否已经关注公众号\r\n\tOnHttpPack_IsSubscribeWeChatMPResult:function(serverPack){\r\n\t\tthis.dataInfo[\"IsSubscribe\"] = serverPack.IsSubscribe;\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"IsSubscribeWeChatMPResult\", serverPack);\r\n\t},\r\n\r\n\t//申请微信sdk初始化签名\r\n\tOnHttpPack_RequestWeChatSDKInitSignResult:function(serverPack){\r\n\t\tconsole.log(\"OnHttpPack_RequestWeChatSDKInitSignResult :\",serverPack);\r\n\t\tif(!this.wx){\r\n\t\t\tthis.ErrLog(\"OnHttpPack_RequestWeChatSDKInitSignResult not find wx\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet signature = serverPack.Signature;\r\n\t\tif(!signature){\r\n\t\t\tthis.ErrLog(\"OnHttpPack_RequestWeChatSDKInitSignResult not find Signature :\", serverPack);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tthis.wx.config({\r\n\t\t\t\"debug\":false,\r\n\t\t\t\"appId\":serverPack.AppId,\r\n\t\t\t\"timestamp\":serverPack.Timestamp,\r\n\t\t\t\"nonceStr\":serverPack.NonceStr,\r\n\t\t\t\"signature\":signature,\r\n\t\t\t\"jsApiList\":[\"onMenuShareTimeline\", \"onMenuShareAppMessage\", \"onMenuShareQQ\", \"onMenuShareWeibo\", \"onMenuShareQZone\", \"getNetworkType\", \"chooseWXPay\"],\r\n\t\t});\r\n\t\tthis.wx.ready(this.OnWeChatReady.bind(this));\r\n\t\tthis.wx.error(this.OnWeChatError.bind(this));\r\n\t},\r\n\r\n\t//初始化成功\r\n\tOnWeChatReady:function(){\r\n\t\tconsole.log(\"XiaoFu InitWeiXinShare OnWeChatReady2\");\r\n\t\tthis.sdk = this.wx;\r\n    \tlet room = app[app.subGameName.toUpperCase()+\"Room\"]();\r\n\t\tlet roomKey = room.GetRoomProperty(\"key\");  //房间号\r\n\t\tif(roomKey){\r\n\t\t\tthis.InitRoomWeChatShare();\r\n\t\t}else{\r\n\t\t\tthis.InitGameWeChatShare();\r\n\t\t}\r\n\t\t\r\n\r\n\r\n\t\t\r\n\t},\r\n\r\n\tOnWeChatError:function(result){\r\n\t\tthis.ErrLog(\"OnWeChatError :\", result);\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"CodeErrorMsg\", [\"公众号签名初始化失败\"])\r\n\t},\r\n\r\n\t//----------------分享接口------------------------\r\n\tInitGameWeChatShare:function(){\r\n\t\tif(!this.sdk){\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\t\tthis.SetWeChatShareDataInfo(clientConfig[\"WeChatShareTitle\"], clientConfig[\"WeChatShareDesc\"]);\r\n\t},\r\n\tBeginShare:function(roomKey,title,desc){\r\n        let weChatShareImageUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareImageUrl\");\r\n        let link=\"https://www.qp355.com/room\"+roomKey;\r\n        let shareInfo = {\r\n\t\t\ttitle:title,\r\n\t\t\tdesc:desc,\r\n\t\t\tlink:link,\r\n\t\t\timgUrl:weChatShareImageUrl,\r\n\t\t\ttype:\"link\",\r\n\t\t\tdataUrl:\"\",\r\n\t\t\tsuccess:this.ShareSuccess.bind(this),\r\n\t\t\tcancel:this.ShareCancel.bind(this),\r\n\t\t}\r\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\r\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\r\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\r\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\r\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\r\n\r\n\r\n\r\n    },\r\n    //微信分享获取短域名并且启动分享\r\n    SuccessTcnUrl:function(serverPack){\r\n        console.log(\"SuccessTcnUrl serverPack:\",serverPack);\r\n        if(typeof(serverPack.requestUrl)==\"undefined\"){\r\n            return;\r\n        }\r\n        let jsonStr=serverPack.requestUrl;\r\n        jsonStr=jsonStr.replace('[','');\r\n        jsonStr=jsonStr.replace(']','');\r\n        let ShareUrl=eval('(' + jsonStr + ')');\r\n        let url_short=ShareUrl.url_short;\r\n        let weChatShareImageUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareImageUrl\");\r\n        let shareInfo = {\r\n\t\t\ttitle:this.ShareTitle,\r\n\t\t\tdesc:this.ShareDesc,\r\n\t\t\tlink:url_short,\r\n\t\t\timgUrl:weChatShareImageUrl,\r\n\t\t\ttype:\"link\",\r\n\t\t\tdataUrl:\"\",\r\n\t\t\tsuccess:this.ShareSuccess.bind(this),\r\n\t\t\tcancel:this.ShareCancel.bind(this),\r\n\t\t}\r\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\r\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\r\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\r\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\r\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\r\n    },\r\n    //微信分享获取短域名失败分享\r\n    FailTcnUrl:function(event){\r\n    },\r\n\t//房间微信分享\r\n\tInitRoomWeChatShare:function(){\r\n\t\tif(!this.sdk){\r\n\t\t\treturn\r\n\t\t}\r\n    \tlet room = app[app.subGameName.toUpperCase()+\"Room\"]();\r\n        var WeChatShare= this.WeChatShare(app.subGameName);\r\n        let title = null;\r\n        if(WeChatShare['special']){\r\n           title =WeChatShare['special'];\r\n        }else{\r\n           title =WeChatShare['title'];\r\n        }\r\n        let desc = WeChatShare['desc'];\r\n        let setCount = room.GetRoomConfigByProperty(\"setCount\");  //多少局\r\n        let roomKey = room.GetRoomProperty(\"key\");  //房间号\r\n\r\n        let allPlayerInfo = room.GetRoomProperty('posList');\r\n        let joinPlayerCount = allPlayerInfo.length;  //几人场\r\n        let nowJoin=0;\r\n\r\n        for(let i=0;i<joinPlayerCount;i++){\r\n            if(allPlayerInfo[i].pid > 0)\r\n                nowJoin++;\r\n        }\r\n        title=title.replace('{房间号}',roomKey);\r\n        title=title.replace('{几局}',setCount);\r\n        let gamedesc =\"\";\r\n        gamedesc=joinPlayerCount+\"人场\";\r\n        let autoCardIdx= room.GetRoomConfigByProperty(\"paymentRoomCardType\"); \r\n        if(0 == autoCardIdx)\r\n            gamedesc=gamedesc+\",房主出卡\";\r\n        else if(1 == autoCardIdx)\r\n            gamedesc=gamedesc+\",平分房卡\";\r\n        else\r\n        \tgamedesc=gamedesc+\",大赢家出卡\";\r\n        let que=joinPlayerCount-nowJoin;\r\n        gamedesc+=\",\"+nowJoin+\"缺\"+que;\r\n        let teshuwanfan=this.WanFa();\r\n        if(teshuwanfan){\r\n        \tgamedesc+=\",\"+teshuwanfan;\r\n        }\r\n        //let text=title+\"\\n\"+gamedesc;\r\n        this.BeginShare(room.GetRoomProperty(\"key\"),title,gamedesc);\r\n\t},\r\n\tWanFa:function(){\r\n    \tthis.gameCreateConfig = this.SysDataManager.GetTableDict(\"gameCreate\");\r\n \t\tlet playGame=app.subGameName;\r\n \t\tif(playGame==''){\r\n \t\t\treturn false;\r\n \t\t}\r\n    \tlet room = app[app.subGameName.toUpperCase()+\"Room\"]();\r\n    \tlet wanfa='';\r\n    \tfor(let key in this.gameCreateConfig){\r\n            if(playGame == this.gameCreateConfig[key].GameName && this.gameCreateConfig[key].isWanFa==1){\r\n            \tlet dataKey = this.gameCreateConfig[key].Key;\r\n            \tlet value=room.GetRoomConfigByProperty(dataKey);\r\n            \tlet ToggleType=this.gameCreateConfig[key].ToggleType;\r\n \t\t\t\tlet ToggleDesc=this.gameCreateConfig[key].ToggleDesc.split(',');\r\n \t\t\t\tif(ToggleType==0){\r\n \t\t\t\t\t//单选\r\n \t\t\t\t\tlet str = '';\r\n \t\t\t\t\tstr = ToggleDesc[value];\r\n \t\t\t\t\tif('zjh' == gameType && ('dingzhu' == dataKey || 'dizhu' == dataKey)){\r\n\t\t\t\t\t\tlet baseDiZhus = [1,2,5,10];\r\n\t\t\t\t\t\tlet dizhuIdx = room.GetRoomConfigByProperty('dizhu');\r\n\t\t\t\t\t\tlet dizhu = baseDiZhus[dizhuIdx];\r\n\t\t\t\t\t\tlet dingzhu = 0;\r\n\t\t\t\t\t\tif(0 == value)\r\n\t\t\t\t            dingzhu = dizhu * 5;\r\n\t\t\t\t        else\r\n\t\t\t\t            dingzhu = dizhu * 10;\r\n\t\t\t\t        dizhu = dizhu * room.GetRoomConfigByProperty('baseMark');\r\n\t\t\t\t\t\tdingzhu = dingzhu * room.GetRoomConfigByProperty('baseMark');\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif('dingzhu' == dataKey)\r\n\t\t\t\t\t\t\tstr = dingzhu.toString() + '分';\r\n\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\tstr = dizhu.toString() + '分';\r\n\t\t\t\t\t}\r\n \t\t\t\t\tif (wanfa == ''){\r\n \t\t\t\t\t\twanfa = str;\r\n \t\t\t\t\t} else {\r\n \t\t\t\t\t\twanfa = wanfa + \"，\" + str;\r\n \t\t\t\t\t}\r\n \t\t\t\t}else if(ToggleType==1){\r\n \t\t\t\t\t//多选\r\n \t\t\t\t\tfor(let j=0;j<value.length;j++){\r\n \t\t\t\t\t\tif(wanfa==''){\r\n \t\t\t\t\t\t\twanfa=ToggleDesc[value[j]];\r\n \t\t\t\t\t\t}else{\r\n \t\t\t\t\t\t\twanfa=wanfa+\"，\"+ToggleDesc[value[j]];\r\n \t\t\t\t\t\t}\r\n \t\t\t\t\t}\r\n \t\t\t\t}\r\n            }\r\n        }\r\n \t\treturn wanfa;\r\n    },\r\n\r\n\t//设置微信预分享数据\r\n\tSetWeChatShareDataInfo:function(title, desc, argDict){\r\n\t\tif(!this.sdk){\r\n\t\t\tthis.Log(\"SetWeChatShareDataInfo not init sdk\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet gameLoadUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameLoadUrl\");\r\n\t\tlet weChatShareImageUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareImageUrl\");\r\n\r\n\t\t//如果没有传递参数字典\r\n\t\tif(!argDict){\r\n\t\t\targDict = {};\r\n\t\t}\r\n\r\n\t\tlet gameID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameID\");\r\n\t\tif(!gameID){\r\n\t\t\tthis.ErrLog(\"SetWeChatShareDataInfo not find GameID\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet mpID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"MPID\");\r\n\t\tif(!mpID){\r\n\t\t\tthis.ErrLog(\"SetWeChatShareDataInfo not find MPID\");\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//添加启动标示参数\r\n\t\targDict[\"ddmchannel\"] = \"wechat\";\r\n\t\targDict[\"ddmgameid\"] = gameID;\r\n\t\targDict[\"ddmmp\"] = mpID;\r\n\t\t//分享携带推广ID\r\n\t\targDict[\"popularizeID\"] = this.HeroManager.GetHeroID();\r\n\r\n\t\tgameLoadUrl += this.GetUrlStr(argDict);\r\n\r\n\t\tlet shareInfo = {\r\n\t\t\ttitle:title,\r\n\t\t\tdesc:desc,\r\n\t\t\tlink:gameLoadUrl,\r\n\t\t\timgUrl:weChatShareImageUrl,\r\n\t\t\ttype:\"link\",\r\n\t\t\tdataUrl:\"\",\r\n\t\t\tsuccess:this.ShareSuccess.bind(this),\r\n\t\t\tcancel:this.ShareCancel.bind(this),\r\n\t\t}\r\n\r\n\t\tthis.sdk.onMenuShareTimeline(shareInfo);\r\n\t\tthis.sdk.onMenuShareAppMessage(shareInfo);\r\n\t\tthis.sdk.onMenuShareQQ(shareInfo);\r\n\t\tthis.sdk.onMenuShareWeibo(shareInfo);\r\n\t\tthis.sdk.onMenuShareQZone(shareInfo);\r\n\t},\r\n\r\n\tGetUrlStr:function(dataDict){\r\n\r\n\t\tif(!dataDict){\r\n\t\t\treturn \"\"\r\n\t\t}\r\n\r\n\t\tvar argList = Object.keys(dataDict);\r\n\t\targList.sort();\r\n\t\tvar count = argList.length;\r\n\r\n\t\tvar urlSendStr = '?';\r\n\t\tfor(var index=0; index<count; index++){\r\n\t\t\tvar key = argList[index];\r\n\t\t\turlSendStr += key + '=' + dataDict[key] + '&';\r\n\t\t}\r\n\t\t//去掉最后一个&\r\n\t\turlSendStr = urlSendStr.substring(0, urlSendStr.length-1);\r\n\r\n\t\treturn urlSendStr;\r\n\t},\r\n\r\n\t//分享成功\r\n\tShareSuccess:function(){\r\n\t},\r\n\r\n\t//取消分享\r\n\tShareCancel:function(){\r\n\t},\r\n\r\n\tGetSDK:function(){\r\n\t\treturn this.sdk;\r\n\t},\r\n\r\n\tGetSDKProperty:function(property){\r\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\r\n\t\t\tthis.ErrLog(\"GetSDKProperty not find property:%s\", property);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\treturn this.dataInfo[property];\r\n\t},\r\n\t//---------------微信头像-------------------------\r\n\r\n\t//玩家登陆完成\r\n\tOnEvent_PlayerLoginOK:function(){\r\n\t\tlet heroID = this.HeroManager.GetHeroID();\r\n\t\tlet headImageUrl = this.HeroManager.GetHeroProperty(\"headImageUrl\");\r\n\t\t//初始化第3方玩家头像贴图\r\n\t\tthis.InitHeroHeadImage(heroID, headImageUrl);\r\n\t},\r\n\r\n\t//------------头像贴图初始化-------------\r\n\t//通过玩家ID初始化玩家头像\r\n\tInitHeroHeadImage:function(heroID, headImageUrl){\r\n\t\tif(!headImageUrl){\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame.SetDefault(heroID, {});\r\n\t\t//如果缓存的url地址没有变化,并且已经存在spriteFrame对象了,则不用申请贴图数据\r\n\t\tif(headSpriteFrameInfo[\"HeadImageUrl\"] == headImageUrl && headSpriteFrameInfo[\"SpriteFrame\"]){\r\n\t\t\treturn\r\n\t\t}\r\n\t\theadSpriteFrameInfo[\"HeadImageUrl\"] = headImageUrl;\r\n\t\theadSpriteFrameInfo[\"SpriteFrame\"] = null;\r\n\r\n\t\tlet headInfo = {};\r\n\t\theadInfo[heroID] = headImageUrl;\r\n\r\n\t\tthis.SendHttpLoadHeadImage(headInfo);\r\n\t},\r\n\r\n\t//通过字典初始化玩家头像\r\n\tInitHeroHeadImageByDict:function(heroHeadInfo){\r\n\t\tlet headInfo = {};\r\n\r\n\t\tfor(var heroID in heroHeadInfo){\r\n\t\t\tlet headImageUrl = heroHeadInfo[heroID];\r\n\t\t\tif(!headImageUrl){\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame.SetDefault(heroID, {});\r\n\t\t\t//如果缓存的url地址没有变化,并且已经存在spriteFrame对象了,则不用申请贴图数据\r\n\t\t\tif(headSpriteFrameInfo[\"HeadImageUrl\"] == headImageUrl && headSpriteFrameInfo[\"SpriteFrame\"]){\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\theadSpriteFrameInfo[\"HeadImageUrl\"] = headImageUrl;\r\n\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = null;\r\n\t\t\theadInfo[heroID] = headImageUrl;\r\n\t\t}\r\n\r\n\t\tif(Object.keys(headInfo).length){\r\n\t\t\tthis.SendHttpLoadHeadImage(headInfo);\r\n\t\t}\r\n\t},\r\n\r\n\t//发送封包请求\r\n\tSendHttpLoadHeadImage:function(headInfo){\r\n\r\n\t\tlet gameID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameID\");\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF09);\r\n\t\tsendPack.HeadInfo = headInfo;\r\n\t\tsendPack.GameID = gameID;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\t//接收到资源服务器下载资源回复\r\n\tOnHttpPack_HeadImagePathInfo:function(serverPack){\r\n\t\t// this.SysLog(\"OnHttpPack_HeadImagePathInfo serverPack:\", serverPack);\r\n\t\tlet resServerUrl = this.NetManager.GetResServerHttpAddress();\r\n\t\tif(!resServerUrl){\r\n\t\t\tthis.ErrLog(\"OnHttpPack_HeadImagePathInfo(%s,%s) not resServerUrl\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet bluebirdList = [];\r\n\t\tlet headPathInfo = serverPack[\"HeadPathInfo\"];\r\n\t\tfor(let heroID in headPathInfo){\r\n\t\t\tbluebirdList.push(this.CreateSpriteFrame(resServerUrl, heroID, headPathInfo[heroID]));\r\n\t\t}\r\n\r\n\t\tlet that = this;\r\n\r\n\t\tapp.bluebird.all(bluebirdList)\r\n\t\t\t.then(function(heroIDList){\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"RefreshHeadImageSprite\", {\"HeroIDList\":heroIDList});\r\n\t\t\t})\r\n\t\t\t.catch(function(error){\r\n\t\t\t\tthat.ErrLog(\"OnHttpPack_HeadImagePathInfo:%s\", error.stack)\r\n\t\t\t})\r\n\r\n\t},\r\n\r\n\t//创建头像贴图对象\r\n\tCreateSpriteFrame:function(resServerUrl, heroID, headPath){\r\n\t\tlet that = this;\r\n\r\n\t\tlet targetPath = [resServerUrl, headPath].join(\"/\");\r\n\r\n\t\treturn this.ControlManager.CreateLoadPromiseByUrl(targetPath)\r\n\t\t\t.then(function(texture){\r\n\t\t\t\tif(texture instanceof cc.Texture2D){\r\n\t\t\t\t\tlet spriteFrame = new cc.SpriteFrame(texture);\r\n\t\t\t\t\tlet headSpriteFrameInfo = that.heroHeadSpriteFrame.SetDefault(heroID, {});\r\n\t\t\t\t\theadSpriteFrameInfo[\"SpriteFrame\"] = spriteFrame;\r\n\t\t\t\t\treturn heroID\r\n\t\t\t\t}\r\n\t\t\t\telse{\r\n\t\t\t\t\tthat.ErrLog(\"texture not Texture2D\");\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(function(error){\r\n\t\t\t\tthat.ErrLog(\"OnHttpPack_HeadImagePathInfo error:%s\", error.stack);\r\n\t\t\t})\r\n\t},\r\n\r\n\t//获取指定玩家的第3方头像贴图对象\r\n\tGetHeroHeadSpriteFrame:function(heroID){\r\n\t\tlet headSpriteFrameInfo = this.heroHeadSpriteFrame[heroID];\r\n\t\tif(!headSpriteFrameInfo){\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn headSpriteFrameInfo[\"SpriteFrame\"];\r\n\t},\r\n\r\n\t//---------------------订单接口---------------------\r\n\t//收到预订单信息\r\n\tReceivePrepayOrder:function(serverPack){\r\n\t\tlet prepayOrderInfo = serverPack[\"PrepayOrderInfo\"];\r\n\r\n\t\tlet argDict = prepayOrderInfo[\"ArgDict\"];\r\n\r\n\t\targDict[\"success\"] = this.OnPayResult.bind(this);\r\n\t\tthis.sdk.chooseWXPay(argDict);\r\n\t},\r\n\r\n\t//接收到扫描支付回调\r\n\tReceivePrepayQRCodeOrder:function(serverPack){\r\n\t\tlet code_url = serverPack[\"Code_url\"];\r\n\r\n\t\tlet orderServerIP = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"OrderServerIP\");\r\n\t\tlet orderServerPort = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"OrderServerPort\");\r\n\r\n\t\tcode_url = [\"http://\",orderServerIP, \":\", orderServerPort, \"/\", code_url].join(\"\");\r\n\r\n\t\t//打开扫描支付页面\r\n\t\tcc.sys.openURL(code_url);\r\n\t},\r\n\r\n\t//支付结果通知\r\n\tOnPayResult:function(resultInfo){\r\n\r\n\t\t// this.SysLog(\"OnPayResult:\", resultInfo);\r\n\r\n\t\t//{\r\n\t\t//\t\"errMsg\":\"chooseWXPay:ok\"\r\n\t\t//}\r\n\t\tif(resultInfo[\"errMsg\"] == \"chooseWXPay:ok\"){\r\n\t\t\tconsole.log(\"支付成功\");\r\n\t\t}\r\n\t\telse{\r\n\t\t\tconsole.log(\"支付失败\");\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"CodeErrorMsg\", [\"微信公众号支付失败:\" + JSON.stringify(resultInfo)]);\r\n\t\t}\r\n\t},\r\n\r\n\t//---------------授权接口--------------------\r\n\t//微信授权\r\n\tLogin:function(){\r\n\t\tlet token = this.dataInfo[\"code\"];\r\n\t\tif(!token){\r\n\t\t\tthis.ErrLog(\"Login dataInfo not find code :\", this.dataInfo);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet mpID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"MPID\");\r\n\t\tif(!mpID){\r\n\t\t\tthis.ErrLog(\"Login not find MPID\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.HeroAccountManager.LoginAccountBySDK(this.ShareDefine.SDKType_WeChat, token, mpID);\r\n\t},\r\n\r\n\t//检查登录是否是短线重登\r\n\tCheckLoginBySDK:function(){\r\n\t\tlet token = this.dataInfo[\"code\"];\r\n\t\tif(!token){\r\n\t\t\tthis.ErrLog(\"Login dataInfo not find code :\", this.dataInfo);\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tlet mpID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"MPID\");\r\n\t\tif(!mpID){\r\n\t\t\tthis.ErrLog(\"Login not find MPID\");\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t//----------------发包接口------------------------\r\n\r\n\t//发送请求微信公众号sdk签名\r\n\tSendRequestWeChatSDKIntSign:function(){\r\n\r\n\t\tlet mpID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"MPID\");\r\n\t\t//没有配置公众号,不需要分享功能\r\n\t\tif(!mpID){\r\n\t\t\tthis.Log(\"SendRequestWeChatSDKIntSign not mpID\");\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//native版本不需要请求签名,H5才需要\r\n\t\tif(cc.sys.isNative){\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//如果网页没有加载wxSDK\r\n\t\tif(!this.wx){\r\n\t\t\tthis.ErrLog(\"SendRequestWeChatSDKIntSign not find wx\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet url = window.location.href.split('#')[0];\r\n\t\tif(!url){\r\n\t\t\tthis.ErrLog(\"SendRequestWeChatSDKIntSign  window.location.href:%s\",  window.location.href)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF06);\r\n\t\tsendPack.MPID = mpID;\r\n\t\tsendPack.Url = url;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\t//是否已经关注公众号\r\n\tSendIsSubscribeWeChatMP:function(){\r\n\r\n\t\tlet mpID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"MPID\");\r\n\t\t//没有配置公众号,不需要验证是否关注公众号\r\n\t\tif(!mpID){\r\n\t\t\tthis.ErrLog(\"SendIsSubscribeWeChatMP not find MPID\");\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet accountID = this.HeroAccountManager.GetAccountProperty(\"AccountID\");\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF05);\r\n\t\tsendPack.AccountID = accountID;\r\n\t\tsendPack.MPID = mpID;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\tWeChatShare:function(playgame,gameCfg=null){\r\n        let type=typeof(playgame);\r\n        if(type== 'number'){\r\n            playgame=app[app.subGameName + \"_ShareDefine\"]().GametTypeID2PinYin[playgame];\r\n        }\r\n        var WeChatShare=new Array();\r\n        let gameId = app[app.subGameName + \"_ShareDefine\"]().GametTypeNameDict[playgame.toUpperCase()];\r\n        var gamename=app[app.subGameName + \"_ShareDefine\"]().GametTypeID2Name[gameId];\r\n        var special='';\r\n        if(playgame){\r\n            special = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"RoomShare\"+playgame.toUpperCase());\r\n        }\r\n        let title='';\r\n        let desc='';\r\n        if(playgame){\r\n            title= app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareRoomTitle\");\r\n            title=title.replace('{游戏名}',gamename);\r\n            desc= app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareRoomDesc\");\r\n            desc=desc.replace('{游戏名}',gamename);\r\n        }else{\r\n            title= app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareTitle\");\r\n            desc= app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatShareDesc\");\r\n        }\r\n        let weChatAppShareUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"WeChatAppShareUrl\");  \r\n        let ShortShareUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"ShortShareUrl\");   \r\n        //获取HeroID\r\n        this.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n        this.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n        let heroID = app[app.subGameName + \"_HeroManager\"]().GetHeroProperty(\"pid\");\r\n        let ShortHeroID=this.ComTool.GetPid(heroID);\r\n        WeChatShare['title']=title;\r\n        WeChatShare['desc']=desc;\r\n        WeChatShare['special']=special;\r\n        WeChatShare['url']=weChatAppShareUrl+\"/\"+ShortHeroID+\"/\";\r\n\t\tconsole.log(\"WeXinShare WeChatShare:\",WeChatShare);\r\n        return WeChatShare;\r\n    },\r\n});\r\n\r\nvar g_pdk_WeChatManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_pdk_WeChatManager){\r\n\t\tg_pdk_WeChatManager = new pdk_WeChatManager();\r\n\t}\r\n\treturn g_pdk_WeChatManager;\r\n}"]}