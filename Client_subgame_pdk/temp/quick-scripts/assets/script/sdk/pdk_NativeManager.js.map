{"version":3,"sources":["pdk_NativeManager.js"],"names":["app","require","pdk_NativeManager","BaseClass","extend","Init","OCClassName","JavaClassName","JavaArgTypeDict","ComTool","subGameName","JS_Name","CallToNative","funName","argList","returnType","cc","sys","isNative","ErrLog","push","IsAndroid","CallToJava","IsIOS","CallToOC","os","javaFunName","javaFunArgList","javaFunSign","count","length","index","argInfo","hasOwnProperty","value","argType","Object","prototype","toString","call","slice","javaType","returnValueType","unshift","jsb","reflection","callStaticMethod","apply","error","ocFunName","ocFunArgList","funString","name","splice","g_pdk_NativeManager","exports","GetModel"],"mappings":"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","file":"pdk_NativeManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\sdk","sourcesContent":["/*\r\n * \tNativeManager.js\r\n * \t移动端接口管理器\r\n *\r\n *\tauthor:hongdian\r\n *\tdate:2014-10-28\r\n *\tversion:1.0\r\n *\r\n * 修改时间 修改人 修改内容:\r\n *\r\n * change: \"2014-10-28 20:24\" hongdian 同步C++\r\n *\r\n */\r\n\r\nvar app = require(\"pdk_app\");\r\n/**\r\n * 类构造\r\n */\r\nvar pdk_NativeManager = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t\tthis.OCClassName = \"NativeMgr\";\r\n\t\tthis.JavaClassName = \"org/cocos2dx/javascript/NativeMgr\";\r\n\t\tthis.JavaArgTypeDict = {\"Number\":\"I\", \"String\":\"Ljava/lang/String;\", \"Boolean\":\"Z\", \"Float\":\"F\"};\r\n\t\tthis.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n\t\tthis.JS_Name = app.subGameName + \"_NativeManager\";\r\n\t},\r\n\r\n\t//调用native平台接口\r\n\t//funName:函数名\r\n\t//参数顺序列表argList=[{\"Name\":\"Title\", \"Value\":\"xx\"},{\"Name\":\"Description\", \"Value\":\"xx\"},{\"Name\":\"URL\", \"Value\":\"xx\"}]\r\n\t//returnType 返回值类型\r\n\tCallToNative:function(funName, argList, returnType){\r\n\t\tif(!cc.sys.isNative){\r\n\t\t\tthis.ErrLog(\"CallToNative(%s) not native\", funName);\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//加入子游戏名字，以便回调到各个小游戏，大厅统一用hall\r\n\t\tlet subGameName = {\"Name\":\"subGameName\",\"Value\":app.subGameName};\r\n\t\targList.push(subGameName);\r\n\t\tif(this.ComTool.IsAndroid()){\r\n\t\t\treturn this.CallToJava(funName, argList, returnType);\r\n\t\t}\r\n\t\telse if(this.ComTool.IsIOS()){\r\n\t\t\treturn this.CallToOC(funName, argList, returnType);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.ErrLog(\"CallToNative:%s error\", cc.sys.os);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * 调用java接口\r\n\t * javaFunName MyAPIManager.java 对应函数名\r\n\t * argList argList 函数接受的参数列表\r\n\t * returnType returnType 函数返回值类型\r\n\t */\r\n\tCallToJava:function(javaFunName, argList, returnType){\r\n\t\t//jsb.reflection.callStaticMethod('org/cocos2dx/javascript/SDKManager',\r\n\t\t//'OnWeChatShare','(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V',\"当当猫\",\"当当猫分享\",\"www.ddmh5.com\",\"0\");\r\n\r\n\t\tlet javaFunArgList = [];\r\n\r\n\t\tlet javaFunSign = \"(\";\r\n\r\n\t\tlet count = argList.length;\r\n\t\tfor(let index=0; index<count; index++){\r\n\t\t\tlet argInfo = argList[index];\r\n\t\t\tif(!argInfo.hasOwnProperty(\"Value\")){\r\n\t\t\t\tthis.ErrLog(\"CallToJava argInfo error\", argInfo);\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tlet value = argInfo[\"Value\"];\r\n\t\t\tlet argType = Object.prototype.toString.call(value).slice(\"[object \".length, -1);\r\n\t\t\tlet javaType = this.JavaArgTypeDict[argType];\r\n\t\t\tif(!javaType){\r\n\t\t\t\tthis.ErrLog(\"CallToJava(%s, %j) error\", javaFunName, argList);\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tjavaFunSign += javaType;\r\n\r\n\t\t\tjavaFunArgList.push(value);\r\n\t\t}\r\n\r\n\t\tlet returnValueType = this.JavaArgTypeDict[returnType];\r\n\t\t//如果有返回值\r\n\t\tif(returnValueType){\r\n\t\t\tjavaFunSign += \")\" + returnValueType;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tjavaFunSign += \")V\";\r\n\t\t}\r\n\t\tjavaFunArgList.unshift(this.JavaClassName, javaFunName, javaFunSign);\r\n\r\n\r\n\t\ttry{\r\n\t\t\treturn jsb.reflection.callStaticMethod.apply(this, javaFunArgList);\r\n\t\t}\r\n\t\tcatch (error){\r\n\t\t\t// this.ErrLog(\"CallToJava(%s,%s,%s) error:%s\", javaFunName, JSON.stringify(argList), returnType, error.stack);\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * 调用oc接口\r\n\t * javaFunName MyAPIManager.java 对应函数名\r\n\t * argList argList 函数接受的参数列表\r\n\t * returnType returnType 函数返回值类型\r\n\t */\r\n\tCallToOC:function(ocFunName, argList){\r\n\t\t//jsb.reflection.callStaticMethod(this.OCClassName,''OnWeChatShareWithTitle: Description: URL:Type:','红中麻将','红中麻将分享','www.ddmh5.com',\"0\");\r\n\r\n\t\tlet ocFunArgList = [];\r\n\t\tocFunArgList.push(this.OCClassName);\r\n\r\n\t\tlet funString = ocFunName;\r\n\t\tlet count = argList.length;\r\n\t\tfor(let index=0; index < count; index++){\r\n\t\t\tlet argInfo = argList[index];\r\n\t\t\tlet name = argInfo[\"Name\"];\r\n\t\t\tlet value = argInfo[\"Value\"];\r\n\r\n\t\t\tif(!name){\r\n\t\t\t\tthis.ErrLog(\"CallToOC(%s) argInfo error\", ocFunName, argInfo);\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif(index){\r\n\t\t\t\tfunString += name + \":\";\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfunString += \"With\" + name + \":\";\r\n\t\t\t}\r\n\r\n\t\t\tocFunArgList.push(value);\r\n\t\t}\r\n\t\t//插入函数签名\r\n\t\tocFunArgList.splice(1, 0, funString);\r\n\r\n\t\ttry{\r\n\t\t\t// this.SysLog(\"javaFunArgList CallToOC(%s)\", JSON.stringify(ocFunArgList));\r\n\t\t\treturn jsb.reflection.callStaticMethod.apply(this, ocFunArgList);\r\n\t\t}\r\n\t\tcatch (error){\r\n\t\t\t// this.ErrLog(\"CallToOC(%s,%s) error:%s\", ocFunName, JSON.stringify(argList), error.stack);\r\n\t\t}\r\n\r\n\t},\r\n})\r\n\r\nvar g_pdk_NativeManager = null\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_pdk_NativeManager){\r\n\t\tg_pdk_NativeManager = new pdk_NativeManager();\r\n\t}\r\n\treturn g_pdk_NativeManager;\r\n}"]}