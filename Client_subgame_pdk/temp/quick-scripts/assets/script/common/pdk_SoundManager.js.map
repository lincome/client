{"version":3,"sources":["pdk_SoundManager.js"],"names":["app","require","pdk_SoundManager","BaseClass","extend","Init","JS_Name","subGameName","SysDataManager","LocalDataManager","Sound","GetTableDict","volume","loadSoundNameList","Log","PlayBackMusic","soundName","filePath","backVolume","GetConfigProperty","bluebird","resolve","soundInfo","ErrLog","InArray","WarnLog","push","that","isLoop","promisefunc","reject","cc","loader","loadRes","AudioClip","error","clip","Remove","StopAllSound","soundID","audioEngine","play","PlaySound","spSound","spVolume","PauseAllSound","pauseAll","PauseSound","audioID","pause","ResumeAllSound","resumeAll","ResumeSound","resume","stopAll","StopSoundByAudioID","stop","ClearSound","uncache","url","raw","ClearAllSound","uncacheAll","g_pdk_SoundManager","exports","GetModel"],"mappings":"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","file":"pdk_SoundManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n 声音管理器\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_SoundManager = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t\tthis.JS_Name = app.subGameName + \"_SoundManager\";\r\n\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.LocalDataManager = app.LocalDataManager();\r\n\t\tthis.Sound = this.SysDataManager.GetTableDict(\"Sound\");\r\n\t\t//音量\r\n\t\tthis.volume = 1;\r\n\r\n\t\tthis.loadSoundNameList = [];\r\n\t\tthis.Log(\"Init\");\r\n\t},\r\n\r\n\r\n\t//播放背景音乐\r\n\tPlayBackMusic:function(soundName, filePath = \"\"){\r\n\t\t// let backMusic = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackMusic\");\r\n\t\tlet backVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackVolume\");\r\n\t\t//如果关闭音效\r\n\t\tif(!backVolume){\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\t\tif (filePath == \"\") {\r\n\t\t\tlet soundInfo = this.Sound[soundName];\r\n\t\t\tif(!soundInfo){\r\n\t\t\t\tthis.ErrLog(\"PlayBackMusic(%s) not find\", soundName);\r\n\t\t\t\treturn app.bluebird.resolve(0)\r\n\t\t\t}\r\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\r\n\t\t}else{\r\n\t\t\tfilePath = filePath;\r\n\t\t}\r\n\r\n\t\tif(this.loadSoundNameList.InArray(soundName)){\r\n\t\t\tthis.WarnLog(\"PlayBackMusic loadSoundNameList(%s) have find\", soundName);\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\r\n\t\tthis.loadSoundNameList.push(soundName);\r\n\t\tvar that = this;\r\n\r\n\t\tlet isLoop = true;\r\n\t\tlet promisefunc = function(resolve, reject){\r\n\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function(error, clip){\r\n\r\n\t\t\t\tif(error && error != true){\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthat.loadSoundNameList.Remove(soundName);\r\n\t\t\t\tthat.StopAllSound();\r\n\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, backVolume);\r\n\t\t\t\tresolve(soundID);\r\n\t\t\t})};\r\n\t\treturn new app.bluebird(promisefunc);\r\n\t},\r\n\r\n\t//播放音效(返回audioID)\r\n\tPlaySound:function(soundName, filePath = \"\", isLoop = false){\r\n\r\n\t\tlet spSound = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpSound\");\r\n\t\tlet spVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpVolume\");\r\n\t\t//如果关闭音效\r\n\t\tif(!spSound){\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\t\tif (filePath == \"\") {\r\n\t\t\tlet soundInfo = this.Sound[soundName];\r\n\t\t\tif(!soundInfo){\r\n\t\t\t\tthis.ErrLog(\"PlaySound(%s) not find\", soundName);\r\n\t\t\t\treturn app.bluebird.resolve(0)\r\n\t\t\t}\r\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\r\n\t\t}else{\r\n\t\t\tfilePath = filePath;\r\n\t\t}\r\n\t\tif(!isLoop){\r\n\t\t\tisLoop = false;\r\n\t\t}\r\n\r\n\t\tif(this.loadSoundNameList.InArray(soundName)){\r\n\t\t\tthis.WarnLog(\"loadSoundNameList(%s) have find\", soundName);\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\r\n\t\tthis.loadSoundNameList.push(soundName);\r\n\t\tvar that = this;\r\n\r\n\t\tlet promisefunc = function(resolve, reject){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function(error, clip){\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif(error && error != true){\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treject(error);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tthat.loadSoundNameList.Remove(soundName);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, spVolume)\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tresolve(soundID);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t})};\r\n\t\treturn new app.bluebird(promisefunc);\r\n\t},\r\n\r\n\t//暂停所有音效\r\n\tPauseAllSound:function(){\r\n\t\tcc.audioEngine.pauseAll();\r\n\t},\r\n\t//暂停正在播放音频。\r\n    PauseSound:function (audioID) {\r\n        cc.audioEngine.pause(audioID);\r\n    },\r\n\t//恢复所有暂停的音效\r\n\tResumeAllSound:function(){\r\n\t\tcc.audioEngine.resumeAll();\r\n\t},\r\n\t//恢复播放指定的音频。\r\n    ResumeSound:function (audioID) {\r\n        cc.audioEngine.resume(audioID);\r\n    },\r\n\t//停止所有正在播放的音效\r\n\tStopAllSound:function(){\r\n\t\tcc.audioEngine.stopAll();\r\n\t},\r\n\r\n\tStopSoundByAudioID:function(audioID){\r\n\t\tcc.audioEngine.stop(audioID);\r\n\t},\r\n\r\n\t//清除音效加载的资源\r\n\tClearSound:function(soundName){\r\n\r\n\t\tlet soundInfo = this.Sound[soundName];\r\n\t\tif(!soundInfo){\r\n\t\t\tthis.ErrLog(\"ClearSound(%s) not find\", soundName);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tcc.audioEngine.uncache(cc.url.raw(soundInfo[\"SoundPath\"]));\r\n\t},\r\n\r\n\tClearAllSound:function(){\r\n\t\tcc.audioEngine.uncacheAll();\r\n\t},\r\n\r\n\r\n});\r\n\r\n\r\nvar g_pdk_SoundManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_pdk_SoundManager){\r\n\t\tg_pdk_SoundManager = new pdk_SoundManager();\r\n\t}\r\n\treturn g_pdk_SoundManager;\r\n}"]}