{"version":3,"sources":["pdk_LocationOnStartMgr.js"],"names":["app","require","pdk_LocationOnStartMgr","BaseClass","extend","extends","cc","Component","properties","Init","Log","subGameName","JS_Name","GetLocation_Success","GetLocation_Error","isSendAddress","SendGetLocation","isGetError","that","setTimeout","SendPack","MyAddress","MyLatitudeEx","MyLongitudeEx","OnGetLocationCallBack","serverPack","console","log","GetLocationForBaiduMap","OnGetLocation","sys","isNative","SendDefaultLocation","CallToNative","num1","Math","floor","random","num2","OnGetLocationForBaiduMapCallBack","g_pdk_LocationOnStartMgr","exports","GetModel"],"mappings":"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","file":"pdk_LocationOnStartMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/**\r\n * 定位服务类\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_LocationOnStartMgr = app.BaseClass.extend({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    Init:function(){\r\n        this.Log(app.subGameName + \"_LocationOnStartMgr Init\");\r\n        this.JS_Name = app[\"subGameName\"] + \"_LocationOnStartMgr\";\r\n        this.GetLocation_Success      = 0;                        //获取位置成功\r\n        this.GetLocation_Error        = 1;                        //获取位置失败\r\n        this.isSendAddress=false;  //是否已经发送位置,3秒内只能发一次\r\n    },\r\n    //发送请求玩家定位服务\r\n    SendGetLocation:function(isGetError){\r\n        //启动5秒不发送机制\r\n        if(this.isSendAddress==true){\r\n            return;\r\n        }\r\n        this.isSendAddress=true;\r\n        let that=this;\r\n        setTimeout(function(){\r\n            that.isSendAddress = false;\r\n        },5000);\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(\"game.CGetLocationEx\", {\"Address\":this.MyAddress,\"Latitude\":this.MyLatitudeEx, \"Longitude\":this.MyLongitudeEx,\"isGetError\":isGetError});\r\n    },\r\n    //获取定位\r\n    OnGetLocationCallBack:function(serverPack){\r\n        let isGetError = false;\r\n        this.MyAddress = '';\r\n        if(serverPack[\"state\"] == this.GetLocation_Error){\r\n            isGetError = true;\r\n            this.MyAddress=\"\";\r\n            this.MyLatitudeEx = 0;\r\n            this.MyLongitudeEx = 0;\r\n            this.SendGetLocation(isGetError);\r\n            // 高德定位失败, 调用百度定位。\r\n            console.log(`>>>>>>>>>>_NativeNotify： baiduMap start location！`);\r\n            this.GetLocationForBaiduMap();\r\n            return;\r\n        }\r\n        this.MyLatitudeEx = serverPack[\"Latitude\"];\r\n        this.MyLongitudeEx = serverPack[\"Longitude\"];\r\n        this.MyAddress =serverPack[\"City\"]+serverPack[\"District\"]+serverPack[\"Street\"];\r\n        this.SendGetLocation(isGetError);\r\n    },\r\n    \r\n    //获取定位\r\n    OnGetLocation:function(){\r\n        if(!cc.sys.isNative){\r\n            this.SendDefaultLocation();\r\n            return;\r\n        }else{\r\n            //手机调用gprs调用上去\r\n            app[app.subGameName + \"_NativeManager\"]().CallToNative(\"GetLocation\", []);\r\n        }\r\n    },\r\n\r\n    // 默认定位\r\n    SendDefaultLocation:function(){\r\n        var num1=Math.floor(Math.random()*10+1);\r\n        var num2=Math.floor(Math.random()*10+1);\r\n        //网页测试随机发送定位上去\r\n        let isGetError = false;\r\n        if(num1>9){\r\n        //    isGetError = true;\r\n        }\r\n        this.MyAddress=\"福建省厦门市思明区软件园二期望海路35号\";\r\n        this.MyLatitudeEx = 24.48591905381944+num1;\r\n        this.MyLongitudeEx = 118.1971853298611-num2;\r\n        this.SendGetLocation(isGetError);\r\n    },\r\n\r\n    // ================= 百度地图 ==========================\r\n    //百度地图获取定位\r\n    GetLocationForBaiduMap:function(){\r\n        if(!cc.sys.isNative){\r\n            this.SendDefaultLocation();\r\n            return;\r\n        }else{\r\n            //手机调用gprs调用上去\r\n            app[app.subGameName + \"_NativeManager\"]().CallToNative(\"GetLocationForBaiduMap\", []);\r\n        }\r\n    },\r\n\r\n    // 百度地图获取定位结果\r\n    OnGetLocationForBaiduMapCallBack:function(serverPack){\r\n        app[app.subGameName + \"_NativeManager\"]().CallToNative(\"StopLocationForBaiduMap\", []); // 停止定位。\r\n\r\n        let isGetError = false;\r\n        this.MyAddress = '';\r\n\r\n        if(serverPack[\"state\"] == this.GetLocation_Error){\r\n            isGetError = true;\r\n            this.MyAddress=\"\";\r\n            this.MyLatitudeEx = 0;\r\n            this.MyLongitudeEx = 0;\r\n            this.SendGetLocation(isGetError);\r\n            return;\r\n        }\r\n        this.MyLatitudeEx = serverPack[\"Latitude\"];\r\n        this.MyLongitudeEx = serverPack[\"Longitude\"];\r\n        this.MyAddress =serverPack[\"City\"]+serverPack[\"District\"]+serverPack[\"Street\"];\r\n        this.SendGetLocation(isGetError);\r\n    },\r\n\r\n});\r\n\r\n\r\nvar g_pdk_LocationOnStartMgr = null;\r\n  /**\r\n  ...\r\n  */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_LocationOnStartMgr){\r\n        g_pdk_LocationOnStartMgr = new pdk_LocationOnStartMgr();\r\n    }\r\n    return g_pdk_LocationOnStartMgr;\r\n}"]}