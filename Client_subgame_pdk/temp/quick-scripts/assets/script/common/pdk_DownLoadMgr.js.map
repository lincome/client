{"version":3,"sources":["pdk_DownLoadMgr.js"],"names":["app","require","DownLoadstate","DwonLoadState_Finish","DwonLoadState_Error","DwonLoadState_Progress","pdk_DownLoadMgr","BaseClass","extend","extends","cc","Component","properties","Init","JS_Name","subGameName","serverUrl","loaclPath","fileName","downloadType","count","OnTimer","passSecond","ShowSysMsg","DownFile","Director","getInstance","getScheduler","unschedule","OnConFirm","clickType","msgID","backArgList","ErrLog","localPath","argList","value","CallToNative","OnDownFileFinish","serverPack","OnEvent","OnDownFileError","isScheduled","schedule","OnDownFileProgress","OnDownLoadEvent","GetDownLoadStateError","DownLoadMgr","GetDownLoadStateFinish","GetDownLoadStateProgress","apply","g_pdk_DownLoadMgr","exports","GetModel"],"mappings":"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","file":"pdk_DownLoadMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    下载管理类\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\nvar DownLoadstate = function(){\r\n    //下载事件\r\n    this.DwonLoadState_Finish       = 0;//下载完成\r\n    this.DwonLoadState_Error        = 1;//下载失败\r\n    this.DwonLoadState_Progress     = 2;//下载进度\r\n};\r\n\r\nvar pdk_DownLoadMgr = app.BaseClass.extend({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    Init:function(){\r\n        this.JS_Name = app.subGameName + \"_DownLoadMgr\";\r\n        \r\n        this.serverUrl = null;\r\n        this.loaclPath = null;\r\n        this.fileName = null;\r\n        this.downloadType  = null;\r\n        this.count = 0\r\n\r\n\r\n        //下载事件\r\n        //this.DwonLoadState_Finish       = 0;//下载完成\r\n        //this.DwonLoadState_Error        = 1;//下载失败\r\n        //this.DwonLoadState_Progress     = 2;//下载进度\r\n\r\n        //this.DownFile(\"http://voice.qp355.com:8080/mp3/20170705/1499260230432a2c41d49b5575fab91b8fd37f5e16.amr\", \"/data/user/0/com.ddmh5.p7/files/100191499260129329.amr\", \"deleteString\",  \"AMRFILEDOWNLOADFINISH\" );\r\n    },\r\n\r\n    //1秒回掉\r\n    OnTimer:function(passSecond){\r\n        app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"MSG_DOWNLOAD_ERROR\");\r\n        this.count++;\r\n        // if(this.count > 3){\r\n        //     let msgID = \"Net_ReconnectConnectFail\";\r\n        //     let ConfirmManager = app[app.subGameName + \"_ConfirmManager\"]();\r\n        //     ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n        //     ConfirmManager.ShowConfirm(app[app.subGameName + \"_ShareDefine\"]().ConfirmOK, msgID, [])\r\n\r\n        //     cc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n        //     return;\r\n        // }\r\n        this.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n        cc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n    },\r\n\r\n    //确认框点击\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n        if(clickType != \"Sure\"){\r\n            return\r\n        }\r\n\r\n        //如果是尝试继续重连\r\n        if(msgID == \"Net_ReconnectConnectFail\"){\r\n            this.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n        }else{\r\n            this.ErrLog(\"OnConFirm:%s\", msgID);\r\n        }\r\n    },\r\n\r\n    //下载文件  filename 没有值是设置为deleteString\r\n    DownFile:function(serverUrl, localPath, fileName,  downloadType ){\r\n        if(serverUrl == null || localPath == null || downloadType == null){\r\n            this.ErrLog(\"DownFile serverUrl == null || localPath == null || downloadType == null\");\r\n            return;\r\n        }\r\n        this.serverUrl = serverUrl;\r\n        this.loaclPath = localPath;\r\n        this.fileName = fileName;\r\n        this.downloadType  = downloadType;\r\n        //this.count = 0\r\n        let argList = [{\"Name\":\"urls\",\"Value\":serverUrl},{\"Name\":\"fileName\",\"Value\":fileName},{\"Name\":\"savePath\",\"Value\":localPath},{\"Name\":\"downloadType\",\"Value\":downloadType}];\r\n        let value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"downLoadFile\", argList);   \r\n    },\r\n\r\n    //下载完成\r\n    OnDownFileFinish:function(serverPack){\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n        this.serverUrl = null;\r\n        this.loaclPath = null;\r\n        this.fileName = null;\r\n        this.downloadType  = null;\r\n        this.count = 0\r\n    },\r\n\r\n    //下载失败\r\n    OnDownFileError:function(serverPack){\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n        if(! cc.Director.getInstance().getScheduler().isScheduled(this.OnTimer, this)) {\r\n            cc.Director.getInstance().getScheduler().schedule(this.OnTimer, this, 3.0);\r\n        }\r\n\r\n        \r\n    },\r\n\r\n    //下载进度\r\n    OnDownFileProgress:function(serverPack){\r\n        //app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], {\"progress\": serverPack[\"proess\"]});\r\n        app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n    },\r\n\r\n    //下载事件\r\n    OnDownLoadEvent:function(serverPack){\r\n        if(serverPack[\"state\"] == pdk_DownLoadMgr.DwonLoadState_Finish){\r\n            this.OnDownFileFinish(serverPack);\r\n        }else if(serverPack[\"state\"] == pdk_DownLoadMgr.DwonLoadState_Error){\r\n            this.OnDownFileError(serverPack);\r\n        }else if (serverPack[\"state\"] == pdk_DownLoadMgr.DwonLoadState_Progress){\r\n            this.OnDownFileProgress(serverPack);\r\n        }\r\n    },\r\n\r\n    //获取失败标识\r\n    GetDownLoadStateError:function(){\r\n        return DownLoadMgr.DwonLoadState_Error;\r\n    },\r\n    //获取成功标识\r\n    GetDownLoadStateFinish:function(){\r\n        return DownLoadMgr.DwonLoadState_Finish;\r\n    },\r\n    //获取进度标识\r\n    GetDownLoadStateProgress:function(){\r\n        return DownLoadMgr.DwonLoadState_Progress;\r\n    },\r\n});\r\n\r\n\r\nDownLoadstate.apply(pdk_DownLoadMgr, []);\r\n\r\nvar g_pdk_DownLoadMgr = null;\r\n  /**\r\n  ...\r\n  */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_DownLoadMgr){\r\n        g_pdk_DownLoadMgr = new pdk_DownLoadMgr();\r\n    }\r\n    return g_pdk_DownLoadMgr;\r\n}"]}