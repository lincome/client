{"version":3,"sources":["pdk_ControlManager.js"],"names":["app","require","pdk_ControlManager","BaseClass","extend","Init","JS_Name","cc","game","on","EVENT_HIDE","OnEventHide","bind","EVENT_SHOW","OnEventShow","catchDataDict","subGameName","CreateLoadPromise","resPath","resType","that","hasOwnProperty","loadData","bluebird","resolve","promisefunc","reject","loader","loadRes","error","ErrLog","stack","CreateLoadPromiseByUrl","load","CreateLoadDirPromise","loadResAll","loadDataList","ReleaseAllRes","key","console","log","indexOf","releaseRes","off","g_pdk_ControlManager","exports","GetModel"],"mappings":"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","file":"pdk_ControlManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    控制器管理器\r\n*/\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_ControlManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n        this.JS_Name = app[\"subGameName\"] + \"_ControlManager\";\r\n        \r\n        cc.game.on(cc.game.EVENT_HIDE,  this.OnEventHide.bind(this));\r\n        cc.game.on(cc.game.EVENT_SHOW,  this.OnEventShow.bind(this));\r\n\r\n        this.catchDataDict = {};\r\n    },\r\n\r\n    //--------------回掉函数---------------\r\n    //应用切入后台\r\n    OnEventHide:function(){\r\n        app[app.subGameName + \"Client\"].OnEventHide();\r\n        \r\n    },\r\n\r\n    //应用显示\r\n    OnEventShow:function(){\r\n        app[app.subGameName + \"Client\"].OnEventShow();\r\n    },\r\n\r\n    //---------------加载资源-----------------\r\n\r\n    //创建异步下载资源对象\r\n    CreateLoadPromise:function(resPath, resType=\"\"){\r\n        let that = this;\r\n\t    //如果已经加载\r\n\t    if(this.catchDataDict.hasOwnProperty(resPath)){\r\n\t\t    let loadData = this.catchDataDict[resPath];\r\n\t\t    return app.bluebird.resolve(loadData)\r\n\t    }\r\n        \r\n        // let gamePath = jsb.fileUtils.getSearchPaths() + \"resources/\" + resPath;\r\n        \r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            \r\n            cc.loader.loadRes(resPath, resType, function (error, loadData) {\r\n                if(error){\r\n                    reject(error);\r\n                    that.ErrLog(\"CreateLoadPromise failed resPath(%s) resType(%s), error:%s\", resPath, resType, error.stack);\r\n                    that.ErrLog(\"CreateLoadPromise loadData(%s)\", loadData);\r\n                    \r\n                    return\r\n                }\r\n                that.catchDataDict[resPath] = loadData;\r\n\r\n                resolve(loadData);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);\r\n    },\r\n\r\n    //加载JSON文件 cc.url.raw('resources/json/' + jsonFileName + \".json\");\r\n    CreateLoadPromiseByUrl:function(resPath){\r\n        let that = this;\r\n\r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            cc.loader.load(resPath, function (error, loadData) {\r\n\r\n                if(error){\r\n                    reject(error);\r\n                    return\r\n                }\r\n\r\n                resolve(loadData);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);   \r\n    },\r\n\r\n    //创建异步下载文件夹所有文件对象\r\n    CreateLoadDirPromise:function(resPath, resType=\"\"){\r\n        //创建异步函数\r\n        let promisefunc = function(resolve, reject){\r\n            //加载资源\r\n            cc.loader.loadResAll(resPath, resType, function (error, loadDataList) {\r\n\r\n                if(error){\r\n                    reject(error);\r\n                    return\r\n                }\r\n\r\n                resolve(loadDataList);\r\n            })};\r\n        //返回异步对象\r\n        return new app.bluebird(promisefunc);\r\n    },\r\n\r\n    //---------------释放资源-----------------\r\n    ReleaseAllRes:function(){\r\n        for(var key in this.catchDataDict){\r\n            console.log(\"ReleaseAllRes key:\" + key);\r\n            if (key.indexOf(\"jsonData\") > -1) {\r\n                //只释放配表资源\r\n                cc.loader.releaseRes(key);\r\n            }\r\n        }\r\n        this.catchDataDict = {};\r\n        cc.game.off(cc.game.EVENT_HIDE,  this.OnEventHide.bind(this));\r\n        cc.game.off(cc.game.EVENT_SHOW,  this.OnEventShow.bind(this));\r\n    },\r\n});\r\n\r\n\r\nvar g_pdk_ControlManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_ControlManager){\r\n        g_pdk_ControlManager = new pdk_ControlManager();\r\n    }\r\n    return g_pdk_ControlManager;\r\n}"]}