{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\game\\PDK/assets\\script\\game\\PDK\\pdk_UIInvitation.js"],"names":["app","require","cc","Class","extends","Component","properties","onLoad","invitationNode","node","getChildByName","userLayout","messageScrollView","getComponent","ScrollView","on","GetNextPage","clubId","unionId","roomID","curPage","InitData","scrollToTop","active","GetPlayerData","sendPack","pageNum","size","self","removeAllChildren","subGameName","SendPack","toUpperCase","serverPack","ShowPlayerData","error","demo","i","length","userNode","instantiate","name","addChild","userName","substring","Label","string","heroID","idStr","ReplacePosToStr","toString","headImageUrl","InitHeroHeadImage","weChatHeadImage","ShowHeroHead","Button","interactable","userData","OnClick_BtnWnd","eventTouch","eventData","PlaySound","btnNode","currentTarget","btnName","OnClick","console","log","stack","clickUserData","parent","pid"],"mappings":"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","file":"pdk_UIInvitation.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\game\\PDK","sourcesContent":["/*\r\n UIMessage 模态消息界面\r\n */\r\n\r\nvar app = require(\"pdk_app\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    //初始化\r\n    onLoad:function(){\r\n        this.invitationNode = this.node.getChildByName(\"invitationNode\");\r\n        this.userLayout = this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getChildByName(\"userLayout\");\r\n        let messageScrollView = this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getComponent(cc.ScrollView);\r\n        messageScrollView.node.on('scroll-to-bottom',this.GetNextPage,this);\r\n        this.clubId = 0;\r\n        this.unionId = 0;\r\n        this.roomID = 0;\r\n        this.curPage = 1;\r\n    },\r\n    //---------显示函数--------------------\r\n    InitData:function (clubId, unionId, roomID) {\r\n        this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getComponent(cc.ScrollView).scrollToTop();\r\n        this.invitationNode.active = false;\r\n        this.curPage = 1;\r\n        this.clubId = clubId;\r\n        this.unionId = unionId;\r\n        this.roomID = roomID;\r\n    },\r\n    GetNextPage:function(){\r\n        this.curPage =this.curPage+1;\r\n        this.GetPlayerData();\r\n    },\r\n    GetPlayerData:function(){\r\n        let sendPack = {};\r\n        sendPack.clubId = this.clubId;\r\n        sendPack.unionId = this.unionId;\r\n        sendPack.pageNum = this.curPage;\r\n        sendPack.roomID = this.roomID;\r\n        sendPack.size = 18;\r\n        let self = this;\r\n        if(this.curPage==1){\r\n            this.userLayout.removeAllChildren();\r\n            this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getComponent(cc.ScrollView).scrollToTop();\r\n        }\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName+'.C'+app.subGameName.toUpperCase()+'RoomInvitationList', sendPack, function(serverPack){\r\n            self.ShowPlayerData(serverPack);\r\n        },function(error){\r\n\r\n        });\r\n    },\r\n    ShowPlayerData:function(serverPack){\r\n        if(this.curPage==1){\r\n            this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getComponent(cc.ScrollView).scrollToTop();\r\n        }\r\n        let demo=this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"demo\");\r\n        for (let i = 0; i < serverPack.length; i++) {\r\n            let userNode = cc.instantiate(demo);\r\n            userNode.name=\"user\"+(i+1);\r\n            this.userLayout.addChild(userNode);\r\n            let userName = serverPack[i][\"name\"];\r\n            if (userName.length >= 6) {\r\n                userName = userName.substring(0,6) + \"...\";\r\n            }\r\n            userNode.getChildByName(\"lb_name\").getComponent(cc.Label).string = userName;\r\n            let heroID = serverPack[i][\"pid\"];\r\n            let idStr = app[app.subGameName + \"_ComTool\"]().ReplacePosToStr(heroID.toString(), 2, 5, \"****\");\r\n            userNode.getChildByName(\"lb_id\").getComponent(cc.Label).string = idStr;\r\n            //用户头像创建\r\n            let headImageUrl = serverPack[i][\"iconUrl\"];\r\n            if(heroID && headImageUrl){\r\n                app[app.subGameName + \"_WeChatManager\"]().InitHeroHeadImage(heroID, headImageUrl);\r\n            }\r\n            let weChatHeadImage=userNode.getChildByName('head').getComponent(app.subGameName + \"_WeChatHeadImage\");\r\n            weChatHeadImage.onLoad();\r\n            weChatHeadImage.ShowHeroHead(heroID);\r\n            userNode.getChildByName(\"btn_invitation\").getComponent(cc.Button).interactable = true;\r\n            userNode.userData = serverPack[i];\r\n            userNode.active = true;\r\n        }\r\n    },\r\n    //控件点击回调\r\n    OnClick_BtnWnd:function(eventTouch, eventData){\r\n        try{\r\n            app[app.subGameName + \"_SoundManager\"]().PlaySound(\"BtnClick\");\r\n            let btnNode = eventTouch.currentTarget;\r\n            let btnName = btnNode.name;\r\n            this.OnClick(btnName, btnNode);\r\n        }\r\n        catch (error){\r\n            console.log(\"OnClick_BtnWnd:\"+error.stack);\r\n        }\r\n    },\r\n    //---------点击函数---------------------\r\n    OnClick:function(btnName, btnNode){\r\n        if(btnName == \"btn_close\"){\r\n            this.userLayout.removeAllChildren();\r\n            this.invitationNode.getChildByName(\"img_bjl\").getChildByName(\"scrollview\").getComponent(cc.ScrollView).scrollToTop();\r\n            this.invitationNode.active = false;\r\n        }else if(btnName == \"btn_reGet\"){\r\n            this.curPage = 1;\r\n            this.GetPlayerData();\r\n        }else if(btnName == \"btn_invitation\"){\r\n            let clickUserData = btnNode.parent.userData;\r\n            let sendPack = {};\r\n            sendPack.clubId = this.clubId;\r\n            sendPack.unionId = this.unionId;\r\n            sendPack.pid = clickUserData.pid;\r\n            sendPack.roomID = this.roomID;\r\n            let self = this;\r\n            app[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName+'.C'+app.subGameName.toUpperCase()+'RoomInvitationOperation', sendPack, function(serverPack){\r\n                btnNode.getComponent(cc.Button).interactable = false;\r\n            });\r\n        }else if (btnName == \"btn_invitationOnline\") {\r\n            if (this.roomID == 0) {\r\n                return;\r\n            }\r\n            this.curPage = 1;\r\n            this.GetPlayerData();\r\n            this.invitationNode.active = true;\r\n        }\r\n    },\r\n\r\n});\r\n\r\n"]}