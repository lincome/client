{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\pdk_HeroAccountManager.js"],"names":["app","require","pdk_HeroAccountManager","BaseClass","extend","Init","JS_Name","subGameName","NetManager","LocalDataManager","ShareDefine","SysNotifyManager","SysDataManager","RegHttpNetPack","OnHttpPack_AccountLogin","OnHttpPack_RegAccountResult","OnHttpPack_ChangeAccountPswResult","RegEvent","Event_CodeError","Event_ConnectFail","Event_ConnectHttpFail","Event_ConnectSuccess","PswReg","AccountReg","AccountFirstStrReg","OnReload","localAccountDict","logInAccountList","InitLocalAccount","lastChangeTime","IsDoLogining","dataInfo","event","codeInfo","KickOut_AccountAuthorizationFail","accountType","GetClientConfigProperty","SDKType_WeChat","gameLoadUrl","window","location","href","SetConfigProperty","IsFormShow","UpdateAccessPoint","now","Date","getTime","ChangeAccessPoint","InitServerAddress","cc","sys","isNative","AccessPoint","GetConfigProperty","accountDict","accountList","charAccount","InArray","ErrLog","AddNewAccountList","account","token","Remove","push","SavePlayerAccount","DeleteLocalAccount","DeleteAllLocalAccount","GetAccountToken","hasOwnProperty","GetLocalAccountList","GetAccountProperty","property","SetAccountProperty","value","GetAccountInfo","CheckCanUseAccount","test","CheckCanUsePassWord","psw","CheckAccountFirstStr","ErrorCloseGame","console","log","game","off","EVENT_HIDE","EVENT_SHOW","LoadScene","switchGameData","roomMgr","toUpperCase","clubId","unionId","action","localStorage","setItem","JSON","stringify","StopAllSound","isConnectIng","Disconnect","RemoveClientManager","gamePath","jsb","fileUtils","getWritablePath","isReconnecting","accountID","uuid","SendPack","serverID","sendPack","ClientVersion","GetHeroID","SendReConnect","version","reloginSign","signString","toString","sign","MD5","hex_md5","serverPack","result","Result","ShowSysMsg","Psw","sdkToken","accessTokenInfo","SDKType_WeChatApp","SDKType_Company","InitConnectServer","AccountLogin","isToken","isDoLogin","GetHttpSendPack","CharAccount","CharAccountPsw","IsToken","SendHttpPack","OneKeyRegAccount","SendRegAccount","accountPsw","SendChangeAccountPsw","oldPsw","newPsw","AccountID","OldPsw","NewPsw","LoginAccountBySDK","sdkType","mpID","sdkAccountID","that","director","getScene","_sgNode","scheduleOnce","SDKType","Token","UserData","SDKAccountID","state","OnEvent","g_pdk_HeroAccountManager","exports","GetModel"],"mappings":"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","file":"pdk_HeroAccountManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    玩家账号数据管理器\r\n*/\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_HeroAccountManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n    \tthis.JS_Name = app.subGameName + \"_HeroAccountManager\";\r\n\r\n    \tthis.NetManager = app[app.subGameName + \"_NetManager\"]();\r\n        this.LocalDataManager = app.LocalDataManager();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t    this.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\t    this.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n        this.NetManager.RegHttpNetPack(0x0000, this.OnHttpPack_AccountLogin, this);\r\n        this.NetManager.RegHttpNetPack(0x0005, this.OnHttpPack_RegAccountResult, this);\r\n        this.NetManager.RegHttpNetPack(0x0006, this.OnHttpPack_ChangeAccountPswResult, this);\r\n\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"CodeError\", this.Event_CodeError, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectFail\", this.Event_ConnectFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectHttpFail\", this.Event_ConnectHttpFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(app.subGameName + \"_ConnectSuccess\", this.Event_ConnectSuccess, this);\r\n\r\n\t    //密码正则表达式(长度5~11之间,只能包含字符,数字和下划线)\r\n\t    this.PswReg = /^(\\w){5,11}$/;\r\n\t    //账号正则表达式(字符开头,长度5~16之间,只能包含字符,数字和下划线)\r\n\t    this.AccountReg = /^[a-zA-Z]\\w{4,15}$/;\r\n\r\n\t    //账号首字符正则表达式(首字符字母)\r\n\t    this.AccountFirstStrReg = /^[a-zA-z]/;\r\n\r\n    \tthis.OnReload();\r\n\r\n        //本地缓存账号密码字典 {account:psw}\r\n        this.localAccountDict = {};\r\n        //登陆账号顺序列表 晚登陆的在后面\r\n        this.logInAccountList = [];\r\n\r\n        this.InitLocalAccount();\r\n        this.lastChangeTime=0;\r\n\t\t\r\n    },\r\n\r\n    //切换账号\r\n    OnReload:function(){\r\n    \tthis.IsDoLogining(false);\r\n    \tthis.dataInfo = {};\r\n    },\r\n\r\n\tEvent_CodeError:function(event){\r\n\t\tlet codeInfo = event;\r\n\t\t//如果是授权失败,过期了,重新授权\r\n\t\tif(codeInfo[\"Code\"] == this.ShareDefine.KickOut_AccountAuthorizationFail){\r\n\t\t\tlet accountType = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"AccountType\");\r\n            if(accountType==this.ShareDefine.SDKType_WeChat){\r\n                //微信浏览器登录情况\r\n                let gameLoadUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameLoadUrl\");\r\n                window.location.href=gameLoadUrl;\r\n            }\r\n\t\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", {});\r\n\t\t\tif(app[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\") == false){\r\n\t\t\t\tapp[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t//密码错误等异常,需要清除登录标示\r\n\t\tthis.IsDoLogining(false);\r\n\r\n\t},\r\n\t//连接服务器失败\r\n\tEvent_ConnectFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n\r\n\tEvent_ConnectHttpFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n\tUpdateAccessPoint:function(){\r\n\t\tlet now= new Date().getTime();\r\n\t\tif(now-this.lastChangeTime<5000){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.lastChangeTime = now;\r\n        this.ChangeAccessPoint();\r\n        app[app.subGameName + \"_NetManager\"]().InitServerAddress();\r\n    },\r\n    ChangeAccessPoint:function(){\r\n        if(!cc.sys.isNative){\r\n            return;  //浏览器不用切换节点\r\n        }\r\n        let AccessPoint=app.LocalDataManager().GetConfigProperty(\"Account\", \"AccessPoint\");\r\n        if(AccessPoint==0){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",1);\r\n        }else if(AccessPoint==1){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",2);\r\n        }else if(AccessPoint==2){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",3);\r\n        }else if(AccessPoint==3){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",0);\r\n        }\r\n    },\r\n    //---------------------本地账号逻辑-----------------\r\n\r\n    //解析本地缓存账号记录\r\n    InitLocalAccount:function(){\r\n        let accountDict = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountDict\");\r\n        let accountList = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountList\");\r\n\r\n        this.logInAccountList = accountList;\r\n\r\n        for(var charAccount in accountDict){\r\n            if(this.logInAccountList.InArray(charAccount, true)){\r\n                this.localAccountDict[charAccount] = accountDict[charAccount];\r\n            }\r\n            else{\r\n                this.ErrLog(\"InitLocalAccount logInAccountList not find :%s\", charAccount);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 增加本地缓存账号\r\n     * @param account\r\n     * @param psw\r\n     */\r\n    AddNewAccountList:function(account, token){\r\n\r\n        if (this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n            this.logInAccountList.push(account);\r\n        }\r\n        else{\r\n            this.logInAccountList.push(account);\r\n        }\r\n\r\n        this.localAccountDict[account] = token;\r\n\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 删除本地账号\r\n     * @param account\r\n     */\r\n    DeleteLocalAccount:function(account){\r\n\r\n        if(this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n\r\n        }\r\n        delete this.localAccountDict[account];\r\n\r\n        this.SavePlayerAccount();\r\n\r\n    },\r\n\r\n    /**\r\n     * 清除本地所有账号\r\n     * @param account\r\n     */\r\n    DeleteAllLocalAccount:function(){\r\n        this.localAccountDict = {};\r\n        this.logInAccountList = [];\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 保存账号数据\r\n     */\r\n    SavePlayerAccount:function(){\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountDict\", this.localAccountDict);\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountList\", this.logInAccountList);\r\n    },\r\n\r\n    /**\r\n     * 获取账号密码\r\n     * @param account\r\n     */\r\n    GetAccountToken:function(account){\r\n        if (!this.localAccountDict.hasOwnProperty(account)){\r\n            // this.Log(\"GetAccountToken not find:%s\", account);\r\n            return \"\"\r\n        }\r\n        return this.localAccountDict[account]\r\n    },\r\n\r\n    /**\r\n     * 获取缓存账号列表\r\n     */\r\n    GetLocalAccountList:function(){\r\n        return this.logInAccountList\r\n    },\r\n\r\n    GetAccountProperty:function(property){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            this.ErrLog(\"GetAccountProperty not find:%s\", property);\r\n            return\r\n        }\r\n        return this.dataInfo[property];\r\n    },\r\n\r\n    SetAccountProperty:function(property, value){\r\n        this.dataInfo[property] = value;\r\n    },\r\n\r\n\t//获取账号属性\r\n\tGetAccountInfo:function(){\r\n\t\treturn this.dataInfo;\r\n\t},\r\n\r\n\t/**\r\n\t * 检测账号是否合法\r\n\t */\r\n\tCheckCanUseAccount:function(account){\r\n\t\treturn this.AccountReg.test(account)\r\n\t},\r\n\r\n\t/**\r\n\t * 检测密码合法\r\n\t * @param psw\r\n\t */\r\n\tCheckCanUsePassWord:function(psw){\r\n\t\treturn this.PswReg.test(psw)\r\n\t},\r\n\r\n\tCheckAccountFirstStr:function(account){\r\n\t\treturn this.AccountFirstStrReg.test(account);\r\n\t},\r\n\r\n    //---------------------事件回掉函数-----------------\r\n    ErrorCloseGame:function(){\r\n        console.log(\"异常关闭游戏：\"+app.subGameName);    \r\n        cc.game.off(cc.game.EVENT_HIDE);\r\n        cc.game.off(cc.game.EVENT_SHOW);\r\n        if (!cc.sys.isNative){\r\n            app[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n            return;\r\n        }\r\n        let switchGameData = null;\r\n        let roomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        if (roomMgr) {\r\n            if (roomMgr.clubId > 0 || roomMgr.unionId > 0) {\r\n                switchGameData = {action:\"openClub\"};\r\n            }\r\n        }\r\n        if (switchGameData != null) {\r\n            cc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(switchGameData));\r\n        }\r\n        app[app.subGameName + \"_SoundManager\"]().StopAllSound();\r\n        //主动断开socket连接，服务端会将玩家踢出\r\n        if(app[app.subGameName + \"_NetWork\"]().isConnectIng){\r\n           app[app.subGameName + \"_NetManager\"]().Disconnect(true);\r\n        }\r\n        app[app.subGameName + \"Client\"].RemoveClientManager();\r\n        let gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\"+app.subGameName;\r\n        console.log(\"ExitGame gamePath:\"+gamePath);\r\n        window.require(gamePath + \"/src/hall.js\");\r\n\r\n    },\r\n    //连接服务器成功\r\n\tEvent_ConnectSuccess:function(event){\r\n        console.log(app.subGameName + \" 连接服务器成功\");\r\n        app[app.subGameName + \"_NetWork\"]().isReconnecting=false;\r\n        app[app.subGameName + \"_NetWork\"]().isConnectIng=true;\r\n\t\tif(!this.dataInfo[\"AccountID\"]){\r\n\t\t\tconsole.log(\"Event_ConnectSuccess not dataInfo\");\r\n            \r\n            this.IsDoLogining(false);\r\n            //本地开发项目跳过登录，请求一个游客账号\r\n            if (!cc.sys.isNative) {\r\n                // this.NetManager.SendPack(\"base.C1111RoleReLogin\", {\"accountID\":0, \"uuid\":0, \"gameName\":app.subGameName});\r\n                //this.OneKeyRegAccount();\r\n            }else{\r\n                let accountID = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountID\");\r\n                let uuid = this.LocalDataManager.GetConfigProperty(\"Account\", \"uuid\");\r\n                this.NetManager.SendPack(\"base.C1111RoleReLogin\", {\"accountID\":accountID, \"uuid\":uuid, \"gameName\":app.subGameName});\r\n                this.dataInfo[\"AccountID\"] = accountID;\r\n            }\r\n\t\t\treturn;\r\n\t\t}\r\n        //网页测试用游客登录\r\n        if (!cc.sys.isNative) {\r\n            let serverID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"ServerID\");\r\n            let sendPack = {\r\n             \"accountID\":this.dataInfo[\"AccountID\"],\r\n             \"openid\":this.dataInfo[\"Openid\"],\r\n             \"unionid\":this.dataInfo[\"Unionid\"],\r\n             \"token\":this.dataInfo[\"Token\"],\r\n             \"nickName\":this.dataInfo[\"NickName\"],\r\n             \"sex\":this.dataInfo[\"Sex\"],\r\n             \"headImageUrl\":this.dataInfo[\"HeadImageUrl\"],\r\n             \"serverID\":serverID,\r\n             \"version\":this.ShareDefine.ClientVersion,\r\n            };\r\n\r\n            //如果是重连\r\n            if(app[app.subGameName + \"_HeroManager\"]().GetHeroID()){\r\n                this.NetManager.SendReConnect(\"base.C1004Login\", sendPack);\r\n            }\r\n            else{\r\n                //登录过程完成\r\n                this.IsDoLogining(false);\r\n                //发送登陆token到connector\r\n                console.log(\"登录过程完成:\",JSON.stringify(sendPack));\r\n                this.NetManager.SendPack(\"base.C1004Login\", sendPack);\r\n            }\r\n        }else{\r\n            //如果是重连\r\n            if(app[app.subGameName + \"_HeroManager\"]().GetHeroID()){\r\n                let accountID = this.dataInfo[\"AccountID\"];\r\n                let version = \"1.0.1\";\r\n                let reloginSign = this.dataInfo[\"reloginSign\"];\r\n                if (typeof(accountID) == \"undefined\") {\r\n                    console.log(\"本地内存还没获取到accountID\");\r\n                    this.ErrorCloseGame();\r\n                    return;\r\n                }\r\n                if (typeof(reloginSign) == \"undefined\") {\r\n                    console.log(\"本地内存还没获取到reloginSign\");\r\n                    this.ErrorCloseGame();\r\n                    return;\r\n                }\r\n                let signString = \"accountID=\" + accountID.toString() + \"&version=\" + version + \"&\" + reloginSign.toString();\r\n                let sign = app.MD5.hex_md5(signString);\r\n                this.NetManager.SendReConnect(\"base.C1008Login\", {\"accountID\":accountID, \"version\":version, \"sign\":sign});\r\n            }\r\n        }\r\n\t\t\r\n    },\r\n\r\n\t//注册账号结果\r\n\tOnHttpPack_RegAccountResult:function(serverPack){\r\n\t\tlet result = serverPack.Result;\r\n\t\tif(result == 1){\r\n\t\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_RegAccountFind\");\r\n\t\t}\r\n\t\tthis.IsDoLogining(false);\r\n\t},\r\n\r\n\t//修改密码结果\r\n\tOnHttpPack_ChangeAccountPswResult:function(serverPack){\r\n\t\tthis.dataInfo[\"CharAccountPsw\"] = serverPack.Psw;\r\n\r\n\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_ChangeAccountPswSuccess\");\r\n\t},\r\n\r\n\r\n\t//账号服务器登录账号回复\r\n\tOnHttpPack_AccountLogin:function(serverPack){\r\n\t\tthis.dataInfo = serverPack;\r\n\r\n\t\t//每次登陆都覆盖缓存的sdkToken(客户端只记录一个玩家登陆token)\r\n\t\tlet sdkToken = this.dataInfo[\"SDKToken\"];\r\n\t\tlet accountType = this.dataInfo[\"AccountType\"];\r\n\t\tlet accountID = this.dataInfo[\"AccountID\"];\r\n\r\n\t\tlet accessTokenInfo = {};\r\n\t\t//如果是微信APP,sdk授权登录\r\n\t\tif(sdkToken && accountType == this.ShareDefine.SDKType_WeChatApp){\r\n\t\t\taccessTokenInfo = {\r\n\t\t\t\t\"SDKToken\":sdkToken,\r\n\t\t\t\t\"AccountType\":accountType,\r\n\t\t\t\t\"AccountID\":accountID,\r\n\t\t\t};\r\n\t\t}\r\n\t\tthis.ErrLog(\"OnHttpPack_AccountLogin sdkToken:%s, accessTokenInfo:%s\", sdkToken, JSON.stringify(accessTokenInfo));\r\n\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", accessTokenInfo);\r\n\r\n\r\n\t\t//如果是公司内部账号,需要保存账号记录\r\n\t\tif(accountType == this.ShareDefine.SDKType_Company){\r\n\t\t\tthis.AddNewAccountList(this.dataInfo[\"CharAccount\"], this.dataInfo[\"Token\"])\r\n\t\t}\r\n\r\n        this.NetManager.InitConnectServer();\r\n\r\n    },\r\n\r\n    //----------------------操作函数--------------------\r\n\r\n    //账号密码连接\r\n    AccountLogin:function(charAccount, psw, isToken){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tthis.ErrLog(\"AccountLogin(%s,%s) is doing login\", charAccount, psw);\r\n    \t\treturn\r\n    \t}\r\n    \tthis.IsDoLogining(true);\r\n\t    let sendPack = this.NetManager.GetHttpSendPack(0xFF03);\r\n\t    sendPack.CharAccount = charAccount;\r\n\t    sendPack.CharAccountPsw = psw;\r\n\t    sendPack.IsToken = isToken;\r\n\t    this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //一键注册账号密码\r\n    OneKeyRegAccount:function(){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tthis.ErrLog(\"OneKeyRegAccount is doing login\");\r\n    \t\treturn\r\n    \t}\r\n        this.IsDoLogining(true);\r\n\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF00);\r\n    \tthis.NetManager.SendHttpPack(sendPack);\r\n\r\n    },\r\n\r\n\tSendRegAccount:function(charAccount, accountPsw){\r\n\t\tif(this.isDoLogin){\r\n\t\t\tthis.ErrLog(\"SendRegAccount is doing login\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.IsDoLogining(true);\r\n\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF07);\r\n\t\tsendPack.CharAccount = charAccount;\r\n\t\tsendPack.Psw = accountPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\tSendChangeAccountPsw:function(accountID, oldPsw, newPsw){\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF08);\r\n\t\tsendPack.AccountID = accountID;\r\n\t\tsendPack.OldPsw = oldPsw;\r\n\t\tsendPack.NewPsw = newPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\t//sdk授权登录\r\n\t//sdkType:sdk类型\r\n\t//token:授权code\r\n\t//mpID:使用到的对应第3方标示(公众号)\r\n    LoginAccountBySDK:function(sdkType, token, mpID, sdkAccountID){\r\n        if(this.isDoLogin){\r\n\t\t\tthis.ErrLog(\"LoginAccountBySDK is doing (%s,%s) login\", sdkType, token);\r\n\t\t\tthis.IsDoLogining(false);\r\n\t\t\tlet that = this;\r\n\t\t\tcc.director.getScene()._sgNode.scheduleOnce(function(){\r\n//\t\t\t\t\tthat.SysLog(\"LoginAccountBySDK 0123456\");\r\n\t\t\t\t\tthat.IsDoLogining(false);\r\n\t\t\t\t}, 0.5);\r\n            return\r\n        }\r\n        this.IsDoLogining(true);\r\n\r\n\t    if(!sdkAccountID){\r\n\t\t    sdkAccountID = 0;\r\n\t    }\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF02);\r\n        sendPack.SDKType = sdkType;\r\n        sendPack.Token = token;\r\n        sendPack.UserData = mpID;\r\n        sendPack.SDKAccountID = sdkAccountID;\r\n        this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //设置是否是在登录\r\n    IsDoLogining:function(state)\r\n    {\r\n        this.isDoLogin = state;\r\n        if (state) {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":1});\r\n        } else {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":0});\r\n        }\r\n    },\r\n});\r\n\r\nvar g_pdk_HeroAccountManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_HeroAccountManager){\r\n        g_pdk_HeroAccountManager = new pdk_HeroAccountManager();\r\n    }\r\n    return g_pdk_HeroAccountManager;\r\n}"]}