{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\pdk_FormManager.js"],"names":["app","require","pdk_FormManager","BaseClass","extend","Init","JS_Name","SysDataManager","subGameName","SceneInfo","GetTableDict","HeroManager","ShareDefine","SysNotifyManager","loadFormDict","showFormDict","createingFormDict","formWndShowInfo","defaultFormNameList","isCloseFunButton","InitData","Log","formPath2RealPath","formPath","indexOf","formPath2formName","split","length","CreateForm","formName","that","CreateLoadPromise","then","prefab","hasOwnProperty","formNode","cc","instantiate","formComponent","getComponent","ErrLog","OnCreate","catch","error","stack","ShowForm","argList","bluebird","resolve","shift","OnEvent","CloseFormReal","CloseForm","name","ShowOrCloseForm","unshift","apply","GetFormComponentByFormName","IsFormShow","GetFormWndShowInfo","SetIsCloseFunButton","GetIsCloseFunButton","AddShowingForm","RemoveShowingForm","ShowFunWnd","node","wndInfo","heroLv","GetHeroProperty","passMaxTowerLv","wndPath","conditionInfo","wndParentPath","conditionType","conditionValue","showType","wndNode","find","wndParent","isOpen","FormWnd_NotShow","active","FormWnd_EffectLock","DeleteWndEffect","AddWndEffect","CheckFunButtonIsOpen","isNotify","ShowSysMsg","AddDefaultFormName","InArray","push","GetDefaultFormNameList","ClearDefaultFormNameList","OnBeforeExitScene","sceneName","isInArray","value","arrayList","i","LoadSceneDefaultForm","bluebirdList","loadFormNameList","NoAddScene","BaseForm","GamePrefab","gamePrefab","is3DShow","LocalDataManager","GetConfigProperty","count","index","all","OnSwithSceneEnd","gameScene","_isOrientationH","frameSize","view","getFrameSize","width","height","g_pdk_FormManager","exports","GetModel"],"mappings":"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","file":"pdk_FormManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n    场景管理器\r\n*/\r\n\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_FormManager = app.BaseClass.extend({\r\n\r\n    //初始化\r\n    Init: function() {\r\n        this.JS_Name = app[\"subGameName\"] + \"_FormManager\";\r\n\r\n        let SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n        this.SceneInfo = app[app.subGameName + \"_SysDataManager\"]().GetTableDict(\"SceneInfo\");\r\n\r\n        this.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n        this.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\r\n        //已经创建的界面字典\r\n        this.loadFormDict = {};\r\n\r\n        this.showFormDict = {};\r\n\r\n        //正在执行创建的界面\r\n        this.createingFormDict = {};\r\n\r\n        //界面控件显示条件字典\r\n        // {\r\n        //     formName:{\r\n        //         wndPath:{\"WndParentPath\":\"\",\"WndPath\":\"aaa/btn01\"}\r\n        //     }\r\n        // }\r\n        this.formWndShowInfo = {};\r\n\r\n        //切换场景默认需要显示的界面\r\n        this.defaultFormNameList = [];\r\n\r\n        //是否关闭功能控制\r\n        this.isCloseFunButton = false;\r\n\r\n        this.InitData();\r\n\r\n        this.Log(\"Init\");\r\n    },\r\n\r\n    InitData: function() {\r\n\r\n        // for(let index in this.FormWndShowInfo){\r\n        //     let formWndShowInfo = this.FormWndShowInfo[index];\r\n        //     let formName = formWndShowInfo[\"FormName\"];\r\n        //     let wndPath = formWndShowInfo[\"WndPath\"];\r\n\r\n        //     let wndPathNameList = wndPath.split(\"/\");\r\n\r\n        //     let wndParentPath = \"\";\r\n\r\n        //     if(wndPathNameList.length == 1){\r\n        //         wndParentPath = \"\";\r\n        //     }\r\n        //     else{\r\n        //         wndParentPath = wndPathNameList.join(\"/\");\r\n        //     }\r\n\r\n        //     let wndInfo = this.formWndShowInfo.SetDefault(formName, {});\r\n        //     if(wndInfo.hasOwnProperty(wndPath)){\r\n        //         this.ErrLog(\"formWndShowInfo(%s) have find(%s)\", formName, wndPath);\r\n        //         continue\r\n        //     }\r\n        //     wndInfo[wndPath] = {\r\n        //                         \"ConditionType\":formWndShowInfo[\"ConditionType\"],\r\n        //                         \"ConditionValue\":formWndShowInfo[\"ConditionValue\"],\r\n        //                         \"ShowType\":formWndShowInfo[\"ShowType\"],\r\n        //                         \"WndParentPath\":wndParentPath,\r\n        //                     };\r\n        // }\r\n    },\r\n    formPath2RealPath: function(formPath) {\r\n        if (formPath.indexOf('/') < 1) {\r\n            return 'ui/' + formPath;\r\n        }\r\n        return formPath;\r\n    },\r\n    formPath2formName: function(formPath) {\r\n        if (formPath.indexOf('/') > -1) {\r\n            let split = formPath.split('/');\r\n            return split[(split.length) - 1];\r\n        } else {\r\n            return formPath;\r\n        }\r\n    },\r\n\r\n    //----------------操作接口--------------------\r\n\r\n    //创建界面\r\n    CreateForm: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        // let formPath = \"\";\r\n\r\n        // let promise = null;\r\n        // for(let idx in this.folder){\r\n        //     formPath = this.folder[idx].folderPath + formName;\r\n        //     promise = app[app.subGameName + \"_ControlManager\"]().CreateLoadPromise(formPath);\r\n        // }\r\n\r\n        let that = this;\r\n        return app[app.subGameName + \"_ControlManager\"]().CreateLoadPromise(formPath)\r\n            .then(function(prefab) {\r\n                if (that.loadFormDict.hasOwnProperty(formPath)) {\r\n                    that.Log(\"CreateForm(%s)重复创建界面\", formPath);\r\n                    return that.loadFormDict[formPath];\r\n                }\r\n\r\n                let formNode = cc.instantiate(prefab);\r\n                // for (var i = 0; i < formNode._components.length; i++) {\r\n                //     console.log(\"CreateForm component Name:\" + formNode._components[i].name);\r\n                // }\r\n                let formComponent = formNode.getComponent(formName);\r\n                if (!formComponent) {\r\n                    that.ErrLog(\"CreateForm(%s) not find Component\", formName);\r\n                    return\r\n                }\r\n                formComponent.OnCreate(formName);\r\n                that.loadFormDict[formPath] = formNode;\r\n                return formComponent\r\n\r\n            })\r\n            .catch(function(error) {\r\n                that.ErrLog(\"CreateForm(%s) error:%s\", formName, error.stack);\r\n            })\r\n    },\r\n    //显示界面\r\n    ShowForm: function(...argList) {\r\n        // console.warn('显示界面被调用', argList);\r\n        if (!argList.length) {\r\n            this.ErrLog(\"ShowForm Need FormName\");\r\n            return app.bluebird.resolve(null);\r\n        }\r\n        let formPath = argList.shift();\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        //如果已经加载过的界面,则设置界面显示\r\n        if (this.loadFormDict.hasOwnProperty(formPath)) {\r\n            let formNode = this.loadFormDict[formPath];\r\n            if (!formNode) {\r\n                this.ErrLog(\"ShowForm Error:formName %s\", formName);\r\n                return;\r\n            }\r\n            let formComponent = formNode.getComponent(formName);\r\n            formComponent.ShowForm(argList);\r\n            return app.bluebird.resolve(formComponent);\r\n        }\r\n\r\n        //如果已经在创建中\r\n        if (this.createingFormDict.hasOwnProperty(formPath)) {\r\n            this.ErrLog(\"ShowForm createingFormDict have find(%s)\", formName);\r\n            return app.bluebird.resolve(null);\r\n        }\r\n\r\n        this.createingFormDict[formPath] = 1;\r\n\r\n        let that = this;\r\n\r\n        app[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n        return this.CreateForm(formPath)\r\n            .then(function(formComponent) {\r\n\r\n                delete that.createingFormDict[formPath];\r\n\r\n                if (formComponent) {\r\n                    formComponent.ShowForm(argList);\r\n                } else {\r\n                    that.ErrLog(\"CreateForm(%s) fail\", formPath);\r\n                }\r\n\r\n                app[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n\r\n                return formComponent\r\n            })\r\n            .catch(function(error) {\r\n                that.ErrLog(\"ShowForm error:%s\", error.stack);\r\n                app[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n            })\r\n\r\n    },\r\n    CloseFormReal: function(formPath) {\r\n        this.CloseForm(formPath);\r\n        delete this.loadFormDict[formPath];\r\n    },\r\n    //关闭界面\r\n    CloseForm: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        if (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n            this.Log(\"CloseForm(%s) not load\", formPath);\r\n            return\r\n        }\r\n        let formNode = this.loadFormDict[formPath];\r\n        if (!formNode) {\r\n            this.ErrLog(\"CloseForm Error:formName %s\", formPath);\r\n            return;\r\n        }\r\n        try {\r\n            let formComponent = formNode.getComponent(formName);\r\n            if (formComponent) {\r\n                formComponent.CloseForm();\r\n            } else {\r\n                this.ErrLog(\"CloseForm Error:formName %s,nodeName %s\", formName, formNode.name);\r\n            }\r\n        } catch (error) {\r\n            this.ErrLog(\"CloseForm Error:formName %s,nodeName %s formPath %s\", formName, formNode.name, formPath);\r\n        }\r\n    },\r\n\r\n    //开启和关闭界面\r\n    ShowOrCloseForm: function(...argList) {\r\n        if (!argList.length) {\r\n            this.ErrLog(\"ShowOrCloseForm Need FormName\");\r\n            return false\r\n        }\r\n        let formPath = argList.shift();\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        if (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n            argList.unshift(formPath)\r\n            //调用更新界面函数\r\n            this.ShowForm.apply(this, argList);\r\n            return true\r\n        }\r\n        let formNode = this.loadFormDict[formPath];\r\n        let formComponent = formNode.getComponent(formName);\r\n        formComponent.ShowOrCloseForm(argList);\r\n    },\r\n    //获取界面字典里的指定名字对象的同名脚本\r\n    GetFormComponentByFormName: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        if (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n            this.Log(\"GetFormComponentByFormName(%s) not load\", formPath);\r\n            return\r\n        }\r\n        return this.loadFormDict[formPath].getComponent(formName);\r\n    },\r\n\r\n    //界面是否显示中\r\n    IsFormShow: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        if (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n            this.Log(\"IsFormShow(%s) not load\", formPath);\r\n            return false\r\n        }\r\n        return this.loadFormDict[formPath].getComponent(formName).IsFormShow();\r\n    },\r\n\r\n    //获取界面控件显示条件字典\r\n    GetFormWndShowInfo: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        if (this.isCloseFunButton) {\r\n            return {}\r\n        }\r\n\r\n        if (!this.formWndShowInfo.hasOwnProperty(formPath)) {\r\n            this.Log(\"GetFormWndShowInfo not find:%s\", formPath);\r\n            return {}\r\n        }\r\n        return this.formWndShowInfo[formPath];\r\n    },\r\n\r\n\r\n\r\n    SetIsCloseFunButton: function() {\r\n        this.isCloseFunButton = !this.isCloseFunButton\r\n    },\r\n\r\n    GetIsCloseFunButton: function() {\r\n        return this.isCloseFunButton\r\n    },\r\n\r\n    AddShowingForm: function(formPath, formComponent) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        this.showFormDict[formPath] = formComponent;\r\n    },\r\n\r\n    RemoveShowingForm: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        delete this.showFormDict[formPath];\r\n    },\r\n\r\n    //显示界面控件功能函数\r\n    ShowFunWnd: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        formName = this.formPath2formName(formPath);\r\n        let formComponent = this.GetFormComponentByFormName(formName);\r\n        if (!formComponent) {\r\n            this.ErrLog(\"ShowFunWnd(%s) not find\");\r\n            return\r\n        }\r\n        let node = formComponent.node;\r\n\r\n        let wndInfo = this.GetFormWndShowInfo(formPath);\r\n        let heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n        let passMaxTowerLv = 0;\r\n\r\n        for (let wndPath in wndInfo) {\r\n\r\n            let conditionInfo = wndInfo[wndPath];\r\n\r\n            let wndParentPath = conditionInfo[\"WndParentPath\"];\r\n            let conditionType = conditionInfo[\"ConditionType\"];\r\n            let conditionValue = conditionInfo[\"ConditionValue\"];\r\n            let showType = conditionInfo[\"ShowType\"];\r\n\r\n            let wndNode = cc.find(wndPath, node);\r\n            if (!wndNode) {\r\n                this.ErrLog(\"ShowFunWnd not find:%s\", wndPath);\r\n                continue\r\n            }\r\n\r\n            let wndParent = \"\";\r\n            if (!wndParentPath) {\r\n                wndParent = node;\r\n            } else {\r\n                wndParent = cc.find(wndParentPath, node);\r\n                if (!wndParent) {\r\n                    this.ErrLog(\"ShowFunWnd(%s) not find\", wndParentPath);\r\n                    continue\r\n                }\r\n            }\r\n\r\n            let isOpen = false;\r\n\r\n            if (conditionType == \"HeroLv\") {\r\n                if (heroLv >= conditionValue) {\r\n                    isOpen = true;\r\n                } else {\r\n                    isOpen = false;\r\n                }\r\n            } else if (conditionType == \"PassMaxTowerLv\") {\r\n                if (passMaxTowerLv >= conditionValue) {\r\n                    isOpen = true;\r\n                } else {\r\n                    isOpen = false;\r\n                }\r\n            } else {\r\n                isOpen = false\r\n            }\r\n\r\n            if (isOpen) {\r\n\r\n                if (showType == this.ShareDefine.FormWnd_NotShow) {\r\n                    wndNode.active = true;\r\n                } else if (showType == this.ShareDefine.FormWnd_EffectLock) {\r\n                    formComponent.DeleteWndEffect(wndPath, \"FunLock\");\r\n                } else {\r\n                    this.ErrLog(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n                }\r\n            } else {\r\n                if (showType == this.ShareDefine.FormWnd_NotShow) {\r\n                    wndNode.active = false;\r\n                } else if (showType == this.ShareDefine.FormWnd_EffectLock) {\r\n                    formComponent.AddWndEffect(wndPath, \"FunLock\", \"Lock\");\r\n                } else {\r\n                    this.ErrLog(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n    CheckFunButtonIsOpen: function(formPath, wndPath, isNotify = true) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        let formName = this.formPath2formName(formPath);\r\n        let wndInfo = this.GetFormWndShowInfo(formPath);\r\n        if (!wndInfo.hasOwnProperty(wndPath)) {\r\n            return true\r\n        }\r\n        let conditionType = wndInfo[wndPath][\"ConditionType\"];\r\n        let conditionValue = wndInfo[wndPath][\"ConditionValue\"];\r\n\r\n        let heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n        let passMaxTowerLv = 0;\r\n\r\n        if (conditionType == \"PassMaxTowerLv\") {\r\n            if (passMaxTowerLv >= conditionValue) {\r\n                return true\r\n            }\r\n            if (isNotify) {\r\n                this.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_PassMaxTowerLv\", [conditionValue - 1]);\r\n            }\r\n            return false\r\n        } else if (conditionType == \"HeroLv\") {\r\n            if (heroLv >= conditionValue) {\r\n                return true\r\n            }\r\n            if (isNotify) {\r\n                this.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_HeroLv\", [conditionValue]);\r\n            }\r\n            return false\r\n        } else {\r\n            this.ErrLog(\"CheckFunButtonIsOpen(%s) conditionType:%s error\", wndPath, conditionType);\r\n            return false\r\n        }\r\n    },\r\n\r\n    //增加默认显示的界面\r\n    AddDefaultFormName: function(formPath) {\r\n        formPath = this.formPath2RealPath(formPath);\r\n        if (this.defaultFormNameList.InArray(formPath)) {\r\n            return\r\n        }\r\n        this.defaultFormNameList.push(formPath);\r\n    },\r\n\r\n    GetDefaultFormNameList: function() {\r\n        return this.defaultFormNameList;\r\n    },\r\n\r\n    ClearDefaultFormNameList: function() {\r\n        this.defaultFormNameList = [];\r\n    },\r\n    //------------------回调函数--------------------------\r\n\r\n    //开始切换场景\r\n    OnBeforeExitScene: function(sceneName) {\r\n        this.Log(\"OnBeforeExitScene(%s)\", sceneName);\r\n        //关闭所有界面\r\n        for (let formPath in this.loadFormDict) {\r\n            this.CloseForm(formPath);\r\n        }\r\n    },\r\n    isInArray: function(value, arrayList) {\r\n        let length = arrayList.length;\r\n        for (let i = 0; i < length; i++) {\r\n            if (value == arrayList[i]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    },\r\n    LoadSceneDefaultForm: function(sceneName) {\r\n\r\n        this.Log(\"LoadSceneDefaultForm(%s)\", sceneName);\r\n\r\n        let bluebirdList = [];\r\n\r\n        let loadFormNameList = [];\r\n        let NoAddScene = ['clubScene', 'fightScene', 'launchScene', 'loginScene', app.subGameName + 'MainScene']; //四个基础场景不用添加uimore，uimark\r\n        let BaseForm = [];\r\n        if (this.isInArray(sceneName, NoAddScene) == false) {\r\n            //添加游戏预制品\r\n            let GamePrefab = this.SceneInfo[sceneName].gamePrefab;\r\n\r\n            //3D切换\r\n            let is3DShow = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"is3DShow\");\r\n            if (is3DShow == 0 && GamePrefab == 'game/XYMJ/ui/UIXYMJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/XYMJ/ui/UIXYMJ2DPlay';\r\n            }\r\n            if (is3DShow == 0 && GamePrefab == 'game/PTMJ/ui/UIPTMJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/PTMJ/ui/UIPTMJ2DPlay';\r\n            }\r\n            if (is3DShow == 0 && GamePrefab == 'game/PT13MJ/ui/UIPT13MJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/PT13MJ/ui/UIPT13MJ2DPlay';\r\n            }\r\n            if (is3DShow == 0 && GamePrefab == 'game/ZJMJ/ui/UIZJMJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/ZJMJ/ui/UIZJMJ2DPlay';\r\n            }\r\n            if (is3DShow == 0 && GamePrefab == 'game/WZMJ/ui/UIWZMJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/WZMJ/ui/UIWZMJ2DPlay';\r\n                BaseForm = [];\r\n            }\r\n            if (is3DShow == 0 && GamePrefab == 'game/YCMJ/ui/UIYCMJPlay') {\r\n                //2D场景需要切换\r\n                GamePrefab = 'game/YCMJ/ui/UIYCMJ2DPlay';\r\n                BaseForm = [];\r\n            }\r\n\r\n            if (GamePrefab == 0) {\r\n                this.ErrLog(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\", sceneName, GamePrefab);\r\n            }\r\n            BaseForm.unshift(GamePrefab);\r\n            //添加三个必须预制品\r\n            for (let i = 0; i < BaseForm.length; i++) {\r\n                let formName = BaseForm[i];\r\n                //如果界面已经创建\r\n                if (this.loadFormDict.hasOwnProperty(formName)) {\r\n                    continue\r\n                }\r\n                //如果界面已经在创建中\r\n                if (this.createingFormDict.hasOwnProperty(formName)) {\r\n                    continue\r\n                }\r\n\r\n                loadFormNameList.push(formName);\r\n                bluebirdList.push(this.CreateForm(formName));\r\n            }\r\n        }\r\n        let count = this.defaultFormNameList.length;\r\n        for (let index = 0; index < count; index++) {\r\n            let formName = this.defaultFormNameList[index];\r\n\r\n            if (loadFormNameList.InArray(formName)) {\r\n                continue\r\n            }\r\n            loadFormNameList.push(formName);\r\n            bluebirdList.push(this.CreateForm(formName));\r\n        }\r\n\r\n        //如果存在需要加载的界面资源\r\n        if (bluebirdList.length) {\r\n\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n            return app.bluebird.all(bluebirdList)\r\n                .then(function() {\r\n                    app[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n                })\r\n        }\r\n    },\r\n\r\n    //切换完场景\r\n    OnSwithSceneEnd: function(sceneName) {\r\n\r\n        this.Log(\"OnSwithSceneEnd(%s)\", sceneName);\r\n\r\n        let BaseForm = [];\r\n        let NoAddScene = ['clubScene', 'fightScene', 'launchScene', 'loginScene', app.subGameName + 'MainScene']; //四个基础场景不用添加uimore，uimark\r\n        if (this.isInArray(sceneName, NoAddScene) == false) {\r\n            //添加游戏预制品\r\n            let GamePrefab = this.SceneInfo[sceneName].gamePrefab;\r\n\r\n            const gameScene = app.LocalDataManager().GetConfigProperty(\"SysSetting\", app.subGameName + \"_GameBg\");\r\n            // console.warn('游戏版面yyy选择', gameScene, GamePrefab);\r\n            if (gameScene == 2 && (GamePrefab == 'game/PDK/UIPDK_Play' || GamePrefab == 'game/PDK/UIPDK_SYPlay' || GamePrefab == 'game/PDK/UIPDK_XiuXPlay')) {\r\n                GamePrefab = 'game/PDK/UIPDK_LPPlay';\r\n            } else if (gameScene == 3 && (GamePrefab == 'game/PDK/UIPDK_Play' || GamePrefab == 'game/PDK/UIPDK_LPPlay' || GamePrefab == 'game/PDK/UIPDK_XiuXPlay')) {\r\n                GamePrefab = 'game/PDK/UIPDK_SYPlay';\r\n            } else if (gameScene == 4 && (GamePrefab == 'game/PDK/UIPDK_Play' || GamePrefab == 'game/PDK/UIPDK_LPPlay' || GamePrefab == 'game/PDK/UIPDK_SYPlay')) {\r\n                GamePrefab = 'game/PDK/UIPDK_XiuXPlay';\r\n            }\r\n\r\n            if (GamePrefab == 0) {\r\n                this.ErrLog(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\", sceneName, GamePrefab);\r\n            }\r\n            BaseForm.unshift(GamePrefab);\r\n            //显示三个必须预制品\r\n            for (let i = 0; i < BaseForm.length; i++) {\r\n                this.ShowForm(BaseForm[i]);\r\n            }\r\n        }\r\n    },\r\n    _isOrientationH: function() {\r\n        let frameSize = cc.view.getFrameSize();\r\n        return frameSize.width > frameSize.height;\r\n    },\r\n});\r\n\r\n\r\nvar g_pdk_FormManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function() {\r\n    if (!g_pdk_FormManager) {\r\n        g_pdk_FormManager = new pdk_FormManager();\r\n    }\r\n    return g_pdk_FormManager;\r\n}"]}