{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\pdk_UIMain.js"],"names":["app","require","cc","Class","extends","subGameName","properties","resVersion","Label","OnCreateInit","practiceConfig","GetTableDict","FormManager","RegEvent","Event_GetCurRoomID","Event_CodeError","OnShow","SetGameType","curRoomID","curGameTypeStr","SetGetRoomIDByUI","SendPack","sys","isNative","string","getLocalVersion","ShowForm","SetAutoPlayIng","CloseForm","allSwitchGameData","switchGameData","localStorage","getItem","push","JSON","parse","i","length","console","log","action","fromName","setItem","event","serverPack","roomID","gameType","toLowerCase","codeInfo","ShareDefine","NotFind_Room","ShowSysMsg","OnClose","InitGameBtnList","gameName","SetWaitForConfirm","msgID","type","msgArg","cbArg","ConfirmManager","SetWaitForConfirmForm","OnConFirm","bind","ShowConfirm","clickType","backArgList","Click_btn_goRoom","clubId","clubCardNtfs","splice","data","setTimeout","clubName","roomcardattention","OnClick","btnName","btnNode","Confirm","RemoveClientManager","LocalDataManager","SetConfigProperty","gamePath","jsb","fileUtils","getWritablePath","window","error","editBox","GetWndNode","getComponent","EditBox","backCode","parseInt","videoData","stringify","LoadScene","ErrLog","OnEvent_LoginGetCurRoomID"],"mappings":"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","file":"pdk_UIMain.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"pdk_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        resVersion:cc.Label,\r\n    },\r\n    OnCreateInit: function () {\r\n        this.practiceConfig = app[app.subGameName + \"_SysDataManager\"]().GetTableDict(\"practice\");\r\n        this.FormManager = app[app.subGameName + \"_FormManager\"]();\r\n        this.RegEvent(\"GetCurRoomID\", this.Event_GetCurRoomID, this);\r\n        this.RegEvent(\"CodeError\", this.Event_CodeError, this);\r\n    },\r\n    //-----------------显示函数------------------\r\n    OnShow: function () {\r\n        app[app.subGameName + \"Client\"].SetGameType('');\r\n        this.curRoomID = 0;\r\n        this.curGameTypeStr = '';\r\n        app[app.subGameName + \"_GameManager\"]().SetGetRoomIDByUI(true);\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(\"game.C1101GetRoomID\", {});\r\n\r\n        if(cc.sys.isNative){\r\n            this.resVersion.string = \"resV\" + app[app.subGameName + \"_HotUpdateMgr\"]().getLocalVersion();\r\n        }else{\r\n            this.resVersion.string = '';\r\n        }\r\n        this.FormManager.ShowForm(app.subGameName + \"_UITop\", app.subGameName + \"_UIMain\",true,false,true);\r\n        app[app.subGameName + \"_GameManager\"]().SetAutoPlayIng(false);\r\n        this.FormManager.CloseForm(app.subGameName + \"_UIAutoPlay\");\r\n        //返回大厅检测下是否有需要处理的数据\r\n        let allSwitchGameData = [];\r\n        let switchGameData = cc.sys.localStorage.getItem(\"switchGameData\");\r\n        if (switchGameData != \"\") {\r\n            allSwitchGameData.push(JSON.parse(switchGameData));\r\n        }\r\n        for (let i = 0; i < allSwitchGameData.length; i++) {\r\n            if (!allSwitchGameData[i]) return;\r\n            console.log(\"allSwitchGameData[i].action\");\r\n            let action = allSwitchGameData[i].action;\r\n            switch(action){\r\n                case 'showForm':\r\n                    this.FormManager.ShowForm(allSwitchGameData[i].fromName);\r\n                    break;\r\n                default:\r\n                    console.log('未知动作: ' + action);\r\n                    break;\r\n            }\r\n        }\r\n        cc.sys.localStorage.setItem(\"switchGameData\", \"\");\r\n    },\r\n    \r\n    Event_GetCurRoomID:function(event){\r\n        let serverPack = event;\r\n        this.curRoomID = serverPack.roomID;\r\n        if(0 != this.curRoomID){\r\n            this.curGameTypeStr = serverPack.gameType.toLowerCase();\r\n        }\r\n    },\r\n    Event_CodeError:function(event){\r\n        let codeInfo = event;\r\n        if(codeInfo[\"Code\"] == this.ShareDefine.NotFind_Room){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('DissolveRoom');\r\n            this.curRoomID = 0;\r\n            this.curGameTypeStr = '';\r\n        }\r\n    },\r\n    OnClose:function(){\r\n    },\r\n    //---------点击函数---------------------\r\n    InitGameBtnList:function(serverPack){\r\n        this.FormManager.ShowForm(\"UICreatRoom\",serverPack,this.gameName);\r\n    },\r\n    SetWaitForConfirm:function(msgID,type,msgArg=[],cbArg=[]){\r\n        let ConfirmManager = app[app.subGameName + \"_ConfirmManager\"]();\r\n        ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, cbArg);\r\n        ConfirmManager.ShowConfirm(type, msgID, msgArg);\r\n    },\r\n    OnConFirm:function(clickType, msgID, backArgList){\r\n        if(clickType != \"Sure\"){\r\n            return\r\n        }\r\n        if('MSG_GO_ROOM' == msgID){\r\n            this.Click_btn_goRoom();\r\n        }\r\n        else if('MSG_CLUB_RoomCard_Not_Enough' == msgID){\r\n            let clubId = backArgList[0];\r\n            for(let i=0;i<this.clubCardNtfs.length;i++){\r\n                if(this.clubCardNtfs[i].clubId == clubId){\r\n                    this.clubCardNtfs.splice(i,1);\r\n                    break;\r\n                }\r\n            }\r\n            if(0 != this.clubCardNtfs.length){\r\n                let data = this.clubCardNtfs[0];\r\n                setTimeout(function(){\r\n                    app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_CLUB_RoomCard_Not_Enough',[data.clubName,data.roomcardattention]);\r\n                },200);\r\n            }\r\n        }\r\n    },\r\n    OnClick:function(btnName, btnNode){\r\n        if('btn_create' == btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n        \tthis.gameName=app.subGameName;\r\n            this.FormManager.ShowForm(app.subGameName + \"_UICreatRoom\",null,this.gameName);\r\n        }else if('btn_lxc'==btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n            this.FormManager.ShowForm(app.subGameName + \"_UIPractice\");\r\n        }\r\n        else if('btn_join' == btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n            this.FormManager.ShowForm(app.subGameName + \"_UIJoin\");\r\n        }\r\n        else if('btn_exit' == btnName){\r\n            if (!cc.sys.isNative) return;\r\n            //如果是游戏切换需要释放内存，重新加载\r\n            app[app.subGameName + \"Client\"].RemoveClientManager();\r\n            app[app.subGameName + \"_NetManager\"]().SendPack(\"base.C1110UUID\", {\"gameName\":\"hall\"}, function(event){\r\n                app.LocalDataManager().SetConfigProperty(\"Account\", \"uuid\", event);\r\n                let gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\"+app.subGameName;\r\n                window.require(gamePath + \"/src/dating.js\");\r\n            }, function(error){\r\n                console.log(\"获取uuid失败\");\r\n            });\r\n        }\r\n        else if('btn_race' == btnName){\r\n            if(0 != this.curRoomID){\r\n                this.SetWaitForConfirm('MSG_GO_ROOM',this.ShareDefine.Confirm,[this.curGameTypeStr]);\r\n                return;\r\n            }\r\n            this.gameName=app.subGameName+'_dr';\r\n            this.FormManager.ShowForm(app.subGameName + \"_UICreatRoom\",null,this.gameName);\r\n        }\r\n        else if('btn_replay' == btnName){\r\n            let editBox = this.GetWndNode(\"main/replay/replayEditBox\").getComponent(cc.EditBox);\r\n            let backCode = parseInt(editBox.string);\r\n            let videoData = {action:\"showVideo\", backCode:backCode};\r\n            cc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(videoData));\r\n            app[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"VideoScene\");\r\n        }\r\n        else{\r\n            this.ErrLog(\"OnClick(%s) not find\",btnName);\r\n        }\r\n        \r\n    },\r\n\r\n    Click_btn_goRoom:function(){\r\n        app[app.subGameName + \"Client\"].SetGameType(this.curGameTypeStr);\r\n        let event = {};\r\n        event = {};\r\n        event.roomID = this.curRoomID;\r\n        app[app.subGameName + \"Client\"].OnEvent_LoginGetCurRoomID(event);\r\n    },\r\n});"]}