{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\pdk_UIMessage03.js"],"names":["app","require","cc","Class","extends","subGameName","properties","lb_time","Label","LabelMessage","btnCancel","Button","btnSure","OnCreateInit","ZorderLv","playerNodes","node","getChildByName","children","RegEvent","Event_PosDealVote","Event_CodeError","OnShow","RoomMgr","toUpperCase","RoomPosMgr","GetEnterRoom","GetRoomPosMgr","room","ShowPosAgree","changePlayerNumInfo","GetRoomProperty","createPos","roomPosMgr","posName","GetPlayerInfoByPos","name","i18n","t","string","endSec","timeString","GetCDTimeStringBySec","ShareDefine","ShowHourMinSec","updateTime","Date","getTime","posAgreeList","allPlayers","GetRoomAllPlayerInfo","clientPos","GetClientPos","playingList","idx","push","canClick","i","length","active","pid","nameLabel","getComponent","Show_btnCancel_btnSure","interactable","enableAutoGrayEffect","event","argDict","code","NotExistRoom","CloseForm","error","FormManager","Name","ClearchangePlayerNum","ShowSysMsg","OnUpdate","time","ShowSecondSec","num","parseInt","OnClick","btnName","btnNode","roomID","GetEnterRoomID","SendChangePlayerRefuse","SendChangePlayerAgree"],"mappings":"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","file":"pdk_UIMessage03.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n UIMessage 模态消息界面\r\n */\r\n\r\nvar app = require(\"pdk_app\");\r\n\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n        lb_time:cc.Label,\r\n        LabelMessage:cc.Label,\r\n        btnCancel:cc.Button,\r\n        btnSure:cc.Button,\r\n    },\r\n\r\n    //初始化\r\n    OnCreateInit:function(){\r\n    \tthis.ZorderLv = 7;\r\n    \tthis.playerNodes = this.node.getChildByName(\"playerNode\").children;\r\n\r\n        this.RegEvent(\"PosChangePlayerDealVote\", this.Event_PosDealVote);\r\n        this.RegEvent(\"CodeError\", this.Event_CodeError);\r\n    },\r\n\r\n    //---------显示函数--------------------\r\n\r\n    OnShow:function () {\r\n        this.RoomMgr = app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        this.RoomPosMgr = this.RoomMgr.GetEnterRoom().GetRoomPosMgr();\r\n\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        this.ShowPosAgree(room);\r\n        let changePlayerNumInfo = room.GetRoomProperty(\"changePlayerNum\");\r\n        let createPos = changePlayerNumInfo[\"createPos\"];\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let posName = roomPosMgr.GetPlayerInfoByPos(createPos).name;\r\n        let LabelMessage = app.i18n.t(\"ChangePlayerText\",{\"Name\": posName});\r\n        this.LabelMessage.string = LabelMessage;\r\n        this.endSec = room.GetRoomProperty(\"changePlayerNum\")[\"endSec\"];\r\n        let timeString = app[app.subGameName + \"_ServerTimeManager\"]().GetCDTimeStringBySec(this.endSec, this.ShareDefine.ShowHourMinSec);\r\n        this.lb_time.string = timeString;\r\n\r\n        this.updateTime = new Date().getTime();\r\n    },\r\n    ShowPosAgree:function (room) {\r\n        let roomPosMgr = room.GetRoomPosMgr();\r\n        let changePlayerNumInfo = room.GetRoomProperty(\"changePlayerNum\");\r\n        let posAgreeList = changePlayerNumInfo[\"posAgreeList\"];\r\n        let allPlayers = roomPosMgr.GetRoomAllPlayerInfo();\r\n        let createPos = changePlayerNumInfo[\"createPos\"];\r\n        let clientPos = roomPosMgr.GetClientPos();\r\n        let playingList = [];\r\n        for(let idx in allPlayers){\r\n            playingList.push(allPlayers[idx]);\r\n        }\r\n        let canClick = true;\r\n        for(let i=0;i<this.playerNodes.length;i++){\r\n            this.playerNodes[i].active = false;\r\n            this.playerNodes[i].getChildByName('icon_jujue').active = false;\r\n            this.playerNodes[i].getChildByName('icon_tongyi').active = false;\r\n            if(i < playingList.length && playingList[i].pid){\r\n                let nameLabel = this.playerNodes[i].getChildByName('name').getComponent(cc.Label);\r\n                nameLabel.string = playingList[i].name;\r\n                //0未表态 1支持 2拒绝\r\n                if(0 == posAgreeList[i]){\r\n\r\n                }\r\n                else if(1 == posAgreeList[i]){\r\n                    this.playerNodes[i].getChildByName('icon_tongyi').active = true;\r\n                    if(i == clientPos)\r\n                        canClick = false;\r\n                }\r\n                else{\r\n                    this.playerNodes[i].getChildByName('icon_jujue').active = true;\r\n                    if(i == clientPos)\r\n                        canClick = false;\r\n                }\r\n                \r\n                this.playerNodes[i].active = true;\r\n            }\r\n        }\r\n        if(createPos == clientPos)\r\n            canClick = false;\r\n        this.Show_btnCancel_btnSure(canClick);\r\n    },\r\n    Show_btnCancel_btnSure:function(canClick){\r\n        if(canClick){\r\n            this.btnCancel.interactable = 1;\r\n            this.btnCancel.enableAutoGrayEffect = 0;\r\n            this.btnSure.interactable = 1;\r\n            this.btnSure.enableAutoGrayEffect = 0;\r\n        }\r\n        else{\r\n            this.btnCancel.interactable = 0;\r\n            this.btnCancel.enableAutoGrayEffect = 1;\r\n            this.btnSure.interactable = 0;\r\n            this.btnSure.enableAutoGrayEffect = 1;\r\n        }\r\n    },\r\n    //---------回调函数--------------------\r\n    Event_CodeError:function(event){\r\n        let argDict = event;\r\n        let code = argDict[\"Code\"];\r\n        if(code == this.ShareDefine.NotExistRoom){\r\n            try{\r\n                this.CloseForm();\r\n            }\r\n            catch(error){\r\n                \r\n            }\r\n        }\r\n    },\r\n    //收到同意/拒绝解散房间\r\n    Event_PosDealVote:function(event){\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        let argDict = event;\r\n        let posAgreeList = argDict[\"posAgreeList\"];\r\n        let createPos = argDict[\"createPos\"];\r\n        let clientPos = room.GetRoomPosMgr().GetClientPos();\r\n        for(let i = 0; i < posAgreeList.length; i++){\r\n            if(posAgreeList[i] == 2){//0未表态 1支持 2拒绝\r\n                this.FormManager.CloseForm(app.subGameName + \"_UIMessage03\");\r\n                let Name = this.RoomMgr.GetEnterRoom().GetRoomPosMgr().GetPlayerInfoByPos(i)[\"name\"];\r\n                room.ClearchangePlayerNum();\r\n                this.ShowSysMsg(\"PlayersRefusedToChangePlayer\",[Name]);\r\n                return;\r\n            }\r\n            else if(posAgreeList[i] == 1){\r\n                this.playerNodes[i].getChildByName('icon_tongyi').active = true;\r\n            }\r\n            else{\r\n\r\n            }\r\n        }\r\n    },\r\n \r\n    //---------刷新函数--------------------\r\n    OnUpdate:function () {\r\n        if(this.endSec){\r\n            let time = new Date().getTime();\r\n            if( time < this.updateTime){\r\n                let timeString = app[app.subGameName + \"_ServerTimeManager\"]().GetCDTimeStringBySec(this.endSec, this.ShareDefine.ShowSecondSec);\r\n                let num = parseInt(timeString);\r\n                if(!num){\r\n                    this.CloseForm();\r\n                    return;\r\n                }\r\n                this.lb_time.string = timeString;\r\n            }\r\n            else{\r\n                this.updateTime += 500;\r\n            }\r\n        }\r\n    },\r\n\r\n    //---------点击函数---------------------\r\n    OnClick:function(btnName, btnNode){\r\n        let room = this.RoomMgr.GetEnterRoom();\r\n        let roomID = this.RoomMgr.GetEnterRoomID();\r\n        if(btnName == \"btnCancel\"){\r\n           // this.RoomMgr.SendchangePlayerNumRoomRefuse(roomID);\r\n            app[app.subGameName + \"_GameManager\"]().SendChangePlayerRefuse(roomID);\r\n            this.Show_btnCancel_btnSure(false);\r\n        }\r\n        else if(btnName == \"btnSure\"){\r\n            //this.RoomMgr.SendchangePlayerNumRoomAgree(roomID);\r\n            app[app.subGameName + \"_GameManager\"]().SendChangePlayerAgree(roomID);\r\n            this.Show_btnCancel_btnSure(false);\r\n        }\r\n    },\r\n\r\n});\r\n"]}