{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\script\\game\\PDK/assets\\script\\game\\PDK\\PDKRoom.js"],"names":["app","require","PDKRoom","BaseClass","extend","Init","JS_Name","subGameName","toUpperCase","ComTool","ShareDefine","HeroManager","RoomPosMgr","RoomSet","SysDataManager","PropertyInfo","GetTableDict","OnReload","Log","dataInfo","roomConfig","roomRecord","OnInitRoomData","serverPack","RoomStateStringDict","prizeType","isCoinRoom","cfg","roomPosInfoList","console","log","OnInitRoomPosData","setInfo","OnInitRoomSetData","isGetGR","OnPosLeave","pos","UpdateOwnerID","ownerID","OnPosContinueGame","OnSetStart","RoomState_Playing","GetRoomSet","OnSetEnd","setEnd","OnRoomEnd","roomEnd","RoomState_End","ChangePlayerNumAgree","agreeDissolve","dissolveInfo","posAgreeList","ErrLog","length","OnStartChangePlaeryDissolve","createPos","playerNum","endSec","index","push","OnPack_ChangePlayerNumAgree","roomID","NowRoom","OnEvent","OnStartVoteDissolve","UpdateEndSec","OnPosDealVote","RoomRecord","OnSportsPointChange","OnDissolve","dissolve","GetRoomXianShi","OnPlaying","opPos","OnSetPlaying","GetRoomRecord","GetRoomDataInfo","GetRoomProperty","property","hasOwnProperty","ClearDissolve","GetRoomConfig","GetRoomConfigByProperty","setID","GetRoomPosMgr","IsClientIsCreater","heroID","GetHeroID","IsClientIsOwner","SetGameRecord","bget","GetGameRecord","GetClientPlayerSetPos","GetClientPos","setPos","GetSetPosByPos","GetClientPlayerInfo","playerInfo","GetPlayerInfoByPos","GetRoomShouPai","GetRoomWanfa","wanfa","indexOf","GetRoomSiDai","value","g_PDKRoom","exports","GetModel"],"mappings":"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","file":"PDKRoom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\game\\PDK","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package SSSRoom.js\r\n *  @todo: 拼罗松房间\r\n *\r\n *  @version 1.0\r\n *\r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *\r\n */\r\nvar app = require('pdk_app');\r\n\r\n/**\r\n * 类构造\r\n */\r\nvar PDKRoom = app.BaseClass.extend({\r\n\r\n\t/**\r\n\t * 初始化\r\n\t */\r\n\tInit:function(){\r\n\r\n\t\tthis.JS_Name = app.subGameName.toUpperCase()+\"Room\";\r\n\r\n\t\tthis.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n\r\n\t\tthis.RoomPosMgr = app[app.subGameName.toUpperCase() + \"RoomPosMgr\"]();\r\n\t\tthis.RoomSet = app[app.subGameName.toUpperCase() + \"RoomSet\"]();\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n\t\tthis.PropertyInfo = this.SysDataManager.GetTableDict(\"PropertyInfo\");\r\n\r\n\t\tthis.OnReload();\r\n\r\n\t\tthis.Log(\"Init\");\r\n\r\n\t},\r\n\r\n\tOnReload:function(){\r\n\r\n\t\tthis.dataInfo = {};\r\n\r\n\t\tthis.roomConfig = {};\r\n\r\n        this.roomRecord = {};\r\n\r\n\t},\r\n\r\n\t//-----------------------回调函数-----------------------------\r\n\t//登录初始化房间数据\r\n\tOnInitRoomData:function(serverPack){\r\n\r\n\t\tserverPack[\"state\"] = this.ShareDefine.RoomStateStringDict[serverPack[\"state\"]];\r\n\r\n\t\tif(serverPack.prizeType == 'Gold'){\r\n\t\t\tapp[app.subGameName+\"_ShareDefine\"]().isCoinRoom = true;\r\n\t\t}\r\n\t\telse if(serverPack.prizeType == 'RoomCard'){\r\n\t\t\tapp[app.subGameName+\"_ShareDefine\"]().isCoinRoom = false;\r\n\t\t}\r\n\r\n\t\tlet cfg = serverPack[\"cfg\"];\r\n\t\tthis.roomConfig = cfg;\r\n\r\n\t\tlet roomPosInfoList = serverPack[\"posList\"]||[];\r\n\t\tconsole.log('roomPosInfoList', roomPosInfoList);\r\n\t\tthis.RoomPosMgr.OnInitRoomPosData(roomPosInfoList);\r\n\r\n\t\tlet setInfo = serverPack[\"set\"];\r\n\t\tthis.RoomSet.OnInitRoomSetData(setInfo);\r\n\r\n\t\t//其余信息存放到dataInfo\r\n\t\tthis.dataInfo = serverPack;\r\n\r\n\t\tthis.isGetGR = false;\r\n\t\tthis.Log(\"roomConfig:\", this.roomConfig);\r\n\t\tthis.Log(\"dataInfo:\", this.dataInfo);\r\n\t},\r\n\r\n\t//位置离开\r\n\tOnPosLeave:function(pos){\r\n\t\tthis.RoomPosMgr.OnPosLeave(pos);\r\n\t},\r\n\tUpdateOwnerID:function(ownerID){\r\n\t\tthis.dataInfo['ownerID']=ownerID;\r\n\t},\r\n\t//继续游戏\r\n\tOnPosContinueGame:function(pos){\r\n\t\tthis.RoomPosMgr.OnPosContinueGame(pos);\r\n\t},\r\n\r\n\t//set开始\r\n\tOnSetStart:function(setInfo){\r\n\t\tthis.dataInfo[\"state\"] = this.ShareDefine.RoomState_Playing;\r\n\t\tthis.dataInfo[\"setID\"] = setInfo[\"setID\"];\r\n\t\tthis.GetRoomSet().OnSetStart(setInfo);\r\n\t},\r\n\r\n\t//set结束\r\n\tOnSetEnd:function(setEnd){\r\n\t\tthis.RoomSet.OnSetEnd(setEnd);\r\n\t\tthis.RoomPosMgr.OnSetEnd(setEnd);\r\n\t},\r\n\r\n\t//房间结束\r\n\tOnRoomEnd:function(roomEnd){\r\n\t\tthis.dataInfo[\"state\"] = this.ShareDefine.RoomState_End;\r\n\t\tthis.dataInfo[\"roomEnd\"] = roomEnd;\r\n\t},\r\n\r\n\t//位置同意拒绝更新\r\n\tChangePlayerNumAgree:function(pos, agreeDissolve){\r\n\t\tlet dissolveInfo = this.dataInfo[\"changePlayerNum\"];\r\n\t\tlet posAgreeList = dissolveInfo[\"posAgreeList\"];\r\n\t\tif(!posAgreeList){\r\n\t\t\tthis.ErrLog(\"OnChangeDealVote not find posAgreeList:\", this.dataInfo);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif(pos >= posAgreeList.length){\r\n\t\t\tthis.ErrLog(\"OnChangeDealVote(%s,%s):\", pos, agreeDissolve, posAgreeList);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif(agreeDissolve){\r\n\t\t\tposAgreeList[pos] = 1;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tposAgreeList[pos] = 2;\r\n\t\t}\r\n\t\treturn dissolveInfo\r\n\t},\r\n\t//人数修改\r\n\tOnStartChangePlaeryDissolve:function(createPos,playerNum,endSec){\r\n\t\tlet posAgreeList = [];\r\n\t\tfor(let index=0; index<3; index++){\r\n\t\t\tif(index == createPos){\r\n\t\t\t\tposAgreeList.push(1);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tposAgreeList.push(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet dissolveInfo = {\"endSec\":endSec,\"createPos\":createPos, \"posAgreeList\":posAgreeList};\r\n\t\tthis.dataInfo[\"changePlayerNum\"] = dissolveInfo;\r\n\t\treturn dissolveInfo;\r\n\t},\r\n\r\n\t//位置更新解散\r\n\tOnPack_ChangePlayerNumAgree:function(serverPack){\r\n\t\tlet roomID = serverPack[\"roomID\"];\r\n\t\tlet pos = serverPack[\"pos\"];\r\n\t\tlet agreeDissolve = serverPack[\"agreeChange\"];\r\n\t\tlet dissolveInfo = this.NowRoom().ChangePlayerNumAgree(pos, agreeDissolve);\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"PosChangePlayerDealVote\", dissolveInfo);\r\n\t},\r\n\r\n\t//开始解散房间\r\n\tOnStartVoteDissolve:function(createPos, endSec){\r\n\t\tlet posAgreeList = [];\r\n\r\n\t\tfor(let index=0; index<10; index++){\r\n\t\t\tconsole.log(\"createPos:\"+createPos+\",index:\"+index);\r\n\t\t\tif(index == createPos){\r\n\t\t\t\tposAgreeList.push(1);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tposAgreeList.push(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet dissolveInfo = {\"endSec\":endSec,\"createPos\":createPos, \"posAgreeList\":posAgreeList};\r\n\t\tthis.dataInfo[\"dissolve\"] = dissolveInfo;\r\n\t\treturn dissolveInfo;\r\n\t},\r\n\tUpdateEndSec:function(endSec){\r\n\t\tthis.dataInfo[\"dissolve\"][\"endSec\"] =endSec;\r\n\t},\r\n\t//位置同意拒绝更新\r\n\tOnPosDealVote:function(pos, agreeDissolve){\r\n\r\n\t\tlet dissolveInfo = this.dataInfo[\"dissolve\"];\r\n\t\tlet posAgreeList = dissolveInfo[\"posAgreeList\"];\r\n\t\tif(!posAgreeList){\r\n\t\t\tthis.ErrLog(\"OnPosDealVote not find posAgreeList:\", this.dataInfo);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif(pos >= posAgreeList.length){\r\n\t\t\tthis.ErrLog(\"OnPosDealVote(%s,%s):\", pos, agreeDissolve, posAgreeList);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif(agreeDissolve){\r\n\t\t\tposAgreeList[pos] = 1;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tposAgreeList[pos] = 2;\r\n\t\t}\r\n\t\treturn dissolveInfo\r\n\t},\r\n\t//更新房间内的对局记录信息\r\n    RoomRecord:function (serverPack) {\r\n\t\tthis.roomRecord = {};\r\n\t\tthis.roomRecord = serverPack;\r\n\t},\r\n\tOnSportsPointChange:function(serverPack){\r\n\t\tthis.RoomPosMgr.OnSportsPointChange(serverPack);\r\n\t},\r\n\t//---------------------设置函数---------------------\r\n\tOnDissolve:function(dissolve){\r\n\t\tthis.dataInfo[\"dissolve\"] = dissolve;\r\n\t},\r\n\tGetRoomXianShi:function(){\r\n\t\treturn this.roomConfig[\"xianShi\"];\r\n\t},\r\n\tOnPlaying:function(serverPack){\r\n\t\t//改变玩家出牌位置\r\n\t\tlet opPos = serverPack.opPos;\r\n\t\tthis.RoomSet.OnSetPlaying(opPos);\r\n\t},\r\n\t\r\n\t//---------------------获取函数---------------------\r\n\t//获取对局记录信息\r\n\tGetRoomRecord:function () {\r\n\t\treturn this.roomRecord;\r\n\t},\r\n\t\r\n\t//获取房间信息\r\n\tGetRoomDataInfo:function () {\r\n\t\treturn this.dataInfo;\r\n    },\r\n\t//获取创建房间信息b\r\n\tGetRoomProperty:function(property){\r\n\t\tif(!this.dataInfo.hasOwnProperty(property)){\r\n\t\t\tthis.ErrLog(\"GetRoomProperty not find:%s\", property);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.dataInfo[property];\r\n\t},\r\n\tClearDissolve:function(){\r\n\t\tthis.dataInfo['dissolve']='';\r\n\t},\r\n\t//获取房间配置信息\r\n\tGetRoomConfig:function(){\r\n\t\treturn this.roomConfig\r\n\t},\r\n\r\n\t//获取房间配置信息\r\n\tGetRoomConfigByProperty:function(property){\r\n\t\tif(!this.roomConfig.hasOwnProperty(property)){\r\n\t\t\tthis.ErrLog(\"GetRoomConfigByProperty not find:%s\", property);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.roomConfig[property];\r\n\t},\r\n\r\n\tGetRoomSet:function(){\r\n\t\tlet setID = this.dataInfo[\"setID\"];\r\n\t\tif(!setID){\r\n\t\t\tthis.ErrLog(\"GetSet not start set\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.RoomSet;\r\n\t},\r\n\r\n\tGetRoomPosMgr:function(){\r\n\t\treturn this.RoomPosMgr;\r\n\t},\r\n\t//客户端玩家是否是开房人\r\n    IsClientIsCreater:function(){\r\n        let heroID = this.HeroManager.GetHeroID();\r\n        if(heroID == this.dataInfo[\"createID\"]){\r\n            return true\r\n        }\r\n        return false\r\n    },\r\n\t//客户端玩家是否是房主\r\n\tIsClientIsOwner:function(){\r\n\t\tlet heroID = this.HeroManager.GetHeroID();\r\n\t\tif(heroID == this.dataInfo[\"ownerID\"]){\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t},\r\n\r\n\tSetGameRecord:function(bget){\r\n\t\tthis.isGetGR = bget;\r\n\t},\r\n\r\n\tGetGameRecord:function(){\r\n\t\treturn this.isGetGR;\r\n\t},\r\n\r\n\t//获取玩家setPos对象\r\n\tGetClientPlayerSetPos:function(){\r\n\r\n\t\tlet pos = this.RoomPosMgr.GetClientPos();\r\n\t\tif(pos < 0){\r\n\t\t\tthis.ErrLog(\"GetClientPlayerSetPos not enter room\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet setPos = this.RoomSet.GetSetPosByPos(pos);\r\n\t\tif(!setPos){\r\n\t\t\tthis.ErrLog(\"GetClientPlayerSetPos(%s) not find setPos\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn setPos\r\n\t},\r\n\r\n\t//获取客户端玩家信息\r\n    GetClientPlayerInfo:function(){\r\n\t\tlet pos = this.RoomPosMgr.GetClientPos();\r\n\t\tif(pos < 0){\r\n\t\t\tthis.ErrLog(\"GetClientPlayerInfo not enter room\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet playerInfo = this.RoomPosMgr.GetPlayerInfoByPos(pos);\r\n\t\tif(!playerInfo){\r\n\t\t\tthis.ErrLog(\"GetClientPlayerInfo(%s) not find playerInfo\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn playerInfo\r\n\t},\r\n\tGetRoomShouPai:function(){\r\n\t\tif(this.roomConfig[\"shoupai\"]==0){\r\n\t\t\treturn 15;\r\n\t\t}\r\n\t\treturn 16;\r\n\t},\r\n\tGetRoomWanfa:function(wanfa){\r\n\t\tif(this.roomConfig[\"kexuanwanfa\"].indexOf(wanfa) != -1){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\tGetRoomSiDai:function(value){\r\n\t\tif(this.roomConfig[\"sidai\"].indexOf(value) != -1){\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n})\r\n\r\n\r\nvar g_PDKRoom = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n\tif(!g_PDKRoom)\r\n\t\tg_PDKRoom = new PDKRoom();\r\n\treturn g_PDKRoom;\r\n}\r\n"]}