{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\pdk_AudioManager.js"],"names":["app","require","pdk_AudioManager","BaseClass","extend","Init","JS_Name","subGameName","audioFileName","recordFileName","recordPos","isRecording","isVoiceTouchEnd","audioList","RegEvent","OnEvent_PlayAudioFinish","OnEvent_AudioError","OnEvent_AudioStopError","OnEvent_MedioRecordError","OnEvent_wellPrepared","RegNetPack","toUpperCase","OnPack_SPlayer_Voice","OnEvt_AmrFileDownLoadFinish","OnEvt_RecordAudioFinsh","OnDestory","setHeadInfo","stopRecord","stopPlayAudio","setSound","flag","value","LocalDataManager","GetConfigProperty","RecoverySceneMusic","PauseAllSound","pos","OnEvent","checkAudioList","length","audioInfo","shift","playAudioOrDownLoad","setTouchEnd","startRecord","IsAudio","ShowSysMsg","that","setTimeout","pausePlayAudio","getFileName","argList","CallToNative","CloseForm","sendRecordFile","cc","sys","isNative","data","jsb","fileUtils","getDataFromFile","url","httpRequest","ActiveXObject","e","XMLHttpRequest","open","setRequestHeader","onerror","ErrLog","onreadystatechange","SysLog","status","responseText","receivePack","JSON","parse","sendAudioURLToServer","readyState","send","downLoadRecordFile","serverURL","LocalURL","downLoadMgr","DownFile","urls","RoomMgr","room","GetEnterRoom","roomID","GetRoomProperty","SendPack","serverPack","GetEnterRoomID","console","log","push","GetRoomPosMgr","GetClientPos","resumePlayAudio","playAudio","filename","event","ShowForm","timestamp","Date","valueOf","storagePath","getWritablePath","AccountID","GetAccountProperty","fileName","Math","random","g_pdk_AudioManager","exports","GetModel"],"mappings":"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","file":"pdk_AudioManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n录音管理器\r\n */\r\nvar app = require(\"pdk_app\");\r\n\r\nvar pdk_AudioManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n        this.JS_Name = app.subGameName + \"_AudioManager\";\r\n        \r\n        this.audioFileName = \"\"; //播放录音文件位置\r\n        this.recordFileName = \"\";//录音文件\r\n        \r\n        this.recordPos = null; //录音位置\r\n\r\n        this.isRecording = false; //是否正在录音\r\n\r\n        this.isVoiceTouchEnd = false;\r\n\r\n        this.audioList = [];\r\n\r\n        //播放录音完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"palyAudioFinsh\",           this.OnEvent_PlayAudioFinish,   this);\r\n        //录音失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AudioError\",               this.OnEvent_AudioError,        this);\r\n        //录音停止失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AudioStopError\",           this.OnEvent_AudioStopError,        this);\r\n        //播放失败\r\n        app[app.subGameName + \"Client\"].RegEvent(\"MedioRecordError\",         this.OnEvent_MedioRecordError,  this);\r\n        //准备录音\r\n        app[app.subGameName + \"Client\"].RegEvent(\"wellPrepared\",             this.OnEvent_wellPrepared,      this);\r\n        //收到其他玩家播放语音\r\n        app[app.subGameName + \"_NetManager\"]().RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_Voice\",    this.OnPack_SPlayer_Voice,      this);\r\n        //下载完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"AMRFILEDOWNLOADFINISH\",    this.OnEvt_AmrFileDownLoadFinish, this);\r\n        //录音完成\r\n        app[app.subGameName + \"Client\"].RegEvent(\"RECORDAUDIOFINSH\",         this.OnEvt_RecordAudioFinsh,    this);\r\n    },\r\n\r\n    //销毁\r\n    OnDestory:function(){\r\n        this.setHeadInfo(false);\r\n        this.audioFileName = \"\";\r\n        this.recordFileName = \"\";\r\n\r\n        this.recordPos = null;\r\n        this.isRecording = false;\r\n\r\n        this.audioList = [];\r\n        this.stopRecord();\r\n        this.stopPlayAudio();\r\n    },\r\n\r\n    //开关背景音乐\r\n    setSound:function(flag){\r\n        let value = app.LocalDataManager().GetConfigProperty(\"SysSetting\",\"BackMusic\");\r\n        if(value){\r\n            if(flag){\r\n                app[app.subGameName + \"_SceneManager\"]().RecoverySceneMusic();\r\n            }else{\r\n                app[app.subGameName + \"_SoundManager\"]().PauseAllSound();\r\n            }\r\n        }\r\n    },\r\n\r\n\r\n    //设置是否显示语音\r\n    setHeadInfo:function(flag, pos ){\r\n        app[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf',{'bShow':flag,'pos':pos});\r\n        if(flag){\r\n            // let that = this;\r\n            // // cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 100.0); \r\n            // setTimeout(function(){\r\n            //     app[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf',{'bShow':false,'pos':pos});\r\n            // },100.0);\r\n        }\r\n    },\r\n\r\n    //判断是否还有语音播放\r\n    checkAudioList:function(){\r\n        this.setHeadInfo(false);\r\n        \r\n        if(this.audioList.length > 0){\r\n            let audioInfo = this.audioList.shift();\r\n            this.playAudioOrDownLoad(audioInfo);\r\n        }else{\r\n            this.setSound(true);\r\n\r\n            // this.setHeadInfo(false);\r\n        }\r\n    },\r\n\r\n    //设置是否是touchEnd\r\n    setTouchEnd:function(flag){\r\n        this.isVoiceTouchEnd = flag;\r\n    },\r\n\r\n    //开始录音\r\n    startRecord:function(){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n        if(this.isRecording){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_LAST_RECORDING');\r\n            return;\r\n        }\r\n        this.isRecording = true;\r\n        \r\n        var that = this;\r\n        // cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 20.0); \r\n\r\n        setTimeout(function(){\r\n            that.isRecording = false;\r\n        },20.0);\r\n        \r\n        this.isVoiceTouchEnd = false;\r\n\r\n        this.setSound(false);\r\n        this.pausePlayAudio();\r\n\r\n        this.audioFileName = this.getFileName();\r\n\r\n        let argList = [{\"Name\":\"fileName\",\"Value\":this.audioFileName}];\r\n        let value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"startRecord\", argList);  \r\n    },\r\n\r\n    //停止录音\r\n    stopRecord:function(){\r\n        app[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n        let value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"stopRecord\", []);\r\n    },\r\n\r\n    //发送文件到服务器\r\n    sendRecordFile:function(){\r\n\r\n        if(this.audioFileName == null || this.audioFileName == \"\") return;\r\n        \r\n        if(!cc.sys.isNative) return;\r\n\r\n        var data = jsb.fileUtils.getDataFromFile(this.audioFileName);\r\n\r\n        var url = \"http://voice.qp355.com:8080\";\r\n        //每次都实例化一个，否则会引起请求结束，实例被释放了\r\n        var httpRequest = null;\r\n        try {\r\n                httpRequest =  new ActiveXObject (\"Microsoft.XMLHTTP\");\r\n        }catch(e){\r\n            try {\r\n                httpRequest = new XMLHttpRequest();\r\n            }catch(e) {\r\n                \r\n            }\r\n        }\r\n        httpRequest.open(\"POST\", url, true);\r\n        httpRequest.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\r\n        httpRequest.setRequestHeader('Content-Type', 'application/octet-stream');\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        httpRequest.setRequestHeader(\"Content-Type\", \"multipart/form-data;\");\r\n\r\n\r\n        var that = this;\r\n        httpRequest.onerror = function(){\r\n            that.ErrLog(\"sendRecordFile httpRequest.error:%s\", url);\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n        };\r\n        \r\n        httpRequest.onreadystatechange = function(){\r\n            that.SysLog(\"onreadystatechange httpRequest.status:%s, httpRequest.responseText:%s\",httpRequest.status, httpRequest.responseText);\r\n            //执行成功\r\n            if (httpRequest.status == 200){\r\n                \r\n                var receivePack = JSON.parse(httpRequest.responseText);\r\n                that.SysLog(\"sendRecordFile receivePack[status]:%s,receivePack[url]:%s\", receivePack[\"status\"],receivePack[\"url\"]);\r\n                if(receivePack[\"status\"] == 1){\r\n                    that.sendAudioURLToServer(receivePack[\"url\"]);\r\n                }else{\r\n                    that.SysLog(\"sendRecordFile receivePack[status]=2 msg:%s\", receivePack[\"msg\"]);\r\n                    app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n                }\r\n            }\r\n            else{\r\n                app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n                that.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\r\n            }\r\n        };\r\n        httpRequest.send(data);\r\n    },\r\n\r\n    //下载文件\r\n    downLoadRecordFile:function(serverURL, LocalURL){\r\n        let downLoadMgr = app[app.subGameName + \"_DownLoadMgr\"]();\r\n        downLoadMgr.DownFile(serverURL, LocalURL, \"deleteString\", \"AMRFILEDOWNLOADFINISH\");\r\n    },\r\n\r\n    //---------------发包接口------------------------\r\n    //将URL上传到服务器\r\n    sendAudioURLToServer:function(urls){\r\n        let RoomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        let room =  RoomMgr.GetEnterRoom();\r\n        let roomID = room.GetRoomProperty(\"roomID\");\r\n\r\n        app[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Voice\", {\"roomID\":roomID,  \"url\":urls});\r\n\r\n        this.isRecording = false;\r\n\r\n    },\r\n\r\n    //----------------封包借口\r\n    //收到回话\r\n    OnPack_SPlayer_Voice:function(serverPack){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n\r\n        let urls    = serverPack[\"url\"];\r\n\r\n        let RoomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        let room = RoomMgr.GetEnterRoom();\r\n\r\n        //不是自己房间\r\n        if(RoomMgr.GetEnterRoomID() != serverPack[\"roomID\"]){\r\n            console.log(\"当前语音不是这个房间的id ---- \" + RoomMgr.GetEnterRoomID() + \" === \" + serverPack[\"roomID\"]);\r\n            return;\r\n        }\r\n\r\n        this.audioList.push({\"pos\":serverPack[\"pos\"], \"url\":serverPack[\"url\"], \"fileName\": this.audioFileName});\r\n        if(this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() != serverPack[\"pos\"]){ //正在录音\r\n            console.log(\"语音播放有误 ---- \" + this.audioFileName);\r\n            return;\r\n        }\r\n        //录音完成\r\n        else if(this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() == serverPack[\"pos\"]){\r\n            if(this.recordFileName != \"\"){\r\n                this.resumePlayAudio();\r\n            }else{\r\n                this.checkAudioList();\r\n            }\r\n\r\n        }else if( this.recordFileName != \"\"){ //上一个播放没有完成\r\n            //this.resumePlayAudio();\r\n            return;\r\n        }\r\n        //没有录音\r\n        else{\r\n            this.checkAudioList();\r\n        }\r\n        this.audioFileName = \"\";\r\n    },\r\n\r\n    ///-------------------------\r\n\r\n    //下载或播放语音\r\n    playAudioOrDownLoad:function(audioInfo){\r\n        let IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n        if(!IsAudio){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n            return;\r\n        }\r\n       \r\n        //自己直接播放\r\n        let RoomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        let room = RoomMgr.GetEnterRoom();\r\n        \r\n        if(room.GetRoomPosMgr().GetClientPos() == audioInfo[\"pos\"]){\r\n            if(this.recordFileName == \"\"){\r\n                this.recordFileName = audioInfo[\"fileName\"];\r\n                this.recordPos =  audioInfo[\"pos\"];\r\n                this.playAudio(this.recordFileName, audioInfo[\"pos\"]);\r\n            }else{\r\n                this.resumePlayAudio();\r\n            }\r\n        }else{\r\n            this.recordFileName = this.getFileName();\r\n            this.recordPos =  audioInfo[\"pos\"];\r\n            this.downLoadRecordFile(audioInfo[\"url\"], this.recordFileName);\r\n        }\r\n    },\r\n\r\n    //播放语音\r\n    playAudio:function(filename, pos){\r\n        if(filename == \"\"){\r\n            return ;\r\n        }\r\n        \r\n        this.setHeadInfo(false);\r\n\r\n        this.setSound(false);\r\n\r\n        let argList = [{\"Name\":\"fileName\",\"Value\":filename}];\r\n        let value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"playerRecord\", argList); \r\n       \r\n        this.setHeadInfo(true, pos);\r\n    },\r\n\r\n    //停止语音\r\n    stopPlayAudio:function(){\r\n        this.setHeadInfo(false);\r\n        let value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"stopPlayerRecord\", []); \r\n    },\r\n\r\n    //暂停播放\r\n    pausePlayAudio:function(){\r\n        if(this.recordFileName == \"\"){\r\n            return;\r\n        }\r\n        \r\n        app[app.subGameName + \"_NativeManager\"]().CallToNative(\"pausePlayerRecord\", []); \r\n    },\r\n    \r\n    //继续播放\r\n    resumePlayAudio:function(){\r\n        app[app.subGameName + \"_NativeManager\"]().CallToNative(\"resumePlayerRecord\", []); \r\n    },\r\n\r\n\r\n    ///------------------------------事件-----------------------\r\n    //语音播放完成\r\n    OnEvent_PlayAudioFinish:function(event){\r\n        app[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\r\n        this.recordFileName = \"\";\r\n\r\n        this.setHeadInfo(false);\r\n\r\n        this.recordPos = null;\r\n\r\n        this.checkAudioList();\r\n    },\r\n    //录制语音失败\r\n    OnEvent_AudioError:function(event){\r\n\r\n        app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_ERROR');\r\n\r\n        this.stopRecord();\r\n        \r\n        this.audioFileName = \"\";\r\n        this.isRecording = false;\r\n\r\n        app[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n        this.checkAudioList();\r\n    },\r\n    //录制停止语音失败\r\n    OnEvent_AudioStopError:function(event){\r\n\r\n        app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_STOP_ERROR');\r\n\r\n        this.audioFileName = \"\";\r\n        this.isRecording = false;\r\n\r\n        app[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n        this.checkAudioList();\r\n    },\r\n    //播放语音失败\r\n    OnEvent_MedioRecordError:function(event){\r\n        this.setHeadInfo(false);\r\n        \r\n        app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_PLAY_RECORD_ERROR');\r\n\r\n        this.recordFileName = \"\";\r\n        this.recordPos = null;\r\n        this.checkAudioList();\r\n    },\r\n    //准备录制\r\n    OnEvent_wellPrepared:function(event){\r\n        if(this.isVoiceTouchEnd){ \r\n            this.audioFileName = \"\";\r\n            this.isRecording = false;\r\n    \r\n            app[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n            this.checkAudioList();\r\n            return;\r\n        }\r\n        this.setSound(false);\r\n        app[app.subGameName + \"_FormManager\"]().ShowForm(app.subGameName + \"_UIAudio\");\r\n    },\r\n\r\n    //文件下载完成\r\n    OnEvt_AmrFileDownLoadFinish:function(event){\r\n        this.playAudio(this.recordFileName, this.recordPos);\r\n    },\r\n\r\n    //录音完成\r\n    OnEvt_RecordAudioFinsh:function(event){\r\n        this.sendRecordFile();  \r\n    },\r\n\r\n    //获取文件名\r\n    getFileName:function(){\r\n        var timestamp = (new Date()).valueOf();\r\n        let storagePath = '/';\r\n        if(cc.sys.isNative){\r\n            storagePath = jsb ? (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'ALLGame/' + app.subGameName : '/';\r\n        }\r\n        let AccountID = app[app.subGameName+\"_HeroAccountManager\"]().GetAccountProperty(\"AccountID\");\r\n        let fileName = storagePath + AccountID + timestamp + Math.random()%16 + \".amr\";\r\n        return fileName;\r\n    },\r\n});\r\n\r\n\r\nvar g_pdk_AudioManager = null;\r\n  /**\r\n  ...\r\n  */\r\nexports.GetModel = function(){\r\n    if(!g_pdk_AudioManager){\r\n        g_pdk_AudioManager = new pdk_AudioManager();\r\n    }\r\n    return g_pdk_AudioManager;\r\n}"]}