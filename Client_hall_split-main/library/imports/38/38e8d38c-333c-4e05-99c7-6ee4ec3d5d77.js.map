{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\ui/assets\\script\\ui\\UILogin.js"],"names":["app","require","cc","Class","extends","properties","EditBoxAccount","EditBox","EditBoxPsw","OnCreateInit","HeroAccountManager","ShareDefine","RegEvent","Event_CodeError","Event_ConnectFail","isToken","event","argDict","code","KickOut_AccountTokenError","string","KickOut_ServerClose","WaitForConfirm","ConfirmYN","UpdateAccessPoint","ShowSysMsg","OnShow","sys","isNative","FormManager","ShowForm","CloseForm","httpPath","Client","GetClientConfigProperty","length","substring","NetRequest","SendHttpRequestGet","serverUrl","responseText","httpRequest","data","JSON","parse","Config","ShowAccountInfo","accountList","GetLocalAccountList","count","account","token","OnClick","btnName","btnNode","Click_btnLogin","Click_btnReg","ErrLog","charAccount","psw","AccountLogin","OneKeyRegAccount","OnEditBoxBegin","sender","OnConFirm","clickType","msgID","backArgList","QQQunLink","openURL","ChangeAccessPoint"],"mappings":"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","file":"UILogin.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\n    UILogin 登陆界面\n*/\nvar app = require(\"app\");\n\ncc.Class({\n    extends: require(\"BaseForm\"),\n\n    properties: {\n        EditBoxAccount: cc.EditBox,\n        EditBoxPsw: cc.EditBox,\n\n    },\n\n    //初始化\n    OnCreateInit:function(){\n        this.HeroAccountManager = app.HeroAccountManager();\n        this.ShareDefine = app.ShareDefine();\n\n\t    this.RegEvent(\"CodeError\", this.Event_CodeError);\n        this.RegEvent(\"ConnectFail\", this.Event_ConnectFail);\n\n        this.isToken = 0;\n    },\n\n\t//登录错误码\n\tEvent_CodeError:function(event){\n\t\tlet argDict = event;\n\t\tlet code = argDict[\"Code\"];\n\t\tif(code == this.ShareDefine.KickOut_AccountTokenError){\n\t\t\tthis.EditBoxPsw.string = \"\";\n\t\t}\n\t\telse if(code == this.ShareDefine.KickOut_ServerClose){\n\t\t\tthis.WaitForConfirm(\"Code_10016\", [], [], this.ShareDefine.ConfirmYN)\n\t\t}\n\t},\n\n\t//连接服务器失败\n\tEvent_ConnectFail:function(event){\n        this.UpdateAccessPoint();\n        let argDict = event;\n\t\tif(!argDict['bCloseByLogout'])\n\t\t\tthis.ShowSysMsg(\"Net_ConnectFail\");\n    },\n\n\t//--------------------显示函数----------------\n\n    OnShow:function(){\n    \tif (cc.sys.isNative){\n            app.FormManager().ShowForm(\"UILogin01\");\n            this.CloseForm();\n            return\n        }\n        let httpPath = app.Client.GetClientConfigProperty(\"WebSiteUrl\");\n        if (httpPath[httpPath.length-1] == \"/\") {\n            httpPath = httpPath.substring(0, httpPath.length-1)\n        }\n        httpPath = httpPath + \"/index.php?module=Api&action=Config\"\n        app.NetRequest().SendHttpRequestGet(httpPath,\"\", {},15000,(serverUrl, responseText, httpRequest) =>{\n            let data = JSON.parse(responseText)\n            app.Config = data.data\n        });\n        this.ShowAccountInfo();\n    },\n\n    //显示账号信息\n    ShowAccountInfo:function(){\n        let accountList = this.HeroAccountManager.GetLocalAccountList();\n        let count = accountList.length;\n\n        let account = \"\";\n        let token = \"\";\n\n        if(count){\n            account = accountList[count-1];\n            //token = this.HeroAccountManager.GetAccountToken(account);\n\t        //this.isToken = 1;\n        }\n\n        this.EditBoxAccount.string = account;\n        this.EditBoxPsw.string = '123456';\n\n    },\n\n    //---------点击函数---------------------\n\n    OnClick:function(btnName, btnNode){\n\t\t// this.HeroAccountManager.LoginAccountBySDK();\n        if(btnName == \"btnLogin\"){\n            this.Click_btnLogin();\n        }\n        else if(btnName == \"btnReg\"){\n            this.Click_btnReg();\n        }\n        else{\n            this.ErrLog(\"OnClick:%s not find\", btnName);\n        }\n    },\n\n    //点击登陆\n    Click_btnLogin:function(){\n        let charAccount = this.EditBoxAccount.string;\n        if(!charAccount){\n            this.ShowSysMsg(\"AccountLogin_NotInputAccount\")\n            return\n        }\n        let psw = '123456';\n        if(!psw){\n            this.ShowSysMsg(\"AccountLogin_NotInputPsw\")\n            return\n        }\n\n        //如果密码等于token为token登录\n        /*if(this.isToken){\n\t\t    psw = this.HeroAccountManager.GetAccountToken(charAccount);\n        }*/\n\n        //账号密码登陆\n        this.HeroAccountManager.AccountLogin(charAccount, psw, this.isToken);\n\n    },\n\n    //点击注册\n    Click_btnReg:function(){\n        this.HeroAccountManager.OneKeyRegAccount();\n    },\n\n    OnEditBoxBegin:function(sender){\n\n\t    //如果点击了密码输入,则清除token标示\n\t    /*if(sender == this.EditBoxPsw){\n\t\t    this.isToken = 0;\n\t\t    sender.string = \"\";\n\t    }*/\n    },\n\n\t//2次确认回调\n\tOnConFirm:function(clickType, msgID, backArgList){\n\n\t\tif(clickType != \"Sure\"){\n\t\t\treturn\n\t\t}\n\t\tif(msgID == \"Code_10016\"){\n\t\t\tlet QQQunLink = app.Client.GetClientConfigProperty(\"QQQunLink\");\n\t\t\tcc.sys.openURL(QQQunLink);\n\t\t}\n\t},\n    UpdateAccessPoint:function(){\n        app.HeroAccountManager().ChangeAccessPoint();\n    },\n});\n"]}