{"version":3,"sources":["..\\..\\..\\..\\assets\\resources/assets\\resources\\version_generator.js"],"names":["fs","require","path","crypto","manifest","packageUrl","remoteManifestUrl","remoteVersionUrl","version","assets","searchPaths","dest","src","i","process","argv","length","arg","url","readDir","dir","obj","stat","statSync","isDirectory","subpaths","readdirSync","subpath","size","md5","compressed","relative","join","isFile","createHash","update","readFileSync","digest","extname","toLowerCase","replace","encodeURI","err","console","error","mkdirSync","e","code","destManifest","destVersion","writeFile","JSON","stringify","log"],"mappings":"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","file":"version_generator.js","sourceRoot":"..\\..\\..\\..\\assets\\resources","sourcesContent":["var fs = require('fs');\nvar path = require('path');\nvar crypto = require('crypto');\n\nvar manifest = {\n    packageUrl: 'http://localhost/tutorial-hot-update/remote-assets/',\n    remoteManifestUrl: 'http://localhost/tutorial-hot-update/remote-assets/project.manifest',\n    remoteVersionUrl: 'http://localhost/tutorial-hot-update/remote-assets/version.manifest',\n    version: '1.0.0',\n    assets: {},\n    searchPaths: []\n};\n\nvar dest = './remote-assets/';\nvar src = './jsb/';\n\n// Parse arguments\nvar i = 2;\nwhile (i < process.argv.length) {\n    var arg = process.argv[i];\n\n    switch (arg) {\n        case '--url':\n        case '-u':\n            var url = process.argv[i + 1];\n            manifest.packageUrl = url;\n            manifest.remoteManifestUrl = url + 'project.manifest';\n            manifest.remoteVersionUrl = url + 'version.manifest';\n            i += 2;\n            break;\n        case '--version':\n        case '-v':\n            manifest.version = process.argv[i + 1];\n            i += 2;\n            break;\n        case '--src':\n        case '-s':\n            src = process.argv[i + 1];\n            i += 2;\n            break;\n        case '--dest':\n        case '-d':\n            dest = process.argv[i + 1];\n            i += 2;\n            break;\n        default:\n            i++;\n            break;\n    }\n}\n\n\nfunction readDir(dir, obj) {\n    try {\n        var stat = fs.statSync(dir);\n        if (!stat.isDirectory()) {\n            return;\n        }\n        var subpaths = fs.readdirSync(dir), subpath, size, md5, compressed, relative;\n        for (var i = 0; i < subpaths.length; ++i) {\n            if (subpaths[i][0] === '.') {\n                continue;\n            }\n            subpath = path.join(dir, subpaths[i]);\n            stat = fs.statSync(subpath);\n            if (stat.isDirectory()) {\n                readDir(subpath, obj);\n            }\n            else if (stat.isFile()) {\n                // Size in Bytes\n                size = stat['size'];\n                md5 = crypto.createHash('md5').update(fs.readFileSync(subpath)).digest('hex');\n                compressed = path.extname(subpath).toLowerCase() === '.zip';\n\n                relative = path.relative(src, subpath);\n                relative = relative.replace(/\\\\/g, '/');\n                relative = encodeURI(relative);\n                obj[relative] = {\n                    'size': size,\n                    'md5': md5\n                };\n                if (compressed) {\n                    obj[relative].compressed = true;\n                }\n            }\n        }\n    } catch (err) {\n        console.error(err)\n    }\n}\n\nvar mkdirSync = function (path) {\n    try {\n        fs.mkdirSync(path);\n    } catch (e) {\n        if (e.code != 'EEXIST') throw e;\n    }\n}\n\n// Iterate assets and src folder\nreadDir(path.join(src, 'src'), manifest.assets);\nreadDir(path.join(src, 'assets'), manifest.assets);\nreadDir(path.join(src, 'jsb-adapter'), manifest.assets);\n\nvar destManifest = path.join(dest, 'project.manifest');\nvar destVersion = path.join(dest, 'version.manifest');\n\nmkdirSync(dest);\n\nfs.writeFile(destManifest, JSON.stringify(manifest), (err) => {\n    if (err) throw err;\n    console.log('Manifest successfully generated');\n});\n\ndelete manifest.assets;\ndelete manifest.searchPaths;\nfs.writeFile(destVersion, JSON.stringify(manifest), (err) => {\n    if (err) throw err;\n    console.log('Version successfully generated');\n});\n"]}