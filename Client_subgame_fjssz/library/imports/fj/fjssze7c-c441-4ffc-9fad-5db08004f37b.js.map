{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\fjssz_ServerTimeManager.js"],"names":["app","require","ServerTimeManager","BaseClass","extend","Init","JS_Name","ShareDefine","subGameName","ComTool","Reload","syncServerDataTimeTick","serverIntMsTime","serverDataTime","Date","logInGameTick","serverStartTime","InitLoginData","serverPack","SetServerTime","SetServerStartTime","curServerTick","curDate","nowTick","getTime","setTime","startTime","GetServerTimeData","getType","curNowTime","GetServerTimeByTimeTick","GetServerWeek","getDay","GetServerHours","getHours","GetServerMinSec","getMinutes","GetServerSec","getSeconds","GetServerYear","getFullYear","GetServerMonth","getMonth","GetServerDay","getDate","GetServerDate","GetServerDateString","year","StringAddNumSuffix","month","day","hour","min","second","join","GetServerTimeByTimeString","timeString","dateList","split","length","console","error","parse","getTimezoneOffset","tick","nowDate","GetDateTickToTimeStr","myDate","dateString","GetServerTimeTickByTime","sec","setHours","Math","floor","GetServerStartTime","TickToStr","showType","dayTick","dayNum","parseInt","hourNum","Second","intervalMinSec","intervalSec","showStr","ShowDayHour","StringReplace","ShowHourMinSec","ShowMinSec","ShowSec","ShowSecondSec","GetPassTimeStr","passTick","isNaN","ErrLog","passSec","BeforeSec_Str","value","i18n","t","GetCDTimeString","endTick","serverTimeTick","remainTick","GetCDTimeStringBySec","endSec","GetRemainTimeStr","timeTick","g_ServerTimeManager","exports","GetModel"],"mappings":"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","file":"fjssz_ServerTimeManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package ServerTimeManager\r\n *  @todo: 服务器时间同步\r\n *  \r\n *  @author hongdian\r\n *  @date 2014-10-30 16:04\r\n *  @version 1.0\r\n *  \r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *  \r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\n/**\r\n * 构造\r\n */\r\nvar ServerTimeManager = app.BaseClass.extend({\r\n\t\r\n\t/**\r\n\t * 初始化\r\n\t */\r\n\tInit:function(){\r\n\t\tthis.JS_Name = \"ServerTimeManager\";\r\n\r\n\t\tthis.ShareDefine = app[app.subGameName+\"_ShareDefine\"]();\r\n\t\tthis.ComTool = app[app.subGameName+\"_ComTool\"]();\r\n\r\n\t\tthis.Reload();\r\n\r\n\t\t// this.Log(\"create ServerTimeManager.js\");\r\n\t},\r\n\r\n\t/**\r\n\t * 重登\r\n\t */\r\n\tReload:function(){\r\n\t\t//收到服务器时间的客户端tick\r\n\t\tthis.syncServerDataTimeTick = 0;\r\n\t\t//收到的服务器时间豪秒形式值\r\n\t\tthis.serverIntMsTime = 0;\r\n\t\t//收到服务器时间的 Date时间形式\r\n\t\tthis.serverDataTime = new Date();\r\n\t\t//收到账号服务器登陆token的客户端tick\r\n\t\tthis.logInGameTick = 0;\r\n\t\t//收到服务器首次开服时间\r\n\t\tthis.serverStartTime = 0;\r\n\t},\r\n\r\n\t//--------------收包---------------------\r\n\t/**\r\n\t * 接收封包\r\n\t */\r\n\tInitLoginData:function(serverPack){\r\n\t\tthis.SetServerTime(serverPack[\"time\"]);\r\n\t\tthis.SetServerStartTime(serverPack[\"startServerTime\"]);\r\n\t},\r\n\t\r\n\r\n\t//---------------设置接口------------------------\r\n\r\n\r\n\t/**\r\n\t * 设置服务器时间\r\n\t */\r\n\tSetServerTime:function(curServerTick){\r\n\r\n\t\tlet curDate = new Date();\r\n\t\tlet nowTick = curDate.getTime();\r\n\r\n\t\tthis.serverIntMsTime = curServerTick;\r\n\t\tthis.serverDataTime.setTime(this.serverIntMsTime);\r\n\t\tthis.syncServerDataTimeTick = nowTick;\r\n\r\n\t\treturn this.serverDataTime\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * 设置服务器首次开服时间\r\n\t */\r\n\tSetServerStartTime:function(startTime){\r\n\t\tthis.serverStartTime = startTime;\r\n\t},\r\n\r\n\t//-------------获取接口---------------------------\r\n\t/**\r\n\t * 获取服务器时间类型\r\n\t */\r\n\tGetServerTimeData:function(getType){\r\n\t\tif (!this.serverIntMsTime){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tlet curNowTime = new Date().getTime();\r\n\r\n\t\tlet curDate = this.GetServerTimeByTimeTick(this.serverIntMsTime + curNowTime - this.syncServerDataTimeTick);\r\n\r\n\t\t// 星期（0为周日）\r\n\t\tif (getType == this.ShareDefine.GetServerWeek){\r\n\t\t\treturn curDate.getDay();\r\n\t\t}\r\n\t\t// 小时（0到23）\r\n\t\telse if(getType == this.ShareDefine.GetServerHours){\r\n\r\n\t\t\treturn curDate.getHours();\r\n\t\t}\r\n\t\t// 分钟（0到59）\r\n\t\telse if(getType == this.ShareDefine.GetServerMinSec){\r\n\r\n\t\t\treturn curDate.getMinutes();\r\n\t\t}\r\n\t\t// 秒（0到59）\r\n\t\telse if(getType == this.ShareDefine.GetServerSec){\r\n\r\n\t\t\treturn curDate.getSeconds();\r\n\t\t}\r\n\t\t// 年\r\n\t\telse if(getType == this.ShareDefine.GetServerYear){\r\n\r\n\t\t\treturn curDate.getFullYear();\r\n\t\t}\r\n\t\t// 月（0表示一月，11表示十二月）\r\n\t\telse if(getType == this.ShareDefine.GetServerMonth){\r\n\r\n\t\t\treturn curDate.getMonth();\r\n\t\t}\r\n\t\t// 日（1到31）\r\n\t\telse if(getType == this.ShareDefine.GetServerDay){\r\n\r\n\t\t\treturn curDate.getDate();\r\n\t\t}\r\n\r\n\t\telse if(getType == this.ShareDefine.GetServerDate){\r\n\r\n\t\t\treturn curDate;\r\n\t\t}\r\n\t\telse if(getType == this.ShareDefine.GetServerDateString){\r\n\r\n\t\t\tlet year = this.ComTool.StringAddNumSuffix(\"\", curDate.getFullYear(), 4);\r\n\t\t\tlet month = this.ComTool.StringAddNumSuffix(\"\", curDate.getMonth() + 1, 2);\r\n\t\t\tlet day = this.ComTool.StringAddNumSuffix(\"\", curDate.getDate(), 2);\r\n\t\t\tlet hour = this.ComTool.StringAddNumSuffix(\"\", curDate.getHours(), 2);\r\n\t\t\tlet min = this.ComTool.StringAddNumSuffix(\"\", curDate.getMinutes(), 2);\r\n\t\t\tlet second = this.ComTool.StringAddNumSuffix(\"\", curDate.getSeconds(), 2);\r\n\r\n\t\t\t//20160101231701\r\n\t\t\treturn [year, month, day, hour, min, second].join(\"\");\r\n\t\t}\r\n\t\t// 服务器当前毫秒数(不需要转化为本地时间,只是一个整数值,与其他服务器时间整数值比较大小用)\r\n\t\telse{\r\n\r\n\t\t\treturn this.serverIntMsTime + (curNowTime - this.syncServerDataTimeTick)\r\n\t\t}\r\n\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * 更加时间字符串获取服务器时间毫秒值 2016-1-18 -> 1454234400000\r\n\t */\r\n\tGetServerTimeByTimeString:function(timeString){\r\n\t\tlet dateList = timeString.split(\"-\");\r\n\t\tif(dateList.length != 3){\r\n\t\t\tconsole.error(\"GetServerTimeByTimeString dateList(%s) error\", dateList);\r\n\t\t\treturn 0\r\n\t\t}\r\n\t\treturn Date.parse([dateList[1], dateList[2], dateList[0]].join(\"/\")) - new Date().getTimezoneOffset() * 60 * 1000 - 8 * 60 * 60 * 1000;\r\n\t},\r\n\r\n\t/**\r\n\t * 通过毫秒整数获取服务器对应时间对象 1454234400000 - > Date()\r\n\t */\r\n\tGetServerTimeByTimeTick:function(tick){\r\n\t\t//创建一个本地时间对象\r\n\t\tlet nowDate = new Date();\r\n\r\n\t\t//计算服务器对应的时间tick 需要加上时区查\r\n\t\tlet curNowTime = tick + nowDate.getTimezoneOffset() * 60 * 1000 + 8 * 60 * 60 * 1000;\r\n\r\n\t\t//加上时区查后生成的时间对象才是和服务器时间同步的对象\r\n\t\treturn new Date(curNowTime);\r\n\t},\r\n\r\n\t/**\r\n\t * 获取当前时间字符串格式\r\n\t * @returns {String} 2014-11-06\r\n\t */\r\n\tGetDateTickToTimeStr:function(tick){\r\n\r\n\t\tvar myDate = this.GetServerTimeByTimeTick(tick);\r\n\r\n\t\tvar year = myDate.getFullYear();\r\n\t\tvar month = myDate.getMonth() + 1;\r\n\t\tvar day = myDate.getDate();\r\n\r\n\t\tvar dateString = [this.ComTool.StringAddNumSuffix(\"\", year, 4), this.ComTool.StringAddNumSuffix(\"\", month, 2), this.ComTool.StringAddNumSuffix(\"\", day, 2)].join(\"-\");\r\n\r\n\t\treturn dateString\r\n\t},\r\n\r\n\t/**\r\n\t * 获取指定点数对应的服务器时间tick值\r\n\t */\r\n\tGetServerTimeTickByTime:function(hour, min, sec){\r\n\r\n\t\tif(!min){\r\n\t\t\tmin = 0;\r\n\t\t}\r\n\r\n\t\tif(!sec){\r\n\t\t\tsec = 0;\r\n\t\t}\r\n\t\tlet curDate = this.GetServerTimeData(this.ShareDefine.GetServerDate);\r\n\t\t//设置为0点时间\r\n\t\tcurDate.setHours(hour, min, sec, 0);\r\n\t\t//this.Log(\"GetServerTimeTickByTime {1}-{2}-{3} {4}:{5}:{6},{7}\", curDate.getFullYear(), curDate.getMonth(), curDate.getDate(), curDate.getHours(),curDate.getMinutes(),curDate.getSeconds(), curDate.getDay());\r\n\r\n\t\treturn Math.floor(curDate.getTime()) - new Date().getTimezoneOffset() * 60 * 1000 - 8 * 60 * 60 * 1000;\r\n\t},\r\n\r\n\t/**\r\n\t * 获取服务器首次开服时间\r\n\t */\r\n\tGetServerStartTime:function(getType){\r\n\r\n\t\tlet curDate = this.GetServerTimeByTimeTick(this.serverStartTime);\r\n\r\n\t\t//this.Log(\"{1}-{2}-{3} {4}:{5}:{6},{7}\", curDate.getFullYear(), curDate.getMonth(), curDate.getDate(), curDate.getHours(),curDate.getMinutes(),curDate.getSeconds(), curDate.getDay());\r\n\r\n\t\t// 星期（0为周日）\r\n\t\tif (getType == this.ShareDefine.GetServerWeek){\r\n\t\t\treturn curDate.getDay();\r\n\t\t}\r\n\t\t// 小时（0到23）\r\n\t\telse if(getType == this.ShareDefine.GetServerHours){\r\n\r\n\t\t\treturn curDate.getHours();\r\n\t\t}\r\n\t\t// 分钟（0到59）\r\n\t\telse if(getType == this.ShareDefine.GetServerMinSec){\r\n\r\n\t\t\treturn curDate.getMinutes();\r\n\t\t}\r\n\t\t// 秒（0到59）\r\n\t\telse if(getType == this.ShareDefine.GetServerSec){\r\n\r\n\t\t\treturn curDate.getSeconds();\r\n\t\t}\r\n\t\t// 年\r\n\t\telse if(getType == this.ShareDefine.GetServerYear){\r\n\r\n\t\t\treturn curDate.getFullYear();\r\n\t\t}\r\n\t\t// 月（0表示一月，11表示十二月）\r\n\t\telse if(getType == this.ShareDefine.GetServerMonth){\r\n\r\n\t\t\treturn curDate.getMonth();\r\n\t\t}\r\n\t\t// 日（1到31）\r\n\t\telse if(getType == this.ShareDefine.GetServerDay){\r\n\r\n\t\t\treturn curDate.getDate();\r\n\t\t}\r\n\r\n\t\telse if(getType == this.ShareDefine.GetServerDate){\r\n\r\n\t\t\treturn curDate;\r\n\t\t}\r\n\t\t// 服务器当前毫秒数(不需要转化为本地时间,只是一个整数值,与其他服务器时间整数值比较大小用)\r\n\t\telse{\r\n\r\n\t\t\treturn this.serverStartTime;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//-------------------操作接口----------------------------\r\n\r\n\t/**\r\n\t * 转换tick为时分秒字符串\r\n\t */\r\n\tTickToStr : function(tick, showType){\r\n\r\n\t\tif(tick < 0){\r\n\t\t\ttick = 0;\r\n\t\t}\r\n\t\tlet dayTick = 24*3600*1000;\r\n\t\tlet dayNum = parseInt(tick /dayTick);\r\n\t\tlet hourNum = parseInt((tick - tick /dayTick - dayNum*dayTick)/ (3600*1000));\r\n\r\n        let Second = parseInt(tick / 1000);\r\n\t\tlet intervalMinSec = (tick - hourNum * (3600*1000));\r\n\t\tlet min = parseInt(intervalMinSec / (60 * 1000))\r\n\t\tlet intervalSec = (intervalMinSec - min * (60*1000))\r\n\t\tlet sec = parseInt(intervalSec / 1000)\r\n\r\n\t\thourNum = this.ComTool.StringAddNumSuffix(\"\", hourNum, 2);\r\n\t\tmin = this.ComTool.StringAddNumSuffix(\"\", min, 2);\r\n\t\tsec = this.ComTool.StringAddNumSuffix(\"\", sec, 2);\r\n\r\n\t\tlet showStr = \"\";\r\n\t\tif (showType == this.ShareDefine.ShowDayHour){\r\n\t\t\tif(dayNum){\r\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}天{2}小时\", [dayNum, hourNum]);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (showType == this.ShareDefine.ShowHourMinSec){\r\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\r\n\t\t}\r\n\t\telse if(showType == this.ShareDefine.ShowMinSec){\r\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}\", [min, sec]);\r\n\t\t}\r\n\t\telse if(showType == this.ShareDefine.ShowSec){\r\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}\", [sec]);\r\n\t\t}\r\n\t\telse if(showType == this.ShareDefine.ShowSecondSec){\r\n            showStr = this.ComTool.StringReplace(\"{1}\", [Second]);\r\n\t\t}\r\n\t\t// else if(showType == this.ShareDefine.YearMonthDayHourMinuteSecond){\r\n         //    showStr = this.ComTool.StringReplace(\"{1}/{2}/{3} {4}:{5}:{6}\", [Year, Month, Day, Hour, Minute,Second]);\r\n\t\t// }\r\n\t\telse{\r\n\t\t\tshowStr = this.ComTool.StringReplace(\"{1}:{2}:{3}\", [hourNum, min, sec]);\r\n\t\t}\r\n\t\treturn showStr\r\n\t},\r\n\r\n\t/**\r\n\t * 获取已过时间的字符串\r\n\t * @param {Number} passSec 已过去秒数\r\n\t * @returns {String} 优先顺序：几天前、几小时前、几分钟前、几秒前\r\n\t * @remarks {}\r\n\t */\r\n\tGetPassTimeStr:function(passTick){\r\n\r\n\t\tif(isNaN(passTick)){\r\n\t\t\tErrLog(\"GetPassTimeStr passSec(%s) is NaN \", passSec);\r\n\t\t\treturn \"0\";\r\n\t\t}\r\n\t\tif(passTick <= 0){\r\n\t\t\treturn this.ComTool.StringReplace(this.BeforeSec_Str, [1]);\r\n\t\t}\r\n\r\n\t\t// 几天前 24*60*60*1000 = 86400000\r\n\t\tlet value = Math.floor(passTick/86400000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"BeforeDay_Str\", {\"Value\":value});\r\n\t\t}\r\n\t\t// 几小时前 60*60*1000 = 3600000\r\n\t\tvalue = Math.floor(passTick/3600000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"BeforeHour_Str\", {\"Value\":value});\r\n\t\t}\r\n\r\n\t\t// 几分钟前 60*1000\r\n\t\tvalue = Math.floor(passTick/60000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"BeforeMinute_Str\", {\"Value\":value});\r\n\t\t}\r\n\r\n\t\t// 几秒前\r\n\t\treturn app.i18n.t(\"BeforeSec_Str\", {\"Value\":Math.floor(passTick/1000)});\r\n\t},\r\n\r\n\t//获取结束tick相对服务器时间的倒计时\r\n\tGetCDTimeString:function(endTick, showType){\r\n\t\tlet serverTimeTick = this.GetServerTimeData();\r\n\t\tlet remainTick = endTick - serverTimeTick;\r\n\t\tif(remainTick <= 0){\r\n\t\t\treturn \"00:00:00\";\r\n\t\t}\r\n\r\n\t\t//默认没传的话返回00:00:00格式\r\n\t\tif(!showType){\r\n\t\t\tshowType = this.ShareDefine.ShowHourMinSec;\r\n\t\t}\r\n\r\n\t\treturn this.TickToStr(remainTick, showType);\r\n\t},\r\n\r\n\t//获取结束sec相对的服务器倒计时\r\n\tGetCDTimeStringBySec:function(endSec, showType){\r\n\t\treturn this.GetCDTimeString(endSec*1000, showType);\r\n\t},\r\n\r\n\t/**\r\n\t * 获取毫秒数相对当前服务器时间剩余多少时间到期\r\n\t * @param {Number} timeTick 毫秒数\r\n\t * @returns {String} 优先顺序：剩余几天、剩余几时、剩余几分、剩余几秒,已过期\r\n\t * @remarks {}\r\n\t */\r\n\tGetRemainTimeStr:function(timeTick){\r\n\t\tlet serverTimeTick = this.GetServerTimeData();\r\n\t\tlet remainTick = timeTick - serverTimeTick;\r\n\r\n\t\tif(remainTick <= 0){\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\t// 几天前 24*60*60*1000 = 86400000\r\n\t\tlet value = Math.floor(remainTick/86400000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"RemainDay\", {\"Value\":value});\r\n\t\t}\r\n\t\t// 几小时前 60*60*1000 = 3600000\r\n\t\tvalue = Math.floor(remainTick/3600000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"RemainHour\", {\"Value\":value});\r\n\t\t}\r\n\r\n\t\t// 几分钟前 60*1000\r\n\t\tvalue = Math.floor(remainTick/60000);\r\n\t\tif(value){\r\n\t\t\treturn app.i18n.t(\"RemainMin\", {\"Value\":value});\r\n\t\t}\r\n\r\n\t\t// 几秒前\r\n\t\treturn app.i18n.t(\"RemainSec\", {\"Value\":Math.floor(remainTick/1000)});\r\n\t},\r\n\r\n})\r\n\r\nvar g_ServerTimeManager = null;\r\n\r\n/**\r\n * 获取单例\r\n * @returns {ServerTimeManager}\r\n */\r\nexports.GetModel = function(){\r\n\tif (!g_ServerTimeManager)\r\n\t\tg_ServerTimeManager = new ServerTimeManager()\r\n\r\n\treturn g_ServerTimeManager\r\n\t\r\n}\r\n"]}