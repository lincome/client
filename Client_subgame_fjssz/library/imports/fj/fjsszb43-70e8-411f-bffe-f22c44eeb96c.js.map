{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\fjssz_AudioManager.js"],"names":["app","require","fjssz_AudioManager","BaseClass","extend","Init","JS_Name","audioFileName","recordFileName","recordPos","isRecording","isVoiceTouchEnd","audioList","subGameName","RegEvent","OnEvent_PlayAudioFinish","OnEvent_AudioError","OnEvent_AudioStopError","OnEvent_MedioRecordError","OnEvent_wellPrepared","RegNetPack","toUpperCase","OnPack_SPlayer_Voice","OnEvt_AmrFileDownLoadFinish","OnEvt_RecordAudioFinsh","OnDestory","setHeadInfo","stopRecord","stopPlayAudio","setSound","flag","value","LocalDataManager","GetConfigProperty","RecoverySceneMusic","PauseAllSound","pos","OnEvent","checkAudioList","length","audioInfo","shift","playAudioOrDownLoad","setTouchEnd","startRecord","IsAudio","ShowSysMsg","that","setTimeout","pausePlayAudio","getFileName","argList","CallToNative","CloseForm","sendRecordFile","cc","sys","isNative","data","jsb","fileUtils","getDataFromFile","url","httpRequest","ActiveXObject","e","XMLHttpRequest","open","setRequestHeader","onerror","ErrLog","onreadystatechange","SysLog","status","responseText","receivePack","JSON","parse","sendAudioURLToServer","readyState","send","downLoadRecordFile","serverURL","LocalURL","downLoadMgr","DownFile","urls","RoomMgr","room","GetEnterRoom","roomID","GetRoomProperty","SendPack","serverPack","GetEnterRoomID","console","log","push","GetRoomPosMgr","GetClientPos","resumePlayAudio","playAudio","filename","event","ShowForm","timestamp","Date","valueOf","storagePath","getWritablePath","AccountID","GetAccountProperty","fileName","Math","random","g_fjssz_AudioManager","exports","GetModel"],"mappings":"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","file":"fjssz_AudioManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n录音管理器\r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\nvar fjssz_AudioManager = app.BaseClass.extend({\r\n\r\n\tInit: function () {\r\n\t\tthis.JS_Name = app[\"subGameName\"] + \"_AudioManager\";\r\n\r\n\t\tthis.audioFileName = \"\"; //播放录音文件位置\r\n\t\tthis.recordFileName = \"\";//录音文件\r\n\r\n\t\tthis.recordPos = null; //录音位置\r\n\r\n\t\tthis.isRecording = false; //是否正在录音\r\n\r\n\t\tthis.isVoiceTouchEnd = false;\r\n\r\n\t\tthis.audioList = [];\r\n\r\n\t\t//播放录音完成\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"palyAudioFinsh\", this.OnEvent_PlayAudioFinish, this);\r\n\t\t//录音失败\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"AudioError\", this.OnEvent_AudioError, this);\r\n\t\t//录音停止失败\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"AudioStopError\", this.OnEvent_AudioStopError, this);\r\n\t\t//播放失败\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"MedioRecordError\", this.OnEvent_MedioRecordError, this);\r\n\t\t//准备录音\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"wellPrepared\", this.OnEvent_wellPrepared, this);\r\n\t\t//收到其他玩家播放语音\r\n\t\tapp[app.subGameName + \"_NetManager\"]().RegNetPack(\"S\" + app.subGameName.toUpperCase() + \"_Voice\", this.OnPack_SPlayer_Voice, this);\r\n\t\t//下载完成\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"AMRFILEDOWNLOADFINISH\", this.OnEvt_AmrFileDownLoadFinish, this);\r\n\t\t//录音完成\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"RECORDAUDIOFINSH\", this.OnEvt_RecordAudioFinsh, this);\r\n\t},\r\n\r\n\t//销毁\r\n\tOnDestory: function () {\r\n\t\tthis.setHeadInfo(false);\r\n\t\tthis.audioFileName = \"\";\r\n\t\tthis.recordFileName = \"\";\r\n\r\n\t\tthis.recordPos = null;\r\n\t\tthis.isRecording = false;\r\n\r\n\t\tthis.audioList = [];\r\n\t\tthis.stopRecord();\r\n\t\tthis.stopPlayAudio();\r\n\t},\r\n\r\n\t//开关背景音乐\r\n\tsetSound: function (flag) {\r\n\t\tlet value = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"BackMusic\");\r\n\t\tif (value) {\r\n\t\t\tif (flag) {\r\n\t\t\t\tapp[app.subGameName + \"_SceneManager\"]().RecoverySceneMusic();\r\n\t\t\t} else {\r\n\t\t\t\tapp[app.subGameName + \"_SoundManager\"]().PauseAllSound();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t//设置是否显示语音\r\n\tsetHeadInfo: function (flag, pos) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf', {'bShow': flag, 'pos': pos});\r\n\t\tif (flag) {\r\n\t\t\t// let that = this;\r\n\t\t\t// // cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 100.0);\r\n\t\t\t// setTimeout(function(){\r\n\t\t\t//     app[app.subGameName + \"Client\"].OnEvent('Head_AudioNtf',{'bShow':false,'pos':pos});\r\n\t\t\t// },100.0);\r\n\t\t}\r\n\t},\r\n\r\n\t//判断是否还有语音播放\r\n\tcheckAudioList: function () {\r\n\t\tthis.setHeadInfo(false);\r\n\r\n\t\tif (this.audioList.length > 0) {\r\n\t\t\tlet audioInfo = this.audioList.shift();\r\n\t\t\tthis.playAudioOrDownLoad(audioInfo);\r\n\t\t} else {\r\n\t\t\tthis.setSound(true);\r\n\r\n\t\t\t// this.setHeadInfo(false);\r\n\t\t}\r\n\t},\r\n\r\n\t//设置是否是touchEnd\r\n\tsetTouchEnd: function (flag) {\r\n\t\tthis.isVoiceTouchEnd = flag;\r\n\t},\r\n\r\n\t//开始录音\r\n\tstartRecord: function () {\r\n\t\tlet IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n\t\tif (!IsAudio) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.isRecording) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_LAST_RECORDING');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.isRecording = true;\r\n\r\n\t\tvar that = this;\r\n\t\t// cc.director.getScene().getChildByName(\"Canvas\").scheduleOnce(OnTimer, 20.0);\r\n\r\n\t\tsetTimeout(function () {\r\n\t\t\tthat.isRecording = false;\r\n\t\t}, 20.0);\r\n\r\n\t\tthis.isVoiceTouchEnd = false;\r\n\r\n\t\tthis.setSound(false);\r\n\t\tthis.pausePlayAudio();\r\n\r\n\t\tthis.audioFileName = this.getFileName();\r\n\r\n\t\tlet argList = [{\"Name\": \"fileName\", \"Value\": this.audioFileName}];\r\n\t\tlet value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"startRecord\", argList);\r\n\t},\r\n\r\n\t//停止录音\r\n\tstopRecord: function () {\r\n\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\t\tlet value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"stopRecord\", []);\r\n\t},\r\n\r\n\t//发送文件到服务器\r\n\tsendRecordFile: function () {\r\n\r\n\t\tif (this.audioFileName == null || this.audioFileName == \"\") return;\r\n\r\n\t\tif (!cc.sys.isNative) return;\r\n\r\n\t\tvar data = jsb.fileUtils.getDataFromFile(this.audioFileName);\r\n\r\n\t\tvar url = \"http://voice.qp355.com:8080\";\r\n\t\t//每次都实例化一个，否则会引起请求结束，实例被释放了\r\n\t\tvar httpRequest = null;\r\n\t\ttry {\r\n\t\t\thttpRequest = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n\t\t} catch (e) {\r\n\t\t\ttry {\r\n\t\t\t\thttpRequest = new XMLHttpRequest();\r\n\t\t\t} catch (e) {\r\n\r\n\t\t\t}\r\n\t\t}\r\n\t\thttpRequest.open(\"POST\", url, true);\r\n\t\thttpRequest.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\r\n\t\thttpRequest.setRequestHeader('Content-Type', 'application/octet-stream');\r\n\t\thttpRequest.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\t\thttpRequest.setRequestHeader(\"Content-Type\", \"multipart/form-data;\");\r\n\r\n\r\n\t\tvar that = this;\r\n\t\thttpRequest.onerror = function () {\r\n\t\t\tthat.ErrLog(\"sendRecordFile httpRequest.error:%s\", url);\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n\t\t};\r\n\r\n\t\thttpRequest.onreadystatechange = function () {\r\n\t\t\tthat.SysLog(\"onreadystatechange httpRequest.status:%s, httpRequest.responseText:%s\", httpRequest.status, httpRequest.responseText);\r\n\t\t\t//执行成功\r\n\t\t\tif (httpRequest.status == 200) {\r\n\r\n\t\t\t\tvar receivePack = JSON.parse(httpRequest.responseText);\r\n\t\t\t\tthat.SysLog(\"sendRecordFile receivePack[status]:%s,receivePack[url]:%s\", receivePack[\"status\"], receivePack[\"url\"]);\r\n\t\t\t\tif (receivePack[\"status\"] == 1) {\r\n\t\t\t\t\tthat.sendAudioURLToServer(receivePack[\"url\"]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthat.SysLog(\"sendRecordFile receivePack[status]=2 msg:%s\", receivePack[\"msg\"]);\r\n\t\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_SEND_FAIL');\r\n\t\t\t\tthat.ErrLog(\"onreadystatechange(%s,%s)\", httpRequest.readyState, httpRequest.status);\r\n\t\t\t}\r\n\t\t};\r\n\t\thttpRequest.send(data);\r\n\t},\r\n\r\n\t//下载文件\r\n\tdownLoadRecordFile: function (serverURL, LocalURL) {\r\n\t\tlet downLoadMgr = app[app.subGameName + \"_DownLoadMgr\"]();\r\n\t\tdownLoadMgr.DownFile(serverURL, LocalURL, \"deleteString\", \"AMRFILEDOWNLOADFINISH\");\r\n\t},\r\n\r\n\t//---------------发包接口------------------------\r\n\t//将URL上传到服务器\r\n\tsendAudioURLToServer: function (urls) {\r\n\t\tlet RoomMgr = app[app.subGameName.toUpperCase() + \"RoomMgr\"]();\r\n\t\tlet room = RoomMgr.GetEnterRoom();\r\n\t\tlet roomID = room.GetRoomProperty(\"roomID\");\r\n\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Voice\", {\r\n\t\t\t\"roomID\": roomID,\r\n\t\t\t\"url\": urls\r\n\t\t});\r\n\r\n\t\tthis.isRecording = false;\r\n\r\n\t},\r\n\r\n\t//----------------封包借口\r\n\t//收到回话\r\n\tOnPack_SPlayer_Voice: function (serverPack) {\r\n\t\tlet IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n\t\tif (!IsAudio) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet urls = serverPack[\"url\"];\r\n\r\n\t\tlet RoomMgr = app[app.subGameName.toUpperCase() + \"RoomMgr\"]();\r\n\t\tlet room = RoomMgr.GetEnterRoom();\r\n\r\n\t\t//不是自己房间\r\n\t\tif (RoomMgr.GetEnterRoomID() != serverPack[\"roomID\"]) {\r\n\t\t\tconsole.log(\"当前语音不是这个房间的id ---- \" + RoomMgr.GetEnterRoomID() + \" === \" + serverPack[\"roomID\"]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.audioList.push({\"pos\": serverPack[\"pos\"], \"url\": serverPack[\"url\"], \"fileName\": this.audioFileName});\r\n\t\tif (this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() != serverPack[\"pos\"]) { //正在录音\r\n\t\t\tconsole.log(\"语音播放有误 ---- \" + this.audioFileName);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//录音完成\r\n\t\telse if (this.audioFileName != \"\" && room.GetRoomPosMgr().GetClientPos() == serverPack[\"pos\"]) {\r\n\t\t\tif (this.recordFileName != \"\") {\r\n\t\t\t\tthis.resumePlayAudio();\r\n\t\t\t} else {\r\n\t\t\t\tthis.checkAudioList();\r\n\t\t\t}\r\n\r\n\t\t} else if (this.recordFileName != \"\") { //上一个播放没有完成\r\n\t\t\t//this.resumePlayAudio();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//没有录音\r\n\t\telse {\r\n\t\t\tthis.checkAudioList();\r\n\t\t}\r\n\t\tthis.audioFileName = \"\";\r\n\t},\r\n\r\n\t///-------------------------\r\n\r\n\t//下载或播放语音\r\n\tplayAudioOrDownLoad: function (audioInfo) {\r\n\t\tlet IsAudio = app.LocalDataManager().GetConfigProperty(\"SysSetting\", \"IsAudio\");\r\n\t\tif (!IsAudio) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_DONOT_AUDIO');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//自己直接播放\r\n\t\tlet RoomMgr = app[app.subGameName.toUpperCase() + \"RoomMgr\"]();\r\n\t\tlet room = RoomMgr.GetEnterRoom();\r\n\r\n\t\tif (room.GetRoomPosMgr().GetClientPos() == audioInfo[\"pos\"]) {\r\n\t\t\tif (this.recordFileName == \"\") {\r\n\t\t\t\tthis.recordFileName = audioInfo[\"fileName\"];\r\n\t\t\t\tthis.recordPos = audioInfo[\"pos\"];\r\n\t\t\t\tthis.playAudio(this.recordFileName, audioInfo[\"pos\"]);\r\n\t\t\t} else {\r\n\t\t\t\tthis.resumePlayAudio();\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.recordFileName = this.getFileName();\r\n\t\t\tthis.recordPos = audioInfo[\"pos\"];\r\n\t\t\tthis.downLoadRecordFile(audioInfo[\"url\"], this.recordFileName);\r\n\t\t}\r\n\t},\r\n\r\n\t//播放语音\r\n\tplayAudio: function (filename, pos) {\r\n\t\tif (filename == \"\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.setHeadInfo(false);\r\n\r\n\t\tthis.setSound(false);\r\n\r\n\t\tlet argList = [{\"Name\": \"fileName\", \"Value\": filename}];\r\n\t\tlet value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"playerRecord\", argList);\r\n\r\n\t\tthis.setHeadInfo(true, pos);\r\n\t},\r\n\r\n\t//停止语音\r\n\tstopPlayAudio: function () {\r\n\t\tthis.setHeadInfo(false);\r\n\t\tlet value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"stopPlayerRecord\", []);\r\n\t},\r\n\r\n\t//暂停播放\r\n\tpausePlayAudio: function () {\r\n\t\tif (this.recordFileName == \"\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tapp[app.subGameName + \"_NativeManager\"]().CallToNative(\"pausePlayerRecord\", []);\r\n\t},\r\n\r\n\t//继续播放\r\n\tresumePlayAudio: function () {\r\n\t\tapp[app.subGameName + \"_NativeManager\"]().CallToNative(\"resumePlayerRecord\", []);\r\n\t},\r\n\r\n\r\n\t///------------------------------事件-----------------------\r\n\t//语音播放完成\r\n\tOnEvent_PlayAudioFinish: function (event) {\r\n\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\r\n\t\tthis.recordFileName = \"\";\r\n\r\n\t\tthis.setHeadInfo(false);\r\n\r\n\t\tthis.recordPos = null;\r\n\r\n\t\tthis.checkAudioList();\r\n\t},\r\n\t//录制语音失败\r\n\tOnEvent_AudioError: function (event) {\r\n\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_ERROR');\r\n\r\n\t\tthis.stopRecord();\r\n\r\n\t\tthis.audioFileName = \"\";\r\n\t\tthis.isRecording = false;\r\n\r\n\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\t\tthis.checkAudioList();\r\n\t},\r\n\t//录制停止语音失败\r\n\tOnEvent_AudioStopError: function (event) {\r\n\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_AUDIO_STOP_ERROR');\r\n\r\n\t\tthis.audioFileName = \"\";\r\n\t\tthis.isRecording = false;\r\n\r\n\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\t\tthis.checkAudioList();\r\n\t},\r\n\t//播放语音失败\r\n\tOnEvent_MedioRecordError: function (event) {\r\n\t\tthis.setHeadInfo(false);\r\n\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_PLAY_RECORD_ERROR');\r\n\r\n\t\tthis.recordFileName = \"\";\r\n\t\tthis.recordPos = null;\r\n\t\tthis.checkAudioList();\r\n\t},\r\n\t//准备录制\r\n\tOnEvent_wellPrepared: function (event) {\r\n\t\tif (this.isVoiceTouchEnd) {\r\n\t\t\tthis.audioFileName = \"\";\r\n\t\t\tthis.isRecording = false;\r\n\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(app.subGameName + \"_UIAudio\");\r\n\t\t\tthis.checkAudioList();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.setSound(false);\r\n\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm(app.subGameName + \"_UIAudio\");\r\n\t},\r\n\r\n\t//文件下载完成\r\n\tOnEvt_AmrFileDownLoadFinish: function (event) {\r\n\t\tthis.playAudio(this.recordFileName, this.recordPos);\r\n\t},\r\n\r\n\t//录音完成\r\n\tOnEvt_RecordAudioFinsh: function (event) {\r\n\t\tthis.sendRecordFile();\r\n\t},\r\n\r\n\t//获取文件名\r\n\tgetFileName: function () {\r\n\t\tvar timestamp = (new Date()).valueOf();\r\n\t\tlet storagePath = '/';\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\tstoragePath = jsb ? (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'ALLGame/' + app.subGameName : '/';\r\n\t\t}\r\n\t\tlet AccountID = app[app.subGameName + \"_HeroAccountManager\"]().GetAccountProperty(\"AccountID\");\r\n\t\tlet fileName = storagePath + AccountID + timestamp + Math.random() % 16 + \".amr\";\r\n\t\treturn fileName;\r\n\t},\r\n});\r\n\r\n\r\nvar g_fjssz_AudioManager = null;\r\n/**\r\n ...\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_fjssz_AudioManager) {\r\n\t\tg_fjssz_AudioManager = new fjssz_AudioManager();\r\n\t}\r\n\treturn g_fjssz_AudioManager;\r\n}"]}