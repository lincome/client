{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\fjssz_SoundManager.js"],"names":["app","require","sss_SoundManager","BaseClass","extend","Init","JS_Name","subGameName","SysDataManager","LocalDataManager","Sound","GetTableDict","volume","loadSoundNameList","Log","PlayBackMusic","soundName","filePath","backVolume","GetConfigProperty","bluebird","resolve","soundInfo","console","error","InArray","WarnLog","push","that","isLoop","promisefunc","reject","cc","loader","loadRes","AudioClip","clip","Remove","StopAllSound","soundID","audioEngine","play","PlaySound","log","spSound","spVolume","PauseAllSound","pauseAll","PauseSound","audioID","pause","ResumeAllSound","resumeAll","ResumeSound","resume","stopAll","StopSoundByAudioID","stop","ClearSound","uncache","url","raw","ClearAllSound","uncacheAll","g_sss_SoundManager","exports","GetModel"],"mappings":"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","file":"fjssz_SoundManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n 声音管理器\r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\nvar sss_SoundManager = app.BaseClass.extend({\r\n\r\n\tInit: function () {\r\n\t\tthis.JS_Name = app.subGameName + \"_SoundManager\";\r\n\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.LocalDataManager = app.LocalDataManager();\r\n\t\tthis.Sound = this.SysDataManager.GetTableDict(\"Sound\");\r\n\t\t//音量\r\n\t\tthis.volume = 1;\r\n\r\n\t\tthis.loadSoundNameList = [];\r\n\t\tthis.Log(\"Init\");\r\n\t},\r\n\r\n\r\n\t//播放背景音乐\r\n\tPlayBackMusic: function (soundName, filePath = \"\") {\r\n\t\t// let backMusic = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackMusic\");\r\n\t\tlet backVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"BackVolume\");\r\n\t\t//如果关闭音效\r\n\t\tif (!backVolume) {\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\t\tif (filePath == \"\") {\r\n\t\t\tlet soundInfo = this.Sound[soundName];\r\n\t\t\tif (!soundInfo) {\r\n\t\t\t\tconsole.error(\"PlayBackMusic(%s) not find\", soundName);\r\n\t\t\t\treturn app.bluebird.resolve(0)\r\n\t\t\t}\r\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\r\n\t\t} else {\r\n\t\t\tfilePath = filePath;\r\n\t\t}\r\n\r\n\t\tif (this.loadSoundNameList.InArray(soundName)) {\r\n\t\t\tthis.WarnLog(\"PlayBackMusic loadSoundNameList(%s) have find\", soundName);\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\r\n\t\tthis.loadSoundNameList.push(soundName);\r\n\t\tvar that = this;\r\n\r\n\t\tlet isLoop = true;\r\n\t\tlet promisefunc = function (resolve, reject) {\r\n\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function (error, clip) {\r\n\r\n\t\t\t\tif (error && error != true) {\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthat.loadSoundNameList.Remove(soundName);\r\n\t\t\t\tthat.StopAllSound();\r\n\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, backVolume);\r\n\t\t\t\tresolve(soundID);\r\n\t\t\t})\r\n\t\t};\r\n\t\treturn new app.bluebird(promisefunc);\r\n\t},\r\n\r\n\t//播放音效(返回audioID)\r\n\tPlaySound: function (soundName, filePath = \"\", isLoop = false) {\r\n\t\tconsole.log(\"播放音效(返回audioID)\", soundName, filePath, isLoop);\r\n\t\tlet spSound = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpSound\");\r\n\t\tlet spVolume = this.LocalDataManager.GetConfigProperty(\"SysSetting\", \"SpVolume\");\r\n\t\t//如果关闭音效\r\n\t\tif (!spSound) {\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\t\tif (filePath == \"\") {\r\n\t\t\tlet soundInfo = this.Sound[soundName];\r\n\t\t\tif (!soundInfo) {\r\n\t\t\t\tconsole.error(\"PlaySound(%s) not find\", soundName);\r\n\t\t\t\treturn app.bluebird.resolve(0)\r\n\t\t\t}\r\n\t\t\tfilePath = soundInfo[\"SoundPath\"];\r\n\t\t} else {\r\n\t\t\tfilePath = filePath;\r\n\t\t}\r\n\t\tif (!isLoop) {\r\n\t\t\tisLoop = false;\r\n\t\t}\r\n\r\n\t\tif (this.loadSoundNameList.InArray(soundName)) {\r\n\t\t\tthis.WarnLog(\"loadSoundNameList(%s) have find\", soundName);\r\n\t\t\treturn app.bluebird.resolve(0)\r\n\t\t}\r\n\r\n\t\tthis.loadSoundNameList.push(soundName);\r\n\t\tvar that = this;\r\n\r\n\t\tlet promisefunc = function (resolve, reject) {\r\n\t\t\tcc.loader.loadRes(filePath, cc.AudioClip, function (error, clip) {\r\n\r\n\t\t\t\tif (error && error != true) {\r\n\t\t\t\t\treject(error);\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthat.loadSoundNameList.Remove(soundName);\r\n\t\t\t\tlet soundID = cc.audioEngine.play(clip, isLoop, spVolume)\r\n\t\t\t\tresolve(soundID);\r\n\t\t\t})\r\n\t\t};\r\n\t\treturn new app.bluebird(promisefunc);\r\n\t},\r\n\r\n\t//暂停所有音效\r\n\tPauseAllSound: function () {\r\n\t\tcc.audioEngine.pauseAll();\r\n\t},\r\n\t//暂停正在播放音频。\r\n\tPauseSound: function (audioID) {\r\n\t\tcc.audioEngine.pause(audioID);\r\n\t},\r\n\t//恢复所有暂停的音效\r\n\tResumeAllSound: function () {\r\n\t\tcc.audioEngine.resumeAll();\r\n\t},\r\n\t//恢复播放指定的音频。\r\n\tResumeSound: function (audioID) {\r\n\t\tcc.audioEngine.resume(audioID);\r\n\t},\r\n\t//停止所有正在播放的音效\r\n\tStopAllSound: function () {\r\n\t\tcc.audioEngine.stopAll();\r\n\t},\r\n\r\n\tStopSoundByAudioID: function (audioID) {\r\n\t\tcc.audioEngine.stop(audioID);\r\n\t},\r\n\r\n\t//清除音效加载的资源\r\n\tClearSound: function (soundName) {\r\n\r\n\t\tlet soundInfo = this.Sound[soundName];\r\n\t\tif (!soundInfo) {\r\n\t\t\tconsole.error(\"ClearSound(%s) not find\", soundName);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tcc.audioEngine.uncache(cc.url.raw(soundInfo[\"SoundPath\"]));\r\n\t},\r\n\r\n\tClearAllSound: function () {\r\n\t\tcc.audioEngine.uncacheAll();\r\n\t},\r\n\r\n\r\n});\r\n\r\n\r\nvar g_sss_SoundManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_sss_SoundManager) {\r\n\t\tg_sss_SoundManager = new sss_SoundManager();\r\n\t}\r\n\treturn g_sss_SoundManager;\r\n}"]}