{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\script\\common/assets\\script\\common\\fjssz_BaseEffect.js"],"names":["app","require","cc","Class","extends","Component","properties","onLoad","update","dt","OnCreate","effectName","effectRes","userData","componentName","zorderLv","JS_Name","animationNameList","animation","node","getComponent","Animation","clips","getClips","count","length","index","clip","push","name","defaultClip","defaultAnimationName","on","OnPlay","OnStop","OnFinished","OnCreateInit","InitEffectData","eventNode","Parent","dataInfo","AddModelToParent","parent","initPos","addChild","setPosition","event","argDict","emit","OnModelAnimationEvent","eventType","hurtPercent","Math","floor","subGameName","OnEvent","console","error","unuse","stop","CloseEffect","reuse","active","ShowEffect","particleNode","getChildByName","childrenList","children","particle","ParticleSystem","resetSystem","play","stopSystem","Destroy","removeChild","destroy","PlayAnimation","actioName","indexOf","SetModelDir","dir","scaleX","abs","SetModelProperty","property","value","zIndex","hasOwnProperty","GetModelProperty"],"mappings":"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","file":"fjssz_BaseEffect.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    特效基类\r\n*/\r\n\r\n\r\nvar app = require(\"fjssz_app\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       \r\n    },\r\n\r\n    // 加载\r\n    onLoad: function () {\r\n    },\r\n\r\n    //每帧回调\r\n    update: function (dt) {\r\n    },\r\n\r\n\r\n    OnCreate:function(effectName, effectRes, userData, componentName, zorderLv){\r\n        this.JS_Name = effectName;\r\n\r\n        this.animationNameList = [];\r\n        this.animation = this.node.getComponent(cc.Animation);\r\n\r\n        let clips = this.animation.getClips();\r\n        let count = clips.length;\r\n        for(let index=0; index<count; index++){\r\n            let clip = clips[index];\r\n            this.animationNameList.push(clip.name);\r\n        }\r\n\r\n        let defaultClip = this.animation.defaultClip;\r\n        this.defaultAnimationName = \"\";\r\n        if(defaultClip){\r\n            this.defaultAnimationName = defaultClip.name;\r\n        }\r\n\r\n        this.animation.on('play',      this.OnPlay,        this);\r\n        this.animation.on('stop',      this.OnStop,        this);\r\n        this.animation.on('finished',  this.OnFinished,    this);\r\n        //this.animation.on('lastframe', this.OnLastFrame,   this);\r\n        // this.animation.on('pause',     this.OnPause,       this);\r\n        // this.animation.on('resume',    this.OnResume,      this);\r\n\r\n        this.OnCreateInit();\r\n        this.InitEffectData(effectName, effectRes, userData, componentName, zorderLv);\r\n    },\r\n\r\n    InitEffectData:function(effectName, effectRes, userData, componentName, zorderLv){\r\n\r\n        //事件分发节点\r\n        this.eventNode = null;\r\n\r\n        //父类\r\n        this.Parent = null;\r\n        \r\n        this.dataInfo = {\r\n                            //模型名字\r\n                            \"EffectName\":effectName,\r\n                            //创建的模型资源名 ModelRes.txt\r\n                            \"EffectRes\":effectRes,\r\n                            //node的组件名(其实就是本类名)\r\n                            \"ComponentName\":componentName,\r\n                            //自定义数据\r\n                            \"UserData\":userData,\r\n                            //模型層\r\n                            \"CreateZOrderLv\":zorderLv,\r\n                            //界面特效控件路径\r\n                            \"WndPath\":\"\",\r\n                        };\r\n    },\r\n\r\n\r\n    //增加模型到父类\r\n    AddModelToParent:function(parent, eventNode, initPos=null){\r\n\r\n        this.eventNode = eventNode;\r\n        this.Parent = parent;\r\n        \r\n        //追加到父类 执行addChild,会回调执行OnLoad\r\n        this.Parent.addChild(this.node, this.dataInfo[\"CreateZOrderLv\"]);\r\n\r\n        //默认都是居中显示特效\r\n        if(initPos){\r\n            this.node.setPosition(initPos);\r\n        }\r\n\r\n    },\r\n\r\n    //---------回调函数---------------------\r\n\r\n    //动作开始播放 OnPlay->OnFinished -> OnStop;\r\n    OnPlay:function(event){\r\n        // let actionName = event.getCurrentTarget().name;\r\n        // this.Log(\"OnPlay:%s\", actionName);\r\n    },\r\n\r\n    //播放结束(循环中不会回掉)\r\n    OnFinished:function(event){\r\n        let argDict = {\r\n            \"Model\":this,\r\n            \"AnimationName\":event,\r\n        };\r\n        this.eventNode.emit(\"EffectAnimationEnd\", argDict);\r\n    },\r\n\r\n    //动作被停止(循环中不会回掉)\r\n    OnStop:function(event){\r\n        // let actionName = event.getCurrentTarget().name;\r\n        // this.Log(\"OnStop:%s\", actionName);\r\n    },\r\n\r\n    //关键帧回掉\r\n\tOnModelAnimationEvent:function(eventType,hurtPercent){\r\n\t\tlet argDict = {};\r\n\t\thurtPercent = Math.floor(hurtPercent);\r\n\t\tif(!hurtPercent){\r\n\t\t\thurtPercent = 100;\r\n\t\t}\r\n\t\tswitch(eventType){\r\n\t\t\tcase \"zd\":\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ShakeScene\");\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"h\":\r\n\t\t\t\targDict[\"GeneralKey\"] = this.dataInfo[\"UserData\"];\r\n\t\t\t\targDict[\"HurtPercent\"] = hurtPercent;\r\n\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"SkillHurt\", argDict);\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"zdh\":\r\n\t\t\t\targDict[\"GeneralKey\"] = this.dataInfo[\"UserData\"];\r\n\t\t\t\targDict[\"HurtPercent\"] = hurtPercent;\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ShakeScene\");\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"SkillHurt\", argDict);\r\n\t\t\t\tbreak\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(\"OnEffectAnimationEvent eventType error\", eventType);\r\n\t\t\t\tbreak\r\n\t\t}\r\n    },\r\n\r\n    //被对象池回收\r\n    unuse: function () {\r\n        this.animation.stop();\r\n        //关闭HP Shadow的显示\r\n        this.CloseEffect();\r\n    },\r\n\r\n    //对象池释放复用\r\n    reuse: function () {\r\n        this.node.active = true;\r\n\r\n    },\r\n\r\n    //--------------操作函数-------------------\r\n\r\n    //显示模型\r\n    ShowEffect:function(){\r\n\r\n        if(!this.defaultAnimationName){\r\n            console.error(\"ShowEffect not defaultAnimationName\");\r\n            return\r\n        }\r\n        this.node.active = true;\r\n\r\n\t    //获取粒子特效节点\r\n\t    let particleNode = this.node.getChildByName(\"Particle\");\r\n\t    if(particleNode){\r\n\t\t    let childrenList = particleNode.children;\r\n\t\t    let count = childrenList.length;\r\n\t\t    //遍历所有子节点\r\n\t\t    for (var index = 0; index < count; ++index) {\r\n\t\t\t    let children = childrenList[index];\r\n\t\t\t    let particle = children.getComponent(cc.ParticleSystem);\r\n\t\t\t    //如果存在粒子这重新播放\r\n\t\t\t    if(particle){\r\n\t\t\t\t    particle.resetSystem();\r\n\t\t\t    }\r\n\t\t    }\r\n\t    }\r\n\r\n\t    return this.animation.play(this.defaultAnimationName)\r\n    },\r\n\r\n\r\n    //关闭模型\r\n    CloseEffect:function(){\r\n        this.node.active = false;\r\n\r\n\r\n\t    //获取粒子特效节点\r\n\t    let particleNode = this.node.getChildByName(\"Particle\");\r\n\t    if(particleNode){\r\n\t\t    let childrenList = particleNode.children;\r\n\t\t    let count = childrenList.length;\r\n\t\t    //遍历所有子节点\r\n\t\t    for (var index = 0; index < count; ++index) {\r\n\t\t\t    let children = childrenList[index];\r\n\t\t\t    let particle = children.getComponent(cc.ParticleSystem);\r\n\t\t\t    //如果存在粒子这重新播放\r\n\t\t\t    if(particle){\r\n\t\t\t\t    //闲重置会删除所有例子\r\n\t\t\t\t    particle.resetSystem();\r\n\t\t\t\t    //在停止发送粒子\r\n\t\t\t\t    particle.stopSystem();\r\n\t\t\t    }\r\n\t\t    }\r\n\t    }\r\n    },\r\n\r\n    //销毁界面\r\n    Destroy:function(){\r\n\r\n        this.Parent.removeChild(this.node);\r\n        //销毁节点\r\n        this.node.destroy();\r\n\r\n    },\r\n\r\n    //播放动画动作\r\n    PlayAnimation:function(actioName){\r\n        if(this.animationNameList.indexOf(actioName) < 0){\r\n            // this.Log(\"PlayAnimation(%s) not in :\", actioName, this.animationNameList);\r\n            return\r\n        }\r\n\r\n        //停止当前动作\r\n        this.animation.stop();\r\n        //isPlaying isPaused \r\n        return this.animation.play(actioName);\r\n\r\n\r\n        //指动画播放多少次后结束\r\n        //animationState.repeatCount = 2;\r\n\r\n        // WrapMode\r\n        // Default Number\r\n        // 向 Animation Component 或者 AnimationClip 查找 wrapMode\r\n\r\n        // Normal Number\r\n        // 动画只播放一遍\r\n\r\n        // Reverse Number\r\n        // 从最后一帧或结束位置开始反向播放，到第一帧或开始位置停止\r\n\r\n        // Loop Number\r\n        // 循环播放\r\n\r\n        // LoopReverse Number\r\n        // 反向循环播放\r\n\r\n        // PingPong Number\r\n        // 从第一帧播放到最后一帧，然后反向播放回第一帧，到第一帧后再正向播放，如此循环\r\n\r\n        // PingPongReverse Number\r\n        // 从最后一帧开始反向播放，其他同 PingPong\r\n        //animationState.wrapMode  = 2;\r\n    },\r\n\r\n    //设置模型面向\r\n    SetModelDir:function(dir){\r\n\r\n        let scaleX = Math.abs(this.node.scaleX);\r\n\r\n        if(dir == \"left\"){\r\n            this.node.scaleX = -1*scaleX;\r\n        }\r\n        else{\r\n            this.node.scaleX = scaleX;\r\n        }\r\n    },\r\n\r\n    SetModelProperty:function(property, value){\r\n\r\n        if(\"ZOrderLv\" == property){\r\n            this.node.zIndex = value;\r\n        }\r\n        else if(this.dataInfo.hasOwnProperty(property)){\r\n            this.dataInfo[property] = value;\r\n        }\r\n        else{\r\n            console.error(\"SetModelProperty(%s) not find(%s)\", this.dataInfo, property);\r\n            return\r\n            \r\n        }\r\n    },\r\n\r\n    //--------------获取接口-----------------\r\n\r\n    //获取模型属性\r\n    GetModelProperty:function(property){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            console.error(\"GetModelProperty(%s) not find(%s)\", this.dataInfo, property);\r\n            return\r\n        }\r\n        return this.dataInfo[property];\r\n    },\r\n\r\n\r\n    //-----子类重载----------------\r\n\r\n    OnCreateInit:function(){\r\n\r\n    },\r\n\r\n\r\n});\r\n"]}