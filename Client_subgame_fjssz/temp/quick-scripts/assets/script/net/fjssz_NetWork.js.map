{"version":3,"sources":["fjssz_NetWork.js"],"names":["emitter","require","app","Request","BaseClass","extend","Init","id","event","param","callback","errcb","MessageType","None","Response","Notify","copyArray","dest","doffset","src","soffset","length","copy","index","EgretReadByteArray","buffer","dataview","DataView","offset","readByte","ret","getUint8","readShort","getInt16","readInt","getInt32","readUTF","tempBuffer","slice","strdecode","bytes","Uint8Array","array","charCode","end","hasEot","cc","error","push","e","String","fromCharCode","apply","EgretWriteByteArray","ArrayBuffer","getBuffer","retBuffer","writeByte","value","setUint8","writeShort","setInt16","writeInt","setInt32","writeUTF","str","strBuffer","strencode","byteArray","i","charCodeAt","codes","j","_buffer","sss_NetWork","JS_Name","subGameName","AllowReConnectCount","socket","isConnectIng","cacheRequestList","host","port","url","join","reConnectTimeID","bDisconnectByLogout","handshakeCallback","eventCallback","BigPack","Array","OnReload","IsDevelopment","requests","requestid","losts","isReconnecting","connectAccountID","clearTimeout","tryReConnectCount","InitConnectInfo","accountID","InitWebSocket","readyState","Connected","Connect","console","log","close","disconnect","isInGame","curRunGame","WebSocket","binaryType","onopen","OnOpen","bind","onmessage","OnMessage","onerror","OnError","onclose","OnClose","that","setTimeout","ReConnect","Disconnect","OnEvent","GetNewRequest","req","pop","ReConnectByTipSureBtn","byLogout","byte","messageType","srcType","srcId","descType","descId","eventName","sequence","errorCode","strBody","body","allPack","nowPack","data","toLocaleLowerCase","BigstrBody","JSON","parse","Log","stack","NetLog","errorFunc","UpdateAccessPoint","clientConfig","GetClientConfig","gameServerIP","gameServerPort","target","URL","ErrLog","type","RequestReConnect","sendPack","ReConnectSuccess","ReConnectFail","head","write","SendLostPack","lostCount","AddLostPack","errorCallback","message","strMsg","stringify","send","g_sss_NetWork","exports","GetModel"],"mappings":";;;;;;AAAA,IAAIA,UAAUC,QAAQ,eAAR,CAAd;;AAEA,IAAIC,MAAMD,QAAQ,WAAR,CAAV;;AAGA,IAAIE,UAAUD,IAAIE,SAAJ,CAAcC,MAAd,CAAqB;AAC/BC,OAAK,gBAAU;AACX,OAAKC,EAAL,GAAU,IAAV;AACA,OAAKC,KAAL,GAAa,IAAb;AACA,OAAKC,KAAL,GAAa,IAAb;AACA,OAAKC,QAAL,GAAgB,IAAhB,CAJW,CAIW;AACtB,OAAKC,KAAL,GAAa,IAAb,CALW,CAKQ;AACtB;AAP8B,CAArB,CAAd;;AAUA,IAAIC,cAAc;AAChBC,OAAO,CADS,EACN;AACV;;;AAGAC,WAAW,CALK;AAMhB;;;AAGAX,UAAU,CATM;AAUhB;;;AAGAY,SAAS;AAbO,CAAlB;;AAgBA,IAAIC,YAAY,SAAZA,SAAY,CAASC,IAAT,EAAeC,OAAf,EAAwBC,GAAxB,EAA6BC,OAA7B,EAAsCC,MAAtC,EAA8C;AAC1D,KAAG,eAAe,OAAOF,IAAIG,IAA7B,EAAmC;AACjC;AACAH,MAAIG,IAAJ,CAASL,IAAT,EAAeC,OAAf,EAAwBE,OAAxB,EAAiCA,UAAUC,MAA3C;AACD,EAHD,MAGO;AACL;AACA,OAAI,IAAIE,QAAM,CAAd,EAAiBA,QAAMF,MAAvB,EAA+BE,OAA/B,EAAuC;AACrCN,QAAKC,SAAL,IAAkBC,IAAIC,SAAJ,CAAlB;AACD;AACF;AACJ,CAVD;;AAYA,IAAII,qBAAqBtB,IAAIE,SAAJ,CAAcC,MAAd,CAAqB;AAC1CC,OAAK,cAASmB,MAAT,EAAgB;AACjB,OAAKA,MAAL,GAAcA,MAAd;AACA,OAAKC,QAAL,GAAgB,IAAIC,QAAJ,CAAa,KAAKF,MAAlB,CAAhB;AACA,OAAKG,MAAL,GAAc,CAAd;AACH,EALyC;;AAO1CC,WAAS,oBAAU;AACf,MAAIC,MAAM,KAAKJ,QAAL,CAAcK,QAAd,CAAuB,KAAKH,MAA5B,CAAV;AACA,OAAKA,MAAL,IAAe,CAAf;AACA,SAAOE,GAAP;AACH,EAXyC;;AAa1CE,YAAU,qBAAU;AAChB,MAAIF,MAAM,KAAKJ,QAAL,CAAcO,QAAd,CAAuB,KAAKL,MAA5B,CAAV;AACA,OAAKA,MAAL,IAAe,CAAf;AACA,SAAOE,GAAP;AACH,EAjByC;;AAmB1CI,UAAQ,mBAAU;AACd,MAAIJ,MAAM,KAAKJ,QAAL,CAAcS,QAAd,CAAuB,KAAKP,MAA5B,CAAV;AACA,OAAKA,MAAL,IAAe,CAAf;AACA,SAAOE,GAAP;AACH,EAvByC;;AAyB1CM,UAAQ,mBAAU;AACd,MAAIf,SAAS,KAAKK,QAAL,CAAcO,QAAd,CAAuB,KAAKL,MAA5B,CAAb;AACA,OAAKA,MAAL,IAAe,CAAf;AACA,MAAIS,aAAa,KAAKZ,MAAL,CAAYa,KAAZ,CAAkB,KAAKV,MAAvB,EAA+B,KAAKA,MAAL,GAAYP,MAA3C,CAAjB;AACD;AACC,OAAKO,MAAL,IAAeP,MAAf;AACA,MAAIS,MAAM,KAAKS,SAAL,CAAeF,UAAf,CAAV;AACA,SAAOP,GAAP;AACH,EAjCyC;;AAmC1C;AACA;AACA;AACA;;AAEA;;;;;AAKFS,YAAU,mBAASd,MAAT,EAAiB;AACzB,MAAIe,QAAQ,IAAIC,UAAJ,CAAehB,MAAf,CAAZ;AACA,MAAIiB,QAAQ,EAAZ;AACA,MAAId,SAAS,CAAb;AACA,MAAIe,WAAW,CAAf;AACA,MAAIC,MAAMJ,MAAMnB,MAAhB;AACA;AACA,MAAIwB,SAAS,KAAb;AACA,SAAMjB,SAASgB,GAAf,EAAmB;AACjB,OAAG;AACD,QAAGJ,MAAMZ,MAAN,IAAgB,GAAnB,EAAuB;AACrBe,gBAAWH,MAAMZ,MAAN,CAAX;AACAA,eAAU,CAAV;AACA,SAAIe,YAAY,CAAhB,EAAmB;AACjBG,SAAGC,KAAH,CAAS,oBAAT;AACAF,eAAS,IAAT;AACA;AACD;AACF,KARD,MAQM,IAAGL,MAAMZ,MAAN,IAAgB,GAAnB,EAAuB;AAC3Be,gBAAW,CAAC,CAACH,MAAMZ,MAAN,IAAgB,IAAjB,KAAwB,CAAzB,KAA+BY,MAAMZ,SAAO,CAAb,IAAkB,IAAjD,CAAX;AACAA,eAAU,CAAV;AACD,KAHK,MAGD;AACHe,gBAAW,CAAC,CAACH,MAAMZ,MAAN,IAAgB,IAAjB,KAAwB,EAAzB,KAAgC,CAACY,MAAMZ,SAAO,CAAb,IAAkB,IAAnB,KAA0B,CAA1D,KAAgEY,MAAMZ,SAAO,CAAb,IAAkB,IAAlF,CAAX;AACAA,eAAU,CAAV;AACD;AACDc,UAAMM,IAAN,CAAWL,QAAX;AACD,IAjBD,CAkBA,OAAMM,CAAN,EAAQ;AACNH,OAAGC,KAAH,CAASE,CAAT;AACD;AACF;AACD,MAAIJ,MAAJ,EACEH,MAAMM,IAAN,CAAW,GAAX;;AAEF,MAAIlB,MAAMoB,OAAOC,YAAP,CAAoBC,KAApB,CAA0B,IAA1B,EAAgCV,KAAhC,CAAV;AACA;AACA,SAAOZ,GAAP;AACD;AAlF2C,CAArB,CAAzB;;AAqFA,IAAIuB,sBAAsBnD,IAAIE,SAAJ,CAAcC,MAAd,CAAqB;AAC3CC,OAAK,cAASe,MAAT,EAAgB;AACjB,OAAKI,MAAL,GAAc,IAAI6B,WAAJ,CAAgBjC,MAAhB,CAAd;AACA,OAAKK,QAAL,GAAgB,IAAIC,QAAJ,CAAa,KAAKF,MAAlB,CAAhB;AACA,OAAKG,MAAL,GAAc,CAAd;AACH,EAL0C;;AAO3C2B,YAAU,qBAAU;AAChB;AACA,MAAIC,YAAY,KAAK/B,MAAL,CAAYa,KAAZ,CAAkB,CAAlB,EAAqB,KAAKV,MAA1B,CAAhB;AACA;AACA,SAAO,KAAKH,MAAZ;AACH,EAZ0C;;AAc3CgC,YAAU,mBAASC,KAAT,EAAe;AACrB,MAAI5B,MAAM,KAAKJ,QAAL,CAAciC,QAAd,CAAuB,KAAK/B,MAA5B,EAAoC8B,KAApC,CAAV;AACA,OAAK9B,MAAL,IAAe,CAAf;AACA;AACH,EAlB0C;;AAoB3CgC,aAAW,oBAASF,KAAT,EAAe;AACtB,MAAI5B,MAAM,KAAKJ,QAAL,CAAcmC,QAAd,CAAuB,KAAKjC,MAA5B,EAAoC8B,KAApC,CAAV;AACA,OAAK9B,MAAL,IAAe,CAAf;AACA;AACH,EAxB0C;;AA0B3CkC,WAAS,kBAASJ,KAAT,EAAe;AACpB,MAAI5B,MAAM,KAAKJ,QAAL,CAAcqC,QAAd,CAAuB,KAAKnC,MAA5B,EAAoC8B,KAApC,CAAV;AACA,OAAK9B,MAAL,IAAe,CAAf;AACA;AACH,EA9B0C;;AAgC3CoC,WAAS,kBAASC,GAAT,EAAa;AAClB;AACA,MAAIC,YAAY,KAAKC,SAAL,CAAeF,GAAf,CAAhB;AACA,OAAKL,UAAL,CAAgBM,UAAU7C,MAA1B;AACAL,YAAU,IAAIyB,UAAJ,CAAe,KAAKhB,MAApB,CAAV,EAAuC,KAAKG,MAA5C,EAAoDsC,SAApD,EAA+D,CAA/D,EAAkEA,UAAU7C,MAA5E;AACA,OAAKO,MAAL,IAAesC,UAAU7C,MAAzB;;AAEA;AACA;AACH,EAzC0C;;AA2C3C8C,YAAU,mBAASF,GAAT,EAAc;AACpB,MAAIG,YAAY,IAAI3B,UAAJ,CAAewB,IAAI5C,MAAJ,GAAa,CAA5B,CAAhB;AACA,MAAIO,SAAS,CAAb;AACA,OAAI,IAAIyC,IAAI,CAAZ,EAAeA,IAAIJ,IAAI5C,MAAvB,EAA+BgD,GAA/B,EAAmC;AACjC,OAAI1B,WAAWsB,IAAIK,UAAJ,CAAeD,CAAf,CAAf;AACA,OAAIE,QAAQ,IAAZ;AACA,OAAG5B,YAAY,IAAf,EAAoB;AAClB4B,YAAQ,CAAC5B,QAAD,CAAR;AACD,IAFD,MAEM,IAAGA,YAAY,KAAf,EAAqB;AACzB4B,YAAQ,CAAC,OAAM5B,YAAU,CAAjB,EAAqB,OAAMA,WAAW,IAAtC,CAAR;AACD,IAFK,MAED;AACH4B,YAAQ,CAAC,OAAM5B,YAAU,EAAjB,EAAsB,OAAM,CAACA,WAAW,KAAZ,KAAoB,CAAhD,EAAoD,OAAMA,WAAW,IAArE,CAAR;AACD;AACD,QAAI,IAAI6B,IAAI,CAAZ,EAAeA,IAAID,MAAMlD,MAAzB,EAAiCmD,GAAjC,EAAqC;AACnCJ,cAAUxC,MAAV,IAAoB2C,MAAMC,CAAN,CAApB;AACA,MAAE5C,MAAF;AACD;AACF;AACD,MAAI6C,UAAU,IAAIhC,UAAJ,CAAeb,MAAf,CAAd;AACAZ,YAAUyD,OAAV,EAAmB,CAAnB,EAAsBL,SAAtB,EAAiC,CAAjC,EAAoCxC,MAApC;AACA,SAAO6C,OAAP;AACH;AAhE0C,CAArB,CAA1B;;AAoEA,IAAIC,cAAcxE,IAAIE,SAAJ,CAAcC,MAAd,CAAqB;;AAEtCC,OAAK,gBAAU;AACX,OAAKqE,OAAL,GAAezE,IAAI0E,WAAJ,GAAkB,UAAjC;;AAEH;AACA,OAAKC,mBAAL,GAA2B,CAA3B;;AAEA;AACA,OAAK7E,OAAL,GAAe,IAAIA,OAAJ,EAAf;;AAEA;AACA,OAAK8E,MAAL,GAAc,IAAd;AACA,OAAKC,YAAL,GAAoB,KAApB,CAXc,CAWY;AAC1B;AACA,OAAKC,gBAAL,GAAwB,EAAxB;;AAEA;AACA,OAAKC,IAAL,GAAY,WAAZ;AACA,OAAKC,IAAL,GAAY,IAAZ;AACA,OAAKC,GAAL,GAAW,CAAC,OAAD,EAAU,KAAKF,IAAf,EAAqB,GAArB,EAA0B,KAAKC,IAA/B,EAAqCE,IAArC,CAA0C,EAA1C,CAAX;;AAEA;AACA,OAAKC,eAAL,GAAuB,CAAvB;;AAEA,OAAKC,mBAAL,GAA2B,KAA3B;AACA;AACA,OAAKC,iBAAL,GAAyB,IAAzB;;AAEA,OAAKC,aAAL,GAAqB,IAArB;;AAEA;AACA,OAAKC,OAAL,GAAa,IAAIC,KAAJ,EAAb;;AAEA,OAAKC,QAAL;AAEG,EApCkC;;AAsCtC;AACAC,gBAAc,yBAAU;AACvB,SAAO1F,IAAIA,IAAI0E,WAAJ,GAAkB,cAAtB,IAAwCgB,aAA/C;AACA,EAzCqC;;AA2CtCD,WAAS,oBAAU;;AAElB;AACA,OAAKE,QAAL,GAAgB,EAAhB,CAHkB,CAGE;AACpB;AACA,OAAKC,SAAL,GAAiB,CAAjB;;AAEA;AACA,OAAKC,KAAL,GAAa,EAAb;;AAEA;AACA,OAAKC,cAAL,GAAsB,KAAtB;AACA;AACA,OAAKjB,YAAL,GAAoB,KAApB;AACA;AACA,OAAKkB,gBAAL,GAAwB,CAAxB;;AAEA,MAAG,KAAKZ,eAAR,EAAwB;AACvBa,gBAAa,KAAKb,eAAlB;AACA,QAAKA,eAAL,GAAuB,CAAvB;AACA;;AAED;AACA,OAAKc,iBAAL,GAAyB,CAAzB;AACA,EAnEqC;;AAqEtC;AACAC,kBAAgB,yBAASC,SAAT,EAAmB;AAClC;AACA,OAAKJ,gBAAL,GAAwBI,SAAxB;AACA,EAzEqC;;AA2EtC;AACAC,gBAAc,uBAASrB,IAAT,EAAeC,IAAf,EAAqBM,aAArB,EAAoCD,iBAApC,EAAsD;AACnE,OAAKA,iBAAL,GAAyBA,iBAAzB;AACA,OAAKC,aAAL,GAAqBA,aAArB;;AAEA,MAAIe,aAAa,CAAjB;AACA,MAAI,KAAKC,SAAL,MAAoB,KAAK1B,MAA7B,EAAoC;AACnCyB,gBAAa,KAAKzB,MAAL,CAAYyB,UAAzB;AACA;;AAED;AACA,MAAI,KAAKC,SAAL,MAAoB,KAAK1B,MAAzB,IAAoCyB,cAAc,CAAlD,IAAwD,KAAKtB,IAAL,IAAaA,IAArE,IAA6E,KAAKC,IAAL,IAAaA,IAA9F,EAAmG;AAClG,QAAKK,iBAAL,CAAuB,KAAvB;AACA,GAFD,MAGI;AACH,QAAKN,IAAL,GAAYA,IAAZ;AACA,QAAKC,IAAL,GAAYA,IAAZ;AACA,QAAKC,GAAL,GAAW,CAAC,OAAD,EAAUF,IAAV,EAAgB,GAAhB,EAAqBC,IAArB,EAA2BE,IAA3B,CAAgC,EAAhC,CAAX;AACA,QAAKqB,OAAL;AACA;AACD,EA/FqC;;AAiGtC;AACAA,UAAQ,mBAAU;AACX,MAAI,KAAK3B,MAAT,EAAiB;AACb4B,WAAQC,GAAR,CAAY,kBAAZ;AACA,OAAG,KAAK7B,MAAL,CAAY8B,KAAf,EAAqB;AACjB,SAAK9B,MAAL,CAAY8B,KAAZ;AACH,IAFD,MAEM,IAAG,KAAK9B,MAAL,CAAY+B,UAAf,EAA0B;AAC5B,SAAK/B,MAAL,CAAY+B,UAAZ;AACH;AACD,QAAK/B,MAAL,GAAc,IAAd;AACH;AACD,MAAI5E,IAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCkC,QAAhC,MAA4C,KAAhD,EAAuD;AACnDJ,WAAQC,GAAR,CAAY,UAAQI,UAAR,GAAmB,WAA/B;AACA;AACH;AACD,OAAKzB,mBAAL,GAA2B,KAA3B;AACA,MAAIH,MAAI,KAAKA,GAAb;AACN,OAAKL,MAAL,GAAc,IAAIkC,SAAJ,CAAc,KAAK7B,GAAnB,CAAd;AACM,OAAKL,MAAL,CAAYmC,UAAZ,GAAyB,aAAzB;AACA,OAAKnC,MAAL,CAAYoC,MAAZ,GAAqB,KAAKC,MAAL,CAAYC,IAAZ,CAAiB,IAAjB,CAArB;AACA,OAAKtC,MAAL,CAAYuC,SAAZ,GAAwB,KAAKC,SAAL,CAAeF,IAAf,CAAoB,IAApB,CAAxB;AACA,OAAKtC,MAAL,CAAYyC,OAAZ,GAAsB,KAAKC,OAAL,CAAaJ,IAAb,CAAkB,IAAlB,CAAtB;AACA,OAAKtC,MAAL,CAAY2C,OAAZ,GAAsB,KAAKC,OAAL,CAAaN,IAAb,CAAkB,IAAlB,CAAtB,CArBW,CAqBoC;AAC/C,MAAIO,OAAK,IAAT;AACAC,aAAW,YAAY;AACnBlB,WAAQC,GAAR,CAAY,gCAA8BgB,KAAK5C,YAA/C;AACA2B,WAAQC,GAAR,CAAY,kCAAgCgB,KAAK3B,cAAjD;AACC,OAAI2B,KAAK5C,YAAL,IAAmB,IAAvB,EAA6B;AACzB2B,YAAQC,GAAR,CAAY,sBAAZ;AACH,IAFD,MAEM;AACFgB,SAAKD,OAAL,CAAa,EAAC,QAAO,SAAR,EAAkB,UAAS,EAAC,OAAMvC,GAAP,EAA3B,EAAb;AACH;AACJ,GARF,EAQG,IARH;AASH,EAlIkC;;AAoItC;AACA0C,YAAU,qBAAU;;AAEnB,OAAKC,UAAL;;AAEA;AACA,MAAG,KAAK7B,gBAAR,EAAyB;AACxB,OAAG,KAAKD,cAAR,EAAuB;AACtB,WAAO,IAAP;AACA;;AAED,QAAKA,cAAL,GAAsB,IAAtB;AACA,QAAKS,OAAL;AACAvG,OAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCmD,OAAhC,CAAwC,YAAxC,EAAsD,gBAAtD;AACA,UAAO,IAAP;AACA,GATD,MAUI;AACH,QAAK/B,cAAL,GAAsB,KAAtB;AACA,UAAO,KAAP;AACA;AAED,EAzJqC;;AA2JtC;AACAgC,gBAAc,yBAAU;;AAEvB,MAAIC,MAAM,KAAKjD,gBAAL,CAAsBkD,GAAtB,EAAV;AACA,MAAG,CAACD,GAAJ,EAAQ;AACPA,SAAM,IAAI9H,OAAJ,EAAN;AACA;AACD8H,MAAI1H,EAAJ,GAAS,KAAKuF,SAAL,EAAT;;AAEA;AACA,MAAI,KAAKA,SAAL,IAAkB,KAAtB,EAA6B;AAC5B,QAAKA,SAAL,GAAiB,CAAjB;AACA;AACD,SAAOmC,GAAP;AACA,EAzKqC;;AA2KtC;AACAzB,YAAU,qBAAU;AACnB,SAAO,KAAKzB,YAAZ;AACA,EA9KqC;AA+KtCoD,wBAAsB,iCAAU;AAC/B,MAAG,KAAK9C,eAAR,EACCa,aAAa,KAAKb,eAAlB;;AAED,OAAKc,iBAAL,GAAyB,CAAzB;AACA,OAAKd,eAAL,GAAuB,CAAvB;AACA,MAAIsC,OAAO,IAAX;AACA,OAAKtC,eAAL,GAAuBuC,WAAW,YAAU;AAC3CD,QAAK3B,cAAL,GAAsB,KAAtB;AACA2B,QAAKE,SAAL;AACA,GAHsB,EAGpB,GAHoB,CAAvB;AAIA,EA1LqC;AA2LtC;AACA;AACAV,SAAO,gBAAS3G,KAAT,EAAe;AACrB,MAAIN,IAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCkC,QAAhC,MAA4C,KAAhD,EAAuD;;AAEhD;AACA;AACP;AACA,MAAG,KAAKd,cAAR,EAAwB,CACvB,CADD,MAEI,CACH;;AAED,MAAG,KAAKX,eAAR,EAAwB;AACvBa,gBAAa,KAAKb,eAAlB;AACA,QAAKA,eAAL,GAAuB,CAAvB;AACA;;AAED,OAAKN,YAAL,GAAoB,IAApB;AACA,OAAKoB,iBAAL,GAAyB,CAAzB;AACA;AACA,MAAG,KAAKZ,iBAAR,EAA0B;AACzB;AACA,QAAKA,iBAAL,CAAuB,KAAKS,cAA5B;AACA;AACD,OAAKA,cAAL,GAAsB,KAAtB;AACA,EArNqC;;AAuNtC;AACG8B,aAAW,sBAA0B;AAAA,MAAjBM,QAAiB,uEAAN,KAAM;;AACjC,MAAG,KAAKrD,YAAL,IAAqB,KAAKD,MAA7B,EAAoC;AAChC,OAAG,KAAKA,MAAL,CAAY8B,KAAf,EAAqB;AACjB,SAAK9B,MAAL,CAAY8B,KAAZ;AACH,IAFD,MAGK,IAAG,KAAK9B,MAAL,CAAY+B,UAAf,EAA0B;AAC3B,SAAK/B,MAAL,CAAY+B,UAAZ;AACH;AACD,QAAK/B,MAAL,GAAc,IAAd;AACH,QAAKC,YAAL,GAAoB,KAApB;AACA,QAAKiB,cAAL,GAAoB,KAApB;AACA,OAAGoC,QAAH,EACC,KAAK9C,mBAAL,GAA2B,IAA3B;AACD;AACJ,EAtOkC;;AAwOtC;AACAgC,YAAU,mBAAS9G,KAAT,EAAe;AACxB,MAAI6H,OAAO,EAAX;AACA,MAAIC,cAAc,CAAlB;AACA,MAAIC,UAAU,CAAd;AACA,MAAIC,QAAQ,CAAZ;AACA,MAAIC,WAAW,CAAf;AACA,MAAIC,SAAS,CAAb;AACA,MAAIC,YAAY,EAAhB;AACA,MAAIC,WAAW,CAAf;AACA,MAAIC,YAAY,CAAhB;AACA,MAAIC,UAAU,EAAd;AACA,MAAIC,OAAO,EAAX;AACA,MAAIC,UAAQ,CAAZ;AACA,MAAIC,UAAQ,CAAZ;;AAEA,MAAG;AACFZ,UAAO,IAAI7G,kBAAJ,CAAuBhB,MAAM0I,IAA7B,CAAP;;AAEAZ,iBAAcD,KAAKxG,QAAL,EAAd;AACA0G,aAAUF,KAAKxG,QAAL,EAAV;AACA2G,WAAQ,CAACH,KAAKnG,OAAL,MAAkB,EAAnB,IAAyBmG,KAAKnG,OAAL,EAAjC;AACAuG,cAAWJ,KAAKxG,QAAL,EAAX;AACA6G,YAAS,CAACL,KAAKnG,OAAL,MAAkB,EAAnB,IAAyBmG,KAAKnG,OAAL,EAAlC;;AAEA8G,aAAUX,KAAKrG,SAAL,EAAV;AACAiH,aAAUZ,KAAKrG,SAAL,EAAV;AACA2G,eAAYN,KAAKjG,OAAL,GAAe+G,iBAAf,EAAZ;;AAEAP,cAAWP,KAAKrG,SAAL,EAAX;AACA6G,eAAYR,KAAKrG,SAAL,EAAZ;AACA8G,aAAUT,KAAKjG,OAAL,EAAV;;AAEA,OAAG4G,UAAQ,CAAX,EAAa;AACZ,SAAKvD,OAAL,CAAawD,OAAb,IAAsBH,OAAtB;AACA,QAAG,KAAKrD,OAAL,CAAapE,MAAb,IAAqB2H,OAAxB,EAAgC;AAC5B,SAAII,aAAW,EAAf;AACA,UAAI,IAAI/E,IAAE,CAAV,EAAYA,IAAE2E,OAAd,EAAsB3E,GAAtB,EAA0B;AACzB+E,mBAAWA,aAAW,KAAK3D,OAAL,CAAapB,CAAb,CAAtB;AACA;AACDyE,eAAQM,UAAR;AACA,UAAK3D,OAAL,GAAa,EAAb;AACA,KAPJ,MAOQ;AACP;AACA;AACD;;AAED,OAAGoD,SAAH,EAAa;AACZE,WAAO,EAAC,OAAMD,OAAP,EAAP;AACA,IAFD,MAGI;AACHC,WAAOM,KAAKC,KAAL,CAAWR,OAAX,CAAP;AACA;;AAED,QAAKS,GAAL,CAAS,2BAAT,EAAsCjB,WAAtC,EAAmDC,OAAnD,EAA4DC,KAA5D,EAAmEC,QAAnE,EAA6EC,MAA7E;AACA,GAvCD,CAwCA,OAAM3F,KAAN,EAAY;AACX2D,WAAQ3D,KAAR,CAAc,oBAAd,EAAoCA,MAAMyG,KAA1C;AACA;AACA;;AAEK,MAAI,KAAK5D,aAAL,EAAJ,EAA0B;AACzB,QAAK6D,MAAL,CAAY,mBAAZ,EAAiCb,QAAjC,EAA2CD,SAA3C,EAAsDE,SAAtD,EAAiEE,IAAjE,EAAuE,MAAvE;AACA;;AAEP,MAAGF,SAAH,EAAa;AACZ,QAAKrD,aAAL,CAAmB,aAAnB,EAAkC,CAACmD,SAAD,EAAYE,SAAZ,EAAuBE,IAAvB,CAAlC;AACA,GAFD,MAGI;AACH,QAAKvD,aAAL,CAAmB,WAAnB,EAAgC,CAACmD,SAAD,EAAYI,IAAZ,CAAhC;AACA;;AAED,MAAId,MAAM,KAAKpC,QAAL,CAAc+C,QAAd,CAAV;AACA;AACA,MAAG,CAACX,GAAJ,EAAQ;AACP;AACA;AACD;AACA,SAAO,KAAKpC,QAAL,CAAc+C,QAAd,CAAP;;AAEA,MAAG;AACF,OAAIC,SAAJ,EAAe;AACd,QAAIa,YAAYzB,IAAItH,KAApB;AACA,QAAG+I,SAAH,EAAa;AACZA,eAAUX,IAAV;AACA;AACD,IALD,MAMK,IAAGd,IAAIvH,QAAP,EAAiB;AACrBuH,QAAIvH,QAAJ,CAAaqI,IAAb;AACA;AACD,GAVD,CAWA,OAAOhG,KAAP,EAAa;AACZ2D,WAAQ3D,KAAR,CAAc,UAAd,EAA0BA,MAAMyG,KAAhC,EAAuCT,IAAvC;AACA;AACD,EAtUqC;AAuUtCY,oBAAkB,6BAAU;AAC3BzJ,MAAIA,IAAI0E,WAAJ,GAAkB,qBAAtB,IAA+C+E,iBAA/C;AACA,MAAIC,eAAe1J,IAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCiF,eAAhC,EAAnB;AACA,MAAIC,eAAeF,aAAa,cAAb,CAAnB;AACA,MAAIG,iBAAiBH,aAAa,gBAAb,CAArB;AACA;AACA,OAAKzE,GAAL,GAAW,CAAC,OAAD,EAAS2E,YAAT,EAAuB,GAAvB,EAA4BC,cAA5B,EAA4C3E,IAA5C,CAAiD,EAAjD,CAAX;AACA,EA9UqC;AA+UtC;AACAoC,UAAQ,iBAAShH,KAAT,EAAe;AAChB,MAAG,KAAK2E,GAAL,IAAU3E,MAAMwJ,MAAN,CAAaC,GAA1B,EAA8B;AAC1B;AACH;AACP;AACA,MAAI/J,IAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCkC,QAAhC,MAA4C,KAAhD,EAAuD;;AAEhD;AACA;AACP,MAAG,KAAKd,cAAR,EAAuB;AACtBU,WAAQ3D,KAAR,CAAc,MAAd;AACA;AACA,OAAG,KAAKsC,eAAR,EAAwB;AACvBa,iBAAa,KAAKb,eAAlB;AACA;AACD,QAAKc,iBAAL;AACA,OAAIwB,OAAO,IAAX;AACA,QAAKtC,eAAL,GAAuBuC,WAAW,YAAU;AAC3CD,SAAKgC,iBAAL;AACAhC,SAAK3B,cAAL,GAAsB,KAAtB;AACA2B,SAAKE,SAAL;AACA,IAJsB,EAIpB,IAJoB,CAAvB;AAKA,GAbD,MAcI;AACH;AACA,QAAKrC,aAAL,CAAmB,SAAnB;AACA;AACD,EA3WqC;;AA6WtC;AACAkC,UAAQ,iBAASlH,KAAT,EAAe;AACtB,MAAG,KAAK2E,GAAL,IAAU3E,MAAMwJ,MAAN,CAAaC,GAA1B,EAA8B;AACpB;AACH;AACP,OAAKC,MAAL,CAAY,eAAZ,EAA6B,KAAK/E,GAAlC,EAAuC3E,MAAM2J,IAA7C;AACA,MAAIjK,IAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCkC,QAAhC,MAA4C,KAAhD,EAAuD;AAChD;AACA;AACP,MAAG,KAAKd,cAAR,EAAuB;AACtB,QAAKuD,GAAL,CAAS,wBAAT;AACA,GAFD,MAGI;AACH,QAAK/D,aAAL,CAAmB,SAAnB,EAA6B,CAAC,KAAKF,mBAAN,CAA7B;AACA,QAAKwC,UAAL;AACA;AACD,OAAK/C,YAAL,GAAoB,KAApB;;AAEA,MAAG,KAAKO,mBAAR,EAA4B;AAAC;AAC5B,QAAKA,mBAAL,GAA2B,KAA3B;AACA,QAAKU,cAAL,GAAsB,KAAtB;AACA;AACA;;AAED,MAAG,KAAK,KAAKG,iBAAb,EAA+B;AAC9BO,WAAQ3D,KAAR,CAAc,8BAAd;AACA,QAAKoD,iBAAL;AACA,OAAG,KAAKd,eAAR,EAAwB;AACvBa,iBAAa,KAAKb,eAAlB;AACA,SAAKA,eAAL,GAAuB,CAAvB;AACA;AACD,OAAIsC,OAAO,IAAX;AACA,QAAKtC,eAAL,GAAuBuC,WAAW,YAAU;AAC/BD,SAAKgC,iBAAL;AACAhC,SAAK3B,cAAL,GAAsB,KAAtB;AACA2B,SAAKE,SAAL;AACH,IAJa,EAIX,IAJW,CAAvB;AAKA;AACD,EAnZqC;;AAqZtC;;AAEA;AACAuC,mBAAiB,0BAASzB,SAAT,EAAoB0B,QAApB,EAA6B;;AAE7C;AACA,MAAG,CAAC,KAAK7D,SAAL,EAAJ,EAAqB;AACpBE,WAAQ3D,KAAR,CAAc,gCAAd;AACA;AACM7C,OAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCmD,OAAhC,CAAwC,YAAxC,EAAsD,YAAtD;AACN;AACA;AACDY,cAAYA,UAAUQ,iBAAV,EAAZ;;AAEA;AACA,MAAIlB,MAAM,KAAKD,aAAL,EAAV;AACAC,MAAIzH,KAAJ,GAAYmI,SAAZ;AACAV,MAAIxH,KAAJ,GAAY4J,QAAZ;AACApC,MAAIvH,QAAJ,GAAe,KAAK4J,gBAAL,CAAsBlD,IAAtB,CAA2B,IAA3B,CAAf;AACAa,MAAItH,KAAJ,GAAY,KAAK4J,aAAL,CAAmBnD,IAAnB,CAAwB,IAAxB,CAAZ;;AAEA,OAAKvB,QAAL,CAAcoC,IAAI1H,EAAlB,IAAwB0H,GAAxB;;AAEA,MAAIuC,OAAO;AACVlC,gBAAa1H,YAAYT,OADf;AAEVK,UAAOmI,SAFG;AAGVC,aAAUX,IAAI1H;AAHJ,GAAX;;AAMA,MAAG,KAAKqF,aAAL,EAAH,EAAwB;AACvB,QAAK6D,MAAL,CAAY,oBAAZ,EAAkCd,SAAlC,EAA6C0B,QAA7C,EAAuD,KAAvD;AACA;AACD;AACA,OAAKI,KAAL,CAAWD,IAAX,EAAiBH,QAAjB;AACA,EAvbqC;;AAybtC;AACAC,mBAAiB,4BAAU;;AAE1B,OAAKtE,cAAL,GAAsB,KAAtB;AACA;AACA,OAAK0E,YAAL;AACA,EA/bqC;;AAictC;AACAH,gBAAc,uBAAS5B,SAAT,EAAoBE,SAApB,EAA+BE,IAA/B,EAAoC;AACjD;AACA;AACA;AACA;AACA;AACG7I,MAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCmD,OAAhC,CAAwC,YAAxC,EAAsD,YAAtD;AACH,EAzcqC;;AA2ctC;AACA2C,eAAa,wBAAU;AACtB,MAAIC,YAAY,KAAK5E,KAAL,CAAW1E,MAA3B;AACA;AACA,OAAK,IAAIE,QAAQ,CAAjB,EAAoBA,QAAQoJ,SAA5B,EAAuCpJ,OAAvC,EAA+C;AAC9C,OAAI0G,MAAM,KAAKlC,KAAL,CAAWxE,KAAX,CAAV;AACA,OAAI,KAAKqE,aAAL,EAAJ,EAA0B;AACzB,SAAK6D,MAAL,CAAY,iBAAZ,EAA+BxB,IAAIuC,IAAJ,CAAShK,KAAxC,EAA+CyH,IAAIxH,KAAnD,EAA0D,KAA1D;AACA;AACD,QAAKgK,KAAL,CAAWxC,IAAIuC,IAAf,EAAqBvC,IAAIxH,KAAzB;AACA;AACD,OAAKsF,KAAL,GAAa,EAAb;AACA,EAvdqC;;AAydtC;AACA6E,cAAY,qBAASJ,IAAT,EAAeH,QAAf,EAAwB;AACnC,MAAI1B,YAAY6B,KAAKhK,KAArB;;AAEA,MAAImK,YAAY,KAAK5E,KAAL,CAAW1E,MAA3B;AACA,OAAI,IAAIE,QAAM,CAAd,EAAiBA,QAAMoJ,SAAvB,EAAkCpJ,OAAlC,EAA0C;AACzC,OAAI0G,MAAM,KAAKlC,KAAL,CAAWxE,KAAX,CAAV;AACA;AACA,OAAG0G,IAAI,MAAJ,EAAY,OAAZ,KAAwBU,SAA3B,EAAqC;AACpC;AACA;AACD;AACD,OAAK5C,KAAL,CAAW/C,IAAX,CAAgB,EAAEwH,MAAMA,IAAR,EAAc/J,OAAO4J,QAArB,EAAhB;AACA,EAteqC;;AAwetC;AACAlK,UAAQ,iBAASwI,SAAT,EAAoB0B,QAApB,EAAiE;AAAA,MAAnC3J,QAAmC,uEAA1B,IAA0B;AAAA,MAApBmK,aAAoB,uEAAN,IAAM;;AACxElC,cAAYA,UAAUQ,iBAAV,EAAZ;;AAEA;AACA,MAAIlB,MAAM,KAAKD,aAAL,EAAV;AACAC,MAAIzH,KAAJ,GAAYmI,SAAZ;AACAV,MAAIxH,KAAJ,GAAY4J,QAAZ;AACApC,MAAIvH,QAAJ,GAAeA,QAAf;AACAuH,MAAItH,KAAJ,GAAYkK,aAAZ;;AAEA,OAAKhF,QAAL,CAAcoC,IAAI1H,EAAlB,IAAwB0H,GAAxB;;AAEA,MAAIuC,OAAO;AACPlC,gBAAa1H,YAAYT,OADlB;AAEPK,UAAOmI,SAFA;AAGPC,aAAUX,IAAI1H;AAHP,GAAX;;AAMA,MAAI,KAAKiG,SAAL,EAAJ,EAAsB;AACrB;AACA,OAAG,KAAKR,cAAR,EAAuB;AACtB,SAAK4E,WAAL,CAAiBJ,IAAjB,EAAuBH,QAAvB;AACA,IAFD,MAGI;AACH,QAAG,KAAKzE,aAAL,EAAH,EAAwB;AACvB,UAAK6D,MAAL,CAAY,eAAZ,EAA6Bd,SAA7B,EAAwC0B,QAAxC,EAAkD,KAAlD;AACA;AACD,SAAKI,KAAL,CAAWD,IAAX,EAAiBH,QAAjB;AACA;AACD,GAXD,MAYI;AACH;AACA,OAAG,KAAKxC,SAAL,EAAH,EAAoB;AACnB,SAAK+C,WAAL,CAAiBJ,IAAjB,EAAuBH,QAAvB;AACA,IAFD,MAGI;AACH;AACAnK,QAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCmD,OAAhC,CAAwC,YAAxC,EAAsD,YAAtD;AACA;AACD;AACD,EAjhBqC;;AAmhBtC;AACAhH,SAAO,gBAAS4H,SAAT,EAAoB0B,QAApB,EAA6B;AACnC1B,cAAYA,UAAUQ,iBAAV,EAAZ;AACA,MAAIqB,OAAO;AACVlC,gBAAa1H,YAAYG,MADf;AAEVP,UAAOmI,SAFG;AAGVC,aAAU;AAHA,GAAX;;AAMA,MAAI,KAAKpC,SAAL,EAAJ,EAAsB;AACrB;AACA,OAAG,KAAKR,cAAR,EAAuB;AACtB,SAAK4E,WAAL,CAAiBJ,IAAjB,EAAuBH,QAAvB;AACA,IAFD,MAGI;AACH,QAAI,KAAKzE,aAAL,EAAJ,EAA0B;AACzB,UAAK6D,MAAL,CAAY,iBAAZ,EAA+Bd,SAA/B,EAA0C0B,QAA1C,EAAoD,KAApD;AACA;AACD,SAAKI,KAAL,CAAWD,IAAX,EAAiBH,QAAjB;AACA;AACD,GAXD,MAYI;AACH;AACA,OAAG,KAAKxC,SAAL,EAAH,EAAoB;AACnB,SAAK+C,WAAL,CAAiBJ,IAAjB,EAAuBH,QAAvB;AACA,IAFD,MAGI;AACH;AACAnK,QAAIA,IAAI0E,WAAJ,GAAkB,QAAtB,EAAgCmD,OAAhC,CAAwC,YAAxC,EAAsD,YAAtD;AACA;AACD;AACD,EAljBqC;;AAojBtC;AACA0C,QAAM,eAASD,IAAT,EAAeM,OAAf,EAAwB;AAC7B;AACA,MAAG;AACF,OAAIC,SAAS1B,KAAK2B,SAAL,CAAeF,OAAf,CAAb;AACA,GAFD,CAGA,OAAO/H,KAAP,EAAa;AACZ2D,WAAQ3D,KAAR,CAAc,iBAAd,EAAiCA,MAAMyG,KAAvC;AACA;AACA;AACK,MAAInI,SAAS,IAAI,CAAJ,GAAQ,CAAR,GAAYmJ,KAAKhK,KAAL,CAAWa,MAAX,GAAoB,CAAhC,GAAoC,CAApC,GAAwC0J,OAAO1J,MAAP,GAAgB,CAArE;AACA;AACN,MAAIgH,OAAO,IAAIhF,mBAAJ,CAAwBhC,MAAxB,CAAX;AACA;AACAgH,OAAK5E,SAAL,CAAe+G,KAAKlC,WAApB,EAb6B,CAaI;AACjCD,OAAKzE,UAAL,CAAgB4G,KAAK5B,QAArB,EAd6B,CAcE;AAC/BP,OAAKrE,QAAL,CAAcwG,KAAKhK,KAAnB,EAf6B,CAeH;AAC1B6H,OAAKrE,QAAL,CAAc+G,MAAd,EAhB6B,CAgBP;AACtB;AACA,OAAKjG,MAAL,CAAYmG,IAAZ,CAAiB5C,KAAK9E,SAAL,EAAjB;AACA;AAxkBqC,CAArB,CAAlB;;AA4kBA,IAAI2H,gBAAgB,IAApB;;AAEA;;;AAGAC,QAAQC,QAAR,GAAmB,YAAU;AACzB,KAAG,CAACF,aAAJ,EAAkB;AACjBA,kBAAgB,IAAIxG,WAAJ,EAAhB;AACA;AACD,QAAOwG,aAAP;AACH,CALD","file":"fjssz_NetWork.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\net","sourcesContent":["var emitter = require(\"fjssz_emitter\");\r\n\r\nvar app = require(\"fjssz_app\");\r\n\r\n\r\nvar Request = app.BaseClass.extend({\r\n    Init:function(){\r\n        this.id = null;\r\n        this.event = null;\r\n        this.param = null;\r\n        this.callback = null; //(msg: any) => void;\r\n        this.errcb = null; //(head: any, code: number, msg: string) => void;\r\n    },\r\n})\r\n\r\nvar MessageType = {\r\n\t\tNone : 0, // 空白定义\r\n\t\t/**\r\n\t\t * 对request的反馈，无需回包\r\n\t\t */\r\n\t\tResponse : 1,\r\n\t\t/**\r\n\t\t * 向其他服务器请求，必定回包\r\n\t\t */\r\n\t\tRequest : 2,\r\n\t\t/**\r\n\t\t * 向其他服务器发送监控信息，无需回包\r\n\t\t */\r\n\t\tNotify : 3,\r\n}\r\n\t\r\nvar copyArray = function(dest, doffset, src, soffset, length) {\r\n    if('function' === typeof src.copy) {\r\n      // Buffer\r\n      src.copy(dest, doffset, soffset, soffset + length);\r\n    } else {\r\n      // Uint8Array\r\n      for(var index=0; index<length; index++){\r\n        dest[doffset++] = src[soffset++];\r\n      }\r\n    }\r\n};\r\n  \r\nvar EgretReadByteArray = app.BaseClass.extend({\r\n    Init:function(buffer){\r\n        this.buffer = buffer;\r\n        this.dataview = new DataView(this.buffer);\r\n        this.offset = 0;\r\n    },\r\n    \r\n    readByte:function(){\r\n        var ret = this.dataview.getUint8(this.offset);\r\n        this.offset += 1;\r\n        return ret;\r\n    },\r\n    \r\n    readShort:function(){\r\n        var ret = this.dataview.getInt16(this.offset);\r\n        this.offset += 2;\r\n        return ret;\r\n    },\r\n    \r\n    readInt:function(){\r\n        var ret = this.dataview.getInt32(this.offset);\r\n        this.offset += 4;\r\n        return ret;\r\n    },\r\n    \r\n    readUTF:function(){\r\n        var length = this.dataview.getInt16(this.offset);\r\n        this.offset += 2;\r\n        var tempBuffer = this.buffer.slice(this.offset, this.offset+length);\r\n       //cc.error(\"length\",this.offset, length, tempBuffer, tempBuffer.byteLength);\r\n        this.offset += length;\r\n        var ret = this.strdecode(tempBuffer);\r\n        return ret;\r\n    },\r\n    \r\n    // // ArrayBuffer转为字符串，参数为ArrayBuffer对象\r\n    // ab2str:function(buf) {\r\n    //     return String.fromCharCode.apply(null, new Uint16Array(buf));\r\n    // },\r\n    \r\n    /**\r\n   * client decode\r\n   * msg String data\r\n   * return Message Object\r\n   */\r\n  strdecode:function(buffer) {\r\n    var bytes = new Uint8Array(buffer);\r\n    var array = [];\r\n    var offset = 0;\r\n    var charCode = 0;\r\n    var end = bytes.length;\r\n    //cc.error('befor Protocol.strdecode length:', end);\r\n    var hasEot = false;\r\n    while(offset < end){\r\n      try{\r\n        if(bytes[offset] < 128){\r\n          charCode = bytes[offset];\r\n          offset += 1;\r\n          if (charCode == 4) {\r\n            cc.error('find strdecode eot');\r\n            hasEot = true;\r\n            continue;\r\n          }\r\n        }else if(bytes[offset] < 224){\r\n          charCode = ((bytes[offset] & 0x3f)<<6) + (bytes[offset+1] & 0x3f);\r\n          offset += 2;\r\n        }else{\r\n          charCode = ((bytes[offset] & 0x0f)<<12) + ((bytes[offset+1] & 0x3f)<<6) + (bytes[offset+2] & 0x3f);\r\n          offset += 3;\r\n        }\r\n        array.push(charCode);  \r\n      }\r\n      catch(e){\r\n        cc.error(e);\r\n      }\r\n    }\r\n    if (hasEot)\r\n      array.push(\"}\");\r\n      \r\n    var ret = String.fromCharCode.apply(null, array);\r\n    //cc.error('after Protocol.strdecode length:', array.length, array, ret);\r\n    return ret;\r\n  },\r\n})\r\n\r\nvar EgretWriteByteArray = app.BaseClass.extend({\r\n    Init:function(length){\r\n        this.buffer = new ArrayBuffer(length);\r\n        this.dataview = new DataView(this.buffer);\r\n        this.offset = 0;\r\n    },\r\n    \r\n    getBuffer:function(){\r\n        //cc.error(this.buffer.byteLength, this.offset);\r\n        var retBuffer = this.buffer.slice(0, this.offset);\r\n        //cc.error(\"getBuffer\", retBuffer);\r\n        return this.buffer;\r\n    },\r\n    \r\n    writeByte:function(value){\r\n        var ret = this.dataview.setUint8(this.offset, value);\r\n        this.offset += 1;\r\n        //cc.error('offset:', this.offset);\r\n    },\r\n    \r\n    writeShort:function(value){\r\n        var ret = this.dataview.setInt16(this.offset, value);\r\n        this.offset += 2;\r\n        //cc.error('offset:', this.offset);\r\n    },\r\n    \r\n    writeInt:function(value){\r\n        var ret = this.dataview.setInt32(this.offset, value);\r\n        this.offset += 4;\r\n        //cc.error('offset:', this.offset);\r\n    },\r\n    \r\n    writeUTF:function(str){\r\n        //cc.error(this.dataview, str, str.length);\r\n        var strBuffer = this.strencode(str);\r\n        this.writeShort(strBuffer.length);\r\n        copyArray(new Uint8Array(this.buffer), this.offset, strBuffer, 0, strBuffer.length);\r\n        this.offset += strBuffer.length;\r\n        \r\n        //cc.error(this.dataview, strBuffer.length);\r\n        //cc.error('offset:', this.offset);\r\n    },\r\n\r\n    strencode:function(str) {\r\n        var byteArray = new Uint8Array(str.length * 3);\r\n        var offset = 0;\r\n        for(var i = 0; i < str.length; i++){\r\n          var charCode = str.charCodeAt(i);\r\n          var codes = null;\r\n          if(charCode <= 0x7f){\r\n            codes = [charCode];\r\n          }else if(charCode <= 0x7ff){\r\n            codes = [0xc0|(charCode>>6), 0x80|(charCode & 0x3f)];\r\n          }else{\r\n            codes = [0xe0|(charCode>>12), 0x80|((charCode & 0xfc0)>>6), 0x80|(charCode & 0x3f)];\r\n          }\r\n          for(var j = 0; j < codes.length; j++){\r\n            byteArray[offset] = codes[j];\r\n            ++offset;\r\n          }\r\n        }\r\n        var _buffer = new Uint8Array(offset);\r\n        copyArray(_buffer, 0, byteArray, 0, offset);\r\n        return _buffer;\r\n    },\r\n})\r\n\r\n\r\nvar sss_NetWork = app.BaseClass.extend({\r\n\r\n\tInit:function(){\r\n\t    this.JS_Name = app.subGameName + \"_NetWork\";\r\n\r\n\t\t//最大允许尝试重连次数\r\n\t\tthis.AllowReConnectCount = 3;\r\n\r\n\t\t//事件分发模块\r\n\t\tthis.emitter = new emitter();\r\n\r\n\t\t//当前连接\r\n\t\tthis.socket = null;\r\n\t\tthis.isConnectIng = false;//websocket正在连接中(js websoket有bug用自定义的)\r\n\t\t//缓存的请求对象列表\r\n\t\tthis.cacheRequestList = [];\r\n\r\n\t\t//连接服务器IP地址\r\n\t\tthis.host = \"127.0.0.1\";\r\n\t\tthis.port = 9999;\r\n\t\tthis.url = ['ws://', this.host, ':', this.port].join(\"\");\r\n\r\n\t\t//延迟重连的事件ID\r\n\t\tthis.reConnectTimeID = 0;\r\n\r\n\t\tthis.bDisconnectByLogout = false;\r\n\t\t//连接成功回调\r\n\t\tthis.handshakeCallback = null;\r\n\r\n\t\tthis.eventCallback = null;\r\n\r\n\t\t//大包\r\n\t\tthis.BigPack=new Array();\r\n\r\n\t\tthis.OnReload();\r\n\r\n    },\r\n\r\n\t//是否开发者模式\r\n\tIsDevelopment:function(){\r\n\t\treturn app[app.subGameName + \"_ShareDefine\"]().IsDevelopment\r\n\t},\r\n\r\n\tOnReload:function(){\r\n\r\n\t\t//发送的封包堆积字典\r\n\t\tthis.requests = {}; // id：req\r\n\t\t//封包序列号\r\n\t\tthis.requestid = 1;\r\n\r\n\t\t//发包失败缓存列表\r\n\t\tthis.losts = [];\r\n\r\n\t\t//是否在处理重连中\r\n\t\tthis.isReconnecting = false;\r\n\t\t//是否在连接中\r\n\t\tthis.isConnectIng = false;\r\n\t\t//客户端当前连接登录的accountID\r\n\t\tthis.connectAccountID = 0\r\n\r\n\t\tif(this.reConnectTimeID){\r\n\t\t\tclearTimeout(this.reConnectTimeID);\r\n\t\t\tthis.reConnectTimeID = 0;\r\n\t\t}\r\n\r\n\t\t//尝试重连次数\r\n\t\tthis.tryReConnectCount = 0;\r\n\t},\r\n\r\n\t//初始化连接的玩家账号\r\n\tInitConnectInfo:function(accountID){\r\n\t\t//记录客户端当前连接登录的accountID\r\n\t\tthis.connectAccountID = accountID;\r\n\t},\r\n\r\n\t//初始化连接\r\n\tInitWebSocket:function(host, port, eventCallback, handshakeCallback){\r\n\t\tthis.handshakeCallback = handshakeCallback;\r\n\t\tthis.eventCallback = eventCallback;\r\n\r\n\t\tlet readyState = 0;\r\n\t\tif (this.Connected() && this.socket){\r\n\t\t\treadyState = this.socket.readyState;\r\n\t\t}\r\n\r\n\t\t//已经连接成功,直接回调握手函数\r\n\t\tif (this.Connected() && this.socket && (readyState == 1) && this.host == host && this.port == port){\r\n\t\t\tthis.handshakeCallback(false);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.host = host;\r\n\t\t\tthis.port = port;\r\n\t\t\tthis.url = ['ws://', host, ':', port].join(\"\");\r\n\t\t\tthis.Connect();\r\n\t\t}\r\n\t},\r\n\r\n\t// 连接Java服务器\r\n\tConnect:function(){\r\n        if (this.socket) {\r\n            console.log(\"socket连接已存在，需先关闭\");\r\n            if(this.socket.close){\r\n                this.socket.close();\r\n            }else if(this.socket.disconnect){\r\n                this.socket.disconnect();\r\n            }\r\n            this.socket = null;\r\n        }\r\n        if (app[app.subGameName + \"Client\"].isInGame()==false) {\r\n            console.log(\"当前游戏：\"+curRunGame+\"无需Connect\");\r\n            return;\r\n        }\r\n        this.bDisconnectByLogout = false;\r\n        let url=this.url;\r\n\t\tthis.socket = new WebSocket(this.url);\r\n        this.socket.binaryType = 'arraybuffer';\r\n        this.socket.onopen = this.OnOpen.bind(this);\r\n        this.socket.onmessage = this.OnMessage.bind(this);\r\n        this.socket.onerror = this.OnError.bind(this);\r\n        this.socket.onclose = this.OnClose.bind(this); // 服务器断开\r\n        let that=this;\r\n        setTimeout(function () {\r\n            console.log(\"setTimeout isConnectIng 触发:\"+that.isConnectIng);\r\n            console.log(\"setTimeout isReconnecting 触发:\"+that.isReconnecting);\r\n             if (that.isConnectIng==true) {\r\n                 console.log(\"setTimeout 已经检测到连接成功\");\r\n             }else {\r\n                 that.OnClose({\"type\":'timeout',\"target\":{\"URL\":url}});\r\n             }\r\n         },3000);\r\n    },\r\n\r\n\t//发起重连\r\n\tReConnect:function(){\r\n\r\n\t\tthis.Disconnect();\r\n\r\n\t\t//玩家登录服务器后,才需要建立重连,否则不重连,登录过程当断网处理,否则登录请求一直重连\r\n\t\tif(this.connectAccountID){\r\n\t\t\tif(this.isReconnecting){\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\r\n\t\t\tthis.isReconnecting = true;\r\n\t\t\tthis.Connect();\r\n\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"StartReConnect\");\r\n\t\t\treturn true\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.isReconnecting = false;\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//创建一个新的封包事件结构体\r\n\tGetNewRequest:function(){\r\n\r\n\t\tlet req = this.cacheRequestList.pop();\r\n\t\tif(!req){\r\n\t\t\treq = new Request();\r\n\t\t}\r\n\t\treq.id = this.requestid++;\r\n\r\n\t\t//修改请求头ID,避免超过字段值\r\n\t\tif (this.requestid >= 60000) {\r\n\t\t\tthis.requestid = 1;\r\n\t\t}\r\n\t\treturn req\r\n\t},\r\n\r\n\t//是否连接中\r\n\tConnected:function(){\r\n\t\treturn this.isConnectIng;\r\n\t},\r\n\tReConnectByTipSureBtn:function(){\r\n\t\tif(this.reConnectTimeID)\r\n\t\t\tclearTimeout(this.reConnectTimeID);\r\n\t\t\r\n\t\tthis.tryReConnectCount = 0;\r\n\t\tthis.reConnectTimeID = 0;\r\n\t\tlet that = this;\r\n\t\tthis.reConnectTimeID = setTimeout(function(){\r\n\t\t\tthat.isReconnecting = false;\r\n\t\t\tthat.ReConnect();\r\n\t\t}, 100);\r\n\t},\r\n\t//----------回掉函数------------------\r\n\t//连接开启\r\n\tOnOpen:function(event){\r\n\t\tif (app[app.subGameName + \"Client\"].isInGame()==false) {\r\n        \t\r\n        \treturn;\r\n        }\r\n\t\t//如果是重连成功回调\r\n\t\tif(this.isReconnecting) {\r\n\t\t}\r\n\t\telse{\r\n\t\t}\r\n\t\t\r\n\t\tif(this.reConnectTimeID){\r\n\t\t\tclearTimeout(this.reConnectTimeID);\r\n\t\t\tthis.reConnectTimeID = 0;\r\n\t\t}\r\n\t\t\r\n\t\tthis.isConnectIng = true;\r\n\t\tthis.tryReConnectCount = 0;\r\n\t\t//连接成功回调\r\n\t\tif(this.handshakeCallback){\r\n\t\t\t//回调确认是重连在置为false\r\n\t\t\tthis.handshakeCallback(this.isReconnecting);\r\n\t\t}\r\n\t\tthis.isReconnecting = false;\r\n\t},\r\n\r\n\t//断开连接\r\n    Disconnect:function(byLogout = false){\r\n        if(this.isConnectIng && this.socket){\r\n            if(this.socket.close){\r\n                this.socket.close();\r\n            }\r\n            else if(this.socket.disconnect){\r\n                this.socket.disconnect();\r\n            }\r\n            this.socket = null;\r\n        \tthis.isConnectIng = false;\r\n        \tthis.isReconnecting=false;\r\n        \tif(byLogout)\r\n        \t\tthis.bDisconnectByLogout = true;\r\n        }\r\n    },\r\n\r\n\t//接受到数据\r\n\tOnMessage:function(event){\r\n\t\tlet byte = \"\";\r\n\t\tlet messageType = 0;\r\n\t\tlet srcType = 0;\r\n\t\tlet srcId = 0;\r\n\t\tlet descType = 0;\r\n\t\tlet descId = 0;\r\n\t\tlet eventName = \"\";\r\n\t\tlet sequence = 0;\r\n\t\tlet errorCode = 0;\r\n\t\tlet strBody = \"\";\r\n\t\tlet body = {};\r\n\t\tlet allPack=0;\r\n\t\tlet nowPack=0;\r\n\r\n\t\ttry{\r\n\t\t\tbyte = new EgretReadByteArray(event.data);\r\n\r\n\t\t\tmessageType = byte.readByte();\r\n\t\t\tsrcType = byte.readByte();\r\n\t\t\tsrcId = (byte.readInt() << 32) + byte.readInt();\r\n\t\t\tdescType = byte.readByte();\r\n\t\t\tdescId = (byte.readInt() << 32) + byte.readInt();\r\n\r\n\t\t\tallPack = byte.readShort();\r\n\t\t\tnowPack = byte.readShort();\r\n\t\t\teventName = byte.readUTF().toLocaleLowerCase();\r\n\r\n\t\t\tsequence = byte.readShort();\r\n\t\t\terrorCode = byte.readShort();\r\n\t\t\tstrBody = byte.readUTF();\r\n\r\n\t\t\tif(allPack>1){\r\n\t\t\t\tthis.BigPack[nowPack]=strBody;\r\n\t\t\t\tif(this.BigPack.length==allPack){\t\r\n    \t\t\t\tlet BigstrBody='';\r\n    \t\t\t\tfor(let i=0;i<allPack;i++){\r\n    \t\t\t\t\tBigstrBody=BigstrBody+this.BigPack[i];\r\n    \t\t\t\t};\r\n    \t\t\t\tstrBody=BigstrBody;\r\n    \t\t\t\tthis.BigPack=[];\r\n    \t\t\t}else{\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif(errorCode){\r\n\t\t\t\tbody = {\"Msg\":strBody};\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tbody = JSON.parse(strBody);\r\n\t\t\t}\r\n\r\n\t\t\tthis.Log(\"OnMessage(%s,%s,%s,%s,%s)\", messageType, srcType, srcId, descType, descId);\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tconsole.error(\"OnMessage error:%s\", error.stack);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n        if (this.IsDevelopment()) {\r\n\t        this.NetLog(\"[Recv](%s,%s,%s):\", sequence, eventName, errorCode, body, \"b-gb\");\r\n        }\r\n\r\n\t\tif(errorCode){\r\n\t\t\tthis.eventCallback(\"OnCodeError\", [eventName, errorCode, body]);\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.eventCallback(\"OnReceive\", [eventName, body]);\r\n\t\t}\r\n\r\n\t\tvar req = this.requests[sequence];\r\n\t\t//请求事件可能注册了回调函数\r\n\t\tif(!req){\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//单次回调事件,删除记录\r\n\t\tdelete this.requests[sequence];\r\n\r\n\t\ttry{\r\n\t\t\tif (errorCode) {\r\n\t\t\t\tvar errorFunc = req.errcb;\r\n\t\t\t\tif(errorFunc){\r\n\t\t\t\t\terrorFunc(body);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(req.callback) {\r\n\t\t\t\treq.callback(body);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error){\r\n\t\t\tconsole.error(\"error:%s\", error.stack, body);\r\n\t\t}\r\n\t},\r\n\tUpdateAccessPoint:function(){\r\n\t\tapp[app.subGameName + \"_HeroAccountManager\"]().UpdateAccessPoint();\r\n\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\t\tlet gameServerIP = clientConfig[\"GameServerIP\"];\r\n\t\tlet gameServerPort = clientConfig[\"GameServerPort\"];\r\n\t\t//换节点\r\n\t\tthis.url = ['ws://',gameServerIP, ':', gameServerPort].join(\"\");\r\n\t},\r\n\t//连接错误\r\n\tOnError:function(event){\r\n        if(this.url!=event.target.URL){\r\n            return;\r\n        }\r\n\t\t//如果重连中,网络连接失败\r\n\t\tif (app[app.subGameName + \"Client\"].isInGame()==false) {\r\n        \t\r\n        \treturn;\r\n        }\r\n\t\tif(this.isReconnecting){\r\n\t\t\tconsole.error(\"重连失败\");\r\n\t\t\t//如果有启动重连定时时间,清除掉回调\r\n\t\t\tif(this.reConnectTimeID){\r\n\t\t\t\tclearTimeout(this.reConnectTimeID);\r\n\t\t\t}\r\n\t\t\tthis.tryReConnectCount++;\r\n\t\t\tlet that = this;\r\n\t\t\tthis.reConnectTimeID = setTimeout(function(){\r\n\t\t\t\tthat.UpdateAccessPoint();\r\n\t\t\t\tthat.isReconnecting = false;\r\n\t\t\t\tthat.ReConnect();\r\n\t\t\t}, 5000);\r\n\t\t}\r\n\t\telse{\r\n\t\t\t//连接错误\r\n\t\t\tthis.eventCallback(\"OnError\");\r\n\t\t}\r\n\t},\r\n\r\n\t//关闭请求(服务器关闭请求)\r\n\tOnClose:function(event){\r\n\t\tif(this.url!=event.target.URL){\r\n            return;\r\n        }\r\n\t\tthis.ErrLog(\"OnClose:%s,%s\", this.url, event.type);\r\n\t\tif (app[app.subGameName + \"Client\"].isInGame()==false) {\r\n        \treturn;\r\n        }\r\n\t\tif(this.isReconnecting){\r\n\t\t\tthis.Log(\"OnClose isReconnecting\");\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.eventCallback(\"OnClose\",[this.bDisconnectByLogout]);\r\n\t\t\tthis.Disconnect();\r\n\t\t}\r\n\t\tthis.isConnectIng = false;\r\n\r\n\t\tif(this.bDisconnectByLogout){//自己断开的不自动重连\r\n\t\t\tthis.bDisconnectByLogout = false;\r\n\t\t\tthis.isReconnecting = false;\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif(0 == this.tryReConnectCount){\r\n\t\t\tconsole.error('NetWork OnClose tryReConnect');\r\n\t\t\tthis.tryReConnectCount++;\r\n\t\t\tif(this.reConnectTimeID){\r\n\t\t\t\tclearTimeout(this.reConnectTimeID);\r\n\t\t\t\tthis.reConnectTimeID = 0;\r\n\t\t\t}\r\n\t\t\tlet that = this;\r\n\t\t\tthis.reConnectTimeID = setTimeout(function(){\r\n                that.UpdateAccessPoint();\r\n                that.isReconnecting = false;\r\n                that.ReConnect();\r\n            }, 1000);\r\n\t\t}\r\n\t},\r\n\r\n\t//-------------------发包接口----------------\r\n\r\n\t//发送登录授权封包,请求重新绑定链接\r\n\tRequestReConnect:function(eventName, sendPack){\r\n\r\n\t\t//还没有建立连接不能发送重连封包请求\r\n\t\tif(!this.Connected()){\r\n\t\t\tconsole.error(\"RequestReConnect not Connected\");\r\n\t\t\t//关闭模态层\r\n        \tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\teventName = eventName.toLocaleLowerCase();\r\n\r\n\t\t// 发送请求\r\n\t\tlet req = this.GetNewRequest();\r\n\t\treq.event = eventName;\r\n\t\treq.param = sendPack;\r\n\t\treq.callback = this.ReConnectSuccess.bind(this);\r\n\t\treq.errcb = this.ReConnectFail.bind(this);\r\n\r\n\t\tthis.requests[req.id] = req;\r\n\r\n\t\tvar head = {\r\n\t\t\tmessageType: MessageType.Request,\r\n\t\t\tevent: eventName,\r\n\t\t\tsequence: req.id\r\n\t\t};\r\n\r\n\t\tif(this.IsDevelopment()){\r\n\t\t\tthis.NetLog(\"[ReConnect](%s) : \", eventName, sendPack, \"b-g\");\r\n\t\t}\r\n\t\t//先发送一个重连封包,直接调用write,不调用Request避免被挤压\r\n\t\tthis.write(head, sendPack);\r\n\t},\r\n\r\n\t//登录重新授权成功\r\n\tReConnectSuccess:function(){\r\n\r\n\t\tthis.isReconnecting = false;\r\n\t\t//在发送挤压封包\r\n\t\tthis.SendLostPack();\r\n\t},\r\n\r\n\t//重新授权失败\r\n\tReConnectFail:function(eventName, errorCode, body){\r\n\t\t// 网络已经连接,重连token授权登录失败\r\n\t\t// 依据errorCode类型:\r\n\t\t// 1:弹框提示,2次授权登录,需要依然保持isReconnecting=true状态.\r\n\t\t// 2:非法性退到登录场景,不允许重连\r\n\t\t//关闭模态层\r\n    \tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\t},\r\n\r\n\t//发送重连后挤压的封包\r\n\tSendLostPack:function(){\r\n\t\tlet lostCount = this.losts.length;\r\n\t\t// 重连成功发送残留封包\r\n\t\tfor (var index = 0; index < lostCount; index++){\r\n\t\t\tvar req = this.losts[index];\r\n\t\t\tif (this.IsDevelopment()) {\r\n\t\t\t\tthis.NetLog(\"[SendLost](%s):\", req.head.event, req.param, \"b-g\");\r\n\t\t\t}\r\n\t\t\tthis.write(req.head, req.param);\r\n\t\t}\r\n\t\tthis.losts = [];\r\n\t},\r\n\r\n\t//追加丢失的封包\r\n\tAddLostPack:function(head, sendPack){\r\n\t\tlet eventName = head.event;\r\n\r\n\t\tlet lostCount = this.losts.length;\r\n\t\tfor(let index=0; index<lostCount; index++){\r\n\t\t\tvar req = this.losts[index];\r\n\t\t\t//存在相同的封包,过滤???\r\n\t\t\tif(req[\"head\"][\"event\"] == eventName){\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.losts.push({ head: head, param: sendPack });\r\n\t},\r\n\r\n\t// 发送封包请求 可以携带callback，errorCallback回调\r\n\tRequest:function(eventName, sendPack, callback=null, errorCallback=null) {\r\n\t\teventName = eventName.toLocaleLowerCase();\r\n\r\n\t\t// 发送请求\r\n\t\tlet req = this.GetNewRequest();\r\n\t\treq.event = eventName;\r\n\t\treq.param = sendPack;\r\n\t\treq.callback = callback;\r\n\t\treq.errcb = errorCallback;\r\n\r\n\t\tthis.requests[req.id] = req;\r\n\r\n\t\tvar head = {\r\n\t\t\t\t\t\tmessageType: MessageType.Request,\r\n\t\t\t\t\t\tevent: eventName,\r\n\t\t\t\t\t\tsequence: req.id\r\n\t\t\t\t\t};\r\n\r\n\t\tif (this.Connected()) {\r\n\t\t\t//如果还在重连建立中,积压封包\r\n\t\t\tif(this.isReconnecting){\r\n\t\t\t\tthis.AddLostPack(head, sendPack);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif(this.IsDevelopment()){\r\n\t\t\t\t\tthis.NetLog(\"[Send](%s) : \", eventName, sendPack, \"b-g\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.write(head, sendPack);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\t//如果成功开启重连,则积压封包\r\n\t\t\tif(this.ReConnect()){\r\n\t\t\t\tthis.AddLostPack(head, sendPack);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//关闭模态层\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t//通知服务器\r\n\tNotify:function(eventName, sendPack){\r\n\t\teventName = eventName.toLocaleLowerCase();\r\n\t\tvar head = {\r\n\t\t\tmessageType: MessageType.Notify,\r\n\t\t\tevent: eventName,\r\n\t\t\tsequence: 0\r\n\t\t};\r\n\r\n\t\tif (this.Connected()) {\r\n\t\t\t//如果还在重连建立中,积压封包\r\n\t\t\tif(this.isReconnecting){\r\n\t\t\t\tthis.AddLostPack(head, sendPack);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tif (this.IsDevelopment()) {\r\n\t\t\t\t\tthis.NetLog(\"[Notify](%s) : \", eventName, sendPack, \"b-g\");\r\n\t\t\t\t}\r\n\t\t\t\tthis.write(head, sendPack);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse{\r\n\t\t\t//如果成功开启重连,则积压封包\r\n\t\t\tif(this.ReConnect()){\r\n\t\t\t\tthis.AddLostPack(head, sendPack);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//关闭模态层\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\t// 发送数据/* head:{ messageType: number, event: string, sequence: number }*/\r\n\twrite:function(head, message) {\r\n\t\t//this.Log(\"write:%s\", head.event);\r\n\t\ttry{\r\n\t\t\tvar strMsg = JSON.stringify(message);\r\n\t\t}\r\n\t\tcatch (error){\r\n\t\t\tconsole.error(\"write error:%s \", error.stack);\r\n\t\t\treturn\r\n\t\t}\r\n        var length = 1 + 2 + 2 + head.event.length * 3 + 2 + strMsg.length * 3;\r\n        // console.log('[send]: length %s, event:%s, length:%s, msg:%s, length:%s', length, head.event, strMsg, head.event.length, strMsg.length);\r\n\t\tvar byte = new EgretWriteByteArray(length);\r\n\t\t//创建 ByteArray 对象\r\n\t\tbyte.writeByte(head.messageType);//消息类型\r\n\t\tbyte.writeShort(head.sequence);//消息序列号\r\n\t\tbyte.writeUTF(head.event);//数据类型\r\n\t\tbyte.writeUTF(strMsg);//消息体\r\n\t\t//发送数据\r\n\t\tthis.socket.send(byte.getBuffer());\r\n\t},\r\n})\r\n\r\n\r\nvar g_sss_NetWork = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_sss_NetWork){\r\n\t    g_sss_NetWork = new sss_NetWork();\r\n    }\r\n    return g_sss_NetWork;\r\n}"]}