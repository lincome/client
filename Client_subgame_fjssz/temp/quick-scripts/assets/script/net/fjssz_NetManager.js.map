{"version":3,"sources":["fjssz_NetManager.js"],"names":["app","require","emitter","fjssz_NetManager","BaseClass","extend","Init","JS_Name","ShareDefine","subGameName","SysDataManager","NetWork","httpRequest","ComTool","NewSysMsg","GetTableDict","H5ClientStartUrl","InitServerAddress","InitHttpPack","RegNetPack","OnPack_GMPack","RetryTime","OnReload","InitConnectAccountID","accountID","InitConnectInfo","clientConfig","GetClientConfig","AccountServerUrl","join","OrderServerUrl","ResServerUrl","gateServerInfo","SysLog","SetGateServerAddress","gateServerIP","gateServerPort","console","error","LocalDataManager","GetConfigProperty","OnEvent","SetServerAddress","gameServerIP","gameServerPort","dbGameServerInfo","SetConfigProperty","RefreshClientConfig","SetAccountAddress","accountServerIP","serverServerPort","dbAccountServerInfo","SetResAddress","resServerIP","dbResServerInfo","SetOrderAddress","orderServerIP","dbOrderServerInfo","SetH5ClientStartUrl","h5ClientStartUrl","sendHttpPackDict","packReceiveServerTypeDict","ClientHttpPackDict","packHeadName","headNameList","split","length","headInt","Math","floor","hasOwnProperty","InitConnectServer","InitWebSocket","OnWebSocketEvent","bind","OnConnectSuccess","GetUrlStr","dataDict","urlSendStr","key","substring","GetHttpSendPack","head","GetHttpSendPackUrl","serverType","url","GetH5ClientStartUrl","GetResServerHttpAddress","SendReConnect","eventName","sendPack","RequestReConnect","SendPack","callback","data","log","errorCallback","Request","SendPackOnly","NotifyPack","Notify","func","target","toLocaleLowerCase","valueType","Object","prototype","toString","call","slice","on","UnRegNetPack","off","UnAllRegNetPack","removeAllListeners","isReconnecting","arg","ReConnect","ShowSysMsg","OnReceive","OnCodeError","OnGMReceive","OnConFirm","clickType","msgID","backArgList","ShowForm","CloseForm","routeName","receivePack","emit","stack","JSON","stringify","code","resultInfo","codeMsg","ErrorSysMsg","InOtherRoomPlay","ExitGame","ResetRoomInfo","roomID","toUpperCase","GetEnterRoomID","SendGetRoomInfo","Maintain","finishttime","GetDateYearMonthDayHourMinuteString","ErrorNotRoomCard","desc","GetSysMsgContentByMsgID","SetWaitForConfirmForm","ConfirmBuyGoTo","ErrorMaxRoom","ErrorNotQuanCard","GetFormComponentByFormName","OnClick","errorMsg","IsDevelopment","NoShowSysMsgCodeList","InArray","argDict","RegHttpNetPack","UnRegHttpNetPack","SendHttpPack","serverUrl","Head","argString","NetLog","SendHttpRequest","OnReceiveHttpPack","httpResText","parse","OnConnectHttpFail","readyState","status","UpdateAccessPoint","AccountServerUrlHttps","Disconnect","byLogout","SendGMPack","cmdString","serverPack","g_fjssz_NetManager","exports","GetModel"],"mappings":"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","file":"fjssz_NetManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\net","sourcesContent":["/*\r\n    网络通信管理器\r\n*/\r\nvar app = require(\"fjssz_app\");\r\nvar emitter = require(\"fjssz_emitter\");\r\n\r\nvar fjssz_NetManager = app.BaseClass.extend({\r\n\r\n\tInit: function () {\r\n\t\tthis.JS_Name = app[\"subGameName\"] + \"_NetManager\";\r\n\r\n\t\tthis.emitter = new emitter();\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.NetWork = app[app.subGameName + \"_NetWork\"]();\r\n\t\tthis.httpRequest = app[app.subGameName + \"_NetRequest\"]();\r\n\t\tthis.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n\r\n\t\tthis.NewSysMsg = this.SysDataManager.GetTableDict(\"NewSysMsg\");\r\n\r\n\t\t//h5客户端启动url\r\n\t\tthis.H5ClientStartUrl = \"\";\r\n\r\n\t\tthis.InitServerAddress();\r\n\r\n\t\tthis.InitHttpPack();\r\n\r\n\t\tthis.RegNetPack(\"game.C1105GMPack\", this.OnPack_GMPack, this);\r\n\r\n\t\tthis.RetryTime = 0;\r\n\t},\r\n\r\n\t//切换账号\r\n\tOnReload: function () {\r\n\t\tthis.NetWork.OnReload();\r\n\t},\r\n\r\n\t//初始化连接\r\n\tInitConnectAccountID: function (accountID) {\r\n\t\tthis.NetWork.InitConnectInfo(accountID);\r\n\t},\r\n\r\n\t//初始化连接的服务器地址\r\n\tInitServerAddress: function () {\r\n\r\n\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\r\n\t\tthis.AccountServerUrl = ['http://', clientConfig[\"AccountServerIP\"], \":\", clientConfig[\"AccountServerPort\"], \"/ClientPack\"].join(\"\");\r\n\r\n\t\t//this.AccountServerUrlHttps = ['https://', clientConfig[\"AccountServerIP\"], \":\", clientConfig[\"AccountServerPort\"].toString()+'0', \"/ClientPack\"].join(\"\");\r\n\r\n\r\n\t\tthis.OrderServerUrl = ['http://', clientConfig[\"OrderServerIP\"], \":\", clientConfig[\"OrderServerPort\"], \"/ClientPack\"].join(\"\");\r\n\r\n\t\tthis.ResServerUrl = ['http://', clientConfig[\"ResServerIP\"], \":\", clientConfig[\"ResServerPort\"], \"/ClientPack\"].join(\"\");\r\n\r\n\t\tlet gateServerInfo = app[\"GateServerInfo\"];\r\n\r\n\t\tthis.SysLog(\"AccountServer(%s)\", this.AccountServerUrl, \"b-g\");\r\n\t\tthis.SysLog(\"OrderServer(%s)\", this.OrderServerUrl, \"b-g\");\r\n\t\tthis.SysLog(\"ResServerUrl(%s)\", this.ResServerUrl, \"b-g\");\r\n\t\tthis.SysLog(\"Server(%s:%s)\", clientConfig[\"GameServerIP\"], clientConfig[\"GameServerPort\"], \"b-g\");\r\n\t},\r\n\r\n\t//设置首次连接服务器IP\r\n\tSetGateServerAddress: function (gateServerIP, gateServerPort) {\r\n\t\tif (!gateServerIP || !gateServerPort) {\r\n\t\t\tconsole.error(\"SetGateServerAddress(%s,%s) error\", gateServerIP, gateServerPort);\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//更新内存\r\n\t\tlet gateServerInfo = app[\"GateServerInfo\"];\r\n\t\tgateServerInfo[\"GateServerIP\"] = gateServerIP;\r\n\t\tgateServerInfo[\"GateServerPort\"] = gateServerPort;\r\n\r\n\t\t//修改本地数据库\r\n\t\tapp.LocalDataManager().GetConfigProperty(\"DebugInfo\", \"GateServerInfo\", gateServerInfo);\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"OnGateServerChangeIP\", null);\r\n\t},\r\n\r\n\t//设置服务器连接IP地址\r\n\tSetServerAddress: function (gameServerIP, gameServerPort) {\r\n\r\n\t\tif (!gameServerIP || !gameServerPort) {\r\n\t\t\tconsole.error(\"SetServerAddress(%s,%s) error\", gameServerIP, gameServerPort);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//保存到本地数据库\r\n\t\tlet LocalDataManager = app.LocalDataManager();\r\n\t\tlet dbGameServerInfo = {\r\n\t\t\t\"GameServerIP\": gameServerIP,\r\n\t\t\t\"GameServerPort\": gameServerPort,\r\n\t\t}\r\n\t\tLocalDataManager.SetConfigProperty(\"DebugInfo\", \"GameServerInfo\", dbGameServerInfo);\r\n\r\n\t\t//修改内存中缓存的字典\r\n\t\tapp[app.subGameName + \"Client\"].RefreshClientConfig()\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"OnChangeIP\", null);\r\n\t},\r\n\tSetAccountAddress: function (accountServerIP, serverServerPort) {\r\n\t\tif (!accountServerIP || !serverServerPort) {\r\n\t\t\tconsole.error(\"SetAccountAddress(%s,%s) error\", accountServerIP, serverServerPort);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.AccountServerUrl = ['http://', accountServerIP, \":\", serverServerPort, \"/ClientPack\"].join(\"\");\r\n\t\t//this.AccountServerUrlHttps = ['https://', accountServerIP, \":\", serverServerPort.toString()+'0', \"/ClientPack\"].join(\"\");\r\n\r\n\t\t//保存到本地数据库\r\n\t\tlet LocalDataManager = app.LocalDataManager();\r\n\t\tlet dbAccountServerInfo = {\r\n\t\t\t\"AccountServerIP\": accountServerIP,\r\n\t\t\t\"AccountServerPort\": serverServerPort,\r\n\t\t}\r\n\t\tLocalDataManager.SetConfigProperty(\"DebugInfo\", \"AccountServerInfo\", dbAccountServerInfo);\r\n\r\n\t\t//修改内存中缓存的字典\r\n\t\tapp[app.subGameName + \"Client\"].RefreshClientConfig()\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"OnChangeIP\", null);\r\n\t},\r\n\tSetResAddress: function (resServerIP, serverServerPort) {\r\n\t\tif (!resServerIP || !serverServerPort) {\r\n\t\t\tconsole.error(\"SetResAddress(%s,%s) error\", resServerIP, serverServerPort);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.ResServerUrl = ['http://', resServerIP, \":\", serverServerPort, \"/ClientPack\"].join(\"\");\r\n\r\n\t\t//保存到本地数据库\r\n\t\tlet LocalDataManager = app.LocalDataManager();\r\n\t\tlet dbResServerInfo = {\r\n\t\t\t\"ResServerIP\": resServerIP,\r\n\t\t\t\"ResServerPort\": serverServerPort,\r\n\t\t}\r\n\t\tLocalDataManager.SetConfigProperty(\"DebugInfo\", \"ResServerInfo\", dbResServerInfo);\r\n\r\n\t\t//修改内存中缓存的字典\r\n\t\tapp[app.subGameName + \"Client\"].RefreshClientConfig()\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"OnChangeIP\", null);\r\n\t},\r\n\tSetOrderAddress: function (orderServerIP, serverServerPort) {\r\n\t\tif (!orderServerIP || !serverServerPort) {\r\n\t\t\tconsole.error(\"SetOrderAddress(%s,%s) error\", orderServerIP, serverServerPort);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.OrderServerUrl = ['http://', orderServerIP, \":\", serverServerPort, \"/ClientPack\"].join(\"\");\r\n\r\n\t\t//保存到本地数据库\r\n\t\tlet LocalDataManager = app.LocalDataManager();\r\n\t\tlet dbOrderServerInfo = {\r\n\t\t\t\"OrderServerIP\": orderServerIP,\r\n\t\t\t\"OrderServerPort\": serverServerPort,\r\n\t\t}\r\n\t\tLocalDataManager.SetConfigProperty(\"DebugInfo\", \"OrderServerInfo\", dbOrderServerInfo);\r\n\r\n\t\t//修改内存中缓存的字典\r\n\t\tapp[app.subGameName + \"Client\"].RefreshClientConfig()\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"OnChangeIP\", null);\r\n\t},\r\n\r\n\r\n\t//设置资源服务器地址\r\n\tSetH5ClientStartUrl: function (h5ClientStartUrl) {\r\n\t\tthis.H5ClientStartUrl = h5ClientStartUrl;\r\n\t},\r\n\r\n\r\n\t//初始化http封包\r\n\tInitHttpPack: function () {\r\n\t\t//输出发送封包字典\r\n\t\t// {\r\n\t\t//     0xFF00:packName\r\n\t\t// }\r\n\t\tthis.sendHttpPackDict = {};\r\n\r\n\t\t//封包发送到那个服务器\r\n\t\t// {\r\n\t\t//     0xFF00:account,\r\n\t\t// }\r\n\t\tthis.packReceiveServerTypeDict = {};\r\n\r\n\t\tlet ClientHttpPackDict = app[app.subGameName + \"_HttpPack\"]().ClientHttpPackDict;\r\n\r\n\t\tfor (let packHeadName in ClientHttpPackDict) {\r\n\t\t\tlet headNameList = packHeadName.split(\".\");\r\n\t\t\tif (headNameList.length != 3) {\r\n\t\t\t\tconsole.error(\"InitHttpPack ClientHttpPackDict packHeadName:%s error\", packHeadName);\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tlet headInt = Math.floor(headNameList[1]);\r\n\r\n\t\t\tif (this.sendHttpPackDict.hasOwnProperty(headInt)) {\r\n\t\t\t\tconsole.error(\"InitHttpPack sendHttpPackDict have find(%s) headInt\", packHeadName);\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tthis.sendHttpPackDict[headInt] = ClientHttpPackDict[packHeadName];\r\n\r\n\t\t\tthis.packReceiveServerTypeDict[headInt] = headNameList[2];\r\n\t\t}\r\n\t},\r\n\r\n\t//初始化连接\r\n\tInitConnectServer: function () {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"OpenNet\");\r\n\r\n\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\r\n\t\tlet gameServerIP = clientConfig[\"GameServerIP\"];\r\n\t\tlet gameServerPort = clientConfig[\"GameServerPort\"];\r\n\r\n\t\t//初始化连接服务器\r\n\t\tthis.NetWork.InitWebSocket(gameServerIP, gameServerPort, this.OnWebSocketEvent.bind(this), this.OnConnectSuccess.bind(this));\r\n\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * 获取url字符串格式\r\n\t * @param dataDict\r\n\t * @returns {String}\r\n\t */\r\n\tGetUrlStr: function (dataDict) {\r\n\r\n\t\tif (!dataDict) {\r\n\t\t\treturn \"\"\r\n\t\t}\r\n\t\tvar urlSendStr = '?';\r\n\t\tfor (var key in dataDict) {\r\n\t\t\turlSendStr += key + '=' + dataDict[key] + '&';\r\n\t\t}\r\n\t\t//去掉最后一个&\r\n\t\turlSendStr = urlSendStr.substring(0, urlSendStr.length - 1);\r\n\r\n\t\treturn urlSendStr;\r\n\t},\r\n\r\n\t//获取http请求发送的封包\r\n\tGetHttpSendPack: function (head) {\r\n\t\tif (!this.sendHttpPackDict.hasOwnProperty(head)) {\r\n\t\t\tconsole.error(\"GetHttpSendPack sendHttpPackDict not find:%s\", head);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn {\"Head\": head}\r\n\t},\r\n\r\n\t//获取http封包发送的目的地地址\r\n\tGetHttpSendPackUrl: function (head) {\r\n\t\tlet serverType = this.packReceiveServerTypeDict[head];\r\n\t\tif (!serverType) {\r\n\t\t\tconsole.error(\"GetHttpSendPackUrl(%s) not find\", head);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tlet url = \"\";\r\n\t\tswitch (serverType) {\r\n\t\t\tcase \"account\":\r\n\t\t\t\turl = this.AccountServerUrl;\r\n\t\t\t\tbreak\r\n\t\t\tcase \"order\":\r\n\t\t\t\turl = this.OrderServerUrl;\r\n\t\t\t\tbreak\r\n\t\t\tcase \"res\":\r\n\t\t\t\turl = this.ResServerUrl;\r\n\t\t\t\tbreak\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(\"GetHttpSendPackUrl serverType:%s error\", serverType);\r\n\t\t\t\tbreak\r\n\t\t}\r\n\r\n\t\treturn url\r\n\t},\r\n\r\n\t//获取客户端启动后的html地址串\r\n\tGetH5ClientStartUrl: function () {\r\n\t\treturn this.H5ClientStartUrl\r\n\t},\r\n\r\n\t//获取客户端资源服务器HTTP地址\r\n\tGetResServerHttpAddress: function () {\r\n\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\t\treturn ['http://', clientConfig[\"ResServerIP\"], \":\", clientConfig[\"ResServerPort\"]].join(\"\");\r\n\t},\r\n\r\n\t//-------------websocket请求------------------\r\n\t//系统自主发送重连请求\r\n\tSendReConnect: function (eventName, sendPack) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"OpenNet\");\r\n\t\tthis.NetWork.RequestReConnect(eventName, sendPack)\r\n\t},\r\n\t//向服务器发起请求\r\n\tSendPack: function (eventName, sendPack, callback = (data) => {\r\n\t\tconsole.log(\"发起成功：\", data)\r\n\t}, errorCallback = (error) => {\r\n\t\tconsole.log(\"发起失败：\", error)\r\n\t}) {\r\n\t\tif (eventName != \"heartBeat.CHeartBeatHandler\") {\r\n\t\t\tconsole.log(\"向服务器发起请求\", eventName, sendPack);\r\n\t\t}\r\n\t\t//开启模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"OpenNet\");\r\n\t\tthis.NetWork.Request(eventName, sendPack, callback, errorCallback);\r\n\t},\r\n\r\n\t//向服务器发起请求,不触发网络\r\n\tSendPackOnly: function (eventName, sendPack, callback = null, errorCallback = null) {\r\n\t\tthis.NetWork.Request(eventName, sendPack, callback, errorCallback);\r\n\t},\r\n\r\n\t//通知服务器得封包数据\r\n\tNotifyPack: function (eventName, sendPack) {\r\n\t\tthis.NetWork.Notify(eventName, sendPack);\r\n\t},\r\n\r\n\t//注册封包事件(需要字符串封包头,才可以避免RegHttpNetPack相同封包头注册事件区分)\r\n\tRegNetPack: function (head, func, target) {\r\n\t\thead = head.toLocaleLowerCase();\r\n\t\tlet valueType = Object.prototype.toString.call(head).slice(\"[object \".length, -1);\r\n\t\tif (valueType != \"String\") {\r\n\t\t\tconsole.error(\"RegNetPack need String head\");\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (!func || !target) {\r\n\t\t\tconsole.error(\"RegNetPack head:%s error\", head);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.emitter.on(head, func, target);\r\n\t},\r\n\r\n\t//取消封包注册\r\n\tUnRegNetPack: function (eventName, func) {\r\n\t\tthis.emitter.off(eventName, func);\r\n\t},\r\n\r\n\t//取消所有封包注册\r\n\tUnAllRegNetPack: function () {\r\n\t\tthis.emitter.removeAllListeners();\r\n\t},\r\n\r\n\t//服务器连接成功\r\n\tOnConnectSuccess: function (isReconnecting) {\r\n\t\t//关闭模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(app.subGameName + \"_ConnectSuccess\", {\r\n\t\t\t\"ServerName\": \"GameServer\",\r\n\t\t\t\"IsReconnecting\": isReconnecting\r\n\t\t});\r\n\t},\r\n\t//websocket事件回掉\r\n\tOnWebSocketEvent: function (eventName, arg) {\r\n\t\t// console.log(\"子游戏 OnWebSocketEvent 回调\");\r\n\t\t//关闭模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\r\n\t\tswitch (eventName) {\r\n\t\t\tcase \"OnError\":\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ConnectFail\", {\r\n\t\t\t\t\t\"ServerName\": \"GameServer\",\r\n\t\t\t\t\t\"EventType\": \"OnError\"\r\n\t\t\t\t});\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"Reconnectd\":\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"StartReConnect\");\r\n\t\t\t\tthis.NetWork.ReConnect();\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OnClose\":\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ConnectFail\", {\r\n\t\t\t\t\t\"bCloseByLogout\": arg[0],\r\n\t\t\t\t\t\"ServerName\": \"GameServer\",\r\n\t\t\t\t\t\"EventType\": \"OnClose\"\r\n\t\t\t\t});\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OnKick\":\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Kick_ByServer\");\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OnReceive\":\r\n\t\t\t\tthis.OnReceive(arg[0], arg[1]);\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OnCodeError\":\r\n\t\t\t\tthis.OnCodeError(arg[0], arg[1], arg[2]);\r\n\t\t\t\tbreak\r\n\r\n\t\t\tcase \"OnGMReceive\":\r\n\t\t\t\tthis.OnGMReceive(arg[0], arg[1]);\r\n\t\t\t\tbreak\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(\"OnWebSocketEvent(%s):\", eventName, arg);\r\n\t\t\t\tbreak\r\n\t\t}\r\n\t},\r\n\r\n\tOnConFirm: function (clickType, msgID, backArgList) {\r\n\t\tif (clickType != \"Sure\") {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (\"goBuyCard\" == msgID) {\r\n\t\t\tlet clientConfig = app[app.subGameName + \"Client\"].GetClientConfig();\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm(\"UIStore\");\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(\"UIJoin\");\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(\"UIChouJiang\");\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().CloseForm(\"game/base/ui/majiang/UIMJResultDetail\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t},\r\n\r\n\t//封包事件回掉\r\n\tOnReceive:function(routeName, receivePack){\r\n\t\tif (routeName != \"splayerheartbeat\" && routeName != \"heartbeat.cheartbeathandler\") {\r\n\t\t\tconsole.log(\"封包事件回掉\", routeName, receivePack);\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tthis.emitter.emit(routeName, receivePack);\r\n\t\t}\r\n\t\tcatch(error){\r\n\t\t\tconsole.error(\"OnReceive:%s\", error.stack);\r\n\t\t\tconsole.error(\"OnReceive routeName :%s, receivePack:%s\", routeName, JSON.stringify(receivePack));\r\n\t\t}\r\n\t},\r\n\r\n\t//封包事件失败回掉\r\n\tOnCodeError: function (eventName, code, resultInfo) {\r\n\t\tlet codeMsg = [\"Code\", code].join(\"_\");\r\n\r\n\t\t//如果是错误提示类型,根据提示码提示,直接提示\r\n\t\tif (code == this.ShareDefine.ErrorSysMsg) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(resultInfo[\"Msg\"]);\r\n\t\t}\r\n\t\t// else if(code == this.ShareDefine.NotAllow){\r\n\t\t// app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_SERVICE_NOTALLOW');\r\n\t\t// }\r\n\t\telse if (code == this.ShareDefine.InOtherRoomPlay) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('MSG_IN_OTHER_ROOM_PLAY');\r\n\t\t}\r\n\t\telse if (code == 12) {\r\n\t\t\tapp[app.subGameName + \"Client\"].ExitGame();\r\n\t\t}\r\n\t\t//继续游戏失败\r\n        else if(code == this.ShareDefine.ResetRoomInfo){\r\n        \tlet roomID = app[app.subGameName.toUpperCase() + \"RoomMgr\"]().GetEnterRoomID();\r\n        \tif(roomID){\r\n        \t\t app[app.subGameName.toUpperCase() + \"RoomMgr\"]().SendGetRoomInfo(roomID);\r\n        \t}\r\n        }\r\n\t\telse if (code == this.ShareDefine.Maintain) {\r\n\t\t\tlet finishttime = resultInfo[\"Msg\"];\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('服务器维护中,预计结束时间：' + app[app.subGameName + \"_ComTool\"]().GetDateYearMonthDayHourMinuteString(finishttime));\r\n\t\t}\r\n\t\telse if (code == this.ShareDefine.ErrorNotRoomCard) {//房卡不足\r\n\t\t\tlet desc = app[app.subGameName + \"_SysNotifyManager\"]().GetSysMsgContentByMsgID(\"MSG_NotRoomCard\");\r\n\t\t\tapp[app.subGameName + \"_ConfirmManager\"]().SetWaitForConfirmForm(this.OnConFirm.bind(this), \"goBuyCard\", []);\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm(app.subGameName + \"_UIMessage\", null, this.ShareDefine.ConfirmBuyGoTo, 0, 0, desc)\r\n\t\t}\r\n\t\telse if (code == this.ShareDefine.ErrorMaxRoom) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('可以创建的房间数量不足');\r\n\t\t} else if (code == 308) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"只有一人无法换座或观战\");\r\n\t\t}\r\n\t\telse if (code == 5004) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"没有空闲的座位了\");\r\n\t\t}\r\n\t\telse if (code == this.ShareDefine.ErrorNotQuanCard) {//圈币不足\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg('圈卡不足，请前往亲友圈商城购买圈卡');\r\n\t\t\tapp[app.subGameName + \"_FormManager\"]().GetFormComponentByFormName(\"ui/club/UIClub\").OnClick('btn_addRoomCard', null);\r\n\t\t}\r\n\t\t//如果有配置系统提示码,则提示错误提示码对应的文本\r\n\t\telse if (this.NewSysMsg.hasOwnProperty(codeMsg)) {\r\n\r\n\t\t\tlet errorMsg = resultInfo[\"Msg\"];\r\n\t\t\t//开发模式有 提示文本的话 显示错误文本\r\n\t\t\tif (this.ShareDefine.IsDevelopment && errorMsg) {\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"CodeErrorMsg\", [errorMsg]);\r\n\t\t\t}\r\n\t\t\t//如果不是开发模式,弹通用的系统提示\r\n\t\t\telse {\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(codeMsg);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//如果配置表没有配置的错误码\r\n\t\telse {\r\n\t\t\t//如果是不需要提示的,不配置也不需要显示的系统提示码\r\n\t\t\tif (this.ShareDefine.NoShowSysMsgCodeList.InArray(code)) {\r\n\r\n\t\t\t}\r\n\t\t\t//没有配置,是开发模式弹框\r\n\t\t\telse if (this.ShareDefine.IsDevelopment) {\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"CodeErrorMsg\", [resultInfo[\"Msg\"]]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"CodeError\", {\r\n\t\t\t\"Code\": code,\r\n\t\t\t\"EventName\": eventName,\r\n\t\t\t\"Result\": resultInfo\r\n\t\t});\r\n\t},\r\n\r\n\t//接受到GM命令汇报\r\n\tOnGMReceive: function (eventName, argDict) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ReceiveGM\", argDict);\r\n\t},\r\n\r\n\t//------------------http请求--------------------------------\r\n\r\n\t//注册http封包事件(需要整形封包头,才可以避免RegNetPack相同封包头注册事件区分)\r\n\tRegHttpNetPack: function (head, func, target) {\r\n\t\tlet valueType = Object.prototype.toString.call(head).slice(\"[object \".length, -1);\r\n\t\tif (valueType != \"Number\") {\r\n\t\t\tconsole.error(\"RegNetPack need Int head\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\thead = head.toString();\r\n\t\tthis.emitter.on(head, func, target);\r\n\t},\r\n\r\n\tUnRegHttpNetPack: function (head, func) {\r\n\t\tlet valueType = Object.prototype.toString.call(head).slice(\"[object \".length, -1);\r\n\t\tif (valueType != \"Number\") {\r\n\t\t\tconsole.error(\"UnRegHttpNetPack need Int head\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\thead = head.toString();\r\n\t\tthis.emitter.off(head, func);\r\n\t},\r\n\r\n\t//发送HTTP请求\r\n\tSendHttpPack: function (sendPack) {\r\n\t\tconsole.log(\"sendPack:\", sendPack);\r\n\t\tlet serverUrl = this.GetHttpSendPackUrl(sendPack.Head);\r\n\t\tif (!serverUrl) {\r\n\t\t\tconsole.error(\"SendHttpPack(%s) not find serverUrl\", sendPack);\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//开启模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"OpenNet\");\r\n\t\tlet argDict = {\"Sign\": \"ddcat\"};\r\n\t\tlet argString = this.GetUrlStr(argDict);\r\n\r\n\t\tif (this.IsDevelopment()) {\r\n\t\t\tthis.NetLog(\"[SendHttp](%s):\", serverUrl, sendPack, \"b-g\");\r\n\t\t}\r\n\t\tthis.sendPack = sendPack;\r\n\t\tthis.httpRequest.SendHttpRequest(serverUrl, argString, \"POST\", sendPack);\r\n\t},\r\n\r\n\t//发送HTTPS请求\r\n\t/*SendHttpsPack:function(){\r\n\t\tlet sendPack=this.sendPack;\r\n\t\tlet serverUrl=this.AccountServerUrlHttps;\r\n\t\tif(!serverUrl){\r\n\t\t\tconsole.error(\"SendHttpPacks(%s) not find serverUrl\", sendPack);\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//开启模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"OpenNet\");\r\n\t\tlet argDict = {\"Sign\":\"ddcat\"};\r\n\t\tlet argString = this.GetUrlStr(argDict);\r\n\r\n\t\tif(this.IsDevelopment()){\r\n\t\t\tthis.NetLog(\"[SendHttps](%s):\", serverUrl, sendPack, \"b-g\");\r\n\t\t}\r\n\r\n\t\tthis.httpRequest.SendHttpRequest(serverUrl, argString, \"POST\", sendPack);\r\n\t},\r\n*/\r\n\t//接受到http请求回复\r\n\tOnReceiveHttpPack: function (serverUrl, httpResText) {\r\n\t\t//关闭模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\r\n\t\tvar receivePack = JSON.parse(httpResText);\r\n\t\tif (this.IsDevelopment()) {\r\n\t\t\tthis.NetLog(\"[RecvHttp]:\", receivePack, \"b-gb\");\r\n\t\t}\r\n\r\n\t\tif (receivePack.hasOwnProperty(\"code\")) {\r\n\t\t\tconsole.error(\"OnReceiveHttpPack HttpCode:\", receivePack);\r\n\r\n\t\t\tlet eventName = \"HttpRequestCode\";\r\n\t\t\tif (serverUrl == this.AccountServerUrl) {\r\n\t\t\t\teventName = \"AccountServerCode\";\r\n\t\t\t\tthis.OnCodeError(eventName, receivePack[\"code\"], receivePack);\r\n\t\t\t}\r\n\t\t\telse if (serverUrl == this.ResServerUrl) {\r\n\t\t\t\teventName = \"ResServerCode\";\r\n\t\t\t\tthis.OnCodeError(eventName, receivePack[\"code\"], receivePack);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.error(\"OnReceiveHttpPack serverUrl(%s) error\", serverUrl);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttry {\r\n\t\t\t\t//转化封包头为字符串 分发事件\r\n\t\t\t\tlet head = receivePack.Head.toString();\r\n\t\t\t\tthis.emitter.emit(head, receivePack);\r\n\t\t\t}\r\n\t\t\tcatch (error) {\r\n\t\t\t\tconsole.error(\"OnReceiveHttpPack(%s) error\", httpResText);\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t/**\r\n\t * 请求连接失败\r\n\t */\r\n\tOnConnectHttpFail: function (serverUrl, readyState, status) {\r\n\t\tconsole.error(\"HttpConnectFail(%s, %s,%s)\", serverUrl, readyState, status);\r\n\r\n\t\t//关闭模态层\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"ReceiveNet\");\r\n\r\n\t\tif (serverUrl == this.AccountServerUrl) {\r\n\t\t\t//app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Code_10010\");\r\n\t\t\t//app[app.subGameName + \"Client\"].OnEvent(\"ConnectHttpFail\", {\"ServerName\":\"AccountServer\"});\r\n\t\t\t//http请求失败，尝试用https请求\r\n\t\t\t//this.SendHttpsPack();\r\n\t\t\tif (this.RetryTime == 9) {\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Code_10010\");\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ConnectHttpFail\", {\"ServerName\": \"AccountServer\"});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//换节点\r\n\t\t\tapp[app.subGameName+\"_HeroAccountManager\"]().UpdateAccessPoint();\r\n\t\t\tthis.InitServerAddress();\r\n\t\t\tthis.SendHttpPack(this.sendPack);\r\n\t\t\tthis.RetryTime = this.RetryTime + 1;\r\n\t\t} else if (serverUrl == this.AccountServerUrlHttps) {\r\n\t\t\t/*if(this.RetryTime==5){\r\n\t\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Code_10010\");\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ConnectHttpFail\", {\"ServerName\":\"AccountServer\"});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//换节点\r\n\t\t\tapp[app.subGameName+\"_HeroAccountManager\"]().UpdateAccessPoint();\r\n\t\t\tthis.InitServerAddress();\r\n\t\t\tthis.SendHttpPack(this.sendPack);\r\n\t\t\tthis.RetryTime=this.RetryTime+1;*/\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(\"OnConnectHttpFail serverUrl:%s error\", serverUrl);\r\n\t\t}\r\n\t},\r\n\r\n\t//------------操作函数-----------------------------\r\n\r\n\t//下线\r\n\tDisconnect: function (byLogout = false) {\r\n\t\tthis.NetWork.Disconnect(byLogout);\r\n\t},\r\n\r\n\tSendGMPack: function (cmdString) {\r\n\t\tlet sendPack = {\"cmdString\": cmdString};\r\n\t\tthis.SendPack(\"game.C1105GMPack\", sendPack)\r\n\t},\r\n\r\n\tOnPack_GMPack: function (serverPack) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"GMPack\", serverPack);\r\n\t},\r\n\r\n});\r\n\r\nvar g_fjssz_NetManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_fjssz_NetManager) {\r\n\t\tg_fjssz_NetManager = new fjssz_NetManager();\r\n\t}\r\n\treturn g_fjssz_NetManager;\r\n}"]}