{"version":3,"sources":["fjssz_FormManager.js"],"names":["app","require","sss_FormManager","BaseClass","extend","Init","JS_Name","SysDataManager","subGameName","SceneInfo","GetTableDict","HeroManager","ShareDefine","SysNotifyManager","loadFormDict","showFormDict","createingFormDict","formWndShowInfo","defaultFormNameList","isCloseFunButton","InitData","Log","formPath2RealPath","formPath","indexOf","formPath2formName","split","length","CreateForm","formName","that","CreateLoadPromise","then","prefab","hasOwnProperty","formNode","cc","instantiate","formComponent","getComponent","ErrLog","OnCreate","catch","error","stack","ShowForm","argList","console","bluebird","resolve","shift","name","OnEvent","CloseFormReal","isDestory","CloseForm","ShowOrCloseForm","unshift","apply","GetFormComponentByFormName","IsFormShow","GetFormWndShowInfo","SetIsCloseFunButton","GetIsCloseFunButton","AddShowingForm","RemoveShowingForm","ShowFunWnd","node","wndInfo","heroLv","GetHeroProperty","passMaxTowerLv","wndPath","conditionInfo","wndParentPath","conditionType","conditionValue","showType","wndNode","find","wndParent","isOpen","FormWnd_NotShow","active","FormWnd_EffectLock","DeleteWndEffect","AddWndEffect","CheckFunButtonIsOpen","isNotify","ShowSysMsg","AddDefaultFormName","InArray","push","GetDefaultFormNameList","ClearDefaultFormNameList","OnBeforeExitScene","sceneName","isInArray","value","arrayList","i","LoadSceneDefaultForm","bluebirdList","loadFormNameList","NoAddScene","BaseForm","GamePrefab","gamePrefab","count","index","all","OnSwithSceneEnd","_isOrientationH","frameSize","view","getFrameSize","width","height","g_sss_FormManager","exports","GetModel"],"mappings":"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","file":"fjssz_FormManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["/*\r\n    场景管理器\r\n*/\r\n\r\nvar app = require(\"fjssz_app\");\r\n\r\nvar sss_FormManager = app.BaseClass.extend({\r\n\r\n\t//初始化\r\n\tInit: function () {\r\n\t\tthis.JS_Name = app[\"subGameName\"] + \"_FormManager\";\r\n\r\n\t\tlet SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.SceneInfo = app[app.subGameName + \"_SysDataManager\"]().GetTableDict(\"SceneInfo\");\r\n\r\n\t\tthis.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\r\n\t\t//已经创建的界面字典\r\n\t\tthis.loadFormDict = {};\r\n\r\n\t\tthis.showFormDict = {};\r\n\r\n\t\t//正在执行创建的界面\r\n\t\tthis.createingFormDict = {};\r\n\r\n\t\t//界面控件显示条件字典\r\n\t\t// {\r\n\t\t//     formName:{\r\n\t\t//         wndPath:{\"WndParentPath\":\"\",\"WndPath\":\"aaa/btn01\"}\r\n\t\t//     }\r\n\t\t// }\r\n\t\tthis.formWndShowInfo = {};\r\n\r\n\t\t//切换场景默认需要显示的界面\r\n\t\tthis.defaultFormNameList = [];\r\n\r\n\t\t//是否关闭功能控制\r\n\t\tthis.isCloseFunButton = false;\r\n\r\n\t\tthis.InitData();\r\n\r\n\t\tthis.Log(\"Init\");\r\n\t},\r\n\r\n\tInitData: function () {\r\n\r\n\t\t// for(let index in this.FormWndShowInfo){\r\n\t\t//     let formWndShowInfo = this.FormWndShowInfo[index];\r\n\t\t//     let formName = formWndShowInfo[\"FormName\"];\r\n\t\t//     let wndPath = formWndShowInfo[\"WndPath\"];\r\n\r\n\t\t//     let wndPathNameList = wndPath.split(\"/\");\r\n\r\n\t\t//     let wndParentPath = \"\";\r\n\r\n\t\t//     if(wndPathNameList.length == 1){\r\n\t\t//         wndParentPath = \"\";\r\n\t\t//     }\r\n\t\t//     else{\r\n\t\t//         wndParentPath = wndPathNameList.join(\"/\");\r\n\t\t//     }\r\n\r\n\t\t//     let wndInfo = this.formWndShowInfo.SetDefault(formName, {});\r\n\t\t//     if(wndInfo.hasOwnProperty(wndPath)){\r\n\t\t//         console.error(\"formWndShowInfo(%s) have find(%s)\", formName, wndPath);\r\n\t\t//         continue\r\n\t\t//     }\r\n\t\t//     wndInfo[wndPath] = {\r\n\t\t//                         \"ConditionType\":formWndShowInfo[\"ConditionType\"],\r\n\t\t//                         \"ConditionValue\":formWndShowInfo[\"ConditionValue\"],\r\n\t\t//                         \"ShowType\":formWndShowInfo[\"ShowType\"],\r\n\t\t//                         \"WndParentPath\":wndParentPath,\r\n\t\t//                     };\r\n\t\t// }\r\n\t},\r\n\tformPath2RealPath: function (formPath) {\r\n\t\tif (formPath.indexOf('/') < 1) {\r\n\t\t\treturn 'ui/' + formPath;\r\n\t\t}\r\n\t\treturn formPath;\r\n\t},\r\n\tformPath2formName: function (formPath) {\r\n\t\tif (formPath.indexOf('/') > -1) {\r\n\t\t\tlet split = formPath.split('/');\r\n\t\t\treturn split[(split.length) - 1];\r\n\t\t} else {\r\n\t\t\treturn formPath;\r\n\t\t}\r\n\t},\r\n\r\n\t//----------------操作接口--------------------\r\n\r\n\t//创建界面\r\n\tCreateForm: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\t// let formPath = \"\";\r\n\r\n\t\t// let promise = null;\r\n\t\t// for(let idx in this.folder){\r\n\t\t//     formPath = this.folder[idx].folderPath + formName;\r\n\t\t//     promise = app[app.subGameName + \"_ControlManager\"]().CreateLoadPromise(formPath);\r\n\t\t// }\r\n\r\n\t\tlet that = this;\r\n\t\treturn app[app.subGameName + \"_ControlManager\"]().CreateLoadPromise(formPath)\r\n\t\t\t.then(function (prefab) {\r\n\t\t\t\tif (that.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\t\t\tthat.Log(\"CreateForm(%s)重复创建界面\", formPath);\r\n\t\t\t\t\treturn that.loadFormDict[formPath];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet formNode = cc.instantiate(prefab);\r\n\t\t\t\t// for (var i = 0; i < formNode._components.length; i++) {\r\n\t\t\t\t//     console.log(\"CreateForm component Name:\" + formNode._components[i].name);\r\n\t\t\t\t// }\r\n\t\t\t\tlet formComponent = formNode.getComponent(formName);\r\n\t\t\t\tif (!formComponent) {\r\n\t\t\t\t\tthat.ErrLog(\"CreateForm(%s) not find Component\", formName);\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tformComponent.OnCreate(formName);\r\n\t\t\t\tthat.loadFormDict[formPath] = formNode;\r\n\t\t\t\treturn formComponent\r\n\r\n\t\t\t})\r\n\t\t\t.catch(function (error) {\r\n\t\t\t\tthat.ErrLog(\"CreateForm(%s) error:%s\", formName, error.stack);\r\n\t\t\t})\r\n\t},\r\n\t//显示界面\r\n\tShowForm: function (...argList) {\r\n\t\tif (!argList.length) {\r\n\t\t\tconsole.error(\"ShowForm Need FormName\");\r\n\t\t\treturn app.bluebird.resolve(null);\r\n\t\t}\r\n\t\tlet formPath = argList.shift();\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\t//如果已经加载过的界面,则设置界面显示\r\n\t\tif (this.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\tlet formNode = this.loadFormDict[formPath];\r\n\t\t\tif (!formNode) {\r\n\t\t\t\tconsole.error(\"ShowForm Error:formName %s\", formName);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (formNode.name != \"\") {\r\n\t\t\t\tlet formComponent = formNode.getComponent(formName);\r\n\t\t\t\tformComponent.ShowForm(argList);\r\n\t\t\t\treturn app.bluebird.resolve(formComponent);\r\n\t\t\t} else {\r\n\t\t\t\tdelete this.loadFormDict[formPath];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//如果已经在创建中\r\n\t\tif (this.createingFormDict.hasOwnProperty(formPath)) {\r\n\t\t\tconsole.error(\"ShowForm createingFormDict have find(%s)\", formName);\r\n\t\t\treturn app.bluebird.resolve(null);\r\n\t\t}\r\n\r\n\t\tthis.createingFormDict[formPath] = 1;\r\n\r\n\t\tlet that = this;\r\n\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n\t\treturn this.CreateForm(formPath)\r\n\t\t\t.then(function (formComponent) {\r\n\r\n\t\t\t\tdelete that.createingFormDict[formPath];\r\n\r\n\t\t\t\tif (formComponent) {\r\n\t\t\t\t\tformComponent.ShowForm(argList);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthat.ErrLog(\"CreateForm(%s) fail\", formPath);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n\r\n\t\t\t\treturn formComponent\r\n\t\t\t})\r\n\t\t\t.catch(function (error) {\r\n\t\t\t\tthat.ErrLog(\"ShowForm error:%s\", error.stack);\r\n\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n\t\t\t})\r\n\r\n\t},\r\n\tCloseFormReal: function (formPath, isDestory = false) {\r\n\t\tthis.CloseForm(formPath, isDestory);\r\n\t\tdelete this.loadFormDict[formPath];\r\n\t},\r\n\t//关闭界面\r\n\tCloseForm: function (formPath, isDestory = false) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tif (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\tthis.Log(\"CloseForm(%s) not load\", formPath);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet formNode = this.loadFormDict[formPath];\r\n\t\tif (!formNode) {\r\n\t\t\tconsole.error(\"CloseForm Error:formName %s\", formPath);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (formNode.name == \"\") {\r\n\t\t\tdelete this.loadFormDict[formPath];\r\n\t\t\treturn;\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet formComponent = formNode.getComponent(formName);\r\n\t\t\tif (formComponent) {\r\n\t\t\t\tformComponent.CloseForm(isDestory);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.error(\"CloseForm Error:formName %s,nodeName %s\", formName, formNode.name);\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(\"CloseForm Error:formName %s,nodeName %s formPath %s\", formName, formNode.name, formPath);\r\n\t\t}\r\n\t},\r\n\r\n\t//开启和关闭界面\r\n\tShowOrCloseForm: function (...argList) {\r\n\t\tif (!argList.length) {\r\n\t\t\tconsole.error(\"ShowOrCloseForm Need FormName\");\r\n\t\t\treturn false\r\n\t\t}\r\n\t\tlet formPath = argList.shift();\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tif (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\targList.unshift(formPath)\r\n\t\t\t//调用更新界面函数\r\n\t\t\tthis.ShowForm.apply(this, argList);\r\n\t\t\treturn true\r\n\t\t}\r\n\t\tlet formNode = this.loadFormDict[formPath];\r\n\t\tlet formComponent = formNode.getComponent(formName);\r\n\t\tformComponent.ShowOrCloseForm(argList);\r\n\t},\r\n\t//获取界面字典里的指定名字对象的同名脚本\r\n\tGetFormComponentByFormName: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tif (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\tthis.Log(\"GetFormComponentByFormName(%s) not load\", formPath);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.loadFormDict[formPath].getComponent(formName);\r\n\t},\r\n\r\n\t//界面是否显示中\r\n\tIsFormShow: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tif (!this.loadFormDict.hasOwnProperty(formPath)) {\r\n\t\t\tthis.Log(\"IsFormShow(%s) not load\", formPath);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\treturn this.loadFormDict[formPath].getComponent(formName).IsFormShow();\r\n\t},\r\n\r\n\t//获取界面控件显示条件字典\r\n\tGetFormWndShowInfo: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tif (this.isCloseFunButton) {\r\n\t\t\treturn {}\r\n\t\t}\r\n\r\n\t\tif (!this.formWndShowInfo.hasOwnProperty(formPath)) {\r\n\t\t\tthis.Log(\"GetFormWndShowInfo not find:%s\", formPath);\r\n\t\t\treturn {}\r\n\t\t}\r\n\t\treturn this.formWndShowInfo[formPath];\r\n\t},\r\n\r\n\r\n\tSetIsCloseFunButton: function () {\r\n\t\tthis.isCloseFunButton = !this.isCloseFunButton\r\n\t},\r\n\r\n\tGetIsCloseFunButton: function () {\r\n\t\treturn this.isCloseFunButton\r\n\t},\r\n\r\n\tAddShowingForm: function (formPath, formComponent) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tthis.showFormDict[formPath] = formComponent;\r\n\t},\r\n\r\n\tRemoveShowingForm: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tdelete this.showFormDict[formPath];\r\n\t},\r\n\r\n\t//显示界面控件功能函数\r\n\tShowFunWnd: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tformName = this.formPath2formName(formPath);\r\n\t\tlet formComponent = this.GetFormComponentByFormName(formName);\r\n\t\tif (!formComponent) {\r\n\t\t\tconsole.error(\"ShowFunWnd(%s) not find\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet node = formComponent.node;\r\n\r\n\t\tlet wndInfo = this.GetFormWndShowInfo(formPath);\r\n\t\tlet heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n\t\tlet passMaxTowerLv = 0;\r\n\r\n\t\tfor (let wndPath in wndInfo) {\r\n\r\n\t\t\tlet conditionInfo = wndInfo[wndPath];\r\n\r\n\t\t\tlet wndParentPath = conditionInfo[\"WndParentPath\"];\r\n\t\t\tlet conditionType = conditionInfo[\"ConditionType\"];\r\n\t\t\tlet conditionValue = conditionInfo[\"ConditionValue\"];\r\n\t\t\tlet showType = conditionInfo[\"ShowType\"];\r\n\r\n\t\t\tlet wndNode = cc.find(wndPath, node);\r\n\t\t\tif (!wndNode) {\r\n\t\t\t\tconsole.error(\"ShowFunWnd not find:%s\", wndPath);\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\r\n\t\t\tlet wndParent = \"\";\r\n\t\t\tif (!wndParentPath) {\r\n\t\t\t\twndParent = node;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\twndParent = cc.find(wndParentPath, node);\r\n\t\t\t\tif (!wndParent) {\r\n\t\t\t\t\tconsole.error(\"ShowFunWnd(%s) not find\", wndParentPath);\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet isOpen = false;\r\n\r\n\t\t\tif (conditionType == \"HeroLv\") {\r\n\t\t\t\tif (heroLv >= conditionValue) {\r\n\t\t\t\t\tisOpen = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tisOpen = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (conditionType == \"PassMaxTowerLv\") {\r\n\t\t\t\tif (passMaxTowerLv >= conditionValue) {\r\n\t\t\t\t\tisOpen = true;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tisOpen = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tisOpen = false\r\n\t\t\t}\r\n\r\n\t\t\tif (isOpen) {\r\n\r\n\t\t\t\tif (showType == this.ShareDefine.FormWnd_NotShow) {\r\n\t\t\t\t\twndNode.active = true;\r\n\t\t\t\t}\r\n\t\t\t\telse if (showType == this.ShareDefine.FormWnd_EffectLock) {\r\n\t\t\t\t\tformComponent.DeleteWndEffect(wndPath, \"FunLock\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.error(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (showType == this.ShareDefine.FormWnd_NotShow) {\r\n\t\t\t\t\twndNode.active = false;\r\n\t\t\t\t}\r\n\t\t\t\telse if (showType == this.ShareDefine.FormWnd_EffectLock) {\r\n\t\t\t\t\tformComponent.AddWndEffect(wndPath, \"FunLock\", \"Lock\");\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tconsole.error(\"wndPath(%s) showType:%s error\", wndPath, showType);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\tCheckFunButtonIsOpen: function (formPath, wndPath, isNotify = true) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tlet formName = this.formPath2formName(formPath);\r\n\t\tlet wndInfo = this.GetFormWndShowInfo(formPath);\r\n\t\tif (!wndInfo.hasOwnProperty(wndPath)) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\tlet conditionType = wndInfo[wndPath][\"ConditionType\"];\r\n\t\tlet conditionValue = wndInfo[wndPath][\"ConditionValue\"];\r\n\r\n\t\tlet heroLv = this.HeroManager.GetHeroProperty(\"lv\");\r\n\t\tlet passMaxTowerLv = 0;\r\n\r\n\t\tif (conditionType == \"PassMaxTowerLv\") {\r\n\t\t\tif (passMaxTowerLv >= conditionValue) {\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\tif (isNotify) {\r\n\t\t\t\tthis.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_PassMaxTowerLv\", [conditionValue - 1]);\r\n\t\t\t}\r\n\t\t\treturn false\r\n\t\t}\r\n\t\telse if (conditionType == \"HeroLv\") {\r\n\t\t\tif (heroLv >= conditionValue) {\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\tif (isNotify) {\r\n\t\t\t\tthis.SysNotifyManager.ShowSysMsg(\"FunBtnNotOpen_HeroLv\", [conditionValue]);\r\n\t\t\t}\r\n\t\t\treturn false\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(\"CheckFunButtonIsOpen(%s) conditionType:%s error\", wndPath, conditionType);\r\n\t\t\treturn false\r\n\t\t}\r\n\t},\r\n\r\n\t//增加默认显示的界面\r\n\tAddDefaultFormName: function (formPath) {\r\n\t\tformPath = this.formPath2RealPath(formPath);\r\n\t\tif (this.defaultFormNameList.InArray(formPath)) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.defaultFormNameList.push(formPath);\r\n\t},\r\n\r\n\tGetDefaultFormNameList: function () {\r\n\t\treturn this.defaultFormNameList;\r\n\t},\r\n\r\n\tClearDefaultFormNameList: function () {\r\n\t\tthis.defaultFormNameList = [];\r\n\t},\r\n\t//------------------回调函数--------------------------\r\n\r\n\t//开始切换场景\r\n\tOnBeforeExitScene: function (sceneName, isDestory = true) {\r\n\t\tthis.Log(\"OnBeforeExitScene(%s)\", sceneName);\r\n\t\t//关闭所有界面\r\n\t\tfor (let formPath in this.loadFormDict) {\r\n\t\t\tthis.CloseForm(formPath, isDestory);\r\n\t\t}\r\n\t},\r\n\tisInArray: function (value, arrayList) {\r\n\t\tlet length = arrayList.length;\r\n\t\tfor (let i = 0; i < length; i++) {\r\n\t\t\tif (value == arrayList[i]) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t},\r\n\tLoadSceneDefaultForm: function (sceneName) {\r\n\r\n\t\tthis.Log(\"LoadSceneDefaultForm(%s)\", sceneName);\r\n\r\n\t\tlet bluebirdList = [];\r\n\r\n\t\tlet loadFormNameList = [];\r\n\t\tlet NoAddScene = ['clubScene', 'fightScene', 'launchScene', 'loginScene', app.subGameName + 'MainScene']; //四个基础场景不用添加uimore，uimark\r\n\t\tlet BaseForm = [];\r\n\t\tif (this.isInArray(sceneName, NoAddScene) == false) {\r\n\t\t\t//添加游戏预制品\r\n\t\t\tlet GamePrefab = this.SceneInfo[sceneName].gamePrefab;\r\n\t\t\tif (GamePrefab == 0) {\r\n\t\t\t\tconsole.error(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\", sceneName, GamePrefab);\r\n\t\t\t}\r\n\t\t\tBaseForm.unshift(GamePrefab);\r\n\t\t\t//添加三个必须预制品\r\n\t\t\tfor (let i = 0; i < BaseForm.length; i++) {\r\n\t\t\t\tlet formName = BaseForm[i];\r\n\t\t\t\t//如果界面已经创建\r\n\t\t\t\tif (this.loadFormDict.hasOwnProperty(formName)) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\t\t\t\t//如果界面已经在创建中\r\n\t\t\t\tif (this.createingFormDict.hasOwnProperty(formName)) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\r\n\t\t\t\tloadFormNameList.push(formName);\r\n\t\t\t\tbluebirdList.push(this.CreateForm(formName));\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet count = this.defaultFormNameList.length;\r\n\t\tfor (let index = 0; index < count; index++) {\r\n\t\t\tlet formName = this.defaultFormNameList[index];\r\n\r\n\t\t\tif (loadFormNameList.InArray(formName)) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tloadFormNameList.push(formName);\r\n\t\t\tbluebirdList.push(this.CreateForm(formName));\r\n\t\t}\r\n\r\n\t\t//如果存在需要加载的界面资源\r\n\t\tif (bluebirdList.length) {\r\n\r\n\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateForm\");\r\n\r\n\t\t\treturn app.bluebird.all(bluebirdList)\r\n\t\t\t\t.then(function () {\r\n\t\t\t\t\tapp[app.subGameName + \"Client\"].OnEvent(\"ModalLayer\", \"CreateFormEnd\");\r\n\t\t\t\t})\r\n\t\t}\r\n\t},\r\n\r\n\t//切换完场景\r\n\tOnSwithSceneEnd: function (sceneName) {\r\n\r\n\t\tthis.Log(\"OnSwithSceneEnd(%s)\", sceneName);\r\n\r\n\t\tlet BaseForm = [];\r\n\t\tlet NoAddScene = ['clubScene', 'fightScene', 'launchScene', 'loginScene', 'fjsszMainScene']; //四个基础场景不用添加uimore，uimark\r\n\t\tif (this.isInArray(sceneName, NoAddScene) == false) {\r\n\t\t\t//添加游戏预制品\r\n\t\t\tlet GamePrefab = this.SceneInfo[sceneName].gamePrefab;\r\n\t\t\tif (GamePrefab == 0) {\r\n\t\t\t\tconsole.error(\"LoadSceneDefaultForm sceneName(%s)  not GamePrefabhave find: (%s)\", sceneName, GamePrefab);\r\n\t\t\t}\r\n\t\t\tBaseForm.unshift(GamePrefab);\r\n\t\t\t//显示三个必须预制品\r\n\t\t\tfor (let i = 0; i < BaseForm.length; i++) {\r\n\t\t\t\tthis.ShowForm(BaseForm[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\t_isOrientationH: function () {\r\n\t\tlet frameSize = cc.view.getFrameSize();\r\n\t\treturn frameSize.width > frameSize.height;\r\n\t},\r\n});\r\n\r\n\r\nvar g_sss_FormManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_sss_FormManager) {\r\n\t\tg_sss_FormManager = new sss_FormManager();\r\n\t}\r\n\treturn g_sss_FormManager;\r\n}\r\n"]}