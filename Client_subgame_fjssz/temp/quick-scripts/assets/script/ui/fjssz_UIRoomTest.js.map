{"version":3,"sources":["fjssz_UIRoomTest.js"],"names":["app","require","cc","Class","extends","subGameName","properties","OnCreateInit","cards","OnShow","c","i","length","element","push","key","sort","totalNum","cardMap","GetValue","log","model","node","getChildByName","bg","children","destroy","Object","hasOwnProperty","call","item","instantiate","parent","active","name","GetName","getComponent","Label","string","v","or","parseInt","substring","names","Sure","test","num","index","Math","min","ShowSysMsg","RoomMgr","toUpperCase","roomID","GetEnterRoom","GetRoomProperty","that","SendChat","JSON","stringify","msg","console","code","CloseForm","Add","event","target","Del","type","quickID","content","success","SendPack"],"mappings":"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","file":"fjssz_UIRoomTest.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\ui","sourcesContent":["var app = require(\"fjssz_app\");\r\ncc.Class({\r\n    extends: require(app.subGameName + \"_BaseForm\"),\r\n\r\n    properties: {\r\n\t\t\r\n    },\r\n    OnCreateInit: function (cards) {\r\n       \r\n        \r\n    },\r\n    OnShow: function (cards) {\r\n        let c = []\r\n        for (let i = 0; i < cards.length; i++) {\r\n            const element = cards[i];\r\n            c.push(element.key)\r\n        }\r\n        cards = c\r\n        this.cards = cards\r\n        cards.sort()\r\n        this.totalNum = 0\r\n        this.cardMap = {}\r\n        for (let i = 0; i < cards.length; i++) {\r\n            const element = this.GetValue(cards[i]);\r\n            if(!element) continue\r\n            if (!this.cardMap[element]) {\r\n                this.cardMap[element] = []\r\n            }\r\n            this.cardMap[element].push(cards[i])\r\n        }\r\n        cc.log(this.cardMap)\r\n\r\n        let model = this.node.getChildByName(\"model\")\r\n        let bg = this.node.getChildByName(\"bg\")\r\n        for (let i = 0; i < bg.children.length; i++) {\r\n            const element = bg.children[i];\r\n            element.destroy()\r\n        }\r\n        for (const key in this.cardMap) {\r\n            if (!Object.hasOwnProperty.call(this.cardMap, key)) continue;\r\n            let item = cc.instantiate(model)\r\n            item.parent = bg\r\n            item.active = true\r\n            let name = this.GetName(key)\r\n            item.getChildByName(\"poker\").getChildByName(\"Label\").getComponent(cc.Label).string = name\r\n            item.name = key\r\n        }\r\n        model.active = false\r\n    },\r\n    GetValue:function(v){\r\n        let or = parseInt(v.substring(0,4))\r\n        v = or\r\n        if(!v) v = 0\r\n        v = v%16;\r\n        if(or > 0x40){\r\n            return 14\r\n        }\r\n        if (v == 14) {\r\n            return 1\r\n        }\r\n        if (v == 15) {\r\n            return 2\r\n        }\r\n        return v\r\n    },\r\n    GetName:function(v){\r\n        if(!v) return \"\"\r\n        let names = [\"扑克A\",\"扑克2\",\"扑克3\",\"扑克4\",\"扑克5\",\"扑克6\",\"扑克7\",\"扑克8\",\"扑克9\",\r\n        \"扑克10\",\"扑克J\",\"扑克Q\",\"扑克K\",\"小鬼\",\"大鬼\"]\r\n        return names[v-1] || \"\"\r\n    },\r\n    Sure:function(){\r\n        let bg = this.node.getChildByName(\"bg\")\r\n        let test = []\r\n        for (let i = 0; i < bg.children.length; i++) {\r\n            const element = bg.children[i].name;\r\n            if (!this.cardMap[element] || this.cardMap[element].length == 0) continue\r\n            let num = parseInt(bg.children[i].getChildByName(\"num\").getComponent(cc.Label).string)\r\n            for (let index = 0; index < Math.min(num, this.cardMap[element].length); index++) {\r\n                test.push(parseInt(this.cardMap[element][index]))\r\n            }\r\n        }\r\n        if(test.length != 13){\r\n            app[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"请选择13张牌\");\r\n            return\r\n        }\r\n        let RoomMgr = app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n        if(!RoomMgr) return;\r\n\t\tlet roomID = RoomMgr.GetEnterRoom().GetRoomProperty(\"roomID\");\r\n        if(!roomID) return\r\n        let that = this\r\n        this.SendChat(5, 9988, roomID, JSON.stringify(test),(msg)=>{\r\n            console.log(msg)\r\n            if(msg.code == \"Success\")\r\n            {\r\n                this.ShowSysMsg(msg.msg);\r\n                that.CloseForm()\r\n            }\r\n        });\r\n        console.log(test)\r\n    },\r\n    Add:function(event){\r\n        let bg = this.node.getChildByName(\"bg\")\r\n        let key = event.target.parent.name\r\n        let num = parseInt(bg.getChildByName(key).getChildByName(\"num\").getComponent(cc.Label).string)\r\n        num ++\r\n        if (this.totalNum >= 13) return\r\n        if (num > this.cardMap[key].length) {\r\n            num = this.cardMap[key].length\r\n        }\r\n        else{\r\n            this.totalNum ++\r\n        }\r\n        bg.getChildByName(key).getChildByName(\"num\").getComponent(cc.Label).string = num\r\n    },\r\n    Del:function(event){\r\n        let bg = this.node.getChildByName(\"bg\")\r\n        let key = event.target.parent.name\r\n        let num = parseInt(bg.getChildByName(key).getChildByName(\"num\").getComponent(cc.Label).string)\r\n        num --\r\n        if (num < 0) {\r\n            num = 0\r\n        }\r\n        else{\r\n            this.totalNum --\r\n        }\r\n        bg.getChildByName(key).getChildByName(\"num\").getComponent(cc.Label).string = num\r\n    },\r\n    SendChat:function (type, quickID, roomID, content,success) {\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"Chat\", \r\n        {\"type\":type, \"quickID\":quickID, \"targetID\":roomID, \"content\":content}, success);\r\n\t},\r\n});\r\n"]}