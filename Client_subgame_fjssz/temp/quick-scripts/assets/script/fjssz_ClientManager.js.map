{"version":3,"sources":["fjssz_ClientManager.js"],"names":["app","require","subGameName","fjssz_ClientManager","cc","Class","extends","properties","globalEffect","Node","reConnectTip","onLoad","console","log","JS_Name","logSecond","isWriteLog","sys","isNative","game","addPersistRootNode","node","StartTimer","schedule","OnTimer","systemEvent","on","SystemEvent","EventType","KEY_DOWN","OnKeyDown","ShareDefineModel","GetModel","ComToolModel","ControlManagerModel","localStorage","setItem","testData","getItem","CanUse","removeItem","error","LocalDataManagerModel","LocalDataManager","NativeManagerModel","NativeManager","clientState","State_Prepare","nextTick","lastHearTime","LostHearTime","isFaXinTiao","isFirstLogin","debugModel","lastReConnectTime","reConnectUseTime","bStartReConnect","reConnectLable","getChildByName","getComponent","Label","startUpInfo","clientConfig","gameType","InitLaunchParameter","isAllReadyRelogin","InitDebug","isDebug","IsDevelopment","debugPrefab","debugNode","instantiate","OnCreate","stack","para","CallToNative","href","window","location","index","indexOf","substr","paraList","length","split","count","paraInfo","paraDataList","OnPack_LuckDrawReceive","serverPack","OnEvent","OnPack_HeartBeat","Date","getTime","bBeatFlag","SendPack","SpeedTest","bind","yanci","OnPack_BaseLogin","HeroAccountManager","accountID","GetAccountProperty","nickName","headImageUrl","sex","InitLoginData","NetManager","InitConnectAccountID","GetHeroID","OnPack_RoleTest","SetAccountProperty","OnPack_OnHeroLogin","heroID","State_Logined","State_LoginPackFail","ShowSysMsg","OnPack_PlayerInfo","OnEvent_InitPlayerFamily","event","SendGetCurRoomID","SetGameType","typeStr","OnEvent_LoginGetCurRoomID","roomID","allSwitchGameData","switchGameData","push","JSON","parse","isShowVideo","i","action","ShowForm","fromName","LoadScene","practiceId","roomKey","that","toUpperCase","OnStartEnterGame","SendGetRoomInfo","OnEvent_ConnectSuccess","bIsReconnect","OnPack_GetGameStatus","isPlayingGame","SceneManager","sceneType","GetSceneType","ExitGame","OnEvent_ReloadHeroData","eventName","OnPack_Kickout","kickOutType","LogOutGame","OnPack_Online","onlineHour","OnNativeNotify","eventType","eventDataString","dataDict","OnNativeNotifyWXLogin","OnNativeNotifyWXShare","OnNativeNotifyWXPay","OnDownLoadEvent","OnGetLocationCallBack","update","dt","passSecond","State_WaitLogin","curTime","isConnectIng","Disconnect","StartReConnect","ReConnectByTipSureBtn","string","StopTimer","unschedule","OnEventHide","curRunGame","OnEventShow","scheduleOnce","OnInitClientData","clientPath","appVersion","State_InitSuccess","OnInitClientFinish","allTableDataDict","RefreshClientConfig","debug","CheckDebugSign","InitModel","InitTable","InitManager","dump","e","LoadLogin","ClientLoginProcess","SendRequestWeChatSDKIntSign","dbGameServerInfo","GetConfigProperty","dbAccountServerInfo","dbOrderServerInfo","dbResServerInfo","gameServerIP","gameServerPort","accountServerIP","accountServerPort","orderServerIP","orderServerPort","resServerIP","resServerPort","accountType","orderType","AccountSDKTypeNameDict","hasOwnProperty","SDKType_Company","OrderSDKTypeNameDict","OrderType_Company","ddmchannel","ddmmp","SDKType_WeChat","OrderType_Wechat","modelName","NeedCreateList","SysDataManager","allTableNameList","Object","keys","tableName","tableInfo","OnLoadTableEnd","startUrl","origin","SetH5ClientStartUrl","RegNetPack","OnEvent_SPlayerContinue","RegEvent","InitSDKParameter","argDict","emit","userName","shortPlayer","name","paymentRoomCardType","func","target","UnRegTargetEvent","off","targetOff","keyCode","KEY","back","msgID","ConfirmManager","SetWaitForConfirmForm","OnConFirm","ShowConfirm","Confirm","clickType","backArgList","end","IsClientLoginOK","SetClientState","code","SetConfigProperty","GetSceneComponent","WarnLog","OnTopEvent","ClearClientData","OnReload","debugSign","argKeyList","sort","keyCount","signString","keyName","join","sign","MD5","hex_md5","GetDebugModel","MultiPoint","serverIP","GetClientConfigProperty","AccessPoint","AccountActive","myCityID","CityPoints","CityPointsList","GetClientConfig","mt","key","InArray","property","GetStartUpProperty","GetGlobalEffectNode","effectName","effectNode","removeFromParent","PushGlobalEffectNode","addChild","GetIsFirstLogin","SetFirstLogin","active","CloseReConnectTip","RemoveClientManager","removePersistRootNode","loadFormDict","showFormDict","createingFormDict","formWndShowInfo","defaultFormNameList","ReleaseAllRes","baseForm","_eventFuncDict","destroy","isInGame","isOutRoom","EVENT_HIDE","EVENT_SHOW","trace","roomMgr","clubId","unionId","stringify","curRunHall","StopAllSound","gamePath","jsb","fileUtils","getWritablePath","module","exports"],"mappings":"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","file":"fjssz_ClientManager.js","sourceRoot":"..\\..\\..\\..\\assets\\script","sourcesContent":["/*\r\n    客户端初始化管理类(该组件节点不会被释放)\r\n*/\r\n\r\nvar app = require(\"fjssz_app\");\r\nrequire(app.subGameName + \"_NativeNotify\");\r\nvar fjssz_ClientManager = cc.Class({\r\n\r\n\textends: require(app.subGameName + \"_BaseComponent\"),\r\n\r\n\tproperties: {\r\n\t\tglobalEffect: cc.Node,\r\n\t\treConnectTip: cc.Node,\r\n\t},\r\n\t// 加载JS主入口\r\n\tonLoad: function () {\r\n\t\tconsole.log(app.subGameName + \" ----- ClientManager onLoad-----\");\r\n\t\tthis.JS_Name = app.subGameName + \"_ClientManager\";\r\n\r\n\t\tthis.logSecond = 0;\r\n\t\t//是否需要写log\r\n\t\tthis.isWriteLog = cc.sys.isNative;\r\n\r\n\t\t//保证客户端管理器不被释放\r\n\t\tcc.game.addPersistRootNode(this.node);\r\n\r\n\t\tthis.StartTimer();\r\n\r\n\t\tthis.schedule(this.OnTimer, 0.1);\r\n\r\n\t\tcc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.OnKeyDown, this);\r\n\r\n\t\t//把Client存放到App上\r\n\t\tapp[app.subGameName + \"Client\"] = this;\r\n\r\n\t\t//枚举管理器\r\n\t\tlet ShareDefineModel = require(app.subGameName + \"_ShareDefine\").GetModel;\r\n\t\tapp[app.subGameName + \"_ShareDefine\"] = ShareDefineModel;\r\n\t\tthis[app.subGameName + \"_ShareDefine\"] = ShareDefineModel();\r\n\r\n\t\t//工具模块\r\n\t\tlet ComToolModel = require(app.subGameName + \"_ComTool\").GetModel;\r\n\t\tapp[app.subGameName + \"_ComTool\"] = ComToolModel;\r\n\t\tthis[app.subGameName + \"_ComTool\"] = ComToolModel();\r\n\r\n\t\t//加载控制器\r\n\t\tlet ControlManagerModel = require(app.subGameName + \"_ControlManager\").GetModel;\r\n\t\tapp[app.subGameName + \"_ControlManager\"] = ControlManagerModel;\r\n\t\tthis[app.subGameName + \"_ControlManager\"] = ControlManagerModel();\r\n\r\n\t\t//检测是否可以使用localStorage,有的浏览器没有\r\n\t\tvar localStorage = cc.sys.localStorage;\r\n\t\tlocalStorage.setItem(\"testStorage\", \"1\");\r\n\t\tvar testData = localStorage.getItem(\"testStorage\");\r\n\t\tif (testData) {\r\n\t\t\tcc.sys.localStorage.CanUse = 1;\r\n\t\t\tlocalStorage.removeItem(\"testStorage\");\r\n\t\t} else {\r\n\t\t\tcc.sys.localStorage.CanUse = 0;\r\n\t\t\tconsole.error(\"cant use sys.localStorage\");\r\n\t\t}\r\n\r\n\t\t//本地数据管理器\r\n\t\tlet LocalDataManagerModel = require(\"LocalDataManager\").GetModel;\r\n\t\tapp[\"LocalDataManager\"] = LocalDataManagerModel;\r\n\t\tthis.LocalDataManager = LocalDataManagerModel();\r\n\r\n\t\t//js调用native平台接口管理器(启动需要获取客户端app启动携带参数)\r\n\t\tlet NativeManagerModel = require(app.subGameName + \"_NativeManager\").GetModel;\r\n\t\tapp[app.subGameName + \"_NativeManager\"] = NativeManagerModel;\r\n\t\tthis.NativeManager = NativeManagerModel();\r\n\r\n\t\t//客户端初始化\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_Prepare;\r\n\r\n\t\t//定时器下次执行时间\r\n\t\tthis.nextTick = 0;\r\n\r\n\t\t//心跳\r\n\t\tthis.lastHearTime = 0;\r\n\t\tthis.LostHearTime = 0;\r\n\t\tthis.isFaXinTiao = false;\r\n\t\tthis.isFirstLogin = true;\r\n\r\n\t\tthis.debugModel = null;\r\n\r\n\t\t//重连计时\r\n\t\tthis.lastReConnectTime = 0;\r\n\t\tthis.reConnectUseTime = 0;\r\n\t\tthis.bStartReConnect = false;\r\n\t\tthis.reConnectLable = this.reConnectTip.getChildByName('sp_info').getChildByName('lb_info').getComponent(cc.Label);\r\n\t\t/*{\r\n\t\t\t//分享携带的roomkey\r\n\t\t\t\"shareRoomKey\":\"\",\r\n\t\t}*/\r\n\t\t//启动携带参数\r\n\t\tthis.startUpInfo = {};\r\n\r\n\t\t//客户端配置字典\r\n\t\tthis.clientConfig = {};\r\n\r\n\t\tthis.gameType = -1;\r\n\r\n\t\tthis.InitLaunchParameter();\r\n\r\n\t\t//this.loadapkpro = 0.0f;\r\n\t\t//\r\n\t\tthis.isAllReadyRelogin = false;\r\n\t},\r\n\r\n\t//debug初始化\r\n\tInitDebug: function (isDebug) {\r\n\r\n\t\tif (isDebug) {\r\n\t\t\t// this.LogManager.IsOpenLog(true);\r\n\t\t\tthis[app.subGameName + \"_ShareDefine\"].IsDevelopment = 1;\r\n\t\t\ttry {\r\n\t\t\t\tif (this.debugPrefab && !this.debugModel) {\r\n\t\t\t\t\tlet debugNode = cc.instantiate(this.debugPrefab);\r\n\t\t\t\t\tthis.debugModel = debugNode.getComponent(\"DebugLayer\");\r\n\t\t\t\t\tthis.debugModel.OnCreate()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch (error) {\r\n\t\t\t\tconsole.error(\"create debug error:%s\", error.stack);\r\n\t\t\t\tthis.debugModel = null;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// this.LogManager.IsOpenLog(false);\r\n\t\t\tthis[app.subGameName + \"_ShareDefine\"].IsDevelopment = 0;\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//启动参数\r\n\tInitLaunchParameter: function () {\r\n\t\tlet para = \"\";\r\n\r\n\t\t//如果是native版本获取应用启动携带参数\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\tpara = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"GetQuery\", [], \"String\");\r\n\t\t\tif (!para) {\r\n\t\t\t\tpara = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t//如果是H5版本\r\n\t\telse {\r\n\t\t\t//浏览器信息\r\n\t\t\t//let navigator = window.navigator;\r\n\t\t\t//let userAgent = navigator.userAgent;\r\n\t\t\tlet href = window.location.href;\r\n\t\t\tlet index = href.indexOf(\"?\");\r\n\t\t\tif (index > -1) {\r\n\t\t\t\t//\"?ddmchannel=dangle&ddmgameid=p1&appId=50059&cpToken=6aacddfec66b4ba2a1728b235d2c5716\"\r\n\t\t\t\tpara = href.substr(index + 1);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet paraList = [];\r\n\t\tif (para.length) {\r\n\t\t\tparaList = para.split(\"&\");\r\n\t\t}\r\n\t\tlet count = paraList.length;\r\n\r\n\t\tfor (let index = 0; index < count; index++) {\r\n\t\t\tlet paraInfo = paraList[index];\r\n\t\t\tlet paraDataList = paraInfo.split(\"=\");\r\n\t\t\tif (paraDataList.length != 2) {\r\n\t\t\t\tconsole.error(\"InitLaunchParameter paraInfo:%s error\", paraInfo);\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tthis.startUpInfo[paraDataList[0]] = paraDataList[1];\r\n\t\t}\r\n\t},\r\n\r\n\t//-----------------封包函数-------------------------\r\n\tOnPack_LuckDrawReceive: function (serverPack) {\r\n\t\tthis.OnEvent(\"OnChouJiangLingQu\", serverPack);\r\n\t},\r\n\t//心跳包\r\n\tOnPack_HeartBeat: function (serverPack) {\r\n\t\tthis.lastHearTime = new Date().getTime();\r\n\t\tthis.LostHearTime = new Date().getTime();\r\n\t\tif (serverPack.bBeatFlag) {\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"heartBeat.CHeartBeatHandler\", {\r\n\t\t\t\t\"strBeatMessage\": \"\",\r\n\t\t\t\t\"lBeatTime\": this.lastHearTime,\r\n\t\t\t\t\"bBeatFlag\": true\r\n\t\t\t}, this.SpeedTest.bind(this), this.SpeedTest.bind(this));\r\n\t\t}\r\n\t},\r\n\t//网速检测\r\n\tSpeedTest: function (serverPack) {\r\n\t\tthis.isFaXinTiao = false;\r\n\t\tlet yanci = new Date().getTime() - this.lastHearTime;\r\n\t\tthis.OnEvent(\"EvtSpeedTest\", {\"yanci\": yanci});\r\n\t},\r\n\t//1:账号登录成功\r\n\tOnPack_BaseLogin: function (serverPack) {\r\n\t\tconsole.log(\"账号登录成功\");\r\n\t\tlet HeroAccountManager = app[app.subGameName + \"_HeroAccountManager\"]();\r\n\t\tlet accountID = HeroAccountManager.GetAccountProperty(\"AccountID\");\r\n\t\tlet nickName = HeroAccountManager.GetAccountProperty(\"NickName\");\r\n\t\tlet headImageUrl = HeroAccountManager.GetAccountProperty(\"HeadImageUrl\");\r\n\t\tlet sex = HeroAccountManager.GetAccountProperty(\"Sex\");\r\n\r\n\t\tapp[app.subGameName + \"_ServerTimeManager\"]().InitLoginData(serverPack);\r\n\r\n\t\tlet NetManager = app[app.subGameName + \"_NetManager\"]();\r\n\r\n\t\t//连接已经建立,初始化连接的玩家账号ID\r\n\t\tNetManager.InitConnectAccountID(accountID);\r\n\r\n\t\t//如果客户端已经有玩家数据了,为重连回包,不需要发送登录封包,只需要同步一次玩家属性,因为有可能变化了属性\r\n\t\tif (app[app.subGameName + \"_HeroManager\"]().GetHeroID()) {\r\n\t\t\tconsole.log(\"玩家数据已经存在\");\r\n\t\t\tNetManager.SendPack(\"base.C1005PlayerInfo\", {});\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (serverPack[\"isNeedCreateRole\"]) {\r\n\t\t\t\tconsole.log(\"创建新角色\");\r\n\t\t\t\tNetManager.SendPack(\"base.C1001CreateRole\", {\r\n\t\t\t\t\t\"nickName\": nickName,\r\n\t\t\t\t\t\"sex\": sex,\r\n\t\t\t\t\t\"headImageUrl\": headImageUrl,\r\n\t\t\t\t\t\"accountID\": accountID\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.log(\"登录已有账号\");\r\n\t\t\t\tNetManager.SendPack(\"base.C1006RoleLogin\", {\"accountID\": accountID});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\t//服务端随机下发一个游客账号，直接登录就可以\r\n\tOnPack_RoleTest: function (serverPack) {\r\n\t\tapp[app.subGameName + \"_HeroAccountManager\"]().SetAccountProperty(\"reloginSign\", serverPack[\"sign\"]);\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"base.C1006RoleLogin\", {\"accountID\": serverPack[\"accountID\"]});\r\n\t},\r\n\r\n\t//2:玩家登陆初始化\r\n\tOnPack_OnHeroLogin: function (serverPack) {\r\n\r\n\t\ttry {\r\n\t\t\tif (this.isAllReadyRelogin) {\r\n\t\t\t\tconsole.log(\"已经初始化玩家数据，重复初始化导致报错...\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.isAllReadyRelogin = true;\r\n\t\t\tlet heroID = serverPack[\"pid\"];\r\n\t\t\tthis.gameType = serverPack[\"currentGameType\"];\r\n\r\n\t\t\tapp[app.subGameName + \"_HeroManager\"]().InitLoginData(heroID, serverPack);\r\n\t\t\tapp[app.subGameName + \"_ServerTimeManager\"]().InitLoginData(serverPack);\r\n\t\t\tapp[app.subGameName + \"_HeroAccountManager\"]().SetAccountProperty(\"AccountID\", serverPack[\"accountID\"]);\r\n\t\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnPack_OnHeroLogin(%s):%s\", serverPack, error.stack);\r\n\t\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_LoginPackFail;\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Code_Login_PackFail\");\r\n\t\t}\r\n\t},\r\n\r\n\tOnPack_PlayerInfo: function (serverPack) {\r\n\t\ttry {\r\n\t\t\tlet heroID = serverPack[\"pid\"];\r\n\t\t\tapp[app.subGameName + \"_HeroManager\"]().InitLoginData(heroID, serverPack);\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnPack_PlayerInfo(%s):%s\", serverPack, error.stack);\r\n\t\t}\r\n\t},\r\n\r\n\t//3:请求玩家工会数据\r\n\tOnEvent_InitPlayerFamily: function (event) {\r\n\t\t//请求玩家进入的房间ID\r\n\t\tapp[app.subGameName + \"_GameManager\"]().SendGetCurRoomID();\r\n\t},\r\n\tSetGameType: function (typeStr) {\r\n\t\tif (app.subGameName == typeStr) {\r\n\t\t\tthis.gameType = 84;\r\n\t\t} else {\r\n\t\t\tthis.gameType = -1;\r\n\t\t}\r\n\t},\r\n\t//4:登录获取玩家当前参与的房间ID\r\n\tOnEvent_LoginGetCurRoomID: function (event) {\r\n\t\tlet serverPack = event;\r\n\t\tlet roomID = serverPack.roomID;\r\n\t\tconsole.log(\"登录获取玩家当前参与的房间ID:\" + roomID);\r\n\t\t//返回大厅检测下是否有需要处理的数据\r\n\t\tlet allSwitchGameData = [];\r\n\t\tlet switchGameData = cc.sys.localStorage.getItem(\"switchGameData\");\r\n\t\tif (switchGameData != \"\") {\r\n\t\t\tallSwitchGameData.push(JSON.parse(switchGameData));\r\n\t\t}\r\n\t\tlet isShowVideo = false;\r\n\t\tfor (let i = 0; i < allSwitchGameData.length; i++) {\r\n\t\t\tif (!allSwitchGameData[i]) continue;\r\n\t\t\tconsole.log(\"allSwitchGameData[i].action\");\r\n\t\t\tlet action = allSwitchGameData[i].action;\r\n\t\t\tswitch (action) {\r\n\t\t\t\tcase 'showForm':\r\n\t\t\t\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm(allSwitchGameData[i].fromName);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 'showVideo':\r\n\t\t\t\t\tisShowVideo = true;\r\n\t\t\t\t\tapp[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"VideoScene\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.log('未知动作: ' + action);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (isShowVideo) {\r\n\t\t\t//正在播放回放\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ('practiceId' in serverPack)\r\n\t\t\tapp[app.subGameName + \"_ShareDefine\"]().practiceId = serverPack.practiceId;\r\n\t\tif (roomID == 0) {\r\n\t\t\t//如果启动参数传递房间号，则尝试进入房间\r\n\t\t\tif (this.startUpInfo['room_id']) {\r\n\t\t\t\tlet roomKey = this.startUpInfo['room_id'];\r\n\t\t\t\tlet that = this;\r\n\t\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(app.subGameName + \".C\" + app.subGameName.toUpperCase() + \"EnterRoom\", {\r\n\t\t\t\t\t\"roomKey\": roomKey,\r\n\t\t\t\t\t\"posID\": -1\r\n\t\t\t\t}, function () {\r\n\t\t\t\t}, function (event) {\r\n\t\t\t\t\tthat.OnStartEnterGame(\"enterMain\");\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.OnStartEnterGame(\"enterMain\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet that = this;\r\n\t\t//进入房间\r\n\t\tapp[app.subGameName.toUpperCase() + \"RoomMgr\"]().SendGetRoomInfo(roomID, function () {\r\n\t\t\tthat.OnStartEnterGame(\"enterRoom\");\r\n\t\t});\r\n\t},\r\n\tOnEvent_ConnectSuccess: function (event) {\r\n\t\tlet serverPack = event;\r\n\t\tlet bIsReconnect = serverPack['IsReconnecting'];\r\n\t\tif (bIsReconnect) {\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"game.CGetGameStatus\", {});\r\n\t\t}\r\n\t},\r\n\t//断线重连状态同步\r\n\tOnPack_GetGameStatus: function (serverPack) {\r\n\t\tlet isPlayingGame = serverPack['isPlayingGame'];\r\n\t\tthis.gameType = serverPack['gameType'];\r\n\t\tlet roomID = serverPack['roomID'];\r\n\t\tif (isPlayingGame) {//游戏中\r\n\t\t\tlet event = {};\r\n\t\t\tevent = {};\r\n\t\t\tevent.roomID = roomID;\r\n\t\t\tthis.OnEvent_LoginGetCurRoomID(event);\r\n\t\t}\r\n\t\telse {//跳转大厅\r\n\t\t\tlet SceneManager = app[app.subGameName + \"_SceneManager\"]();\r\n\t\t\tlet sceneType = SceneManager.GetSceneType();\r\n\t\t\t//如果已经在登录场景则不切换\r\n\t\t\tif ('mainScene' != sceneType)\r\n\t\t\t\tthis.ExitGame();\r\n\t\t}\r\n\t},\r\n\tOnEvent_ReloadHeroData: function (event) {\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"game.C1101GetRoomID\", {});\r\n\t\t} else {\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n\t\t}\r\n\t},\r\n\t//开始进入游戏\r\n\tOnStartEnterGame: function (eventName) {\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n\r\n\t\tif (eventName == \"enterMain\") {\r\n\t\t\t//进入主场景\r\n\t\t\tconsole.log(\"进入主场景\");\r\n\t\t\tthis.ExitGame();\r\n\t\t}\r\n\r\n\t\tthis.OnEvent(\"PlayerLoginOK\", {});\r\n\t},\r\n\r\n\t//被ti\r\n\tOnPack_Kickout: function (serverPack) {\r\n\t\tlet kickOutType = serverPack[\"type\"];\r\n\r\n\t\tif (kickOutType == 2) {\r\n\t\t\tthis.LogOutGame(-1);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(\"OnPack_Kickout kickOutType:%s not find\", kickOutType);\r\n\t\t}\r\n\t},\r\n\r\n\t//提醒玩家在线时长\r\n\tOnPack_Online: function (serverPack) {\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"MSG_TIME_ONLINE\", [serverPack.onlineHour]);\r\n\t},\r\n\r\n\t//-----------------回调函数-------------------------\r\n\r\n\r\n\t//native平台回调\r\n\tOnNativeNotify: function (eventType, eventDataString) {\r\n\t\ttry {\r\n\t\t\tlet dataDict = JSON.parse(eventDataString);\r\n\t\t\tif (eventType == \"wechat\") { //微信登录\r\n\t\t\t\tapp[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXLogin(dataDict);\r\n\t\t\t} else if (eventType == \"wechatShare\") {  //微信分享\r\n\t\t\t\tapp[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXShare(dataDict);\r\n\t\t\t} else if (eventType == \"wechatPay\") { //微信支付\r\n\t\t\t\tapp[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXPay(dataDict);\r\n\t\t\t} else if (eventType == \"onBatteryLevel\") { //电量回掉\r\n\t\t\t\tthis.OnEvent(\"EvtBatteryLevel\", {\"Level\": dataDict[\"Level\"], \"status\": dataDict[\"status\"]});\r\n\t\t\t} else if (eventType == \"apkProess\") { //下载apk进度\r\n\t\t\t\tthis.OnEvent(\"LoadApkProess\", {\"progress\": dataDict[\"proess\"]});\r\n\t\t\t} else if (eventType == \"download\") { //下载\r\n\t\t\t\tapp[app.subGameName + \"_DownLoadMgr\"]().OnDownLoadEvent(dataDict);\r\n\t\t\t} else if (eventType == \"palyAudioFinsh\") { //播放完成\r\n\t\t\t\tthis.OnEvent(\"palyAudioFinsh\", {});\r\n\t\t\t} else if (eventType == \"AudioError\") {//录音失败\r\n\t\t\t\tthis.OnEvent(\"AudioError\", {});\r\n\t\t\t} else if (eventType == \"AudioStopError\") {//录音失败\r\n\t\t\t\tthis.OnEvent(\"AudioStopError\", {});\r\n\t\t\t} else if (eventType == \"MedioRecordError\") {//播放失败\r\n\t\t\t\tthis.OnEvent(\"MedioRecordError\", {});\r\n\t\t\t} else if (eventType == \"wellPrepared\") {//准备录音\r\n\t\t\t\tthis.OnEvent(\"wellPrepared\", {});\r\n\t\t\t} else if (eventType == \"RecordAudioFinsh\") { //录音完成\r\n\t\t\t\tthis.OnEvent(\"RECORDAUDIOFINSH\", {});\r\n\t\t\t} else if (eventType == \"GETLOCATION\") { //获取定位\r\n\t\t\t\tapp[app.subGameName + \"_LocationOnStartMgr\"]().OnGetLocationCallBack(dataDict);\r\n\t\t\t} else if (eventType == \"copyText\") { //获取定位\r\n\t\t\t\tthis.OnEvent(\"OnCopyTextNtf\", dataDict);\r\n\t\t\t} else if (eventType == \"DDShare\") {\r\n\t\t\t\tthis.OnEvent(\"OnDDShare\", dataDict);\r\n\t\t\t} else if (eventType == \"XLShare\") {\r\n\t\t\t\tthis.OnEvent(\"OnXLShare\", dataDict);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\"OnNativeNotify not find eventType:%s\", eventType);\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tif (eventType == 'wechatShare') {\r\n\t\t\t\t//还是给分享成功回调\r\n\t\t\t\tapp[app.subGameName + \"_WeChatAppManager\"]().OnNativeNotifyWXShare({\"ErrCode\": 0});\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\"OnNativeNotify(%s,%s) error(%s), error.stack:%s\", eventType, eventDataString, error, error.stack);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// 每帧回掉\r\n\tupdate: function (dt) {\r\n\r\n\t\t//if(this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin){\r\n\t\t//\treturn\r\n\t\t//}\r\n\t\t//\r\n\t\t//let nowTick = new Date().getTime();\r\n\t\t//\r\n\t\t//if(nowTick >= this.nextTick){\r\n\t\t//\tthis.nextTick = nowTick + 1000;\r\n\t\t//}\r\n\t},\r\n\r\n\t//100毫秒回掉\r\n\tOnTimer: function (passSecond) {\r\n\t\ttry {\r\n\t\t\tif (this.isWriteLog) {\r\n\t\t\t\tthis.logSecond += passSecond;\r\n\t\t\t\t//500毫秒输出一次log\r\n\t\t\t\tif (this.logSecond >= 0.5) {\r\n\t\t\t\t\t// this.LogManager.OutPutLog();\r\n\t\t\t\t\tthis.logSecond = 0\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().OnTimer(passSecond);\r\n\r\n\t\t\t//完整登录才能调用\r\n\t\t\tif (this.clientState == this[app.subGameName + \"_ShareDefine\"].State_Logined) {\r\n\t\t\t\tlet curTime = new Date().getTime();\r\n\r\n\t\t\t\tif (this.lastHearTime && curTime > this.lastHearTime + 23000) {\r\n\t\t\t\t\tconsole.error('NetWork Disconnect By Heart');\r\n\t\t\t\t\tthis.lastHearTime = 0;\r\n\t\t\t\t\tif (app[app.subGameName + \"_NetWork\"]().isConnectIng)//ios的可能websoket不会主动断开\r\n\t\t\t\t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect();\r\n\r\n\t\t\t\t\tif (!this.bStartReConnect) {\r\n\t\t\t\t\t\tthis.StartReConnect();\r\n\t\t\t\t\t\tapp[app.subGameName + \"_NetWork\"]().ReConnectByTipSureBtn();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bStartReConnect) {\r\n\t\t\t\t\tif (this.lastReConnectTime && curTime > this.lastReConnectTime + 1000) {\r\n\t\t\t\t\t\tthis.lastReConnectTime = curTime;\r\n\t\t\t\t\t\tthis.reConnectUseTime++;\r\n\t\t\t\t\t\tthis.reConnectLable.string = '连接失败,重新加载中(' + this.reConnectUseTime + '秒)' + '...';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnTimer:%s\", error.stack);\r\n\t\t}\r\n\t},\r\n\r\n\tStartTimer: function () {\r\n\t\tthis.schedule(this.OnTimer, 1);\r\n\t},\r\n\tStopTimer: function () {\r\n\t\tthis.unschedule(this.OnTimer);\r\n\t},\r\n\r\n\tOnEventHide: function () {\r\n\t\tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n\t\tif (curRunGame != app.subGameName) {\r\n\t\t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需监听OnEventHide事件\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.StopTimer();\r\n\t\tif (this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().OnEventHide();\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnEventHide error:%s\", error.stack);\r\n\t\t}\r\n\t},\r\n\r\n\tOnEventShow: function () {\r\n\t\tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n\t\tif (curRunGame != app.subGameName) {\r\n\t\t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需监听OnEventShow事件\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.StopTimer();\r\n\t\tif (this.clientState < this[app.subGameName + \"_ShareDefine\"].State_WaitLogin) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tlet curTime = new Date().getTime();\r\n\t\t\tif (this.LostHearTime && curTime > this.LostHearTime + 55000) {\r\n\t\t\t\tthis.lastHearTime = 0;\r\n\t\t\t\t// console.log(\"后台切回来大厅 3\");\r\n\t\t\t\tif (app[app.subGameName + \"_NetWork\"]().isConnectIng) {//ios的可能websoket不会主动断开\r\n\t\t\t\t\tconsole.log(\"后台切回来，先断开连接\");\r\n\t\t\t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect();\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.bStartReConnect) {\r\n\t\t\t\t\tconsole.log(\"后台切回来，发起断线重连\");\r\n\t\t\t\t\tthis.StartReConnect();\r\n\t\t\t\t\tapp[app.subGameName + \"_NetWork\"]().ReConnectByTipSureBtn();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().OnEventShow(this.bStartReConnect);\r\n\t\t\tthis.scheduleOnce(function () {\r\n\t\t\t\tthis.StartTimer();\r\n\t\t\t}, 2);\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnEventShow error:%s\", error.stack);\r\n\t\t}\r\n\t},\r\n\r\n\t//初始化客户端访问路径和app版本号\r\n\tOnInitClientData: function (clientPath, appVersion) {\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_InitSuccess;\r\n\t},\r\n\r\n\t//客户端初始化成功回调\r\n\tOnInitClientFinish: function (allTableDataDict, clientConfig) {\r\n\t\ttry {\r\n\t\t\tthis.clientConfig = clientConfig;\r\n\r\n\t\t\tconsole.log(\"ClietManage clientConfig:\", this.clientConfig);\r\n\t\t\tthis.RefreshClientConfig();\r\n\r\n\t\t\tif (this.debugModel) {\r\n\t\t\t\tthis.debugModel.OnInitClientFinish();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet debug = this.clientConfig[\"debug\"];\r\n\r\n\t\t\t\t//如果服务器下发debug\r\n\t\t\t\tif (debug && this.CheckDebugSign(debug)) {\r\n\t\t\t\t\tthis.InitDebug(true);\r\n\t\t\t\t\tthis.debugModel.OnInitClientFinish();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this.clientState != this[app.subGameName + \"_ShareDefine\"].State_InitSuccess) {\r\n\t\t\t\tconsole.log(\"OnInitClientFinish 初始化异常\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.InitModel()) {\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitModel fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.InitTable(allTableDataDict)) {\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitTable fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//初始化客户端所有管理器\r\n\t\t\tif (!this.InitManager()) {\r\n\t\t\t\tconsole.log(\"OnInitClientFinish InitManager fail\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\t//强制CG一次,否则内存一直会占用不释放\r\n\t\t\t// cc.sys.garbageCollect();\r\n\r\n\t\t\t//输出运行环境信息\r\n\t\t\tcc.sys.dump();\r\n\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tconsole.error(\"InitUpdateFinish:%s\", e.stack);\r\n\t\t}\r\n\t},\r\n\r\n\tLoadLogin: function () {\r\n\t\tthis.ClientLoginProcess();\r\n\t\tapp[app.subGameName + \"_WeChatManager\"]().SendRequestWeChatSDKIntSign();\r\n\t},\r\n\r\n\t//刷新客户端启动配置字典\r\n\tRefreshClientConfig: function () {\r\n\t\tconsole.log(\"ClientManageer this.clientConfig:\", this.clientConfig);\r\n\t\tlet dbGameServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"GameServerInfo\");\r\n\t\tlet dbAccountServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"AccountServerInfo\");\r\n\t\tlet dbOrderServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"OrderServerInfo\");\r\n\t\tlet dbResServerInfo = this.LocalDataManager.GetConfigProperty(\"DebugInfo\", \"ResServerInfo\");\r\n\r\n\t\tif (dbGameServerInfo) {\r\n\t\t\tlet gameServerIP = dbGameServerInfo[\"GameServerIP\"];\r\n\t\t\tlet gameServerPort = dbGameServerInfo[\"GameServerPort\"];\r\n\r\n\t\t\tif (gameServerIP && gameServerPort) {\r\n\t\t\t\tthis.clientConfig[\"GameServerIP\"] = gameServerIP;\r\n\t\t\t\tthis.clientConfig[\"GameServerPort\"] = gameServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dbAccountServerInfo) {\r\n\t\t\tlet accountServerIP = dbAccountServerInfo[\"AccountServerIP\"];\r\n\t\t\tlet accountServerPort = dbAccountServerInfo[\"AccountServerPort\"];\r\n\r\n\t\t\tif (accountServerIP && accountServerPort) {\r\n\t\t\t\tthis.clientConfig[\"AccountServerIP\"] = accountServerIP;\r\n\t\t\t\tthis.clientConfig[\"AccountServerPort\"] = accountServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dbOrderServerInfo) {\r\n\t\t\tlet orderServerIP = dbOrderServerInfo[\"OrderServerIP\"];\r\n\t\t\tlet orderServerPort = dbOrderServerInfo[\"OrderServerPort\"];\r\n\r\n\t\t\tif (orderServerIP && orderServerPort) {\r\n\t\t\t\tthis.clientConfig[\"OrderServerIP\"] = orderServerIP;\r\n\t\t\t\tthis.clientConfig[\"OrderServerPort\"] = orderServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (dbResServerInfo) {\r\n\t\t\tlet resServerIP = dbResServerInfo[\"ResServerIP\"];\r\n\t\t\tlet resServerPort = dbResServerInfo[\"ResServerPort\"];\r\n\r\n\t\t\tif (resServerIP && resServerPort) {\r\n\t\t\t\tthis.clientConfig[\"ResServerIP\"] = resServerIP;\r\n\t\t\t\tthis.clientConfig[\"ResServerPort\"] = resServerPort;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//如果是H5连接启动,使用的账号和支付方式，需要重置一次\r\n\t\t//H5使用的账号授权SDK和支付SDK 又配置的连接携带的参数决定,不是由配置决定\r\n\t\t//公众号标示也有启动参数决定,不是由配置决定\r\n\t\tconsole.log(\"RefreshClientConfig cc.sys.isNative\", cc.sys.isNative);\r\n\t\tif (cc.sys.isNative) {\r\n\t\t\t//判断使用SDK授权,支付SDK,枚举是否存在\r\n\t\t\tlet accountType = this.clientConfig[\"AccountType\"];\r\n\t\t\tlet orderType = this.clientConfig[\"OrderType\"];\r\n\t\t\tif (!this[app.subGameName + \"_ShareDefine\"].AccountSDKTypeNameDict.hasOwnProperty(accountType)) {\r\n\t\t\t\tconsole.log(\"AccountSDKTypeNameDict not find :%s\", accountType);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t}\r\n\r\n\t\t\tif (!this[app.subGameName + \"_ShareDefine\"].OrderSDKTypeNameDict.hasOwnProperty(orderType)) {\r\n\t\t\t\tconsole.log(\"OrderSDKTypeNameDict not find :%s\", orderType);\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tlet ddmchannel = this.startUpInfo[\"ddmchannel\"];\r\n\t\t\tlet ddmmp = this.startUpInfo[\"ddmmp\"];\r\n\r\n\t\t\tthis.clientConfig[\"Channel\"] = ddmchannel;\r\n\r\n\t\t\tif (ddmchannel == \"website\") {\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t\telse if (ddmchannel == \"wechat\") {\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_WeChat;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Wechat;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = ddmmp;\r\n\t\t\t}\r\n\t\t\t//可能是本机调试启动\r\n\t\t\telse if (!this.startUpInfo.hasOwnProperty(\"ddmchannel\")) {\r\n\t\t\t\tconsole.log(\"webdebug ddmchannel:%s \", ddmchannel);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.error(\"ddmchannel:%s error\", ddmchannel);\r\n\t\t\t\tthis.clientConfig[\"AccountType\"] = this[app.subGameName + \"_ShareDefine\"].SDKType_Company;\r\n\t\t\t\tthis.clientConfig[\"OrderType\"] = this[app.subGameName + \"_ShareDefine\"].OrderType_Company;\r\n\t\t\t\tthis.clientConfig[\"MPID\"] = \"\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//初始化模块\r\n\tInitModel: function () {\r\n\t\tlet modelName = \"\";\r\n\t\ttry {\r\n\t\t\tlet NeedCreateList = app.NeedCreateList;\r\n\t\t\tlet count = NeedCreateList.length;\r\n\t\t\tfor (let index = 0; index < count; index++) {\r\n\t\t\t\tmodelName = NeedCreateList[index];\r\n\t\t\t\t//设置所有单例引用接口到app\r\n\t\t\t\tapp[modelName] = require(modelName).GetModel;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"OnLoad require(%s) error:%s\", modelName, error.stack);\r\n\t\t\treturn false\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t},\r\n\r\n\t//初始化表数据\r\n\tInitTable: function (allTableDataDict) {\r\n\r\n\t\tlet SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n\t\tlet allTableNameList = Object.keys(allTableDataDict);\r\n\t\tlet count = allTableNameList.length;\r\n\t\tfor (let index = 0; index < count; index++) {\r\n\t\t\tlet tableName = allTableNameList[index];\r\n\t\t\tlet tableInfo = allTableDataDict[tableName];\r\n\t\t\tSysDataManager.OnLoadTableEnd(tableName, tableInfo[\"KeyNameList\"], tableInfo[\"Data\"]);\r\n\t\t}\r\n\r\n\t\treturn true\r\n\t},\r\n\r\n\t//初始化管理器\r\n\tInitManager: function () {\r\n\r\n\t\t//实例化所有单例管理器\r\n\t\tlet NeedCreateList = app.NeedCreateList;\r\n\t\tlet count = NeedCreateList.length;\r\n\r\n\t\tlet modelName = \"\";\r\n\t\ttry {\r\n\t\t\tfor (let index = 0; index < count; index++) {\r\n\t\t\t\tconsole.log(app.subGameName + \" InitManager\", modelName)\r\n\t\t\t\tmodelName = NeedCreateList[index];\r\n\t\t\t\trequire(modelName).GetModel()\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"InitManager(%s) error:%s\", modelName, error.stack);\r\n\t\t\treturn false\r\n\t\t}\r\n\t\t//追加调试全局入口\r\n\t\tif (window) {\r\n\t\t\twindow[\"app\"] = app;\r\n\t\t}\r\n\r\n\t\tlet NetManager = app[app.subGameName + \"_NetManager\"]();\r\n\t\tlet startUrl = \"\";\r\n\t\t//初始化资源服务器地址\r\n\t\tif (window.location) {\r\n\t\t\tstartUrl = window.location.origin;\r\n\t\t}\r\n\t\tNetManager.SetH5ClientStartUrl(startUrl);\r\n\r\n\t\t//封包注册\r\n\t\t//封包事件注册\r\n\r\n\t\t//心跳\r\n\t\tNetManager.RegNetPack(\"SPlayerHeartBeat\", this.OnPack_HeartBeat, this);\r\n\t\tNetManager.RegNetPack(\"base.C1111RoleReLogin\", this.OnPack_RoleTest, this);\r\n\t\tNetManager.RegNetPack(\"base.C1004Login\", this.OnPack_BaseLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1006RoleLogin\", this.OnPack_OnHeroLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1001CreateRole\", this.OnPack_OnHeroLogin, this);\r\n\t\tNetManager.RegNetPack(\"base.C1005PlayerInfo\", this.OnPack_PlayerInfo, this);\r\n\t\tNetManager.RegNetPack(\"kickout\", this.OnPack_Kickout, this);\r\n\t\tNetManager.RegNetPack(\"SPlayer_OnlineTime\", this.OnPack_Online, this);\r\n\t\t//断线重连状态\r\n\t\tNetManager.RegNetPack(\"game.CGetGameStatus\", this.OnPack_GetGameStatus, this);\r\n\t\t//玩家点击继续\r\n\t\tNetManager.RegNetPack(\"SPlayer_Continue\", this.OnEvent_SPlayerContinue, this);\r\n\t\t//抽奖奖品领取通知\r\n\t\tNetManager.RegNetPack(\"SPlayer_LuckDrawReceive\", this.OnPack_LuckDrawReceive, this);\r\n\r\n\t\tthis.RegEvent(\"InitPlayerFamily\", this.OnEvent_InitPlayerFamily, this);\r\n\t\tthis.RegEvent(\"LoginGetCurRoomID\", this.OnEvent_LoginGetCurRoomID, this);\r\n\t\t//链接服务器成功并且重新初始化玩家数据\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(\"ReloadHeroData\", this.OnEvent_ReloadHeroData, this);\r\n\t\t//断线重连成功通知\r\n\t\tapp[app.subGameName + \"Client\"].RegEvent(app.subGameName + \"_ConnectSuccess\", this.OnEvent_ConnectSuccess, this);\r\n\t\t//初始化管理器完成调用一次sdk初始化接口(h5游戏客户端需要初始化携带的sdk参数:token)\r\n\t\tconsole.log(\"InitManager this.startUpInfo:\", this.startUpInfo);\r\n\t\tapp[app.subGameName + \"_SDKManager\"]().InitSDKParameter(this.startUpInfo);\r\n\r\n\t\treturn true;\r\n\r\n\t},\r\n\r\n\t//---------------------客户端事件分发接口-----------------------------\r\n\t//客户端封包事件\r\n\tOnEvent: function (eventName, argDict) {\r\n\t\tif(argDict){\r\n\t\tconsole.log(\"客户端事件分发 OnEvent:\" + eventName + \",\" + argDict);\r\n\t\t}\r\n\t\telse{\r\n\t\t    console.log(\"客户端事件分发 OnEvent:\" + eventName);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n\t\t\tif (curRunGame != app.subGameName) {\r\n\t\t\t\tconsole.log(\"当前游戏在 \" + curRunGame + \",无需分发事件\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.node.emit(eventName, argDict);\r\n\t\t}\r\n\t\tcatch (error) {\r\n\t\t\tconsole.error(\"子游戏事件分发 OnEvent:%s\", error.stack);\r\n\t\t}\r\n\t},\r\n\tOnEvent_SPlayerContinue: function (serverPack) {\r\n\t\tlet roomKey = serverPack.roomKey;\r\n\t\tlet userName = serverPack.shortPlayer.name;\r\n\t\tlet paymentRoomCardType = serverPack.paymentRoomCardType;\r\n\t\tapp[app.subGameName + \"_FormManager\"]().ShowForm('UIJoinMessage', roomKey, userName, paymentRoomCardType);\r\n\t},\r\n\r\n\t//注册封包事件\r\n\tRegEvent: function (eventName, func, target) {\r\n\t\tif (!func || !target) {\r\n\t\t\tconsole.error(\"eventName:%s error\", eventName);\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.node.on(eventName, func, target);\r\n\t},\r\n\r\n\t//取消注册封包事件\r\n\tUnRegTargetEvent: function (target, eventName = \"\", func = \"\") {\r\n\t\tif (!this.node) {\r\n\t\t\t//节点已经被销毁了\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//如果有制定注销事件\r\n\t\tif (eventName && func) {\r\n\t\t\tthis.node.off(eventName, func, target);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.node.targetOff(target);\r\n\t\t}\r\n\t},\r\n\r\n\t//键盘按下\r\n\tOnKeyDown: function (event) {\r\n\t\tlet keyCode = event.keyCode;\r\n\t\tswitch (keyCode) {\r\n\t\t\tcase cc.KEY.back: {\r\n\t\t\t\tlet msgID = \"MSG_EXIT_GAME\";\r\n\t\t\t\tlet ConfirmManager = app[app.subGameName + \"_ConfirmManager\"]();\r\n\t\t\t\tConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n\t\t\t\tConfirmManager.ShowConfirm(this[app.subGameName + \"_ShareDefine\"].Confirm, msgID, []);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.OnEvent(\"OnKeyDown\", {\"KeyCode\": keyCode});\r\n\t},\r\n\tOnConFirm: function (clickType, msgID, backArgList) {\r\n\t\tif ('Sure' == clickType) {\r\n\t\t\tif ('MSG_EXIT_GAME' == msgID)\r\n\t\t\t\tcc.game.end();\r\n\t\t}\r\n\t},\r\n\t//----------------逻辑函数----------------------\r\n\t//客户端是否登录封包完成\r\n\tIsClientLoginOK: function () {\r\n\t\treturn this.clientState == this[app.subGameName + \"_ShareDefine\"].State_Logined;\r\n\t},\r\n\r\n\tSetClientState: function (clientState) {\r\n\t\tthis.clientState = clientState;\r\n\t},\r\n\r\n\t//退出游戏到登录界面\r\n\tLogOutGame: function (code = 0) {\r\n\t\tconsole.log('LogOutGame');\r\n\t\tif (-1 == code) {\r\n\r\n\t\t} else if (-2 == code) {\r\n\t\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"Kick_ByServer\");\r\n\t\t}\r\n\t\t\r\n\t\tapp.LocalDataManager().SetConfigProperty(\"Account\", \"AccessTokenInfo\", {});\r\n\t\tthis.ClientLoginProcess();\r\n\t},\r\n\r\n\t/**\r\n\t * 退到客户端登录场景,客户端初始化s\r\n\t */\r\n\tClientLoginProcess: function () {\r\n\r\n\t\tlet SceneManager = app[app.subGameName + \"_SceneManager\"]();\r\n\r\n\t\tlet sceneType = SceneManager.GetSceneType();\r\n\r\n\t\t//如果已经在登录场景则不切换\r\n\t\tif (sceneType == (app.subGameName + \"LoginScene\")) {\r\n\t\t\tif (!SceneManager.GetSceneComponent()) {\r\n\t\t\t\tthis.WarnLog(\"ClientLoginProcess not sceneName\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tSceneManager.GetSceneComponent().OnTopEvent(\"Close\");\r\n\t\t}\r\n\t\t//如果不在登录场景，则切换到登录场景，\r\n\t\telse {\r\n\r\n\t\t\tthis.ClearClientData();\r\n\t\t\tSceneManager.LoadScene(app.subGameName + \"LoginScene\");\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//清理管理器数据\r\n\tClearClientData: function () {\r\n\t\tapp.LocalDataManager().OnReload();\r\n\t\t//----客户端基础管理器---\r\n\t\tapp[app.subGameName + \"_NetManager\"]().OnReload();\r\n\t\tapp[app.subGameName + \"_SceneManager\"]().OnReload();\r\n\t\tapp[app.subGameName + \"_SDKManager\"]().OnReload();\r\n\r\n\t\t//----数据管理器-------\r\n\t\tapp[app.subGameName + \"_HeroManager\"]().OnReload();\r\n\r\n\t\tapp[app.subGameName + \"_GameManager\"]().OnReload();\r\n\r\n\r\n\t\tthis.clientState = this[app.subGameName + \"_ShareDefine\"].State_WaitLogin;\r\n\t},\r\n\r\n\r\n\t//检测Debug签名\r\n\tCheckDebugSign: function (debugSign) {\r\n\t\t//生成签名\r\n\t\tlet argDict = {\r\n\t\t\t\"gameID\": \"p7\",\r\n\t\t\t\"gameType\": \"h5\",\r\n\t\t\t\"nonceStr\": \"18320c805fb57d88805d3918cdd1b2a3\",\r\n\t\t};\r\n\t\tlet argKeyList = Object.keys(argDict);\r\n\t\targKeyList.sort();\r\n\t\tlet keyCount = argKeyList.length;\r\n\t\tlet signString = \"\";\r\n\t\tfor (let index = 0; index < keyCount; index++) {\r\n\t\t\tlet keyName = argKeyList[index];\r\n\t\t\tsignString += [keyName, \"=\", argDict[keyName], \"&\"].join(\"\");\r\n\t\t}\r\n\t\tsignString += \"ddmh5.com\";\r\n\t\tlet sign = app.MD5.hex_md5(signString);\r\n\t\tif (sign == debugSign) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t},\r\n\r\n\t//--------------全局缓存---------------\r\n\r\n\t//获取全局缓存的bebug节点\r\n\tGetDebugModel: function () {\r\n\t\treturn this.debugModel;\r\n\t},\r\n\tMultiPoint:function(serverIP){\r\n        if(serverIP==\"\"){\r\n            return \"\";\r\n        }\r\n        if(app[app.subGameName + \"Client\"].GetClientConfigProperty(\"IsGaoFang\")==0){\r\n            //不接入高防\r\n            return serverIP;\r\n        }\r\n        let AccessPoint=app.LocalDataManager().GetConfigProperty(\"Account\", \"AccessPoint\");\r\n        if(AccessPoint>0){\r\n            if(AccessPoint==1){\r\n                return 'line1.'+serverIP;\r\n            }else if(AccessPoint==2){\r\n                return 'line2.'+serverIP;\r\n            }else if(AccessPoint==3){\r\n                return 'line3.'+serverIP;\r\n            }\r\n        }\r\n\r\n        let AccountActive = app.LocalDataManager().GetConfigProperty(\"Account\", \"AccountActive\");\r\n        //如果该城市有独立节点，则调用本城市自己的节点\r\n        let myCityID = cc.sys.localStorage.getItem(\"myCityID\");\r\n        if(myCityID){\r\n            let CityPoints=app[app.subGameName + \"Client\"].GetClientConfigProperty(\"CityPoints\");\r\n            if(CityPoints){\r\n                let CityPointsList=CityPoints.split(',');\r\n                if(CityPointsList.indexOf(myCityID)>-1){\r\n                    //用户选择的城市有配置独立的节点\r\n                    if(AccountActive>10){\r\n                        return 'h'+myCityID+'.'+serverIP; //活跃用户\r\n                    }else{\r\n                        return 'c'+myCityID+'.'+serverIP; //普通用户\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if(AccountActive>100){\r\n            serverIP='a100.'+serverIP;\r\n        }else if(AccountActive>50){\r\n            serverIP='i50.'+serverIP;\r\n        }else if(AccountActive>10){\r\n            serverIP='x10.'+serverIP;\r\n        }\r\n\r\n\r\n        return serverIP;\r\n    },\r\n\t//获取客户端启动配置\r\n\tGetClientConfig: function () {\r\n\t\tlet clientConfig = [];\r\n\t\tlet mt = [\"GateServerIP\", \"GameServerIP\", \"AccountServerIP\", \"OrderServerIP\", \"ResServerIP\"];\r\n\t\tfor (var key in this.clientConfig) {\r\n\t\t\tif (mt.InArray(key)) {\r\n\t\t\t\tclientConfig[key] = this.MultiPoint(this.clientConfig[key]);\r\n\t\t\t} else {\r\n\t\t\t\tclientConfig[key] = this.clientConfig[key];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn clientConfig;\r\n\t},\r\n\r\n\t//获取客户端启动配置属性值\r\n\tGetClientConfigProperty: function (property) {\r\n\t\tlet mt = [\"GateServerIP\", \"GameServerIP\", \"AccountServerIP\", \"OrderServerIP\", \"ResServerIP\"];\r\n\t\tif (this.clientConfig.hasOwnProperty(property)) {\r\n\t\t\tif (mt.InArray(property)) {\r\n\t\t\t\treturn this.MultiPoint(this.clientConfig[property]);\r\n\t\t\t} else {\r\n\t\t\t\treturn this.clientConfig[property];\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.error(\"GetClientConfigProperty not find :%s\", property);\r\n\t\t\treturn 0\r\n\t\t}\r\n\t},\r\n\r\n\t//获取启动属性值\r\n\tGetStartUpProperty: function (property) {\r\n\t\tif (!this.startUpInfo.hasOwnProperty(property)) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.startUpInfo[property];\r\n\t},\r\n\r\n\tGetGlobalEffectNode: function (effectName) {\r\n\t\tlet effectNode = this.node.getChildByName('globalEffect').getChildByName(effectName);\r\n\t\tif (!effectNode) {\r\n\t\t\tconsole.error(\"GetGlobalEffectNode(%s) not find\", effectName);\r\n\t\t\treturn\r\n\t\t}\r\n\t\teffectNode.removeFromParent(false);\r\n\t\treturn effectNode\r\n\t},\r\n\r\n\tPushGlobalEffectNode: function (effectNode) {\r\n\t\teffectNode.removeFromParent(false);\r\n\t\tthis.node.getChildByName('globalEffect').addChild(effectNode);\r\n\t},\r\n\r\n\tGetIsFirstLogin: function () {\r\n\t\treturn this.isFirstLogin\r\n\t},\r\n\r\n\tSetFirstLogin: function () {\r\n\t\tthis.isFirstLogin = false;\r\n\t},\r\n\r\n\tStartReConnect: function () {\r\n\t\tif (this.bStartReConnect)\r\n\t\t\treturn;\r\n\t\tthis.bStartReConnect = true;\r\n\t\tthis.reConnectUseTime = 0;\r\n\t\tthis.reConnectLable.string = '连接失败,重新加载中(1秒)...';\r\n\t\tthis.lastReConnectTime = new Date().getTime();\r\n\t\tthis.reConnectTip.active = true;\r\n\t},\r\n\tCloseReConnectTip: function () {\r\n\t\tthis.bStartReConnect = false;\r\n\t\tthis.lastReConnectTime = 0;\r\n\t\tthis.reConnectUseTime = 0;\r\n\t\tthis.reConnectLable.string = '';\r\n\t\tthis.reConnectTip.active = false;\r\n\t},\r\n\r\n\t//取消常驻节点，以便重新加载游戏\r\n\tRemoveClientManager: function () {\r\n\t\tcc.game.removePersistRootNode(this.node);\r\n\t\t//清理已经加载的界面\r\n\t\tapp[app.subGameName + \"_FormManager\"]().loadFormDict = {};\r\n\t\tapp[app.subGameName + \"_FormManager\"]().showFormDict = {};\r\n\t\tapp[app.subGameName + \"_FormManager\"]().createingFormDict = {};\r\n\t\tapp[app.subGameName + \"_FormManager\"]().formWndShowInfo = {};\r\n\t\tapp[app.subGameName + \"_FormManager\"]().defaultFormNameList = [];\r\n\t\t//释放已经加载的资源\r\n\t\tthis[app.subGameName + \"_ControlManager\"].ReleaseAllRes();\r\n\t\t//清除注册事件\r\n\t\tthis.UnRegTargetEvent(this);\r\n\t\tlet baseForm = require(app.subGameName + \"_BaseForm\");\r\n\t\tbaseForm._eventFuncDict = {};\r\n\t\tthis.destroy();\r\n\t\tthis.node.destroy();\r\n\t},\r\n\t\r\n\tisInGame:function(){\r\n\t\tlet curRunGame = cc.sys.localStorage.getItem(\"curRunGame\");\r\n        if (curRunGame!= app.subGameName) {\r\n        \treturn false;\r\n        }\r\n        return true;\r\n\t},\r\n\tExitGame:function(switchGameData = null,isOutRoom='1') {\r\n\t\tcc.game.off(cc.game.EVENT_HIDE);\r\n\t\tcc.game.off(cc.game.EVENT_SHOW);\r\n\t\tconsole.trace(\"退出游戏\")\r\n\t\tif (!cc.sys.isNative) {\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//联盟/亲友圈房间返回联盟/亲友圈房间列表\r\n\t\tlet roomMgr =app[app.subGameName.toUpperCase()+\"RoomMgr\"]();\r\n\t\tif (roomMgr) {\r\n\t\t\tif (roomMgr.clubId > 0 || roomMgr.unionId > 0) {\r\n\t\t\t\tswitchGameData = {action:\"openClub\"};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (switchGameData != null) {\r\n\t\t\t// let testData = {action:\"showForm\", fromName:\"UIStore\"};\r\n\t\t\tcc.sys.localStorage.setItem(\"isOutRoom\",isOutRoom);\r\n\t\t\tcc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(switchGameData));\r\n\t\t}\r\n\t\t//如果是游戏切换需要释放内存，重新加载\r\n\t\tthis.RemoveClientManager();\r\n\t\tlet curRunHall = cc.sys.localStorage.getItem(\"curRunHall\");\r\n\t\tapp[app.subGameName + \"_NetManager\"]().SendPack(\"base.C1110UUID\", {\"gameName\": \"hall\"}, function (event) {\r\n\t\t\tapp.LocalDataManager().SetConfigProperty(\"Account\", \"uuid\", event);\r\n\t\t\t//停止场景音乐\r\n\t\t\tapp[app.subGameName + \"_SoundManager\"]().StopAllSound();\r\n\t\t\t//主动断开socket连接，服务端会将玩家踢出\r\n\t\t\tif (app[app.subGameName + \"_NetWork\"]().isConnectIng) {\r\n\t\t\t\tconsole.log(\"获取uuid成功，断开连接\");\r\n\t\t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect(true);\r\n\t\t\t}\r\n\t\t\tlet gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\" + app.subGameName;\r\n\t\t\twindow.require(gamePath + \"/src/hall.js\");\r\n\t\t}, function (error) {\r\n\t\t\tconsole.log(\"获取uuid失败\");\r\n\t\t});\r\n\t},\r\n});\r\n\r\nmodule.exports = fjssz_ClientManager;"]}