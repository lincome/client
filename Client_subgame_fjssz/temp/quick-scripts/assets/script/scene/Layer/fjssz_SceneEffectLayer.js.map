{"version":3,"sources":["fjssz_SceneEffectLayer.js"],"names":["app","require","cc","Class","extends","Component","properties","OnCreate","sceneType","JS_Name","join","effectDict","EffectManager","subGameName","node","on","Event_EffectAnimationEnd","event","modelComponent","DeleteSceneEffect","AddSceneEffect","effectName","effectRes","repeatCount","userData","that","CreateEffectByEffectRes","then","effectComponent","OnCreateEffectEnd","catch","error","ErrLog","stack","console","hasOwnProperty","Log","AddModelToParent","animationState","ShowEffect","wrapMode","WrapMode","Default","Loop","GetModelProperty","DeleteEffect","OnBeforeExitScene","DeleteEffectByDict"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,MAAMC,QAAQ,WAAR,CAAV;;AAEAC,GAAGC,KAAH,CAAS;AACRC,UAASF,GAAGG,SADJ;;AAGRC,aAAY,EAHJ;;AAMRC,WAAU,kBAAUC,SAAV,EAAqB;AAC9B,OAAKC,OAAL,GAAe,CAACD,SAAD,EAAY,kBAAZ,EAAgCE,IAAhC,CAAqC,GAArC,CAAf;;AAEA;AACA,OAAKC,UAAL,GAAkB,EAAlB;;AAEA,OAAKC,aAAL,GAAqBZ,IAAIA,IAAIa,WAAJ,GAAkB,gBAAtB,GAArB;;AAEA,OAAKC,IAAL,CAAUC,EAAV,CAAa,oBAAb,EAAmC,KAAKC,wBAAxC,EAAkE,IAAlE;AACA,EAfO;;AAiBR;AACAA,2BAAyB,kCAASC,KAAT,EAAe;AACvC,MAAIC,iBAAiBD,MAAM,OAAN,CAArB;AACA;AACA;AACA,OAAKE,iBAAL,CAAuBD,cAAvB;AACA,EAvBO;;AAyBR;;AAEA;AACAE,iBAAe,wBAASC,UAAT,EAAqBC,SAArB,EAA0D;AAAA,MAA1BC,WAA0B,uEAAd,CAAc;AAAA,MAAXC,QAAW,uEAAF,CAAE;;;AAExE,MAAIC,OAAO,IAAX;;AAEA,SAAO,KAAKb,aAAL,CAAmBc,uBAAnB,CAA2CL,UAA3C,EAAuDC,SAAvD,EAAkEE,QAAlE,EACHG,IADG,CACE,UAASC,eAAT,EAAyB;AAC9B,UAAOH,KAAKI,iBAAL,CAAuBR,UAAvB,EAAmCO,eAAnC,EAAoDL,WAApD,CAAP;AACA,GAHG,EAIHO,KAJG,CAIG,UAASC,KAAT,EAAe;AACrBN,QAAKO,MAAL,CAAY,8BAAZ,EAA4CX,UAA5C,EAAwDC,SAAxD,EAAmEE,QAAnE,EAA6EO,MAAME,KAAnF;AACA,GANG,CAAP;AAOA,EAvCO;;AAyCR;AACAJ,oBAAkB,2BAASR,UAAT,EAAqBO,eAArB,EAAsCL,WAAtC,EAAkD;AACnE,MAAG,CAACK,eAAJ,EAAoB;AACnBM,WAAQH,KAAR,CAAc,4BAAd,EAA4CV,UAA5C;AACA;AACA;;AAED,MAAG,KAAKV,UAAL,CAAgBwB,cAAhB,CAA+Bd,UAA/B,CAAH,EAA8C;AAC7C,QAAKe,GAAL,CAAS,2CAAT,EAAsDf,UAAtD;AACA;AACA;;AAEDO,kBAAgBS,gBAAhB,CAAiC,KAAKvB,IAAtC,EAA4C,KAAKA,IAAjD;;AAEA,MAAIwB,iBAAiBV,gBAAgBW,UAAhB,EAArB;AACA,MAAG,CAACD,cAAJ,EAAmB;AAClBJ,WAAQH,KAAR,CAAc,mCAAd;AACA;AACA;AACD;AACA,MAAGR,WAAH,EAAe;AACde,kBAAeE,QAAf,GAA2BtC,GAAGuC,QAAH,CAAYC,OAAvC;AACAJ,kBAAef,WAAf,GAA6BA,WAA7B;AACA,GAHD,MAII;AACH;AACAe,kBAAeE,QAAf,GAA2BtC,GAAGuC,QAAH,CAAYE,IAAvC;AACA;;AAED,OAAKhC,UAAL,CAAgBU,UAAhB,IAA8BO,eAA9B;;AAEA,SAAOA,eAAP;AACA,EAzEO;;AA2ER;AACAT,oBAAkB,2BAASD,cAAT,EAAwB;AACzC,MAAIG,aAAaH,eAAe0B,gBAAf,CAAgC,YAAhC,CAAjB;AACA,SAAO,KAAKjC,UAAL,CAAgBU,UAAhB,CAAP;AACA,OAAKT,aAAL,CAAmBiC,YAAnB,CAAgC3B,cAAhC;AACA,EAhFO;;AAkFR;AACA4B,oBAAkB,6BAAU;AAC3B,OAAKlC,aAAL,CAAmBmC,kBAAnB,CAAsC,KAAKpC,UAA3C;AACA,OAAKA,UAAL,GAAkB,EAAlB;AACA;AAtFO,CAAT","file":"fjssz_SceneEffectLayer.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\scene\\Layer","sourcesContent":["/*\r\n 场景特效层\r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\ncc.Class({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {\r\n\t},\r\n\r\n\tOnCreate: function (sceneType) {\r\n\t\tthis.JS_Name = [sceneType, \"SceneEffectLayer\"].join(\"_\");\r\n\r\n\t\t//场景特效字典\r\n\t\tthis.effectDict = {};\r\n\r\n\t\tthis.EffectManager = app[app.subGameName + \"_EffectManager\"]();\r\n\r\n\t\tthis.node.on(\"EffectAnimationEnd\", this.Event_EffectAnimationEnd, this);\r\n\t},\r\n\r\n\t//--------回调函数-----------------\r\n\tEvent_EffectAnimationEnd:function(event){\r\n\t\tlet modelComponent = event[\"Model\"];\r\n\t\t//let animationName = event[\"AnimationName\"];\r\n\t\t//特效播放结束删除掉\r\n\t\tthis.DeleteSceneEffect(modelComponent);\r\n\t},\r\n\r\n\t//------------特效相关-----------------------\r\n\r\n\t//创建场景特效\r\n\tAddSceneEffect:function(effectName, effectRes, repeatCount=0, userData=0){\r\n\r\n\t\tlet that = this;\r\n\r\n\t\treturn this.EffectManager.CreateEffectByEffectRes(effectName, effectRes, userData)\r\n\t\t\t\t\t.then(function(effectComponent){\r\n\t\t\t\t\t\treturn that.OnCreateEffectEnd(effectName, effectComponent, repeatCount);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch(function(error){\r\n\t\t\t\t\t\tthat.ErrLog(\"AddSceneEffect(%s, %s,%s):%s\", effectName, effectRes, userData, error.stack);\r\n\t\t\t\t\t})\r\n\t},\r\n\r\n\t//创建特效成功回调\r\n\tOnCreateEffectEnd:function(effectName, effectComponent, repeatCount){\r\n\t\tif(!effectComponent){\r\n\t\t\tconsole.error(\"OnCreateEffectEnd(%s) fail\", effectName);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif(this.effectDict.hasOwnProperty(effectName)){\r\n\t\t\tthis.Log(\"OnCreateEffectEnd effectDict have find:%s\", effectName);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\teffectComponent.AddModelToParent(this.node, this.node);\r\n\r\n\t\tlet animationState = effectComponent.ShowEffect();\r\n\t\tif(!animationState){\r\n\t\t\tconsole.error(\"OnCreateEffectEnd ShowEffect fail\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\t//如果是0代表循环播放\r\n\t\tif(repeatCount){\r\n\t\t\tanimationState.wrapMode  = cc.WrapMode.Default;\r\n\t\t\tanimationState.repeatCount = repeatCount;\r\n\t\t}\r\n\t\telse{\r\n\t\t\t//需要注意的是，修改wrapMode时，会重置time以及repeatCount\r\n\t\t\tanimationState.wrapMode  = cc.WrapMode.Loop;\r\n\t\t}\r\n\r\n\t\tthis.effectDict[effectName] = effectComponent;\r\n\r\n\t\treturn effectComponent\r\n\t},\r\n\r\n\t//删除特效\r\n\tDeleteSceneEffect:function(modelComponent){\r\n\t\tlet effectName = modelComponent.GetModelProperty(\"EffectName\");\r\n\t\tdelete this.effectDict[effectName];\r\n\t\tthis.EffectManager.DeleteEffect(modelComponent);\r\n\t},\r\n\r\n\t//场景准备退出前\r\n\tOnBeforeExitScene:function(){\r\n\t\tthis.EffectManager.DeleteEffectByDict(this.effectDict);\r\n\t\tthis.effectDict = {};\r\n\t},\r\n});\r\n"]}