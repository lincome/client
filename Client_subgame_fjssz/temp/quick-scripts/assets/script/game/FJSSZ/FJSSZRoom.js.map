{"version":3,"sources":["FJSSZRoom.js"],"names":["app","require","FJSSZRoom","BaseClass","extend","Init","JS_Name","ComTool","subGameName","ShareDefine","HeroManager","RoomSet","toUpperCase","RoomPosMgr","SysDataManager","OnReload","Log","dataInfo","roomConfig","roomRecord","ClearDissolve","ClearchangePlayerNum","OnInitRoomData","serverPack","RoomStateStringDict","prizeType","isCoinRoom","cfg","roomPosInfoList","OnInitRoomPosData","setInfo","OnInitRoomSetData","isGetGR","OnPosLeave","pos","UpdateOwnerID","ownerID","OnPosContinueGame","OnZhuangJia","opPos","beiShu","OnSetZhuangJia","OnSetStart","RoomState_Playing","GetRoomSet","GetRoomPosMgr","OnChangeStatus","SetStateStringDict","OnSetEnd","setEnd","OnRoomEnd","roomEnd","RoomState_End","OnStartVoteDissolve","createPos","endSec","posAgreeList","index","console","log","push","dissolveInfo","OnPosDealVote","agreeDissolve","error","length","RoomRecord","OnPosCardReady","OnPosIsReady","isReady","GetClientPos","ranked","SetRoomProperty","OnResult","playerList","sRankingResult","posResultList","idx","player","onPosJifen","onPosSportsPoint","reSetCardReady","OnTotalScoreFromLogin","posList","onPosTotalJifen","OnDissolve","dissolve","GetRoomRecord","GetRoomDataInfo","GetRoomProperty","property","hasOwnProperty","GetRoomConfig","GetRoomConfigByProperty","OnSportsPointChange","setID","IsClientIsCreater","heroID","GetHeroID","IsClientIsOwner","SetGameRecord","bget","GetGameRecord","GetClientPlayerSetPos","setPos","GetSetPosByPos","data","GetClientPlayerInfo","playerInfo","GetPlayerInfoByPos","OnStartChangePlaeryDissolve","playerNum","ChangePlayerNumAgree","g_FJSSZRoom","exports","GetModel"],"mappings":"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","file":"FJSSZRoom.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\script\\game\\FJSSZ","sourcesContent":["/*\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @copyright: Copyright (c) 2004, 2010 Xiamen DDM Network Technology Co.,Ltd., All rights reserved.\r\n *  ----------------------------------------------------------------------------------------------------\r\n *  @package FJSSZRoom.js\r\n *  @todo: 自由扑克房间\r\n *\r\n *  @version 1.0\r\n *\r\n *  修改时间 修改人 修改内容\r\n *  -------------------------------------------------------------------------------\r\n *\r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\n/**\r\n * 类构造\r\n */\r\nvar FJSSZRoom = app.BaseClass.extend({\r\n\r\n\t/**\r\n\t * 初始化\r\n\t */\r\n\tInit: function () {\r\n\r\n\t\tthis.JS_Name = \"FJSSZRoom\";\r\n\r\n\t\tthis.ComTool = app[app.subGameName + \"_ComTool\"]();\r\n\t\tthis.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t\tthis.HeroManager = app[app.subGameName + \"_HeroManager\"]();\r\n\t\tthis.RoomSet = app[app.subGameName.toUpperCase() + \"RoomSet\"]();\r\n\t\tthis.RoomPosMgr = app[app.subGameName.toUpperCase() + \"RoomPosMgr\"]();\r\n\t\tthis.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\t\tthis.OnReload();\r\n\r\n\t\tthis.Log(\"Init\");\r\n\r\n\t},\r\n\r\n\tOnReload: function () {\r\n\t\tthis.dataInfo = {};\r\n\t\tthis.roomConfig = {};\r\n\t\tthis.roomRecord = {};\r\n\t\tthis.RoomPosMgr.OnReload();\r\n\t\tthis.RoomSet.OnReload();\r\n\t},\r\n\tClearDissolve: function () {\r\n\t\tthis.dataInfo[\"dissolve\"] = \"\";\r\n\t},\r\n\tClearchangePlayerNum: function () {\r\n\t\tthis.dataInfo[\"changePlayerNum\"] = \"\";\r\n\t},\r\n\t//-----------------------回调函数-----------------------------\r\n\t//登录初始化房间数据\r\n\tOnInitRoomData: function (serverPack) {\r\n\t\tserverPack[\"state\"] = this.ShareDefine.RoomStateStringDict[serverPack[\"state\"]];\r\n\t\tif (serverPack.prizeType == 'Gold') {\r\n\t\t\tapp[app.subGameName + \"_ShareDefine\"]().isCoinRoom = true;\r\n\t\t} else if (serverPack.prizeType == 'RoomCard') {\r\n\t\t\tapp[app.subGameName + \"_ShareDefine\"]().isCoinRoom = false;\r\n\t\t}\r\n\r\n\t\tlet cfg = serverPack[\"cfg\"];\r\n\t\tthis.roomConfig = cfg;\r\n\r\n\t\tlet roomPosInfoList = serverPack[\"posList\"] || [];\r\n\t\tthis.RoomPosMgr.OnInitRoomPosData(roomPosInfoList);\r\n\r\n\t\tlet setInfo = serverPack[\"set\"];\r\n\t\tsetInfo[\"rankingResults\"] = serverPack[\"rankingResults\"];\r\n\t\tthis.RoomSet.OnInitRoomSetData(setInfo);\r\n\r\n\t\t//其余信息存放到dataInfo\r\n\t\tthis.dataInfo = serverPack;\r\n\r\n\t\tthis.isGetGR = false;\r\n\t\tthis.Log(\"roomConfig:\", this.roomConfig);\r\n\t\tthis.Log(\"dataInfo:\", this.dataInfo);\r\n\t},\r\n\r\n\t//位置离开\r\n\tOnPosLeave: function (pos) {\r\n\t\tthis.RoomPosMgr.OnPosLeave(pos);\r\n\t\tthis.RoomSet.OnPosLeave(pos);\r\n\t},\r\n\tUpdateOwnerID: function (ownerID) {\r\n\t\tthis.dataInfo['ownerID'] = ownerID;\r\n\t},\r\n\t//继续游戏\r\n\tOnPosContinueGame: function (pos) {\r\n\t\tthis.RoomPosMgr.OnPosContinueGame(pos);\r\n\t\tthis.RoomSet.OnPosContinueGame(pos);\r\n\t},\r\n\tOnZhuangJia: function (opPos, beiShu) {\r\n\t\tthis.RoomSet.OnSetZhuangJia(opPos, beiShu);\r\n\t},\r\n\t//set开始\r\n\tOnSetStart: function (setInfo) {\r\n\t\tthis.dataInfo[\"state\"] = this.ShareDefine.RoomState_Playing;\r\n\t\tthis.dataInfo[\"setID\"] = setInfo[\"setID\"];\r\n\t\tthis.GetRoomSet().OnSetStart(setInfo);\r\n\t\tthis.GetRoomPosMgr().OnSetStart(setInfo[\"posInfo\"]);\r\n\t},\r\n\t//游戏状态改变\r\n\tOnChangeStatus: function (setInfo) {\r\n\t\tthis.dataInfo[\"state\"] = this.ShareDefine.SetStateStringDict[setInfo[\"state\"]];\r\n\t\tthis.dataInfo[\"setID\"] = setInfo[\"setID\"];\r\n\t\tthis.GetRoomSet().OnChangeStatus(setInfo);\r\n\t\tthis.GetRoomPosMgr().OnChangeStatus(setInfo);\r\n\t},\r\n\r\n\t//set结束\r\n\tOnSetEnd: function (setEnd) {\r\n\t\tthis.RoomSet.OnSetEnd(setEnd);\r\n\t\tthis.RoomPosMgr.OnSetEnd(setEnd);\r\n\t},\r\n\r\n\t//房间结束\r\n\tOnRoomEnd: function (roomEnd) {\r\n\t\tthis.dataInfo[\"state\"] = this.ShareDefine.RoomState_End;\r\n\t\tthis.dataInfo[\"roomEnd\"] = roomEnd;\r\n\t},\r\n\r\n\t//开始解散房间\r\n\tOnStartVoteDissolve: function (createPos, endSec) {\r\n\t\tlet posAgreeList = [];\r\n\r\n\t\tfor (let index = 0; index < 10; index++) {\r\n\t\t\tconsole.log(\"createPos:\" + createPos + \",index:\" + index);\r\n\t\t\tif (index == createPos) {\r\n\t\t\t\tposAgreeList.push(1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tposAgreeList.push(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet dissolveInfo = {\"endSec\": endSec, \"createPos\": createPos, \"posAgreeList\": posAgreeList};\r\n\t\tthis.dataInfo[\"dissolve\"] = dissolveInfo;\r\n\t\treturn dissolveInfo;\r\n\t},\r\n\r\n\t//位置同意拒绝更新\r\n\tOnPosDealVote: function (pos, agreeDissolve) {\r\n\r\n\t\tlet dissolveInfo = this.dataInfo[\"dissolve\"];\r\n\t\t``\r\n\t\tlet posAgreeList = dissolveInfo[\"posAgreeList\"];\r\n\t\tif (!posAgreeList) {\r\n\t\t\tconsole.error(\"OnPosDealVote not find posAgreeList:\", this.dataInfo);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (pos >= posAgreeList.length) {\r\n\t\t\tconsole.error(\"OnPosDealVote(%s,%s):\", pos, agreeDissolve, posAgreeList);\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (agreeDissolve) {\r\n\t\t\tposAgreeList[pos] = 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tposAgreeList[pos] = 2;\r\n\t\t}\r\n\t\treturn dissolveInfo\r\n\t},\r\n\t//更新房间内的对局记录信息\r\n\tRoomRecord: function (serverPack) {\r\n\t\tthis.roomRecord = {};\r\n\t\tthis.roomRecord = serverPack;\r\n\t},\r\n\r\n\r\n\t//更新玩家是否摆好牌\r\n\tOnPosCardReady: function (serverPack) {\r\n\t\tthis.GetRoomPosMgr().OnPosIsReady(serverPack.pos, serverPack.isReady);\r\n\t\tif (serverPack.pos == this.RoomPosMgr.GetClientPos() && serverPack.ranked && serverPack.isReady) {\r\n\t\t\tthis.GetRoomSet().SetRoomProperty(\"ranked\",serverPack.ranked)\r\n\t\t}\r\n\t},\r\n\t//---------------------设置函数---------------------\r\n\t//保存当前局所有比牌信息\r\n\tOnResult: function (serverPack) {\r\n\t\tthis.GetRoomSet().OnResult(serverPack);\r\n\t\tthis.dataInfo[\"resultInfo\"] = serverPack;\r\n\t\tlet playerList = serverPack.sRankingResult.posResultList;\r\n\t\tfor (let idx = 0; idx < playerList.length; idx++) {\r\n\t\t\tlet player = playerList[idx];\r\n\t\t\tthis.RoomPosMgr.onPosJifen(player);\r\n\t\t\tthis.RoomPosMgr.onPosSportsPoint(player);\r\n\t\t}\r\n\t\tthis.RoomPosMgr.reSetCardReady();\r\n\t},\r\n\tOnTotalScoreFromLogin: function (posList) {\r\n\r\n\t\tthis.RoomPosMgr.onPosTotalJifen(posList);\r\n\r\n\t},\r\n\tOnDissolve: function (dissolve) {\r\n\t\tthis.dataInfo[\"dissolve\"] = dissolve;\r\n\t},\r\n\t//---------------------获取函数---------------------\r\n\t//获取对局记录信息\r\n\tGetRoomRecord: function () {\r\n\t\treturn this.roomRecord;\r\n\t},\r\n\t//获取房间信息\r\n\tGetRoomDataInfo: function () {\r\n\t\treturn this.dataInfo;\r\n\t},\r\n\t//获取创建房间信息b\r\n\tGetRoomProperty: function (property) {\r\n\t\tif (!this.dataInfo.hasOwnProperty(property)) {\r\n\t\t\tconsole.error(\"GetRoomProperty not find:%s\", property);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.dataInfo[property];\r\n\t},\r\n\r\n\t//获取房间配置信息\r\n\tGetRoomConfig: function () {\r\n\t\treturn this.roomConfig\r\n\t},\r\n\r\n\t//获取房间配置信息\r\n\tGetRoomConfigByProperty: function (property) {\r\n\t\tif (!this.roomConfig.hasOwnProperty(property)) {\r\n\t\t\tconsole.error(\"GetRoomConfigByProperty not find:%s\", property);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.roomConfig[property];\r\n\t},\r\n\tOnSportsPointChange: function (serverPack) {\r\n\t\tthis.RoomPosMgr.OnSportsPointChange(serverPack);\r\n\t},\r\n\tGetRoomSet: function () {\r\n\t\tlet setID = this.dataInfo[\"setID\"];\r\n\t\tif (!setID) {\r\n\t\t\tconsole.error(\"GetSet not start set\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn this.RoomSet\r\n\t},\r\n\r\n\tGetRoomPosMgr: function () {\r\n\t\treturn this.RoomPosMgr\r\n\t},\r\n\t//客户端玩家是否是开房人\r\n\tIsClientIsCreater: function () {\r\n\t\tlet heroID = this.HeroManager.GetHeroID();\r\n\t\tif (heroID == this.dataInfo[\"ownerID\"]) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t},\r\n\t//客户端玩家是否是房主\r\n\tIsClientIsOwner: function () {\r\n\t\tlet heroID = this.HeroManager.GetHeroID();\r\n\t\tif (heroID == this.dataInfo[\"ownerID\"]) {\r\n\t\t\treturn true\r\n\t\t}\r\n\t\treturn false\r\n\t},\r\n\r\n\tSetGameRecord: function (bget) {\r\n\t\tthis.isGetGR = bget;\r\n\t},\r\n\r\n\tGetGameRecord: function () {\r\n\t\treturn this.isGetGR;\r\n\t},\r\n\r\n\t//获取玩家setPos对象\r\n\tGetClientPlayerSetPos: function () {\r\n\r\n\t\tlet pos = this.RoomPosMgr.GetClientPos();\r\n\t\tif (pos < 0) {\r\n\t\t\tconsole.error(\"GetClientPlayerSetPos not enter room\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet setPos = this.RoomSet.GetSetPosByPos(pos);\r\n\t\tif (!setPos) {\r\n\t\t\tconsole.error(\"GetClientPlayerSetPos(%s) not find setPos\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn setPos\r\n\t},\r\n\t//更新房间信息\r\n\tSetRoomProperty: function (property, data) {\r\n\t\tif (!this.dataInfo.hasOwnProperty(property)) {\r\n\t\t\tconsole.error(\"SetRoomProperty not find:%\", property);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.dataInfo[property] = data;\r\n\t},\r\n\t//获取客户端玩家信息\r\n\tGetClientPlayerInfo: function () {\r\n\t\tlet pos = this.RoomPosMgr.GetClientPos();\r\n\t\tif (pos < 0) {\r\n\t\t\tconsole.error(\"GetClientPlayerInfo not enter room\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tlet playerInfo = this.RoomPosMgr.GetPlayerInfoByPos(pos);\r\n\t\tif (!playerInfo) {\r\n\t\t\tconsole.error(\"GetClientPlayerInfo(%s) not find playerInfo\", pos);\r\n\t\t\treturn\r\n\t\t}\r\n\t\treturn playerInfo\r\n\t},\r\n\t//人数修改\r\n\tOnStartChangePlaeryDissolve: function (createPos, playerNum, endSec) {\r\n\t\tlet posAgreeList = [];\r\n\t\tfor (let index = 0; index < 8; index++) {\r\n\t\t\tif (index == createPos) {\r\n\t\t\t\tposAgreeList.push(1);\r\n\t\t\t} else {\r\n\t\t\t\tposAgreeList.push(0);\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet dissolveInfo = {\"endSec\": endSec, \"createPos\": createPos, \"posAgreeList\": posAgreeList};\r\n\t\tthis.dataInfo[\"changePlayerNum\"] = dissolveInfo;\r\n\t\treturn dissolveInfo;\r\n\t},\r\n\t//位置同意拒绝更新\r\n\tChangePlayerNumAgree: function (pos, agreeDissolve) {\r\n\t\tlet dissolveInfo = this.dataInfo[\"changePlayerNum\"] || {posAgreeList: [0, 0, 0, 0, 0, 0, 0, 0]};\r\n\t\tlet posAgreeList = dissolveInfo[\"posAgreeList\"];\r\n\t\tif (!posAgreeList) {\r\n\t\t\tconsole.error(\"OnChangeDealVote not find posAgreeList:\", this.dataInfo);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (pos >= posAgreeList.length) {\r\n\t\t\tconsole.error(\"OnChangeDealVote(%s,%s):\", pos, agreeDissolve, posAgreeList);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tif (agreeDissolve) {\r\n\t\t\tposAgreeList[pos] = 1;\r\n\t\t} else {\r\n\t\t\tposAgreeList[pos] = 2;\r\n\t\t}\r\n\t\treturn dissolveInfo\r\n\t},\r\n});\r\n\r\n\r\nvar g_FJSSZRoom = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_FJSSZRoom)\r\n\t\tg_FJSSZRoom = new FJSSZRoom();\r\n\treturn g_FJSSZRoom;\r\n\r\n}\r\n"]}