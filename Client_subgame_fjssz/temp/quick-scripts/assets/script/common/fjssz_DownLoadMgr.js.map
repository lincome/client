{"version":3,"sources":["fjssz_DownLoadMgr.js"],"names":["app","require","DownLoadstate","DwonLoadState_Finish","DwonLoadState_Error","DwonLoadState_Progress","fjssz_DownLoadMgr","BaseClass","extend","extends","cc","Component","properties","Init","JS_Name","subGameName","serverUrl","loaclPath","fileName","downloadType","count","OnTimer","pafqplSecond","ShowSysMsg","DownFile","Director","getInstance","getScheduler","unschedule","OnConFirm","clickType","msgID","backArgList","console","error","localPath","argList","value","CallToNative","OnDownFileFinish","serverPack","OnEvent","OnDownFileError","isScheduled","schedule","OnDownFileProgress","OnDownLoadEvent","GetDownLoadStateError","GetDownLoadStateFinish","GetDownLoadStateProgress","apply","g_fjssz_DownLoadMgr","exports","GetModel"],"mappings":"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","file":"fjssz_DownLoadMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    下载管理类\r\n */\r\nvar app = require(\"fjssz_app\");\r\n\r\nvar DownLoadstate = function () {\r\n\t//下载事件\r\n\tthis.DwonLoadState_Finish = 0;//下载完成\r\n\tthis.DwonLoadState_Error = 1;//下载失败\r\n\tthis.DwonLoadState_Progress = 2;//下载进度\r\n};\r\n\r\nvar fjssz_DownLoadMgr = app.BaseClass.extend({\r\n\textends: cc.Component,\r\n\r\n\tproperties: {},\r\n\r\n\tInit: function () {\r\n\t\tthis.JS_Name = app.subGameName + \"_DownLoadMgr\";\r\n\r\n\t\tthis.serverUrl = null;\r\n\t\tthis.loaclPath = null;\r\n\t\tthis.fileName = null;\r\n\t\tthis.downloadType = null;\r\n\t\tthis.count = 0\r\n\r\n\r\n\t\t//下载事件\r\n\t\t//this.DwonLoadState_Finish       = 0;//下载完成\r\n\t\t//this.DwonLoadState_Error        = 1;//下载失败\r\n\t\t//this.DwonLoadState_Progress     = 2;//下载进度\r\n\r\n\t\t//this.DownFile(\"http://voice.qp355.com:8080/mp3/20170705/1499260230432a2c41d49b5575fab91b8fd37f5e16.amr\", \"/data/user/0/com.ddmh5.p7/files/100191499260129329.amr\", \"deleteString\",  \"AMRFILEDOWNLOADFINISH\" );\r\n\t},\r\n\r\n\t//1秒回掉\r\n\tOnTimer: function (pafqplSecond) {\r\n\t\tapp[app.subGameName + \"_SysNotifyManager\"]().ShowSysMsg(\"MSG_DOWNLOAD_ERROR\");\r\n\t\tthis.count++;\r\n\t\t// if(this.count > 3){\r\n\t\t//     let msgID = \"Net_ReconnectConnectFail\";\r\n\t\t//     let ConfirmManager = app[app.subGameName+\"_ConfirmManager\"]();\r\n\t\t//     ConfirmManager.SetWaitForConfirmForm(this.OnConFirm.bind(this), msgID, []);\r\n\t\t//     ConfirmManager.ShowConfirm(app[app.subGameName+\"_ShareDefine\"]().ConfirmOK, msgID, [])\r\n\r\n\t\t//     cc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n\t\t//     return;\r\n\t\t// }\r\n\t\tthis.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n\t\tcc.Director.getInstance().getScheduler().unschedule(this.OnTimer, this);\r\n\t},\r\n\r\n\t//确认框点击\r\n\tOnConFirm: function (clickType, msgID, backArgList) {\r\n\t\tif (clickType != \"Sure\") {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t//如果是尝试继续重连\r\n\t\tif (msgID == \"Net_ReconnectConnectFail\") {\r\n\t\t\tthis.DownFile(this.serverUrl, this.loaclPath, this.fileName, this.downloadType);\r\n\t\t} else {\r\n\t\t\tconsole.error(\"OnConFirm:%s\", msgID);\r\n\t\t}\r\n\t},\r\n\r\n\t//下载文件  filename 没有值是设置为deleteString\r\n\tDownFile: function (serverUrl, localPath, fileName, downloadType) {\r\n\t\tif (serverUrl == null || localPath == null || downloadType == null) {\r\n\t\t\tconsole.error(\"DownFile serverUrl == null || localPath == null || downloadType == null\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.serverUrl = serverUrl;\r\n\t\tthis.loaclPath = localPath;\r\n\t\tthis.fileName = fileName;\r\n\t\tthis.downloadType = downloadType;\r\n\t\t//this.count = 0\r\n\t\tlet argList = [{\"Name\": \"urls\", \"Value\": serverUrl}, {\r\n\t\t\t\"Name\": \"fileName\",\r\n\t\t\t\"Value\": fileName\r\n\t\t}, {\"Name\": \"savePath\", \"Value\": localPath}, {\"Name\": \"downloadType\", \"Value\": downloadType}];\r\n\t\tlet value = app[app.subGameName + \"_NativeManager\"]().CallToNative(\"downLoadFile\", argList);\r\n\t},\r\n\r\n\t//下载完成\r\n\tOnDownFileFinish: function (serverPack) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n\t\tthis.serverUrl = null;\r\n\t\tthis.loaclPath = null;\r\n\t\tthis.fileName = null;\r\n\t\tthis.downloadType = null;\r\n\t\tthis.count = 0\r\n\t},\r\n\r\n\t//下载失败\r\n\tOnDownFileError: function (serverPack) {\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\r\n\t\tif (!cc.Director.getInstance().getScheduler().isScheduled(this.OnTimer, this)) {\r\n\t\t\tcc.Director.getInstance().getScheduler().schedule(this.OnTimer, this, 3.0);\r\n\t\t}\r\n\r\n\r\n\t},\r\n\r\n\t//下载进度\r\n\tOnDownFileProgress: function (serverPack) {\r\n\t\t//app[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], {\"progress\": serverPack[\"proess\"]});\r\n\t\tapp[app.subGameName + \"Client\"].OnEvent(serverPack[\"downloadType\"], serverPack);\r\n\t},\r\n\r\n\t//下载事件\r\n\tOnDownLoadEvent: function (serverPack) {\r\n\t\tif (serverPack[\"state\"] == fjssz_DownLoadMgr.DwonLoadState_Finish) {\r\n\t\t\tthis.OnDownFileFinish(serverPack);\r\n\t\t} else if (serverPack[\"state\"] == fjssz_DownLoadMgr.DwonLoadState_Error) {\r\n\t\t\tthis.OnDownFileError(serverPack);\r\n\t\t} else if (serverPack[\"state\"] == fjssz_DownLoadMgr.DwonLoadState_Progress) {\r\n\t\t\tthis.OnDownFileProgress(serverPack);\r\n\t\t}\r\n\t},\r\n\r\n\t//获取失败标识\r\n\tGetDownLoadStateError: function () {\r\n\t\treturn fjssz_DownLoadMgr.DwonLoadState_Error;\r\n\t},\r\n\t//获取成功标识\r\n\tGetDownLoadStateFinish: function () {\r\n\t\treturn fjssz_DownLoadMgr.DwonLoadState_Finish;\r\n\t},\r\n\t//获取进度标识\r\n\tGetDownLoadStateProgress: function () {\r\n\t\treturn fjssz_DownLoadMgr.DwonLoadState_Progress;\r\n\t},\r\n});\r\n\r\n\r\nDownLoadstate.apply(fjssz_DownLoadMgr, []);\r\n\r\nvar g_fjssz_DownLoadMgr = null;\r\n/**\r\n ...\r\n */\r\nexports.GetModel = function () {\r\n\tif (!g_fjssz_DownLoadMgr) {\r\n\t\tg_fjssz_DownLoadMgr = new fjssz_DownLoadMgr();\r\n\t}\r\n\treturn g_fjssz_DownLoadMgr;\r\n};"]}