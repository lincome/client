{"version":3,"sources":["fjssz_HeroAccountManager.js"],"names":["app","require","fjssz_HeroAccountManager","BaseClass","extend","Init","JS_Name","NetManager","subGameName","LocalDataManager","ShareDefine","SysNotifyManager","SysDataManager","RegHttpNetPack","OnHttpPack_AccountLogin","OnHttpPack_RegAccountResult","OnHttpPack_ChangeAccountPswResult","RegEvent","Event_CodeError","Event_ConnectFail","Event_ConnectHttpFail","Event_ConnectSuccess","PswReg","AccountReg","AccountFirstStrReg","OnReload","localAccountDict","logInAccountList","InitLocalAccount","lastChangeTime","IsDoLogining","dataInfo","event","codeInfo","KickOut_AccountAuthorizationFail","accountType","GetClientConfigProperty","SDKType_WeChat","gameLoadUrl","window","location","href","SetConfigProperty","IsFormShow","UpdateAccessPoint","now","Date","getTime","ChangeAccessPoint","InitServerAddress","cc","sys","isNative","AccessPoint","GetConfigProperty","accountDict","accountList","charAccount","InArray","console","error","AddNewAccountList","account","token","Remove","push","SavePlayerAccount","DeleteLocalAccount","DeleteAllLocalAccount","GetAccountToken","hasOwnProperty","GetLocalAccountList","GetAccountProperty","property","SetAccountProperty","value","GetAccountInfo","CheckCanUseAccount","test","CheckCanUsePassWord","psw","CheckAccountFirstStr","ErrorCloseGame","log","game","off","EVENT_HIDE","EVENT_SHOW","switchGameData","LoadScene","roomMgr","toUpperCase","clubId","unionId","action","localStorage","setItem","JSON","stringify","StopAllSound","isConnectIng","Disconnect","RemoveClientManager","gamePath","jsb","fileUtils","getWritablePath","isReconnecting","accountID","uuid","SendPack","serverID","sendPack","ClientVersion","GetHeroID","SendReConnect","version","reloginSign","signString","toString","sign","MD5","hex_md5","serverPack","result","Result","ShowSysMsg","Psw","sdkToken","accessTokenInfo","SDKType_WeChatApp","SDKType_Company","InitConnectServer","AccountLogin","isToken","isDoLogin","GetHttpSendPack","CharAccount","CharAccountPsw","IsToken","SendHttpPack","OneKeyRegAccount","SendRegAccount","accountPsw","SendChangeAccountPsw","oldPsw","newPsw","AccountID","OldPsw","NewPsw","LoginAccountBySDK","sdkType","mpID","sdkAccountID","that","director","getScene","_sgNode","scheduleOnce","SDKType","Token","UserData","SDKAccountID","state","OnEvent","g_fjssz_HeroAccountManager","exports","GetModel"],"mappings":"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","file":"fjssz_HeroAccountManager.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\script\\common","sourcesContent":["/*\r\n    玩家账号数据管理器\r\n*/\r\nvar app = require(\"fjssz_app\");\r\n\r\nvar fjssz_HeroAccountManager = app.BaseClass.extend({\r\n\r\n    Init:function(){\r\n    \tthis.JS_Name = app[\"subGameName\"] + \"_HeroAccountManager\";\r\n\r\n    \tthis.NetManager = app[app.subGameName + \"_NetManager\"]();\r\n        this.LocalDataManager = app.LocalDataManager();\r\n        this.ShareDefine = app[app.subGameName + \"_ShareDefine\"]();\r\n\t    this.SysNotifyManager = app[app.subGameName + \"_SysNotifyManager\"]();\r\n\t    this.SysDataManager = app[app.subGameName + \"_SysDataManager\"]();\r\n\r\n        this.NetManager.RegHttpNetPack(0x0000, this.OnHttpPack_AccountLogin, this);\r\n        this.NetManager.RegHttpNetPack(0x0005, this.OnHttpPack_RegAccountResult, this);\r\n        this.NetManager.RegHttpNetPack(0x0006, this.OnHttpPack_ChangeAccountPswResult, this);\r\n\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"CodeError\", this.Event_CodeError, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectFail\", this.Event_ConnectFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(\"ConnectHttpFail\", this.Event_ConnectHttpFail, this);\r\n\t    app[app.subGameName + \"Client\"].RegEvent(app.subGameName + \"_ConnectSuccess\", this.Event_ConnectSuccess, this);\r\n\r\n\t    //密码正则表达式(长度5~11之间,只能包含字符,数字和下划线)\r\n\t    this.PswReg = /^(\\w){5,11}$/;\r\n\t    //账号正则表达式(字符开头,长度5~16之间,只能包含字符,数字和下划线)\r\n\t    this.AccountReg = /^[a-zA-Z]\\w{4,15}$/;\r\n\r\n\t    //账号首字符正则表达式(首字符字母)\r\n\t    this.AccountFirstStrReg = /^[a-zA-z]/;\r\n\r\n    \tthis.OnReload();\r\n\r\n        //本地缓存账号密码字典 {account:psw}\r\n        this.localAccountDict = {};\r\n        //登陆账号顺序列表 晚登陆的在后面\r\n        this.logInAccountList = [];\r\n\r\n        this.InitLocalAccount();\r\n        this.lastChangeTime=0;\r\n\t\t\r\n    },\r\n\r\n    //切换账号\r\n    OnReload:function(){\r\n    \tthis.IsDoLogining(false);\r\n    \tthis.dataInfo = {};\r\n    },\r\n\r\n\tEvent_CodeError:function(event){\r\n\t\tlet codeInfo = event;\r\n\t\t//如果是授权失败,过期了,重新授权\r\n\t\tif(codeInfo[\"Code\"] == this.ShareDefine.KickOut_AccountAuthorizationFail){\r\n\t\t\tlet accountType = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"AccountType\");\r\n            if(accountType==this.ShareDefine.SDKType_WeChat){\r\n                //微信浏览器登录情况\r\n                let gameLoadUrl = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"GameLoadUrl\");\r\n                window.location.href=gameLoadUrl;\r\n            }\r\n\t\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", {});\r\n\t\t\tif(app[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\") == false){\r\n\t\t\t\tapp[app.subGameName + \"_FormManager\"]().IsFormShow(\"UILogin01\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t//密码错误等异常,需要清除登录标示\r\n\t\tthis.IsDoLogining(false);\r\n\r\n\t},\r\n\t//连接服务器失败\r\n\tEvent_ConnectFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n\r\n\tEvent_ConnectHttpFail:function(event){\r\n\t\tthis.IsDoLogining(false);\r\n\t\tthis.UpdateAccessPoint();\r\n\t},\r\n\tUpdateAccessPoint:function(){\r\n\t\tlet now= new Date().getTime();\r\n\t\tif(now-this.lastChangeTime<5000){\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.lastChangeTime = now;\r\n        this.ChangeAccessPoint();\r\n        app[app.subGameName + \"_NetManager\"]().InitServerAddress();\r\n    },\r\n    ChangeAccessPoint:function(){\r\n        if(!cc.sys.isNative){\r\n            return;  //浏览器不用切换节点\r\n        }\r\n        let AccessPoint=app.LocalDataManager().GetConfigProperty(\"Account\", \"AccessPoint\");\r\n        if(AccessPoint==0){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",1);\r\n        }else if(AccessPoint==1){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",2);\r\n        }else if(AccessPoint==2){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",3);\r\n        }else if(AccessPoint==3){\r\n            app.LocalDataManager().SetConfigProperty(\"Account\", \"AccessPoint\",0);\r\n        }\r\n    },\r\n    //---------------------本地账号逻辑-----------------\r\n\r\n    //解析本地缓存账号记录\r\n    InitLocalAccount:function(){\r\n        let accountDict = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountDict\");\r\n        let accountList = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountList\");\r\n\r\n        this.logInAccountList = accountList;\r\n\r\n        for(var charAccount in accountDict){\r\n            if(this.logInAccountList.InArray(charAccount, true)){\r\n                this.localAccountDict[charAccount] = accountDict[charAccount];\r\n            }\r\n            else{\r\n                console.error(\"InitLocalAccount logInAccountList not find :%s\", charAccount);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 增加本地缓存账号\r\n     * @param account\r\n     * @param psw\r\n     */\r\n    AddNewAccountList:function(account, token){\r\n\r\n        if (this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n            this.logInAccountList.push(account);\r\n        }\r\n        else{\r\n            this.logInAccountList.push(account);\r\n        }\r\n\r\n        this.localAccountDict[account] = token;\r\n\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 删除本地账号\r\n     * @param account\r\n     */\r\n    DeleteLocalAccount:function(account){\r\n\r\n        if(this.logInAccountList.InArray(account)){\r\n            this.logInAccountList.Remove(account);\r\n\r\n        }\r\n        delete this.localAccountDict[account];\r\n\r\n        this.SavePlayerAccount();\r\n\r\n    },\r\n\r\n    /**\r\n     * 清除本地所有账号\r\n     * @param account\r\n     */\r\n    DeleteAllLocalAccount:function(){\r\n        this.localAccountDict = {};\r\n        this.logInAccountList = [];\r\n        this.SavePlayerAccount();\r\n    },\r\n\r\n    /**\r\n     * 保存账号数据\r\n     */\r\n    SavePlayerAccount:function(){\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountDict\", this.localAccountDict);\r\n        this.LocalDataManager.SetConfigProperty(\"Account\", \"AccountList\", this.logInAccountList);\r\n    },\r\n\r\n    /**\r\n     * 获取账号密码\r\n     * @param account\r\n     */\r\n    GetAccountToken:function(account){\r\n        if (!this.localAccountDict.hasOwnProperty(account)){\r\n            // this.Log(\"GetAccountToken not find:%s\", account);\r\n            return \"\"\r\n        }\r\n        return this.localAccountDict[account]\r\n    },\r\n\r\n    /**\r\n     * 获取缓存账号列表\r\n     */\r\n    GetLocalAccountList:function(){\r\n        return this.logInAccountList\r\n    },\r\n\r\n    GetAccountProperty:function(property){\r\n        if(!this.dataInfo.hasOwnProperty(property)){\r\n            console.error(\"GetAccountProperty not find:%s\", property);\r\n            return\r\n        }\r\n        return this.dataInfo[property];\r\n    },\r\n\r\n    SetAccountProperty:function(property, value){\r\n        this.dataInfo[property] = value;\r\n    },\r\n\r\n\t//获取账号属性\r\n\tGetAccountInfo:function(){\r\n\t\treturn this.dataInfo;\r\n\t},\r\n\r\n\t/**\r\n\t * 检测账号是否合法\r\n\t */\r\n\tCheckCanUseAccount:function(account){\r\n\t\treturn this.AccountReg.test(account)\r\n\t},\r\n\r\n\t/**\r\n\t * 检测密码合法\r\n\t * @param psw\r\n\t */\r\n\tCheckCanUsePassWord:function(psw){\r\n\t\treturn this.PswReg.test(psw)\r\n\t},\r\n\r\n\tCheckAccountFirstStr:function(account){\r\n\t\treturn this.AccountFirstStrReg.test(account);\r\n\t},\r\n\r\n    //---------------------事件回掉函数-----------------\r\n\tErrorCloseGame: function () {\r\n\t\tconsole.log(\"异常关闭游戏：\" + app.subGameName);\r\n\t\tcc.game.off(cc.game.EVENT_HIDE);\r\n\t\tcc.game.off(cc.game.EVENT_SHOW);\r\n\t\tlet switchGameData = null;\r\n\t\tif (!cc.sys.isNative) {\r\n\t\t\tapp[app.subGameName + \"_SceneManager\"]().LoadScene(app.subGameName + \"MainScene\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet roomMgr = app[app.subGameName.toUpperCase() + \"RoomMgr\"]();\r\n\t\tif (roomMgr) {\r\n\t\t\tif (roomMgr.clubId > 0 || roomMgr.unionId > 0) {\r\n\t\t\t\tswitchGameData = {action: \"openClub\"};\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (switchGameData != null) {\r\n\t\t\tcc.sys.localStorage.setItem(\"switchGameData\", JSON.stringify(switchGameData));\r\n\t\t}\r\n\t\tapp[app.subGameName + \"_SoundManager\"]().StopAllSound();\r\n\t\t//主动断开socket连接，服务端会将玩家踢出\r\n\t\tif (app[app.subGameName + \"_NetWork\"]().isConnectIng) {\r\n\t\t\tapp[app.subGameName + \"_NetManager\"]().Disconnect(true);\r\n\t\t}\r\n\t\tapp[app.subGameName + \"Client\"].RemoveClientManager();\r\n\t\tlet gamePath = (jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + \"ALLGame/\" + app.subGameName;\r\n\t\tconsole.log(\"ExitGame gamePath:\" + gamePath);\r\n\t\twindow.require(gamePath + \"/src/hall.js\");\r\n\r\n\t},\r\n\t//连接服务器成功\r\n\tEvent_ConnectSuccess:function(event){\r\n        console.log(app.subGameName + \" 连接服务器成功\");\r\n        app[app.subGameName + \"_NetWork\"]().isReconnecting=false;\r\n        app[app.subGameName + \"_NetWork\"]().isConnectIng=true;\r\n        if(!this.dataInfo[\"AccountID\"]){\r\n\t\t\tconsole.log(\"Event_ConnectSuccess not dataInfo\");\r\n\r\n\t\t\tthis.IsDoLogining(false);\r\n\t\t\t//本地开发项目跳过登录，请求一个游客账号\r\n\t\t\tif (!cc.sys.isNative) {\r\n\t\t\t\t// this.NetManager.SendPack(\"base.C1111RoleReLogin\", {\"accountID\":0, \"uuid\":0, \"gameName\":app.subGameName});\r\n\t\t\t\t//this.OneKeyRegAccount();\r\n\t\t\t} else {\r\n\t\t\t\tlet accountID = this.LocalDataManager.GetConfigProperty(\"Account\", \"AccountID\");\r\n\t\t\t\tlet uuid = this.LocalDataManager.GetConfigProperty(\"Account\", \"uuid\");\r\n\t\t\t\tthis.NetManager.SendPack(\"base.C1111RoleReLogin\", {\r\n\t\t\t\t\t\"accountID\": accountID,\r\n\t\t\t\t\t\"uuid\": uuid,\r\n\t\t\t\t\t\"gameName\": app.subGameName\r\n\t\t\t\t});\r\n\t\t\t\tthis.dataInfo[\"AccountID\"] = accountID;\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t//网页测试用游客登录\r\n\t\tif (!cc.sys.isNative) {\r\n\t\t\tlet serverID = app[app.subGameName + \"Client\"].GetClientConfigProperty(\"ServerID\");\r\n\t\t\tlet sendPack = {\r\n\t\t\t\t\"accountID\": this.dataInfo[\"AccountID\"],\r\n\t\t\t\t\"openid\": this.dataInfo[\"Openid\"],\r\n\t\t\t\t\"unionid\": this.dataInfo[\"Unionid\"],\r\n\t\t\t\t\"token\": this.dataInfo[\"Token\"],\r\n\t\t\t\t\"nickName\": this.dataInfo[\"NickName\"],\r\n\t\t\t\t\"sex\": this.dataInfo[\"Sex\"],\r\n\t\t\t\t\"headImageUrl\": this.dataInfo[\"HeadImageUrl\"],\r\n\t\t\t\t\"serverID\": serverID,\r\n\t\t\t\t\"version\": this.ShareDefine.ClientVersion,\r\n\t\t\t};\r\n\r\n\t\t\t//如果是重连\r\n\t\t\tif (app[app.subGameName + \"_HeroManager\"]().GetHeroID()) {\r\n\t\t\t\tthis.NetManager.SendReConnect(\"base.C1004Login\", sendPack);\r\n\t\t\t} else {\r\n\t\t\t\t//登录过程完成\r\n\t\t\t\tthis.IsDoLogining(false);\r\n\t\t\t\t//发送登陆token到connector\r\n\t\t\t\tconsole.log(\"登录过程完成:\", JSON.stringify(sendPack));\r\n\t\t\t\tthis.NetManager.SendPack(\"base.C1004Login\", sendPack);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//如果是重连\r\n\t\t\tif (app[app.subGameName + \"_HeroManager\"]().GetHeroID()) {\r\n\t\t\t\tlet accountID = this.dataInfo[\"AccountID\"];\r\n\t\t\t\tlet version = \"1.0.1\";\r\n\t\t\t\tlet reloginSign = this.dataInfo[\"reloginSign\"];\r\n\t\t\t\tif (typeof(accountID) == \"undefined\") {\r\n\t\t\t\t\tconsole.log(\"本地内存还没获取到accountID\");\r\n\t\t\t\t\tthis.ErrorCloseGame();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (typeof(reloginSign) == \"undefined\") {\r\n\t\t\t\t\tconsole.log(\"本地内存还没获取到reloginSign\");\r\n\t\t\t\t\tthis.ErrorCloseGame();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tlet signString = \"accountID=\" + accountID.toString() + \"&version=\" + version + \"&\" + reloginSign.toString();\r\n\t\t\t\tlet sign = app.MD5.hex_md5(signString);\r\n\t\t\t\tthis.NetManager.SendReConnect(\"base.C1008Login\", {\r\n\t\t\t\t\t\"accountID\": accountID,\r\n\t\t\t\t\t\"version\": version,\r\n\t\t\t\t\t\"sign\": sign\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t//注册账号结果\r\n\tOnHttpPack_RegAccountResult:function(serverPack){\r\n\t\tlet result = serverPack.Result;\r\n\t\tif(result == 1){\r\n\t\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_RegAccountFind\");\r\n\t\t}\r\n\t\tthis.IsDoLogining(false);\r\n\t},\r\n\r\n\t//修改密码结果\r\n\tOnHttpPack_ChangeAccountPswResult:function(serverPack){\r\n\t\tthis.dataInfo[\"CharAccountPsw\"] = serverPack.Psw;\r\n\r\n\t\tthis.SysNotifyManager.ShowSysMsg(\"Account_ChangeAccountPswSuccess\");\r\n\t},\r\n\r\n\r\n\t//账号服务器登录账号回复\r\n\tOnHttpPack_AccountLogin:function(serverPack){\r\n\t\tthis.dataInfo = serverPack;\r\n\r\n\t\t//每次登陆都覆盖缓存的sdkToken(客户端只记录一个玩家登陆token)\r\n\t\tlet sdkToken = this.dataInfo[\"SDKToken\"];\r\n\t\tlet accountType = this.dataInfo[\"AccountType\"];\r\n\t\tlet accountID = this.dataInfo[\"AccountID\"];\r\n\r\n\t\tlet accessTokenInfo = {};\r\n\t\t//如果是微信APP,sdk授权登录\r\n\t\tif(sdkToken && accountType == this.ShareDefine.SDKType_WeChatApp){\r\n\t\t\taccessTokenInfo = {\r\n\t\t\t\t\"SDKToken\":sdkToken,\r\n\t\t\t\t\"AccountType\":accountType,\r\n\t\t\t\t\"AccountID\":accountID,\r\n\t\t\t};\r\n\t\t}\r\n\t\tconsole.error(\"OnHttpPack_AccountLogin sdkToken:%s, accessTokenInfo:%s\", sdkToken, JSON.stringify(accessTokenInfo));\r\n\t\tthis.LocalDataManager.SetConfigProperty(\"Account\", \"AccessTokenInfo\", accessTokenInfo);\r\n\r\n\r\n\t\t//如果是公司内部账号,需要保存账号记录\r\n\t\tif(accountType == this.ShareDefine.SDKType_Company){\r\n\t\t\tthis.AddNewAccountList(this.dataInfo[\"CharAccount\"], this.dataInfo[\"Token\"])\r\n\t\t}\r\n\r\n        this.NetManager.InitConnectServer();\r\n\r\n    },\r\n\r\n    //----------------------操作函数--------------------\r\n\r\n    //账号密码连接\r\n    AccountLogin:function(charAccount, psw, isToken){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tconsole.error(\"AccountLogin(%s,%s) is doing login\", charAccount, psw);\r\n    \t\treturn\r\n    \t}\r\n    \tthis.IsDoLogining(true);\r\n\r\n\t    let sendPack = this.NetManager.GetHttpSendPack(0xFF03);\r\n\t    sendPack.CharAccount = charAccount;\r\n\t    sendPack.CharAccountPsw = psw;\r\n\t    sendPack.IsToken = isToken;\r\n\t    this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //一键注册账号密码\r\n    OneKeyRegAccount:function(){\r\n\r\n    \tif(this.isDoLogin){\r\n    \t\tconsole.error(\"OneKeyRegAccount is doing login\");\r\n    \t\treturn\r\n    \t}\r\n        this.IsDoLogining(true);\r\n\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF00);\r\n    \tthis.NetManager.SendHttpPack(sendPack);\r\n\r\n    },\r\n\r\n\tSendRegAccount:function(charAccount, accountPsw){\r\n\t\tif(this.isDoLogin){\r\n\t\t\tconsole.error(\"SendRegAccount is doing login\");\r\n\t\t\treturn\r\n\t\t}\r\n\t\tthis.IsDoLogining(true);\r\n\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF07);\r\n\t\tsendPack.CharAccount = charAccount;\r\n\t\tsendPack.Psw = accountPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\tSendChangeAccountPsw:function(accountID, oldPsw, newPsw){\r\n\t\tlet sendPack = this.NetManager.GetHttpSendPack(0xFF08);\r\n\t\tsendPack.AccountID = accountID;\r\n\t\tsendPack.OldPsw = oldPsw;\r\n\t\tsendPack.NewPsw = newPsw;\r\n\t\tthis.NetManager.SendHttpPack(sendPack);\r\n\t},\r\n\r\n\t//sdk授权登录\r\n\t//sdkType:sdk类型\r\n\t//token:授权code\r\n\t//mpID:使用到的对应第3方标示(公众号)\r\n    LoginAccountBySDK:function(sdkType, token, mpID, sdkAccountID){\r\n        if(this.isDoLogin){\r\n\t\t\tconsole.error(\"LoginAccountBySDK is doing (%s,%s) login\", sdkType, token);\r\n\t\t\tthis.IsDoLogining(false);\r\n\t\t\tlet that = this;\r\n\t\t\tcc.director.getScene()._sgNode.scheduleOnce(function(){\r\n//\t\t\t\t\tthat.SysLog(\"LoginAccountBySDK 0123456\");\r\n\t\t\t\t\tthat.IsDoLogining(false);\r\n\t\t\t\t}, 0.5);\r\n            return\r\n        }\r\n        this.IsDoLogining(true);\r\n\r\n\t    if(!sdkAccountID){\r\n\t\t    sdkAccountID = 0;\r\n\t    }\r\n        let sendPack = this.NetManager.GetHttpSendPack(0xFF02);\r\n        sendPack.SDKType = sdkType;\r\n        sendPack.Token = token;\r\n        sendPack.UserData = mpID;\r\n        sendPack.SDKAccountID = sdkAccountID;\r\n        this.NetManager.SendHttpPack(sendPack);\r\n    },\r\n\r\n    //设置是否是在登录\r\n    IsDoLogining:function(state)\r\n    {\r\n        this.isDoLogin = state;\r\n        if (state) {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":1});\r\n        } else {\r\n            app[app.subGameName + \"Client\"].OnEvent(\"ChangeBtnState\", {\"state\":0});\r\n        }\r\n    },\r\n});\r\n\r\nvar g_fjssz_HeroAccountManager = null;\r\n\r\n/**\r\n * 绑定模块外部方法\r\n */\r\nexports.GetModel = function(){\r\n    if(!g_fjssz_HeroAccountManager){\r\n        g_fjssz_HeroAccountManager = new fjssz_HeroAccountManager();\r\n    }\r\n    return g_fjssz_HeroAccountManager;\r\n}"]}